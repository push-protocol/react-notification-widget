import{a as Ka,c as Pe,g as Ba,e as ct,d as Gr,w as Ct,f as Er,b as St,h as ii}from"./index-08116de4.js";import{s as Ks,a as Bs,d as Vs,f as dn}from"./browser-ponyfill-2ed4500a.js";var ni,gn;function Va(){if(gn)return ni;gn=1;function r(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}ni=e;function e(t,i,n){var d=n&&n.stringify||r,_=1;if(typeof t=="object"&&t!==null){var g=i.length+_;if(g===1)return t;var w=new Array(g);w[0]=d(t);for(var I=1;I<g;I++)w[I]=d(i[I]);return w.join(" ")}if(typeof t!="string")return t;var x=i.length;if(x===0)return t;for(var N="",q=1-_,C=-1,A=t&&t.length||0,z=0;z<A;){if(t.charCodeAt(z)===37&&z+1<A){switch(C=C>-1?C:0,t.charCodeAt(z+1)){case 100:case 102:if(q>=x||i[q]==null)break;C<z&&(N+=t.slice(C,z)),N+=Number(i[q]),C=z+2,z++;break;case 105:if(q>=x||i[q]==null)break;C<z&&(N+=t.slice(C,z)),N+=Math.floor(Number(i[q])),C=z+2,z++;break;case 79:case 111:case 106:if(q>=x||i[q]===void 0)break;C<z&&(N+=t.slice(C,z));var j=typeof i[q];if(j==="string"){N+="'"+i[q]+"'",C=z+2,z++;break}if(j==="function"){N+=i[q].name||"<anonymous>",C=z+2,z++;break}N+=d(i[q]),C=z+2,z++;break;case 115:if(q>=x)break;C<z&&(N+=t.slice(C,z)),N+=String(i[q]),C=z+2,z++;break;case 37:C<z&&(N+=t.slice(C,z)),N+="%",C=z+2,z++,q--;break}++q}++z}return C===-1?t:(C<A&&(N+=t.slice(C)),N)}return ni}var si,pn;function Gs(){if(pn)return si;pn=1;const r=Va();si=n;const e=v().console||{},t={mapHttpRequest:A,mapHttpResponse:A,wrapRequestSerializer:z,wrapResponseSerializer:z,wrapErrorSerializer:z,req:A,res:A,err:q};function i(p,s){return Array.isArray(p)?p.filter(function(L){return L!=="!stdSerializers.err"}):p===!0?Object.keys(s):!1}function n(p){p=p||{},p.browser=p.browser||{};const s=p.browser.transmit;if(s&&typeof s.send!="function")throw Error("pino: transmit option must have a send function");const h=p.browser.write||e;p.browser.write&&(p.browser.asObject=!0);const L=p.serializers||{},o=i(p.browser.serialize,L);let c=p.browser.serialize;Array.isArray(p.browser.serialize)&&p.browser.serialize.indexOf("!stdSerializers.err")>-1&&(c=!1);const u=["error","fatal","warn","info","debug","trace"];typeof h=="function"&&(h.error=h.fatal=h.warn=h.info=h.debug=h.trace=h),p.enabled===!1&&(p.level="silent");const y=p.level||"info",l=Object.create(h);l.log||(l.log=j),Object.defineProperty(l,"levelVal",{get:O}),Object.defineProperty(l,"level",{get:P,set:H});const f={transmit:s,serialize:o,asObject:p.browser.asObject,levels:u,timestamp:C(p)};l.levels=n.levels,l.level=y,l.setMaxListeners=l.getMaxListeners=l.emit=l.addListener=l.on=l.prependListener=l.once=l.prependOnceListener=l.removeListener=l.removeAllListeners=l.listeners=l.listenerCount=l.eventNames=l.write=l.flush=j,l.serializers=L,l._serialize=o,l._stdErrSerialize=c,l.child=E,s&&(l._logEvent=N());function O(){return this.level==="silent"?1/0:this.levels.values[this.level]}function P(){return this._level}function H(R){if(R!=="silent"&&!this.levels.values[R])throw Error("unknown level "+R);this._level=R,d(f,l,"error","log"),d(f,l,"fatal","error"),d(f,l,"warn","error"),d(f,l,"info","log"),d(f,l,"debug","log"),d(f,l,"trace","log")}function E(R,B){if(!R)throw new Error("missing bindings for child Pino");B=B||{},o&&R.serializers&&(B.serializers=R.serializers);const K=B.serializers;if(o&&K){var V=Object.assign({},L,K),X=p.browser.serialize===!0?Object.keys(V):o;delete R.serializers,w([R],X,V,this._stdErrSerialize)}function Y(ee){this._childLevel=(ee._childLevel|0)+1,this.error=I(ee,R,"error"),this.fatal=I(ee,R,"fatal"),this.warn=I(ee,R,"warn"),this.info=I(ee,R,"info"),this.debug=I(ee,R,"debug"),this.trace=I(ee,R,"trace"),V&&(this.serializers=V,this._serialize=X),s&&(this._logEvent=N([].concat(ee._logEvent.bindings,R)))}return Y.prototype=this,new Y(this)}return l}n.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},n.stdSerializers=t,n.stdTimeFunctions=Object.assign({},{nullTime:G,epochTime:b,unixTime:D,isoTime:m});function d(p,s,h,L){const o=Object.getPrototypeOf(s);s[h]=s.levelVal>s.levels.values[h]?j:o[h]?o[h]:e[h]||e[L]||j,_(p,s,h)}function _(p,s,h){!p.transmit&&s[h]===j||(s[h]=function(L){return function(){const c=p.timestamp(),u=new Array(arguments.length),y=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var l=0;l<u.length;l++)u[l]=arguments[l];if(p.serialize&&!p.asObject&&w(u,this._serialize,this.serializers,this._stdErrSerialize),p.asObject?L.call(y,g(this,h,u,c)):L.apply(y,u),p.transmit){const f=p.transmit.level||s.level,O=n.levels.values[f],P=n.levels.values[h];if(P<O)return;x(this,{ts:c,methodLevel:h,methodValue:P,transmitLevel:f,transmitValue:n.levels.values[p.transmit.level||s.level],send:p.transmit.send,val:s.levelVal},u)}}}(s[h]))}function g(p,s,h,L){p._serialize&&w(h,p._serialize,p.serializers,p._stdErrSerialize);const o=h.slice();let c=o[0];const u={};L&&(u.time=L),u.level=n.levels.values[s];let y=(p._childLevel|0)+1;if(y<1&&(y=1),c!==null&&typeof c=="object"){for(;y--&&typeof o[0]=="object";)Object.assign(u,o.shift());c=o.length?r(o.shift(),o):void 0}else typeof c=="string"&&(c=r(o.shift(),o));return c!==void 0&&(u.msg=c),u}function w(p,s,h,L){for(const o in p)if(L&&p[o]instanceof Error)p[o]=n.stdSerializers.err(p[o]);else if(typeof p[o]=="object"&&!Array.isArray(p[o]))for(const c in p[o])s&&s.indexOf(c)>-1&&c in h&&(p[o][c]=h[c](p[o][c]))}function I(p,s,h){return function(){const L=new Array(1+arguments.length);L[0]=s;for(var o=1;o<L.length;o++)L[o]=arguments[o-1];return p[h].apply(this,L)}}function x(p,s,h){const L=s.send,o=s.ts,c=s.methodLevel,u=s.methodValue,y=s.val,l=p._logEvent.bindings;w(h,p._serialize||Object.keys(p.serializers),p.serializers,p._stdErrSerialize===void 0?!0:p._stdErrSerialize),p._logEvent.ts=o,p._logEvent.messages=h.filter(function(f){return l.indexOf(f)===-1}),p._logEvent.level.label=c,p._logEvent.level.value=u,L(c,p._logEvent,y),p._logEvent=N(l)}function N(p){return{ts:0,messages:[],bindings:p||[],level:{label:"",value:0}}}function q(p){const s={type:p.constructor.name,msg:p.message,stack:p.stack};for(const h in p)s[h]===void 0&&(s[h]=p[h]);return s}function C(p){return typeof p.timestamp=="function"?p.timestamp:p.timestamp===!1?G:b}function A(){return{}}function z(p){return p}function j(){}function G(){return!1}function b(){return Date.now()}function D(){return Math.round(Date.now()/1e3)}function m(){return new Date(Date.now()).toISOString()}function v(){function p(s){return typeof s<"u"&&s}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return p(self)||p(window)||p(this)||{}}}return si}var Ga=Gs();const Wr=Ka(Ga);var kr={},zr={},Wa={get exports(){return zr},set exports(r){zr=r}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(r){var e,t,i,n,d,_,g,w,I,x,N,q,C,A,z,j,G,b,D,m,v,p,s;(function(h){var L=typeof Pe=="object"?Pe:typeof self=="object"?self:typeof this=="object"?this:{};h(o(L,o(r.exports)));function o(c,u){return c!==L&&(typeof Object.create=="function"?Object.defineProperty(c,"__esModule",{value:!0}):c.__esModule=!0),function(y,l){return c[y]=u?u(y,l):l}}})(function(h){var L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,c){o.__proto__=c}||function(o,c){for(var u in c)c.hasOwnProperty(u)&&(o[u]=c[u])};e=function(o,c){L(o,c);function u(){this.constructor=o}o.prototype=c===null?Object.create(c):(u.prototype=c.prototype,new u)},t=Object.assign||function(o){for(var c,u=1,y=arguments.length;u<y;u++){c=arguments[u];for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(o[l]=c[l])}return o},i=function(o,c){var u={};for(var y in o)Object.prototype.hasOwnProperty.call(o,y)&&c.indexOf(y)<0&&(u[y]=o[y]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,y=Object.getOwnPropertySymbols(o);l<y.length;l++)c.indexOf(y[l])<0&&Object.prototype.propertyIsEnumerable.call(o,y[l])&&(u[y[l]]=o[y[l]]);return u},n=function(o,c,u,y){var l=arguments.length,f=l<3?c:y===null?y=Object.getOwnPropertyDescriptor(c,u):y,O;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,c,u,y);else for(var P=o.length-1;P>=0;P--)(O=o[P])&&(f=(l<3?O(f):l>3?O(c,u,f):O(c,u))||f);return l>3&&f&&Object.defineProperty(c,u,f),f},d=function(o,c){return function(u,y){c(u,y,o)}},_=function(o,c){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,c)},g=function(o,c,u,y){function l(f){return f instanceof u?f:new u(function(O){O(f)})}return new(u||(u=Promise))(function(f,O){function P(R){try{E(y.next(R))}catch(B){O(B)}}function H(R){try{E(y.throw(R))}catch(B){O(B)}}function E(R){R.done?f(R.value):l(R.value).then(P,H)}E((y=y.apply(o,c||[])).next())})},w=function(o,c){var u={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},y,l,f,O;return O={next:P(0),throw:P(1),return:P(2)},typeof Symbol=="function"&&(O[Symbol.iterator]=function(){return this}),O;function P(E){return function(R){return H([E,R])}}function H(E){if(y)throw new TypeError("Generator is already executing.");for(;u;)try{if(y=1,l&&(f=E[0]&2?l.return:E[0]?l.throw||((f=l.return)&&f.call(l),0):l.next)&&!(f=f.call(l,E[1])).done)return f;switch(l=0,f&&(E=[E[0]&2,f.value]),E[0]){case 0:case 1:f=E;break;case 4:return u.label++,{value:E[1],done:!1};case 5:u.label++,l=E[1],E=[0];continue;case 7:E=u.ops.pop(),u.trys.pop();continue;default:if(f=u.trys,!(f=f.length>0&&f[f.length-1])&&(E[0]===6||E[0]===2)){u=0;continue}if(E[0]===3&&(!f||E[1]>f[0]&&E[1]<f[3])){u.label=E[1];break}if(E[0]===6&&u.label<f[1]){u.label=f[1],f=E;break}if(f&&u.label<f[2]){u.label=f[2],u.ops.push(E);break}f[2]&&u.ops.pop(),u.trys.pop();continue}E=c.call(o,u)}catch(R){E=[6,R],l=0}finally{y=f=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}},s=function(o,c,u,y){y===void 0&&(y=u),o[y]=c[u]},I=function(o,c){for(var u in o)u!=="default"&&!c.hasOwnProperty(u)&&(c[u]=o[u])},x=function(o){var c=typeof Symbol=="function"&&Symbol.iterator,u=c&&o[c],y=0;if(u)return u.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&y>=o.length&&(o=void 0),{value:o&&o[y++],done:!o}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")},N=function(o,c){var u=typeof Symbol=="function"&&o[Symbol.iterator];if(!u)return o;var y=u.call(o),l,f=[],O;try{for(;(c===void 0||c-- >0)&&!(l=y.next()).done;)f.push(l.value)}catch(P){O={error:P}}finally{try{l&&!l.done&&(u=y.return)&&u.call(y)}finally{if(O)throw O.error}}return f},q=function(){for(var o=[],c=0;c<arguments.length;c++)o=o.concat(N(arguments[c]));return o},C=function(){for(var o=0,c=0,u=arguments.length;c<u;c++)o+=arguments[c].length;for(var y=Array(o),l=0,c=0;c<u;c++)for(var f=arguments[c],O=0,P=f.length;O<P;O++,l++)y[l]=f[O];return y},A=function(o){return this instanceof A?(this.v=o,this):new A(o)},z=function(o,c,u){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var y=u.apply(o,c||[]),l,f=[];return l={},O("next"),O("throw"),O("return"),l[Symbol.asyncIterator]=function(){return this},l;function O(K){y[K]&&(l[K]=function(V){return new Promise(function(X,Y){f.push([K,V,X,Y])>1||P(K,V)})})}function P(K,V){try{H(y[K](V))}catch(X){B(f[0][3],X)}}function H(K){K.value instanceof A?Promise.resolve(K.value.v).then(E,R):B(f[0][2],K)}function E(K){P("next",K)}function R(K){P("throw",K)}function B(K,V){K(V),f.shift(),f.length&&P(f[0][0],f[0][1])}},j=function(o){var c,u;return c={},y("next"),y("throw",function(l){throw l}),y("return"),c[Symbol.iterator]=function(){return this},c;function y(l,f){c[l]=o[l]?function(O){return(u=!u)?{value:A(o[l](O)),done:l==="return"}:f?f(O):O}:f}},G=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=o[Symbol.asyncIterator],u;return c?c.call(o):(o=typeof x=="function"?x(o):o[Symbol.iterator](),u={},y("next"),y("throw"),y("return"),u[Symbol.asyncIterator]=function(){return this},u);function y(f){u[f]=o[f]&&function(O){return new Promise(function(P,H){O=o[f](O),l(P,H,O.done,O.value)})}}function l(f,O,P,H){Promise.resolve(H).then(function(E){f({value:E,done:P})},O)}},b=function(o,c){return Object.defineProperty?Object.defineProperty(o,"raw",{value:c}):o.raw=c,o},D=function(o){if(o&&o.__esModule)return o;var c={};if(o!=null)for(var u in o)Object.hasOwnProperty.call(o,u)&&(c[u]=o[u]);return c.default=o,c},m=function(o){return o&&o.__esModule?o:{default:o}},v=function(o,c){if(!c.has(o))throw new TypeError("attempted to get private field on non-instance");return c.get(o)},p=function(o,c,u){if(!c.has(o))throw new TypeError("attempted to set private field on non-instance");return c.set(o,u),u},h("__extends",e),h("__assign",t),h("__rest",i),h("__decorate",n),h("__param",d),h("__metadata",_),h("__awaiter",g),h("__generator",w),h("__exportStar",I),h("__createBinding",s),h("__values",x),h("__read",N),h("__spread",q),h("__spreadArrays",C),h("__await",A),h("__asyncGenerator",z),h("__asyncDelegator",j),h("__asyncValues",G),h("__makeTemplateObject",b),h("__importStar",D),h("__importDefault",m),h("__classPrivateFieldGet",v),h("__classPrivateFieldSet",p)})})(Wa);var Dr={};Object.defineProperty(Dr,"__esModule",{value:!0});function ka(r){if(typeof r!="string")throw new Error(`Cannot safe json parse value of type ${typeof r}`);try{return JSON.parse(r)}catch{return r}}Dr.safeJsonParse=ka;function Ya(r){return typeof r=="string"?r:JSON.stringify(r,(e,t)=>typeof t>"u"?null:t)}Dr.safeJsonStringify=Ya;var Hr={},oi={get exports(){return Hr},set exports(r){Hr=r}},yn;function Ja(){return yn||(yn=1,function(){let r;function e(){}r=e,r.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},r.prototype.setItem=function(t,i){this[t]=String(i)},r.prototype.removeItem=function(t){delete this[t]},r.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(i){t[i]=void 0,delete t[i]})},r.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},r.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Pe<"u"&&Pe.localStorage?oi.exports=Pe.localStorage:typeof window<"u"&&window.localStorage?oi.exports=window.localStorage:oi.exports=new e}()),Hr}var ai={},fr={},_n;function Xa(){if(_n)return fr;_n=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.IKeyValueStorage=void 0;class r{}return fr.IKeyValueStorage=r,fr}var hr={},bn;function Za(){if(bn)return hr;bn=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.parseEntry=void 0;const r=Dr;function e(t){var i;return[t[0],r.safeJsonParse((i=t[1])!==null&&i!==void 0?i:"")]}return hr.parseEntry=e,hr}var mn;function Qa(){return mn||(mn=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=zr;e.__exportStar(Xa(),r),e.__exportStar(Za(),r)}(ai)),ai}Object.defineProperty(kr,"__esModule",{value:!0});kr.KeyValueStorage=void 0;const rr=zr,wn=Dr,ec=rr.__importDefault(Ja()),tc=Qa();class Ws{constructor(){this.localStorage=ec.default}getKeys(){return rr.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return rr.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(tc.parseEntry)})}getItem(e){return rr.__awaiter(this,void 0,void 0,function*(){const t=this.localStorage.getItem(e);if(t!==null)return wn.safeJsonParse(t)})}setItem(e,t){return rr.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,wn.safeJsonStringify(t))})}removeItem(e){return rr.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}kr.KeyValueStorage=Ws;var rc=kr.default=Ws,Sr={},ir={},ic={get exports(){return ir},set exports(r){ir=r}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(r){var e,t,i,n,d,_,g,w,I,x,N,q,C,A,z,j,G,b,D,m,v,p,s;(function(h){var L=typeof Pe=="object"?Pe:typeof self=="object"?self:typeof this=="object"?this:{};h(o(L,o(r.exports)));function o(c,u){return c!==L&&(typeof Object.create=="function"?Object.defineProperty(c,"__esModule",{value:!0}):c.__esModule=!0),function(y,l){return c[y]=u?u(y,l):l}}})(function(h){var L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,c){o.__proto__=c}||function(o,c){for(var u in c)c.hasOwnProperty(u)&&(o[u]=c[u])};e=function(o,c){L(o,c);function u(){this.constructor=o}o.prototype=c===null?Object.create(c):(u.prototype=c.prototype,new u)},t=Object.assign||function(o){for(var c,u=1,y=arguments.length;u<y;u++){c=arguments[u];for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(o[l]=c[l])}return o},i=function(o,c){var u={};for(var y in o)Object.prototype.hasOwnProperty.call(o,y)&&c.indexOf(y)<0&&(u[y]=o[y]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,y=Object.getOwnPropertySymbols(o);l<y.length;l++)c.indexOf(y[l])<0&&Object.prototype.propertyIsEnumerable.call(o,y[l])&&(u[y[l]]=o[y[l]]);return u},n=function(o,c,u,y){var l=arguments.length,f=l<3?c:y===null?y=Object.getOwnPropertyDescriptor(c,u):y,O;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,c,u,y);else for(var P=o.length-1;P>=0;P--)(O=o[P])&&(f=(l<3?O(f):l>3?O(c,u,f):O(c,u))||f);return l>3&&f&&Object.defineProperty(c,u,f),f},d=function(o,c){return function(u,y){c(u,y,o)}},_=function(o,c){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,c)},g=function(o,c,u,y){function l(f){return f instanceof u?f:new u(function(O){O(f)})}return new(u||(u=Promise))(function(f,O){function P(R){try{E(y.next(R))}catch(B){O(B)}}function H(R){try{E(y.throw(R))}catch(B){O(B)}}function E(R){R.done?f(R.value):l(R.value).then(P,H)}E((y=y.apply(o,c||[])).next())})},w=function(o,c){var u={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},y,l,f,O;return O={next:P(0),throw:P(1),return:P(2)},typeof Symbol=="function"&&(O[Symbol.iterator]=function(){return this}),O;function P(E){return function(R){return H([E,R])}}function H(E){if(y)throw new TypeError("Generator is already executing.");for(;u;)try{if(y=1,l&&(f=E[0]&2?l.return:E[0]?l.throw||((f=l.return)&&f.call(l),0):l.next)&&!(f=f.call(l,E[1])).done)return f;switch(l=0,f&&(E=[E[0]&2,f.value]),E[0]){case 0:case 1:f=E;break;case 4:return u.label++,{value:E[1],done:!1};case 5:u.label++,l=E[1],E=[0];continue;case 7:E=u.ops.pop(),u.trys.pop();continue;default:if(f=u.trys,!(f=f.length>0&&f[f.length-1])&&(E[0]===6||E[0]===2)){u=0;continue}if(E[0]===3&&(!f||E[1]>f[0]&&E[1]<f[3])){u.label=E[1];break}if(E[0]===6&&u.label<f[1]){u.label=f[1],f=E;break}if(f&&u.label<f[2]){u.label=f[2],u.ops.push(E);break}f[2]&&u.ops.pop(),u.trys.pop();continue}E=c.call(o,u)}catch(R){E=[6,R],l=0}finally{y=f=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}},s=function(o,c,u,y){y===void 0&&(y=u),o[y]=c[u]},I=function(o,c){for(var u in o)u!=="default"&&!c.hasOwnProperty(u)&&(c[u]=o[u])},x=function(o){var c=typeof Symbol=="function"&&Symbol.iterator,u=c&&o[c],y=0;if(u)return u.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&y>=o.length&&(o=void 0),{value:o&&o[y++],done:!o}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")},N=function(o,c){var u=typeof Symbol=="function"&&o[Symbol.iterator];if(!u)return o;var y=u.call(o),l,f=[],O;try{for(;(c===void 0||c-- >0)&&!(l=y.next()).done;)f.push(l.value)}catch(P){O={error:P}}finally{try{l&&!l.done&&(u=y.return)&&u.call(y)}finally{if(O)throw O.error}}return f},q=function(){for(var o=[],c=0;c<arguments.length;c++)o=o.concat(N(arguments[c]));return o},C=function(){for(var o=0,c=0,u=arguments.length;c<u;c++)o+=arguments[c].length;for(var y=Array(o),l=0,c=0;c<u;c++)for(var f=arguments[c],O=0,P=f.length;O<P;O++,l++)y[l]=f[O];return y},A=function(o){return this instanceof A?(this.v=o,this):new A(o)},z=function(o,c,u){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var y=u.apply(o,c||[]),l,f=[];return l={},O("next"),O("throw"),O("return"),l[Symbol.asyncIterator]=function(){return this},l;function O(K){y[K]&&(l[K]=function(V){return new Promise(function(X,Y){f.push([K,V,X,Y])>1||P(K,V)})})}function P(K,V){try{H(y[K](V))}catch(X){B(f[0][3],X)}}function H(K){K.value instanceof A?Promise.resolve(K.value.v).then(E,R):B(f[0][2],K)}function E(K){P("next",K)}function R(K){P("throw",K)}function B(K,V){K(V),f.shift(),f.length&&P(f[0][0],f[0][1])}},j=function(o){var c,u;return c={},y("next"),y("throw",function(l){throw l}),y("return"),c[Symbol.iterator]=function(){return this},c;function y(l,f){c[l]=o[l]?function(O){return(u=!u)?{value:A(o[l](O)),done:l==="return"}:f?f(O):O}:f}},G=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=o[Symbol.asyncIterator],u;return c?c.call(o):(o=typeof x=="function"?x(o):o[Symbol.iterator](),u={},y("next"),y("throw"),y("return"),u[Symbol.asyncIterator]=function(){return this},u);function y(f){u[f]=o[f]&&function(O){return new Promise(function(P,H){O=o[f](O),l(P,H,O.done,O.value)})}}function l(f,O,P,H){Promise.resolve(H).then(function(E){f({value:E,done:P})},O)}},b=function(o,c){return Object.defineProperty?Object.defineProperty(o,"raw",{value:c}):o.raw=c,o},D=function(o){if(o&&o.__esModule)return o;var c={};if(o!=null)for(var u in o)Object.hasOwnProperty.call(o,u)&&(c[u]=o[u]);return c.default=o,c},m=function(o){return o&&o.__esModule?o:{default:o}},v=function(o,c){if(!c.has(o))throw new TypeError("attempted to get private field on non-instance");return c.get(o)},p=function(o,c,u){if(!c.has(o))throw new TypeError("attempted to set private field on non-instance");return c.set(o,u),u},h("__extends",e),h("__assign",t),h("__rest",i),h("__decorate",n),h("__param",d),h("__metadata",_),h("__awaiter",g),h("__generator",w),h("__exportStar",I),h("__createBinding",s),h("__values",x),h("__read",N),h("__spread",q),h("__spreadArrays",C),h("__await",A),h("__asyncGenerator",z),h("__asyncDelegator",j),h("__asyncValues",G),h("__makeTemplateObject",b),h("__importStar",D),h("__importDefault",m),h("__classPrivateFieldGet",v),h("__classPrivateFieldSet",p)})})(ic);var lr={},te={},nr={},nc={get exports(){return nr},set exports(r){nr=r}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(r){var e,t,i,n,d,_,g,w,I,x,N,q,C,A,z,j,G,b,D,m,v,p,s;(function(h){var L=typeof Pe=="object"?Pe:typeof self=="object"?self:typeof this=="object"?this:{};h(o(L,o(r.exports)));function o(c,u){return c!==L&&(typeof Object.create=="function"?Object.defineProperty(c,"__esModule",{value:!0}):c.__esModule=!0),function(y,l){return c[y]=u?u(y,l):l}}})(function(h){var L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,c){o.__proto__=c}||function(o,c){for(var u in c)c.hasOwnProperty(u)&&(o[u]=c[u])};e=function(o,c){L(o,c);function u(){this.constructor=o}o.prototype=c===null?Object.create(c):(u.prototype=c.prototype,new u)},t=Object.assign||function(o){for(var c,u=1,y=arguments.length;u<y;u++){c=arguments[u];for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(o[l]=c[l])}return o},i=function(o,c){var u={};for(var y in o)Object.prototype.hasOwnProperty.call(o,y)&&c.indexOf(y)<0&&(u[y]=o[y]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,y=Object.getOwnPropertySymbols(o);l<y.length;l++)c.indexOf(y[l])<0&&Object.prototype.propertyIsEnumerable.call(o,y[l])&&(u[y[l]]=o[y[l]]);return u},n=function(o,c,u,y){var l=arguments.length,f=l<3?c:y===null?y=Object.getOwnPropertyDescriptor(c,u):y,O;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,c,u,y);else for(var P=o.length-1;P>=0;P--)(O=o[P])&&(f=(l<3?O(f):l>3?O(c,u,f):O(c,u))||f);return l>3&&f&&Object.defineProperty(c,u,f),f},d=function(o,c){return function(u,y){c(u,y,o)}},_=function(o,c){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,c)},g=function(o,c,u,y){function l(f){return f instanceof u?f:new u(function(O){O(f)})}return new(u||(u=Promise))(function(f,O){function P(R){try{E(y.next(R))}catch(B){O(B)}}function H(R){try{E(y.throw(R))}catch(B){O(B)}}function E(R){R.done?f(R.value):l(R.value).then(P,H)}E((y=y.apply(o,c||[])).next())})},w=function(o,c){var u={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},y,l,f,O;return O={next:P(0),throw:P(1),return:P(2)},typeof Symbol=="function"&&(O[Symbol.iterator]=function(){return this}),O;function P(E){return function(R){return H([E,R])}}function H(E){if(y)throw new TypeError("Generator is already executing.");for(;u;)try{if(y=1,l&&(f=E[0]&2?l.return:E[0]?l.throw||((f=l.return)&&f.call(l),0):l.next)&&!(f=f.call(l,E[1])).done)return f;switch(l=0,f&&(E=[E[0]&2,f.value]),E[0]){case 0:case 1:f=E;break;case 4:return u.label++,{value:E[1],done:!1};case 5:u.label++,l=E[1],E=[0];continue;case 7:E=u.ops.pop(),u.trys.pop();continue;default:if(f=u.trys,!(f=f.length>0&&f[f.length-1])&&(E[0]===6||E[0]===2)){u=0;continue}if(E[0]===3&&(!f||E[1]>f[0]&&E[1]<f[3])){u.label=E[1];break}if(E[0]===6&&u.label<f[1]){u.label=f[1],f=E;break}if(f&&u.label<f[2]){u.label=f[2],u.ops.push(E);break}f[2]&&u.ops.pop(),u.trys.pop();continue}E=c.call(o,u)}catch(R){E=[6,R],l=0}finally{y=f=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}},s=function(o,c,u,y){y===void 0&&(y=u),o[y]=c[u]},I=function(o,c){for(var u in o)u!=="default"&&!c.hasOwnProperty(u)&&(c[u]=o[u])},x=function(o){var c=typeof Symbol=="function"&&Symbol.iterator,u=c&&o[c],y=0;if(u)return u.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&y>=o.length&&(o=void 0),{value:o&&o[y++],done:!o}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")},N=function(o,c){var u=typeof Symbol=="function"&&o[Symbol.iterator];if(!u)return o;var y=u.call(o),l,f=[],O;try{for(;(c===void 0||c-- >0)&&!(l=y.next()).done;)f.push(l.value)}catch(P){O={error:P}}finally{try{l&&!l.done&&(u=y.return)&&u.call(y)}finally{if(O)throw O.error}}return f},q=function(){for(var o=[],c=0;c<arguments.length;c++)o=o.concat(N(arguments[c]));return o},C=function(){for(var o=0,c=0,u=arguments.length;c<u;c++)o+=arguments[c].length;for(var y=Array(o),l=0,c=0;c<u;c++)for(var f=arguments[c],O=0,P=f.length;O<P;O++,l++)y[l]=f[O];return y},A=function(o){return this instanceof A?(this.v=o,this):new A(o)},z=function(o,c,u){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var y=u.apply(o,c||[]),l,f=[];return l={},O("next"),O("throw"),O("return"),l[Symbol.asyncIterator]=function(){return this},l;function O(K){y[K]&&(l[K]=function(V){return new Promise(function(X,Y){f.push([K,V,X,Y])>1||P(K,V)})})}function P(K,V){try{H(y[K](V))}catch(X){B(f[0][3],X)}}function H(K){K.value instanceof A?Promise.resolve(K.value.v).then(E,R):B(f[0][2],K)}function E(K){P("next",K)}function R(K){P("throw",K)}function B(K,V){K(V),f.shift(),f.length&&P(f[0][0],f[0][1])}},j=function(o){var c,u;return c={},y("next"),y("throw",function(l){throw l}),y("return"),c[Symbol.iterator]=function(){return this},c;function y(l,f){c[l]=o[l]?function(O){return(u=!u)?{value:A(o[l](O)),done:l==="return"}:f?f(O):O}:f}},G=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=o[Symbol.asyncIterator],u;return c?c.call(o):(o=typeof x=="function"?x(o):o[Symbol.iterator](),u={},y("next"),y("throw"),y("return"),u[Symbol.asyncIterator]=function(){return this},u);function y(f){u[f]=o[f]&&function(O){return new Promise(function(P,H){O=o[f](O),l(P,H,O.done,O.value)})}}function l(f,O,P,H){Promise.resolve(H).then(function(E){f({value:E,done:P})},O)}},b=function(o,c){return Object.defineProperty?Object.defineProperty(o,"raw",{value:c}):o.raw=c,o},D=function(o){if(o&&o.__esModule)return o;var c={};if(o!=null)for(var u in o)Object.hasOwnProperty.call(o,u)&&(c[u]=o[u]);return c.default=o,c},m=function(o){return o&&o.__esModule?o:{default:o}},v=function(o,c){if(!c.has(o))throw new TypeError("attempted to get private field on non-instance");return c.get(o)},p=function(o,c,u){if(!c.has(o))throw new TypeError("attempted to set private field on non-instance");return c.set(o,u),u},h("__extends",e),h("__assign",t),h("__rest",i),h("__decorate",n),h("__param",d),h("__metadata",_),h("__awaiter",g),h("__generator",w),h("__exportStar",I),h("__createBinding",s),h("__values",x),h("__read",N),h("__spread",q),h("__spreadArrays",C),h("__await",A),h("__asyncGenerator",z),h("__asyncDelegator",j),h("__asyncValues",G),h("__makeTemplateObject",b),h("__importStar",D),h("__importDefault",m),h("__classPrivateFieldGet",v),h("__classPrivateFieldSet",p)})})(nc);var ci={},dr={},vn;function sc(){if(vn)return dr;vn=1,Object.defineProperty(dr,"__esModule",{value:!0}),dr.delay=void 0;function r(e){return new Promise(t=>{setTimeout(()=>{t(!0)},e)})}return dr.delay=r,dr}var Vt={},ui={},Gt={},En;function oc(){return En||(En=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.ONE_THOUSAND=Gt.ONE_HUNDRED=void 0,Gt.ONE_HUNDRED=100,Gt.ONE_THOUSAND=1e3),Gt}var fi={},Dn;function ac(){return Dn||(Dn=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ONE_YEAR=r.FOUR_WEEKS=r.THREE_WEEKS=r.TWO_WEEKS=r.ONE_WEEK=r.THIRTY_DAYS=r.SEVEN_DAYS=r.FIVE_DAYS=r.THREE_DAYS=r.ONE_DAY=r.TWENTY_FOUR_HOURS=r.TWELVE_HOURS=r.SIX_HOURS=r.THREE_HOURS=r.ONE_HOUR=r.SIXTY_MINUTES=r.THIRTY_MINUTES=r.TEN_MINUTES=r.FIVE_MINUTES=r.ONE_MINUTE=r.SIXTY_SECONDS=r.THIRTY_SECONDS=r.TEN_SECONDS=r.FIVE_SECONDS=r.ONE_SECOND=void 0,r.ONE_SECOND=1,r.FIVE_SECONDS=5,r.TEN_SECONDS=10,r.THIRTY_SECONDS=30,r.SIXTY_SECONDS=60,r.ONE_MINUTE=r.SIXTY_SECONDS,r.FIVE_MINUTES=r.ONE_MINUTE*5,r.TEN_MINUTES=r.ONE_MINUTE*10,r.THIRTY_MINUTES=r.ONE_MINUTE*30,r.SIXTY_MINUTES=r.ONE_MINUTE*60,r.ONE_HOUR=r.SIXTY_MINUTES,r.THREE_HOURS=r.ONE_HOUR*3,r.SIX_HOURS=r.ONE_HOUR*6,r.TWELVE_HOURS=r.ONE_HOUR*12,r.TWENTY_FOUR_HOURS=r.ONE_HOUR*24,r.ONE_DAY=r.TWENTY_FOUR_HOURS,r.THREE_DAYS=r.ONE_DAY*3,r.FIVE_DAYS=r.ONE_DAY*5,r.SEVEN_DAYS=r.ONE_DAY*7,r.THIRTY_DAYS=r.ONE_DAY*30,r.ONE_WEEK=r.SEVEN_DAYS,r.TWO_WEEKS=r.ONE_WEEK*2,r.THREE_WEEKS=r.ONE_WEEK*3,r.FOUR_WEEKS=r.ONE_WEEK*4,r.ONE_YEAR=r.ONE_DAY*365}(fi)),fi}var Sn;function ks(){return Sn||(Sn=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=nr;e.__exportStar(oc(),r),e.__exportStar(ac(),r)}(ui)),ui}var On;function cc(){if(On)return Vt;On=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.fromMiliseconds=Vt.toMiliseconds=void 0;const r=ks();function e(i){return i*r.ONE_THOUSAND}Vt.toMiliseconds=e;function t(i){return Math.floor(i/r.ONE_THOUSAND)}return Vt.fromMiliseconds=t,Vt}var xn;function uc(){return xn||(xn=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=nr;e.__exportStar(sc(),r),e.__exportStar(cc(),r)}(ci)),ci}var tr={},In;function fc(){if(In)return tr;In=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.Watch=void 0;class r{constructor(){this.timestamps=new Map}start(t){if(this.timestamps.has(t))throw new Error(`Watch already started for label: ${t}`);this.timestamps.set(t,{started:Date.now()})}stop(t){const i=this.get(t);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${t}`);const n=Date.now()-i.started;this.timestamps.set(t,{started:i.started,elapsed:n})}get(t){const i=this.timestamps.get(t);if(typeof i>"u")throw new Error(`No timestamp found for label: ${t}`);return i}elapsed(t){const i=this.get(t);return i.elapsed||Date.now()-i.started}}return tr.Watch=r,tr.default=r,tr}var hi={},gr={},Tn;function hc(){if(Tn)return gr;Tn=1,Object.defineProperty(gr,"__esModule",{value:!0}),gr.IWatch=void 0;class r{}return gr.IWatch=r,gr}var Pn;function lc(){return Pn||(Pn=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),nr.__exportStar(hc(),r)}(hi)),hi}(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=nr;e.__exportStar(uc(),r),e.__exportStar(fc(),r),e.__exportStar(lc(),r),e.__exportStar(ks(),r)})(te);var li={},pr={};let Jt=class{};const dc=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Jt},Symbol.toStringTag,{value:"Module"})),gc=Ba(dc);var An;function pc(){if(An)return pr;An=1,Object.defineProperty(pr,"__esModule",{value:!0}),pr.IHeartBeat=void 0;const r=gc;class e extends r.IEvents{constructor(i){super()}}return pr.IHeartBeat=e,pr}var Nn;function Ys(){return Nn||(Nn=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),ir.__exportStar(pc(),r)}(li)),li}var di={},Wt={},Cn;function yc(){if(Cn)return Wt;Cn=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.HEARTBEAT_EVENTS=Wt.HEARTBEAT_INTERVAL=void 0;const r=te;return Wt.HEARTBEAT_INTERVAL=r.FIVE_SECONDS,Wt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Wt}var Rn;function Js(){return Rn||(Rn=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),ir.__exportStar(yc(),r)}(di)),di}var Fn;function _c(){if(Fn)return lr;Fn=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.HeartBeat=void 0;const r=ir,e=ct,t=te,i=Ys(),n=Js();class d extends i.IHeartBeat{constructor(g){super(g),this.events=new e.EventEmitter,this.interval=n.HEARTBEAT_INTERVAL,this.interval=(g==null?void 0:g.interval)||n.HEARTBEAT_INTERVAL}static init(g){return r.__awaiter(this,void 0,void 0,function*(){const w=new d(g);return yield w.init(),w})}init(){return r.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}on(g,w){this.events.on(g,w)}once(g,w){this.events.once(g,w)}off(g,w){this.events.off(g,w)}removeListener(g,w){this.events.removeListener(g,w)}initialize(){return r.__awaiter(this,void 0,void 0,function*(){setInterval(()=>this.pulse(),t.toMiliseconds(this.interval))})}pulse(){this.events.emit(n.HEARTBEAT_EVENTS.pulse)}}return lr.HeartBeat=d,lr}(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=ir;e.__exportStar(_c(),r),e.__exportStar(Ys(),r),e.__exportStar(Js(),r)})(Sr);var De={},wi={},bc={get exports(){return wi},set exports(r){wi=r}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(r){var e,t,i,n,d,_,g,w,I,x,N,q,C,A,z,j,G,b,D,m,v,p,s;(function(h){var L=typeof Pe=="object"?Pe:typeof self=="object"?self:typeof this=="object"?this:{};h(o(L,o(r.exports)));function o(c,u){return c!==L&&(typeof Object.create=="function"?Object.defineProperty(c,"__esModule",{value:!0}):c.__esModule=!0),function(y,l){return c[y]=u?u(y,l):l}}})(function(h){var L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,c){o.__proto__=c}||function(o,c){for(var u in c)c.hasOwnProperty(u)&&(o[u]=c[u])};e=function(o,c){L(o,c);function u(){this.constructor=o}o.prototype=c===null?Object.create(c):(u.prototype=c.prototype,new u)},t=Object.assign||function(o){for(var c,u=1,y=arguments.length;u<y;u++){c=arguments[u];for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(o[l]=c[l])}return o},i=function(o,c){var u={};for(var y in o)Object.prototype.hasOwnProperty.call(o,y)&&c.indexOf(y)<0&&(u[y]=o[y]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,y=Object.getOwnPropertySymbols(o);l<y.length;l++)c.indexOf(y[l])<0&&Object.prototype.propertyIsEnumerable.call(o,y[l])&&(u[y[l]]=o[y[l]]);return u},n=function(o,c,u,y){var l=arguments.length,f=l<3?c:y===null?y=Object.getOwnPropertyDescriptor(c,u):y,O;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,c,u,y);else for(var P=o.length-1;P>=0;P--)(O=o[P])&&(f=(l<3?O(f):l>3?O(c,u,f):O(c,u))||f);return l>3&&f&&Object.defineProperty(c,u,f),f},d=function(o,c){return function(u,y){c(u,y,o)}},_=function(o,c){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,c)},g=function(o,c,u,y){function l(f){return f instanceof u?f:new u(function(O){O(f)})}return new(u||(u=Promise))(function(f,O){function P(R){try{E(y.next(R))}catch(B){O(B)}}function H(R){try{E(y.throw(R))}catch(B){O(B)}}function E(R){R.done?f(R.value):l(R.value).then(P,H)}E((y=y.apply(o,c||[])).next())})},w=function(o,c){var u={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},y,l,f,O;return O={next:P(0),throw:P(1),return:P(2)},typeof Symbol=="function"&&(O[Symbol.iterator]=function(){return this}),O;function P(E){return function(R){return H([E,R])}}function H(E){if(y)throw new TypeError("Generator is already executing.");for(;u;)try{if(y=1,l&&(f=E[0]&2?l.return:E[0]?l.throw||((f=l.return)&&f.call(l),0):l.next)&&!(f=f.call(l,E[1])).done)return f;switch(l=0,f&&(E=[E[0]&2,f.value]),E[0]){case 0:case 1:f=E;break;case 4:return u.label++,{value:E[1],done:!1};case 5:u.label++,l=E[1],E=[0];continue;case 7:E=u.ops.pop(),u.trys.pop();continue;default:if(f=u.trys,!(f=f.length>0&&f[f.length-1])&&(E[0]===6||E[0]===2)){u=0;continue}if(E[0]===3&&(!f||E[1]>f[0]&&E[1]<f[3])){u.label=E[1];break}if(E[0]===6&&u.label<f[1]){u.label=f[1],f=E;break}if(f&&u.label<f[2]){u.label=f[2],u.ops.push(E);break}f[2]&&u.ops.pop(),u.trys.pop();continue}E=c.call(o,u)}catch(R){E=[6,R],l=0}finally{y=f=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}},s=function(o,c,u,y){y===void 0&&(y=u),o[y]=c[u]},I=function(o,c){for(var u in o)u!=="default"&&!c.hasOwnProperty(u)&&(c[u]=o[u])},x=function(o){var c=typeof Symbol=="function"&&Symbol.iterator,u=c&&o[c],y=0;if(u)return u.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&y>=o.length&&(o=void 0),{value:o&&o[y++],done:!o}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")},N=function(o,c){var u=typeof Symbol=="function"&&o[Symbol.iterator];if(!u)return o;var y=u.call(o),l,f=[],O;try{for(;(c===void 0||c-- >0)&&!(l=y.next()).done;)f.push(l.value)}catch(P){O={error:P}}finally{try{l&&!l.done&&(u=y.return)&&u.call(y)}finally{if(O)throw O.error}}return f},q=function(){for(var o=[],c=0;c<arguments.length;c++)o=o.concat(N(arguments[c]));return o},C=function(){for(var o=0,c=0,u=arguments.length;c<u;c++)o+=arguments[c].length;for(var y=Array(o),l=0,c=0;c<u;c++)for(var f=arguments[c],O=0,P=f.length;O<P;O++,l++)y[l]=f[O];return y},A=function(o){return this instanceof A?(this.v=o,this):new A(o)},z=function(o,c,u){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var y=u.apply(o,c||[]),l,f=[];return l={},O("next"),O("throw"),O("return"),l[Symbol.asyncIterator]=function(){return this},l;function O(K){y[K]&&(l[K]=function(V){return new Promise(function(X,Y){f.push([K,V,X,Y])>1||P(K,V)})})}function P(K,V){try{H(y[K](V))}catch(X){B(f[0][3],X)}}function H(K){K.value instanceof A?Promise.resolve(K.value.v).then(E,R):B(f[0][2],K)}function E(K){P("next",K)}function R(K){P("throw",K)}function B(K,V){K(V),f.shift(),f.length&&P(f[0][0],f[0][1])}},j=function(o){var c,u;return c={},y("next"),y("throw",function(l){throw l}),y("return"),c[Symbol.iterator]=function(){return this},c;function y(l,f){c[l]=o[l]?function(O){return(u=!u)?{value:A(o[l](O)),done:l==="return"}:f?f(O):O}:f}},G=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=o[Symbol.asyncIterator],u;return c?c.call(o):(o=typeof x=="function"?x(o):o[Symbol.iterator](),u={},y("next"),y("throw"),y("return"),u[Symbol.asyncIterator]=function(){return this},u);function y(f){u[f]=o[f]&&function(O){return new Promise(function(P,H){O=o[f](O),l(P,H,O.done,O.value)})}}function l(f,O,P,H){Promise.resolve(H).then(function(E){f({value:E,done:P})},O)}},b=function(o,c){return Object.defineProperty?Object.defineProperty(o,"raw",{value:c}):o.raw=c,o},D=function(o){if(o&&o.__esModule)return o;var c={};if(o!=null)for(var u in o)Object.hasOwnProperty.call(o,u)&&(c[u]=o[u]);return c.default=o,c},m=function(o){return o&&o.__esModule?o:{default:o}},v=function(o,c){if(!c.has(o))throw new TypeError("attempted to get private field on non-instance");return c.get(o)},p=function(o,c,u){if(!c.has(o))throw new TypeError("attempted to set private field on non-instance");return c.set(o,u),u},h("__extends",e),h("__assign",t),h("__rest",i),h("__decorate",n),h("__param",d),h("__metadata",_),h("__awaiter",g),h("__generator",w),h("__exportStar",I),h("__createBinding",s),h("__values",x),h("__read",N),h("__spread",q),h("__spreadArrays",C),h("__await",A),h("__asyncGenerator",z),h("__asyncDelegator",j),h("__asyncValues",G),h("__makeTemplateObject",b),h("__importStar",D),h("__importDefault",m),h("__classPrivateFieldGet",v),h("__classPrivateFieldSet",p)})})(bc);var kt={},Un;function Xs(){return Un||(Un=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.PINO_CUSTOM_CONTEXT_KEY=kt.PINO_LOGGER_DEFAULTS=void 0,kt.PINO_LOGGER_DEFAULTS={level:"info"},kt.PINO_CUSTOM_CONTEXT_KEY="custom_context"),kt}var it={},jn;function mc(){if(jn)return it;jn=1,Object.defineProperty(it,"__esModule",{value:!0}),it.generateChildLogger=it.formatChildLoggerContext=it.getLoggerContext=it.setBrowserLoggerContext=it.getBrowserLoggerContext=it.getDefaultLoggerOptions=void 0;const r=Xs();function e(g){return Object.assign(Object.assign({},g),{level:(g==null?void 0:g.level)||r.PINO_LOGGER_DEFAULTS.level})}it.getDefaultLoggerOptions=e;function t(g,w=r.PINO_CUSTOM_CONTEXT_KEY){return g[w]||""}it.getBrowserLoggerContext=t;function i(g,w,I=r.PINO_CUSTOM_CONTEXT_KEY){return g[I]=w,g}it.setBrowserLoggerContext=i;function n(g,w=r.PINO_CUSTOM_CONTEXT_KEY){let I="";return typeof g.bindings>"u"?I=t(g,w):I=g.bindings().context||"",I}it.getLoggerContext=n;function d(g,w,I=r.PINO_CUSTOM_CONTEXT_KEY){const x=n(g,I);return x.trim()?`${x}/${w}`:w}it.formatChildLoggerContext=d;function _(g,w,I=r.PINO_CUSTOM_CONTEXT_KEY){const x=d(g,w,I),N=g.child({context:x});return i(N,x,I)}return it.generateChildLogger=_,it}(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.pino=void 0;const e=wi,t=e.__importDefault(Gs());Object.defineProperty(r,"pino",{enumerable:!0,get:function(){return t.default}}),e.__exportStar(Xs(),r),e.__exportStar(mc(),r)})(De);class wc extends Jt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}let vc=class extends Jt{constructor(e,t){super(),this.core=e,this.logger=t,this.records=new Map}},Ec=class{constructor(e,t){this.logger=e,this.core=t}},Dc=class extends Jt{constructor(e,t){super(),this.relayer=e,this.logger=t}};class Sc extends Jt{constructor(e){super()}}let Oc=class{constructor(e,t,i,n){this.core=e,this.logger=t,this.name=i}};class xc extends Jt{constructor(e,t){super(),this.relayer=e,this.logger=t}}let Ic=class extends Jt{constructor(e,t){super(),this.core=e,this.logger=t}},Tc=class{constructor(e){this.opts=e,this.protocol="wc",this.version=2}},Pc=class{constructor(e){this.client=e}};function Ni(r){if(typeof r!="string")throw new Error(`Cannot safe json parse value of type ${typeof r}`);try{return JSON.parse(r)}catch{return r}}function wr(r){return typeof r=="string"?r:JSON.stringify(r)}var Ci={},Zs={};(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=Gr,t=Ct;r.DIGEST_LENGTH=64,r.BLOCK_SIZE=128;var i=function(){function g(){this.digestLength=r.DIGEST_LENGTH,this.blockSize=r.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return g.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},g.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},g.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._tempHi),t.wipe(this._tempLo),this.reset()},g.prototype.update=function(w,I){if(I===void 0&&(I=w.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var x=0;if(this._bytesHashed+=I,this._bufferLength>0){for(;this._bufferLength<r.BLOCK_SIZE&&I>0;)this._buffer[this._bufferLength++]=w[x++],I--;this._bufferLength===this.blockSize&&(d(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(I>=this.blockSize&&(x=d(this._tempHi,this._tempLo,this._stateHi,this._stateLo,w,x,I),I%=this.blockSize);I>0;)this._buffer[this._bufferLength++]=w[x++],I--;return this},g.prototype.finish=function(w){if(!this._finished){var I=this._bytesHashed,x=this._bufferLength,N=I/536870912|0,q=I<<3,C=I%128<112?128:256;this._buffer[x]=128;for(var A=x+1;A<C-8;A++)this._buffer[A]=0;e.writeUint32BE(N,this._buffer,C-8),e.writeUint32BE(q,this._buffer,C-4),d(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,C),this._finished=!0}for(var A=0;A<this.digestLength/8;A++)e.writeUint32BE(this._stateHi[A],w,A*8),e.writeUint32BE(this._stateLo[A],w,A*8+4);return this},g.prototype.digest=function(){var w=new Uint8Array(this.digestLength);return this.finish(w),w},g.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},g.prototype.restoreState=function(w){return this._stateHi.set(w.stateHi),this._stateLo.set(w.stateLo),this._bufferLength=w.bufferLength,w.buffer&&this._buffer.set(w.buffer),this._bytesHashed=w.bytesHashed,this._finished=!1,this},g.prototype.cleanSavedState=function(w){t.wipe(w.stateHi),t.wipe(w.stateLo),w.buffer&&t.wipe(w.buffer),w.bufferLength=0,w.bytesHashed=0},g}();r.SHA512=i;var n=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function d(g,w,I,x,N,q,C){for(var A=I[0],z=I[1],j=I[2],G=I[3],b=I[4],D=I[5],m=I[6],v=I[7],p=x[0],s=x[1],h=x[2],L=x[3],o=x[4],c=x[5],u=x[6],y=x[7],l,f,O,P,H,E,R,B;C>=128;){for(var K=0;K<16;K++){var V=8*K+q;g[K]=e.readUint32BE(N,V),w[K]=e.readUint32BE(N,V+4)}for(var K=0;K<80;K++){var X=A,Y=z,ee=j,$=G,M=b,F=D,a=m,T=v,k=p,Z=s,fe=h,ye=L,le=o,me=c,Fe=u,Ae=y;if(l=v,f=y,H=f&65535,E=f>>>16,R=l&65535,B=l>>>16,l=(b>>>14|o<<32-14)^(b>>>18|o<<32-18)^(o>>>41-32|b<<32-(41-32)),f=(o>>>14|b<<32-14)^(o>>>18|b<<32-18)^(b>>>41-32|o<<32-(41-32)),H+=f&65535,E+=f>>>16,R+=l&65535,B+=l>>>16,l=b&D^~b&m,f=o&c^~o&u,H+=f&65535,E+=f>>>16,R+=l&65535,B+=l>>>16,l=n[K*2],f=n[K*2+1],H+=f&65535,E+=f>>>16,R+=l&65535,B+=l>>>16,l=g[K%16],f=w[K%16],H+=f&65535,E+=f>>>16,R+=l&65535,B+=l>>>16,E+=H>>>16,R+=E>>>16,B+=R>>>16,O=R&65535|B<<16,P=H&65535|E<<16,l=O,f=P,H=f&65535,E=f>>>16,R=l&65535,B=l>>>16,l=(A>>>28|p<<32-28)^(p>>>34-32|A<<32-(34-32))^(p>>>39-32|A<<32-(39-32)),f=(p>>>28|A<<32-28)^(A>>>34-32|p<<32-(34-32))^(A>>>39-32|p<<32-(39-32)),H+=f&65535,E+=f>>>16,R+=l&65535,B+=l>>>16,l=A&z^A&j^z&j,f=p&s^p&h^s&h,H+=f&65535,E+=f>>>16,R+=l&65535,B+=l>>>16,E+=H>>>16,R+=E>>>16,B+=R>>>16,T=R&65535|B<<16,Ae=H&65535|E<<16,l=$,f=ye,H=f&65535,E=f>>>16,R=l&65535,B=l>>>16,l=O,f=P,H+=f&65535,E+=f>>>16,R+=l&65535,B+=l>>>16,E+=H>>>16,R+=E>>>16,B+=R>>>16,$=R&65535|B<<16,ye=H&65535|E<<16,z=X,j=Y,G=ee,b=$,D=M,m=F,v=a,A=T,s=k,h=Z,L=fe,o=ye,c=le,u=me,y=Fe,p=Ae,K%16===15)for(var V=0;V<16;V++)l=g[V],f=w[V],H=f&65535,E=f>>>16,R=l&65535,B=l>>>16,l=g[(V+9)%16],f=w[(V+9)%16],H+=f&65535,E+=f>>>16,R+=l&65535,B+=l>>>16,O=g[(V+1)%16],P=w[(V+1)%16],l=(O>>>1|P<<32-1)^(O>>>8|P<<32-8)^O>>>7,f=(P>>>1|O<<32-1)^(P>>>8|O<<32-8)^(P>>>7|O<<32-7),H+=f&65535,E+=f>>>16,R+=l&65535,B+=l>>>16,O=g[(V+14)%16],P=w[(V+14)%16],l=(O>>>19|P<<32-19)^(P>>>61-32|O<<32-(61-32))^O>>>6,f=(P>>>19|O<<32-19)^(O>>>61-32|P<<32-(61-32))^(P>>>6|O<<32-6),H+=f&65535,E+=f>>>16,R+=l&65535,B+=l>>>16,E+=H>>>16,R+=E>>>16,B+=R>>>16,g[V]=R&65535|B<<16,w[V]=H&65535|E<<16}l=A,f=p,H=f&65535,E=f>>>16,R=l&65535,B=l>>>16,l=I[0],f=x[0],H+=f&65535,E+=f>>>16,R+=l&65535,B+=l>>>16,E+=H>>>16,R+=E>>>16,B+=R>>>16,I[0]=A=R&65535|B<<16,x[0]=p=H&65535|E<<16,l=z,f=s,H=f&65535,E=f>>>16,R=l&65535,B=l>>>16,l=I[1],f=x[1],H+=f&65535,E+=f>>>16,R+=l&65535,B+=l>>>16,E+=H>>>16,R+=E>>>16,B+=R>>>16,I[1]=z=R&65535|B<<16,x[1]=s=H&65535|E<<16,l=j,f=h,H=f&65535,E=f>>>16,R=l&65535,B=l>>>16,l=I[2],f=x[2],H+=f&65535,E+=f>>>16,R+=l&65535,B+=l>>>16,E+=H>>>16,R+=E>>>16,B+=R>>>16,I[2]=j=R&65535|B<<16,x[2]=h=H&65535|E<<16,l=G,f=L,H=f&65535,E=f>>>16,R=l&65535,B=l>>>16,l=I[3],f=x[3],H+=f&65535,E+=f>>>16,R+=l&65535,B+=l>>>16,E+=H>>>16,R+=E>>>16,B+=R>>>16,I[3]=G=R&65535|B<<16,x[3]=L=H&65535|E<<16,l=b,f=o,H=f&65535,E=f>>>16,R=l&65535,B=l>>>16,l=I[4],f=x[4],H+=f&65535,E+=f>>>16,R+=l&65535,B+=l>>>16,E+=H>>>16,R+=E>>>16,B+=R>>>16,I[4]=b=R&65535|B<<16,x[4]=o=H&65535|E<<16,l=D,f=c,H=f&65535,E=f>>>16,R=l&65535,B=l>>>16,l=I[5],f=x[5],H+=f&65535,E+=f>>>16,R+=l&65535,B+=l>>>16,E+=H>>>16,R+=E>>>16,B+=R>>>16,I[5]=D=R&65535|B<<16,x[5]=c=H&65535|E<<16,l=m,f=u,H=f&65535,E=f>>>16,R=l&65535,B=l>>>16,l=I[6],f=x[6],H+=f&65535,E+=f>>>16,R+=l&65535,B+=l>>>16,E+=H>>>16,R+=E>>>16,B+=R>>>16,I[6]=m=R&65535|B<<16,x[6]=u=H&65535|E<<16,l=v,f=y,H=f&65535,E=f>>>16,R=l&65535,B=l>>>16,l=I[7],f=x[7],H+=f&65535,E+=f>>>16,R+=l&65535,B+=l>>>16,E+=H>>>16,R+=E>>>16,B+=R>>>16,I[7]=v=R&65535|B<<16,x[7]=y=H&65535|E<<16,q+=128,C-=128}return q}function _(g){var w=new i;w.update(g);var I=w.digest();return w.clean(),I}r.hash=_})(Zs);(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.convertSecretKeyToX25519=r.convertPublicKeyToX25519=r.verify=r.sign=r.extractPublicKeyFromSecretKey=r.generateKeyPair=r.generateKeyPairFromSeed=r.SEED_LENGTH=r.SECRET_KEY_LENGTH=r.PUBLIC_KEY_LENGTH=r.SIGNATURE_LENGTH=void 0;const e=Er,t=Zs,i=Ct;r.SIGNATURE_LENGTH=64,r.PUBLIC_KEY_LENGTH=32,r.SECRET_KEY_LENGTH=64,r.SEED_LENGTH=32;function n($){const M=new Float64Array(16);if($)for(let F=0;F<$.length;F++)M[F]=$[F];return M}const d=new Uint8Array(32);d[0]=9;const _=n(),g=n([1]),w=n([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),I=n([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),x=n([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),N=n([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),q=n([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function C($,M){for(let F=0;F<16;F++)$[F]=M[F]|0}function A($){let M=1;for(let F=0;F<16;F++){let a=$[F]+M+65535;M=Math.floor(a/65536),$[F]=a-M*65536}$[0]+=M-1+37*(M-1)}function z($,M,F){const a=~(F-1);for(let T=0;T<16;T++){const k=a&($[T]^M[T]);$[T]^=k,M[T]^=k}}function j($,M){const F=n(),a=n();for(let T=0;T<16;T++)a[T]=M[T];A(a),A(a),A(a);for(let T=0;T<2;T++){F[0]=a[0]-65517;for(let Z=1;Z<15;Z++)F[Z]=a[Z]-65535-(F[Z-1]>>16&1),F[Z-1]&=65535;F[15]=a[15]-32767-(F[14]>>16&1);const k=F[15]>>16&1;F[14]&=65535,z(a,F,1-k)}for(let T=0;T<16;T++)$[2*T]=a[T]&255,$[2*T+1]=a[T]>>8}function G($,M){let F=0;for(let a=0;a<32;a++)F|=$[a]^M[a];return(1&F-1>>>8)-1}function b($,M){const F=new Uint8Array(32),a=new Uint8Array(32);return j(F,$),j(a,M),G(F,a)}function D($){const M=new Uint8Array(32);return j(M,$),M[0]&1}function m($,M){for(let F=0;F<16;F++)$[F]=M[2*F]+(M[2*F+1]<<8);$[15]&=32767}function v($,M,F){for(let a=0;a<16;a++)$[a]=M[a]+F[a]}function p($,M,F){for(let a=0;a<16;a++)$[a]=M[a]-F[a]}function s($,M,F){let a,T,k=0,Z=0,fe=0,ye=0,le=0,me=0,Fe=0,Ae=0,pe=0,de=0,he=0,ce=0,ae=0,oe=0,se=0,re=0,ue=0,ge=0,ie=0,_e=0,be=0,ve=0,Ee=0,we=0,pt=0,wt=0,Rt=0,ut=0,Ht=0,ar=0,Ar=0,je=F[0],Ne=F[1],Le=F[2],Me=F[3],$e=F[4],Ce=F[5],qe=F[6],Ke=F[7],Be=F[8],Ve=F[9],Ge=F[10],He=F[11],ze=F[12],Ie=F[13],We=F[14],ke=F[15];a=M[0],k+=a*je,Z+=a*Ne,fe+=a*Le,ye+=a*Me,le+=a*$e,me+=a*Ce,Fe+=a*qe,Ae+=a*Ke,pe+=a*Be,de+=a*Ve,he+=a*Ge,ce+=a*He,ae+=a*ze,oe+=a*Ie,se+=a*We,re+=a*ke,a=M[1],Z+=a*je,fe+=a*Ne,ye+=a*Le,le+=a*Me,me+=a*$e,Fe+=a*Ce,Ae+=a*qe,pe+=a*Ke,de+=a*Be,he+=a*Ve,ce+=a*Ge,ae+=a*He,oe+=a*ze,se+=a*Ie,re+=a*We,ue+=a*ke,a=M[2],fe+=a*je,ye+=a*Ne,le+=a*Le,me+=a*Me,Fe+=a*$e,Ae+=a*Ce,pe+=a*qe,de+=a*Ke,he+=a*Be,ce+=a*Ve,ae+=a*Ge,oe+=a*He,se+=a*ze,re+=a*Ie,ue+=a*We,ge+=a*ke,a=M[3],ye+=a*je,le+=a*Ne,me+=a*Le,Fe+=a*Me,Ae+=a*$e,pe+=a*Ce,de+=a*qe,he+=a*Ke,ce+=a*Be,ae+=a*Ve,oe+=a*Ge,se+=a*He,re+=a*ze,ue+=a*Ie,ge+=a*We,ie+=a*ke,a=M[4],le+=a*je,me+=a*Ne,Fe+=a*Le,Ae+=a*Me,pe+=a*$e,de+=a*Ce,he+=a*qe,ce+=a*Ke,ae+=a*Be,oe+=a*Ve,se+=a*Ge,re+=a*He,ue+=a*ze,ge+=a*Ie,ie+=a*We,_e+=a*ke,a=M[5],me+=a*je,Fe+=a*Ne,Ae+=a*Le,pe+=a*Me,de+=a*$e,he+=a*Ce,ce+=a*qe,ae+=a*Ke,oe+=a*Be,se+=a*Ve,re+=a*Ge,ue+=a*He,ge+=a*ze,ie+=a*Ie,_e+=a*We,be+=a*ke,a=M[6],Fe+=a*je,Ae+=a*Ne,pe+=a*Le,de+=a*Me,he+=a*$e,ce+=a*Ce,ae+=a*qe,oe+=a*Ke,se+=a*Be,re+=a*Ve,ue+=a*Ge,ge+=a*He,ie+=a*ze,_e+=a*Ie,be+=a*We,ve+=a*ke,a=M[7],Ae+=a*je,pe+=a*Ne,de+=a*Le,he+=a*Me,ce+=a*$e,ae+=a*Ce,oe+=a*qe,se+=a*Ke,re+=a*Be,ue+=a*Ve,ge+=a*Ge,ie+=a*He,_e+=a*ze,be+=a*Ie,ve+=a*We,Ee+=a*ke,a=M[8],pe+=a*je,de+=a*Ne,he+=a*Le,ce+=a*Me,ae+=a*$e,oe+=a*Ce,se+=a*qe,re+=a*Ke,ue+=a*Be,ge+=a*Ve,ie+=a*Ge,_e+=a*He,be+=a*ze,ve+=a*Ie,Ee+=a*We,we+=a*ke,a=M[9],de+=a*je,he+=a*Ne,ce+=a*Le,ae+=a*Me,oe+=a*$e,se+=a*Ce,re+=a*qe,ue+=a*Ke,ge+=a*Be,ie+=a*Ve,_e+=a*Ge,be+=a*He,ve+=a*ze,Ee+=a*Ie,we+=a*We,pt+=a*ke,a=M[10],he+=a*je,ce+=a*Ne,ae+=a*Le,oe+=a*Me,se+=a*$e,re+=a*Ce,ue+=a*qe,ge+=a*Ke,ie+=a*Be,_e+=a*Ve,be+=a*Ge,ve+=a*He,Ee+=a*ze,we+=a*Ie,pt+=a*We,wt+=a*ke,a=M[11],ce+=a*je,ae+=a*Ne,oe+=a*Le,se+=a*Me,re+=a*$e,ue+=a*Ce,ge+=a*qe,ie+=a*Ke,_e+=a*Be,be+=a*Ve,ve+=a*Ge,Ee+=a*He,we+=a*ze,pt+=a*Ie,wt+=a*We,Rt+=a*ke,a=M[12],ae+=a*je,oe+=a*Ne,se+=a*Le,re+=a*Me,ue+=a*$e,ge+=a*Ce,ie+=a*qe,_e+=a*Ke,be+=a*Be,ve+=a*Ve,Ee+=a*Ge,we+=a*He,pt+=a*ze,wt+=a*Ie,Rt+=a*We,ut+=a*ke,a=M[13],oe+=a*je,se+=a*Ne,re+=a*Le,ue+=a*Me,ge+=a*$e,ie+=a*Ce,_e+=a*qe,be+=a*Ke,ve+=a*Be,Ee+=a*Ve,we+=a*Ge,pt+=a*He,wt+=a*ze,Rt+=a*Ie,ut+=a*We,Ht+=a*ke,a=M[14],se+=a*je,re+=a*Ne,ue+=a*Le,ge+=a*Me,ie+=a*$e,_e+=a*Ce,be+=a*qe,ve+=a*Ke,Ee+=a*Be,we+=a*Ve,pt+=a*Ge,wt+=a*He,Rt+=a*ze,ut+=a*Ie,Ht+=a*We,ar+=a*ke,a=M[15],re+=a*je,ue+=a*Ne,ge+=a*Le,ie+=a*Me,_e+=a*$e,be+=a*Ce,ve+=a*qe,Ee+=a*Ke,we+=a*Be,pt+=a*Ve,wt+=a*Ge,Rt+=a*He,ut+=a*ze,Ht+=a*Ie,ar+=a*We,Ar+=a*ke,k+=38*ue,Z+=38*ge,fe+=38*ie,ye+=38*_e,le+=38*be,me+=38*ve,Fe+=38*Ee,Ae+=38*we,pe+=38*pt,de+=38*wt,he+=38*Rt,ce+=38*ut,ae+=38*Ht,oe+=38*ar,se+=38*Ar,T=1,a=k+T+65535,T=Math.floor(a/65536),k=a-T*65536,a=Z+T+65535,T=Math.floor(a/65536),Z=a-T*65536,a=fe+T+65535,T=Math.floor(a/65536),fe=a-T*65536,a=ye+T+65535,T=Math.floor(a/65536),ye=a-T*65536,a=le+T+65535,T=Math.floor(a/65536),le=a-T*65536,a=me+T+65535,T=Math.floor(a/65536),me=a-T*65536,a=Fe+T+65535,T=Math.floor(a/65536),Fe=a-T*65536,a=Ae+T+65535,T=Math.floor(a/65536),Ae=a-T*65536,a=pe+T+65535,T=Math.floor(a/65536),pe=a-T*65536,a=de+T+65535,T=Math.floor(a/65536),de=a-T*65536,a=he+T+65535,T=Math.floor(a/65536),he=a-T*65536,a=ce+T+65535,T=Math.floor(a/65536),ce=a-T*65536,a=ae+T+65535,T=Math.floor(a/65536),ae=a-T*65536,a=oe+T+65535,T=Math.floor(a/65536),oe=a-T*65536,a=se+T+65535,T=Math.floor(a/65536),se=a-T*65536,a=re+T+65535,T=Math.floor(a/65536),re=a-T*65536,k+=T-1+37*(T-1),T=1,a=k+T+65535,T=Math.floor(a/65536),k=a-T*65536,a=Z+T+65535,T=Math.floor(a/65536),Z=a-T*65536,a=fe+T+65535,T=Math.floor(a/65536),fe=a-T*65536,a=ye+T+65535,T=Math.floor(a/65536),ye=a-T*65536,a=le+T+65535,T=Math.floor(a/65536),le=a-T*65536,a=me+T+65535,T=Math.floor(a/65536),me=a-T*65536,a=Fe+T+65535,T=Math.floor(a/65536),Fe=a-T*65536,a=Ae+T+65535,T=Math.floor(a/65536),Ae=a-T*65536,a=pe+T+65535,T=Math.floor(a/65536),pe=a-T*65536,a=de+T+65535,T=Math.floor(a/65536),de=a-T*65536,a=he+T+65535,T=Math.floor(a/65536),he=a-T*65536,a=ce+T+65535,T=Math.floor(a/65536),ce=a-T*65536,a=ae+T+65535,T=Math.floor(a/65536),ae=a-T*65536,a=oe+T+65535,T=Math.floor(a/65536),oe=a-T*65536,a=se+T+65535,T=Math.floor(a/65536),se=a-T*65536,a=re+T+65535,T=Math.floor(a/65536),re=a-T*65536,k+=T-1+37*(T-1),$[0]=k,$[1]=Z,$[2]=fe,$[3]=ye,$[4]=le,$[5]=me,$[6]=Fe,$[7]=Ae,$[8]=pe,$[9]=de,$[10]=he,$[11]=ce,$[12]=ae,$[13]=oe,$[14]=se,$[15]=re}function h($,M){s($,M,M)}function L($,M){const F=n();let a;for(a=0;a<16;a++)F[a]=M[a];for(a=253;a>=0;a--)h(F,F),a!==2&&a!==4&&s(F,F,M);for(a=0;a<16;a++)$[a]=F[a]}function o($,M){const F=n();let a;for(a=0;a<16;a++)F[a]=M[a];for(a=250;a>=0;a--)h(F,F),a!==1&&s(F,F,M);for(a=0;a<16;a++)$[a]=F[a]}function c($,M){const F=n(),a=n(),T=n(),k=n(),Z=n(),fe=n(),ye=n(),le=n(),me=n();p(F,$[1],$[0]),p(me,M[1],M[0]),s(F,F,me),v(a,$[0],$[1]),v(me,M[0],M[1]),s(a,a,me),s(T,$[3],M[3]),s(T,T,I),s(k,$[2],M[2]),v(k,k,k),p(Z,a,F),p(fe,k,T),v(ye,k,T),v(le,a,F),s($[0],Z,fe),s($[1],le,ye),s($[2],ye,fe),s($[3],Z,le)}function u($,M,F){for(let a=0;a<4;a++)z($[a],M[a],F)}function y($,M){const F=n(),a=n(),T=n();L(T,M[2]),s(F,M[0],T),s(a,M[1],T),j($,a),$[31]^=D(F)<<7}function l($,M,F){C($[0],_),C($[1],g),C($[2],g),C($[3],_);for(let a=255;a>=0;--a){const T=F[a/8|0]>>(a&7)&1;u($,M,T),c(M,$),c($,$),u($,M,T)}}function f($,M){const F=[n(),n(),n(),n()];C(F[0],x),C(F[1],N),C(F[2],g),s(F[3],x,N),l($,F,M)}function O($){if($.length!==r.SEED_LENGTH)throw new Error(`ed25519: seed must be ${r.SEED_LENGTH} bytes`);const M=(0,t.hash)($);M[0]&=248,M[31]&=127,M[31]|=64;const F=new Uint8Array(32),a=[n(),n(),n(),n()];f(a,M),y(F,a);const T=new Uint8Array(64);return T.set($),T.set(F,32),{publicKey:F,secretKey:T}}r.generateKeyPairFromSeed=O;function P($){const M=(0,e.randomBytes)(32,$),F=O(M);return(0,i.wipe)(M),F}r.generateKeyPair=P;function H($){if($.length!==r.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${r.SECRET_KEY_LENGTH} bytes`);return new Uint8Array($.subarray(32))}r.extractPublicKeyFromSecretKey=H;const E=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function R($,M){let F,a,T,k;for(a=63;a>=32;--a){for(F=0,T=a-32,k=a-12;T<k;++T)M[T]+=F-16*M[a]*E[T-(a-32)],F=Math.floor((M[T]+128)/256),M[T]-=F*256;M[T]+=F,M[a]=0}for(F=0,T=0;T<32;T++)M[T]+=F-(M[31]>>4)*E[T],F=M[T]>>8,M[T]&=255;for(T=0;T<32;T++)M[T]-=F*E[T];for(a=0;a<32;a++)M[a+1]+=M[a]>>8,$[a]=M[a]&255}function B($){const M=new Float64Array(64);for(let F=0;F<64;F++)M[F]=$[F];for(let F=0;F<64;F++)$[F]=0;R($,M)}function K($,M){const F=new Float64Array(64),a=[n(),n(),n(),n()],T=(0,t.hash)($.subarray(0,32));T[0]&=248,T[31]&=127,T[31]|=64;const k=new Uint8Array(64);k.set(T.subarray(32),32);const Z=new t.SHA512;Z.update(k.subarray(32)),Z.update(M);const fe=Z.digest();Z.clean(),B(fe),f(a,fe),y(k,a),Z.reset(),Z.update(k.subarray(0,32)),Z.update($.subarray(32)),Z.update(M);const ye=Z.digest();B(ye);for(let le=0;le<32;le++)F[le]=fe[le];for(let le=0;le<32;le++)for(let me=0;me<32;me++)F[le+me]+=ye[le]*T[me];return R(k.subarray(32),F),k}r.sign=K;function V($,M){const F=n(),a=n(),T=n(),k=n(),Z=n(),fe=n(),ye=n();return C($[2],g),m($[1],M),h(T,$[1]),s(k,T,w),p(T,T,$[2]),v(k,$[2],k),h(Z,k),h(fe,Z),s(ye,fe,Z),s(F,ye,T),s(F,F,k),o(F,F),s(F,F,T),s(F,F,k),s(F,F,k),s($[0],F,k),h(a,$[0]),s(a,a,k),b(a,T)&&s($[0],$[0],q),h(a,$[0]),s(a,a,k),b(a,T)?-1:(D($[0])===M[31]>>7&&p($[0],_,$[0]),s($[3],$[0],$[1]),0)}function X($,M,F){const a=new Uint8Array(32),T=[n(),n(),n(),n()],k=[n(),n(),n(),n()];if(F.length!==r.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${r.SIGNATURE_LENGTH} bytes`);if(V(k,$))return!1;const Z=new t.SHA512;Z.update(F.subarray(0,32)),Z.update($),Z.update(M);const fe=Z.digest();return B(fe),l(T,k,fe),f(k,F.subarray(32)),c(T,k),y(a,T),!G(F,a)}r.verify=X;function Y($){let M=[n(),n(),n(),n()];if(V(M,$))throw new Error("Ed25519: invalid public key");let F=n(),a=n(),T=M[1];v(F,g,T),p(a,g,T),L(a,a),s(F,F,a);let k=new Uint8Array(32);return j(k,F),k}r.convertPublicKeyToX25519=Y;function ee($){const M=(0,t.hash)($.subarray(0,32));M[0]&=248,M[31]&=127,M[31]|=64;const F=new Uint8Array(M.subarray(0,32));return(0,i.wipe)(M),F}r.convertSecretKeyToX25519=ee})(Ci);const Ac="EdDSA",Nc="JWT",Qs=".",eo="base64url",Cc="utf8",Rc="utf8",Fc=":",Uc="did",jc="key",Ln="base58btc",Lc="z",Mc="K36",$c=32;function Ri(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function to(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Ri(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function zc(r,e){e||(e=r.reduce((n,d)=>n+d.length,0));const t=to(e);let i=0;for(const n of r)t.set(n,i),i+=n.length;return Ri(t)}function Hc(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var n=0;n<r.length;n++){var d=r.charAt(n),_=d.charCodeAt(0);if(t[_]!==255)throw new TypeError(d+" is ambiguous");t[_]=n}var g=r.length,w=r.charAt(0),I=Math.log(g)/Math.log(256),x=Math.log(256)/Math.log(g);function N(A){if(A instanceof Uint8Array||(ArrayBuffer.isView(A)?A=new Uint8Array(A.buffer,A.byteOffset,A.byteLength):Array.isArray(A)&&(A=Uint8Array.from(A))),!(A instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(A.length===0)return"";for(var z=0,j=0,G=0,b=A.length;G!==b&&A[G]===0;)G++,z++;for(var D=(b-G)*x+1>>>0,m=new Uint8Array(D);G!==b;){for(var v=A[G],p=0,s=D-1;(v!==0||p<j)&&s!==-1;s--,p++)v+=256*m[s]>>>0,m[s]=v%g>>>0,v=v/g>>>0;if(v!==0)throw new Error("Non-zero carry");j=p,G++}for(var h=D-j;h!==D&&m[h]===0;)h++;for(var L=w.repeat(z);h<D;++h)L+=r.charAt(m[h]);return L}function q(A){if(typeof A!="string")throw new TypeError("Expected String");if(A.length===0)return new Uint8Array;var z=0;if(A[z]!==" "){for(var j=0,G=0;A[z]===w;)j++,z++;for(var b=(A.length-z)*I+1>>>0,D=new Uint8Array(b);A[z];){var m=t[A.charCodeAt(z)];if(m===255)return;for(var v=0,p=b-1;(m!==0||v<G)&&p!==-1;p--,v++)m+=g*D[p]>>>0,D[p]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");G=v,z++}if(A[z]!==" "){for(var s=b-G;s!==b&&D[s]===0;)s++;for(var h=new Uint8Array(j+(b-s)),L=j;s!==b;)h[L++]=D[s++];return h}}}function C(A){var z=q(A);if(z)return z;throw new Error(`Non-${e} character`)}return{encode:N,decodeUnsafe:q,decode:C}}var qc=Hc,Kc=qc;const Bc=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},Vc=r=>new TextEncoder().encode(r),Gc=r=>new TextDecoder().decode(r);class Wc{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class kc{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ro(this,e)}}class Yc{constructor(e){this.decoders=e}or(e){return ro(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ro=(r,e)=>new Yc({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class Jc{constructor(e,t,i,n){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=n,this.encoder=new Wc(e,t,i),this.decoder=new kc(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Yr=({name:r,prefix:e,encode:t,decode:i})=>new Jc(r,e,t,i),Or=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:n}=Kc(t,e);return Yr({prefix:r,name:e,encode:i,decode:d=>Bc(n(d))})},Xc=(r,e,t,i)=>{const n={};for(let x=0;x<e.length;++x)n[e[x]]=x;let d=r.length;for(;r[d-1]==="=";)--d;const _=new Uint8Array(d*t/8|0);let g=0,w=0,I=0;for(let x=0;x<d;++x){const N=n[r[x]];if(N===void 0)throw new SyntaxError(`Non-${i} character`);w=w<<t|N,g+=t,g>=8&&(g-=8,_[I++]=255&w>>g)}if(g>=t||255&w<<8-g)throw new SyntaxError("Unexpected end of data");return _},Zc=(r,e,t)=>{const i=e[e.length-1]==="=",n=(1<<t)-1;let d="",_=0,g=0;for(let w=0;w<r.length;++w)for(g=g<<8|r[w],_+=8;_>t;)_-=t,d+=e[n&g>>_];if(_&&(d+=e[n&g<<t-_]),i)for(;d.length*t&7;)d+="=";return d},Qe=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>Yr({prefix:e,name:r,encode(n){return Zc(n,i,t)},decode(n){return Xc(n,i,t,r)}}),Qc=Yr({prefix:"\0",name:"identity",encode:r=>Gc(r),decode:r=>Vc(r)}),eu=Object.freeze(Object.defineProperty({__proto__:null,identity:Qc},Symbol.toStringTag,{value:"Module"})),tu=Qe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),ru=Object.freeze(Object.defineProperty({__proto__:null,base2:tu},Symbol.toStringTag,{value:"Module"})),iu=Qe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),nu=Object.freeze(Object.defineProperty({__proto__:null,base8:iu},Symbol.toStringTag,{value:"Module"})),su=Or({prefix:"9",name:"base10",alphabet:"0123456789"}),ou=Object.freeze(Object.defineProperty({__proto__:null,base10:su},Symbol.toStringTag,{value:"Module"})),au=Qe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),cu=Qe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),uu=Object.freeze(Object.defineProperty({__proto__:null,base16:au,base16upper:cu},Symbol.toStringTag,{value:"Module"})),fu=Qe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),hu=Qe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),lu=Qe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),du=Qe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),gu=Qe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),pu=Qe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),yu=Qe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),_u=Qe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),bu=Qe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),mu=Object.freeze(Object.defineProperty({__proto__:null,base32:fu,base32hex:gu,base32hexpad:yu,base32hexpadupper:_u,base32hexupper:pu,base32pad:lu,base32padupper:du,base32upper:hu,base32z:bu},Symbol.toStringTag,{value:"Module"})),wu=Or({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),vu=Or({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Eu=Object.freeze(Object.defineProperty({__proto__:null,base36:wu,base36upper:vu},Symbol.toStringTag,{value:"Module"})),Du=Or({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Su=Or({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Ou=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Du,base58flickr:Su},Symbol.toStringTag,{value:"Module"})),xu=Qe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Iu=Qe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Tu=Qe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Pu=Qe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Au=Object.freeze(Object.defineProperty({__proto__:null,base64:xu,base64pad:Iu,base64url:Tu,base64urlpad:Pu},Symbol.toStringTag,{value:"Module"})),io=Array.from(""),Nu=io.reduce((r,e,t)=>(r[t]=e,r),[]),Cu=io.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function Ru(r){return r.reduce((e,t)=>(e+=Nu[t],e),"")}function Fu(r){const e=[];for(const t of r){const i=Cu[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const Uu=Yr({prefix:"",name:"base256emoji",encode:Ru,decode:Fu}),ju=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Uu},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const qr={...eu,...ru,...nu,...ou,...uu,...mu,...Eu,...Ou,...Au,...ju};function no(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const Mn=no("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),gi=no("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=to(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),so={utf8:Mn,"utf-8":Mn,hex:qr.base16,latin1:gi,ascii:gi,binary:gi,...qr};function Fi(r,e="utf8"){const t=so[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}function Ui(r,e="utf8"){const t=so[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Ri(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function Kr(r){return Fi(Ui(wr(r),Cc),eo)}function oo(r){const e=Ui(Mc,Ln),t=Lc+Fi(zc([e,r]),Ln);return[Uc,jc,t].join(Fc)}function Lu(r){return Fi(r,eo)}function Mu(r){return Ui([Kr(r.header),Kr(r.payload)].join(Qs),Rc)}function $u(r){return[Kr(r.header),Kr(r.payload),Lu(r.signature)].join(Qs)}function $n(r=Er.randomBytes($c)){return Ci.generateKeyPairFromSeed(r)}async function zu(r,e,t,i,n=te.fromMiliseconds(Date.now())){const d={alg:Ac,typ:Nc},_=oo(i.publicKey),g=n+t,w={iss:_,sub:r,aud:e,iat:n,exp:g},I=Mu({header:d,payload:w}),x=Ci.sign(i.secretKey,I);return $u({header:d,payload:w,signature:x})}var ji={},Jr={};Object.defineProperty(Jr,"__esModule",{value:!0});var rt=Gr,vi=Ct,Hu=20;function qu(r,e,t){for(var i=1634760805,n=857760878,d=2036477234,_=1797285236,g=t[3]<<24|t[2]<<16|t[1]<<8|t[0],w=t[7]<<24|t[6]<<16|t[5]<<8|t[4],I=t[11]<<24|t[10]<<16|t[9]<<8|t[8],x=t[15]<<24|t[14]<<16|t[13]<<8|t[12],N=t[19]<<24|t[18]<<16|t[17]<<8|t[16],q=t[23]<<24|t[22]<<16|t[21]<<8|t[20],C=t[27]<<24|t[26]<<16|t[25]<<8|t[24],A=t[31]<<24|t[30]<<16|t[29]<<8|t[28],z=e[3]<<24|e[2]<<16|e[1]<<8|e[0],j=e[7]<<24|e[6]<<16|e[5]<<8|e[4],G=e[11]<<24|e[10]<<16|e[9]<<8|e[8],b=e[15]<<24|e[14]<<16|e[13]<<8|e[12],D=i,m=n,v=d,p=_,s=g,h=w,L=I,o=x,c=N,u=q,y=C,l=A,f=z,O=j,P=G,H=b,E=0;E<Hu;E+=2)D=D+s|0,f^=D,f=f>>>32-16|f<<16,c=c+f|0,s^=c,s=s>>>32-12|s<<12,m=m+h|0,O^=m,O=O>>>32-16|O<<16,u=u+O|0,h^=u,h=h>>>32-12|h<<12,v=v+L|0,P^=v,P=P>>>32-16|P<<16,y=y+P|0,L^=y,L=L>>>32-12|L<<12,p=p+o|0,H^=p,H=H>>>32-16|H<<16,l=l+H|0,o^=l,o=o>>>32-12|o<<12,v=v+L|0,P^=v,P=P>>>32-8|P<<8,y=y+P|0,L^=y,L=L>>>32-7|L<<7,p=p+o|0,H^=p,H=H>>>32-8|H<<8,l=l+H|0,o^=l,o=o>>>32-7|o<<7,m=m+h|0,O^=m,O=O>>>32-8|O<<8,u=u+O|0,h^=u,h=h>>>32-7|h<<7,D=D+s|0,f^=D,f=f>>>32-8|f<<8,c=c+f|0,s^=c,s=s>>>32-7|s<<7,D=D+h|0,H^=D,H=H>>>32-16|H<<16,y=y+H|0,h^=y,h=h>>>32-12|h<<12,m=m+L|0,f^=m,f=f>>>32-16|f<<16,l=l+f|0,L^=l,L=L>>>32-12|L<<12,v=v+o|0,O^=v,O=O>>>32-16|O<<16,c=c+O|0,o^=c,o=o>>>32-12|o<<12,p=p+s|0,P^=p,P=P>>>32-16|P<<16,u=u+P|0,s^=u,s=s>>>32-12|s<<12,v=v+o|0,O^=v,O=O>>>32-8|O<<8,c=c+O|0,o^=c,o=o>>>32-7|o<<7,p=p+s|0,P^=p,P=P>>>32-8|P<<8,u=u+P|0,s^=u,s=s>>>32-7|s<<7,m=m+L|0,f^=m,f=f>>>32-8|f<<8,l=l+f|0,L^=l,L=L>>>32-7|L<<7,D=D+h|0,H^=D,H=H>>>32-8|H<<8,y=y+H|0,h^=y,h=h>>>32-7|h<<7;rt.writeUint32LE(D+i|0,r,0),rt.writeUint32LE(m+n|0,r,4),rt.writeUint32LE(v+d|0,r,8),rt.writeUint32LE(p+_|0,r,12),rt.writeUint32LE(s+g|0,r,16),rt.writeUint32LE(h+w|0,r,20),rt.writeUint32LE(L+I|0,r,24),rt.writeUint32LE(o+x|0,r,28),rt.writeUint32LE(c+N|0,r,32),rt.writeUint32LE(u+q|0,r,36),rt.writeUint32LE(y+C|0,r,40),rt.writeUint32LE(l+A|0,r,44),rt.writeUint32LE(f+z|0,r,48),rt.writeUint32LE(O+j|0,r,52),rt.writeUint32LE(P+G|0,r,56),rt.writeUint32LE(H+b|0,r,60)}function ao(r,e,t,i,n){if(n===void 0&&(n=0),r.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(i.length<t.length)throw new Error("ChaCha: destination is shorter than source");var d,_;if(n===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");d=new Uint8Array(16),_=d.length-e.length,d.set(e,_)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");d=e,_=n}for(var g=new Uint8Array(64),w=0;w<t.length;w+=64){qu(g,d,r);for(var I=w;I<w+64&&I<t.length;I++)i[I]=t[I]^g[I-w];Bu(d,0,_)}return vi.wipe(g),n===0&&vi.wipe(d),i}Jr.streamXOR=ao;function Ku(r,e,t,i){return i===void 0&&(i=0),vi.wipe(t),ao(r,e,t,t,i)}Jr.stream=Ku;function Bu(r,e,t){for(var i=1;t--;)i=i+(r[e]&255)|0,r[e]=i&255,i>>>=8,e++;if(i>0)throw new Error("ChaCha: counter overflow")}var co={},zt={};Object.defineProperty(zt,"__esModule",{value:!0});function Vu(r,e,t){return~(r-1)&e|r-1&t}zt.select=Vu;function Gu(r,e){return(r|0)-(e|0)-1>>>31&1}zt.lessOrEqual=Gu;function uo(r,e){if(r.length!==e.length)return 0;for(var t=0,i=0;i<r.length;i++)t|=r[i]^e[i];return 1&t-1>>>8}zt.compare=uo;function Wu(r,e){return r.length===0||e.length===0?!1:uo(r,e)!==0}zt.equal=Wu;(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=zt,t=Ct;r.DIGEST_LENGTH=16;var i=function(){function _(g){this.digestLength=r.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var w=g[0]|g[1]<<8;this._r[0]=w&8191;var I=g[2]|g[3]<<8;this._r[1]=(w>>>13|I<<3)&8191;var x=g[4]|g[5]<<8;this._r[2]=(I>>>10|x<<6)&7939;var N=g[6]|g[7]<<8;this._r[3]=(x>>>7|N<<9)&8191;var q=g[8]|g[9]<<8;this._r[4]=(N>>>4|q<<12)&255,this._r[5]=q>>>1&8190;var C=g[10]|g[11]<<8;this._r[6]=(q>>>14|C<<2)&8191;var A=g[12]|g[13]<<8;this._r[7]=(C>>>11|A<<5)&8065;var z=g[14]|g[15]<<8;this._r[8]=(A>>>8|z<<8)&8191,this._r[9]=z>>>5&127,this._pad[0]=g[16]|g[17]<<8,this._pad[1]=g[18]|g[19]<<8,this._pad[2]=g[20]|g[21]<<8,this._pad[3]=g[22]|g[23]<<8,this._pad[4]=g[24]|g[25]<<8,this._pad[5]=g[26]|g[27]<<8,this._pad[6]=g[28]|g[29]<<8,this._pad[7]=g[30]|g[31]<<8}return _.prototype._blocks=function(g,w,I){for(var x=this._fin?0:2048,N=this._h[0],q=this._h[1],C=this._h[2],A=this._h[3],z=this._h[4],j=this._h[5],G=this._h[6],b=this._h[7],D=this._h[8],m=this._h[9],v=this._r[0],p=this._r[1],s=this._r[2],h=this._r[3],L=this._r[4],o=this._r[5],c=this._r[6],u=this._r[7],y=this._r[8],l=this._r[9];I>=16;){var f=g[w+0]|g[w+1]<<8;N+=f&8191;var O=g[w+2]|g[w+3]<<8;q+=(f>>>13|O<<3)&8191;var P=g[w+4]|g[w+5]<<8;C+=(O>>>10|P<<6)&8191;var H=g[w+6]|g[w+7]<<8;A+=(P>>>7|H<<9)&8191;var E=g[w+8]|g[w+9]<<8;z+=(H>>>4|E<<12)&8191,j+=E>>>1&8191;var R=g[w+10]|g[w+11]<<8;G+=(E>>>14|R<<2)&8191;var B=g[w+12]|g[w+13]<<8;b+=(R>>>11|B<<5)&8191;var K=g[w+14]|g[w+15]<<8;D+=(B>>>8|K<<8)&8191,m+=K>>>5|x;var V=0,X=V;X+=N*v,X+=q*(5*l),X+=C*(5*y),X+=A*(5*u),X+=z*(5*c),V=X>>>13,X&=8191,X+=j*(5*o),X+=G*(5*L),X+=b*(5*h),X+=D*(5*s),X+=m*(5*p),V+=X>>>13,X&=8191;var Y=V;Y+=N*p,Y+=q*v,Y+=C*(5*l),Y+=A*(5*y),Y+=z*(5*u),V=Y>>>13,Y&=8191,Y+=j*(5*c),Y+=G*(5*o),Y+=b*(5*L),Y+=D*(5*h),Y+=m*(5*s),V+=Y>>>13,Y&=8191;var ee=V;ee+=N*s,ee+=q*p,ee+=C*v,ee+=A*(5*l),ee+=z*(5*y),V=ee>>>13,ee&=8191,ee+=j*(5*u),ee+=G*(5*c),ee+=b*(5*o),ee+=D*(5*L),ee+=m*(5*h),V+=ee>>>13,ee&=8191;var $=V;$+=N*h,$+=q*s,$+=C*p,$+=A*v,$+=z*(5*l),V=$>>>13,$&=8191,$+=j*(5*y),$+=G*(5*u),$+=b*(5*c),$+=D*(5*o),$+=m*(5*L),V+=$>>>13,$&=8191;var M=V;M+=N*L,M+=q*h,M+=C*s,M+=A*p,M+=z*v,V=M>>>13,M&=8191,M+=j*(5*l),M+=G*(5*y),M+=b*(5*u),M+=D*(5*c),M+=m*(5*o),V+=M>>>13,M&=8191;var F=V;F+=N*o,F+=q*L,F+=C*h,F+=A*s,F+=z*p,V=F>>>13,F&=8191,F+=j*v,F+=G*(5*l),F+=b*(5*y),F+=D*(5*u),F+=m*(5*c),V+=F>>>13,F&=8191;var a=V;a+=N*c,a+=q*o,a+=C*L,a+=A*h,a+=z*s,V=a>>>13,a&=8191,a+=j*p,a+=G*v,a+=b*(5*l),a+=D*(5*y),a+=m*(5*u),V+=a>>>13,a&=8191;var T=V;T+=N*u,T+=q*c,T+=C*o,T+=A*L,T+=z*h,V=T>>>13,T&=8191,T+=j*s,T+=G*p,T+=b*v,T+=D*(5*l),T+=m*(5*y),V+=T>>>13,T&=8191;var k=V;k+=N*y,k+=q*u,k+=C*c,k+=A*o,k+=z*L,V=k>>>13,k&=8191,k+=j*h,k+=G*s,k+=b*p,k+=D*v,k+=m*(5*l),V+=k>>>13,k&=8191;var Z=V;Z+=N*l,Z+=q*y,Z+=C*u,Z+=A*c,Z+=z*o,V=Z>>>13,Z&=8191,Z+=j*L,Z+=G*h,Z+=b*s,Z+=D*p,Z+=m*v,V+=Z>>>13,Z&=8191,V=(V<<2)+V|0,V=V+X|0,X=V&8191,V=V>>>13,Y+=V,N=X,q=Y,C=ee,A=$,z=M,j=F,G=a,b=T,D=k,m=Z,w+=16,I-=16}this._h[0]=N,this._h[1]=q,this._h[2]=C,this._h[3]=A,this._h[4]=z,this._h[5]=j,this._h[6]=G,this._h[7]=b,this._h[8]=D,this._h[9]=m},_.prototype.finish=function(g,w){w===void 0&&(w=0);var I=new Uint16Array(10),x,N,q,C;if(this._leftover){for(C=this._leftover,this._buffer[C++]=1;C<16;C++)this._buffer[C]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(x=this._h[1]>>>13,this._h[1]&=8191,C=2;C<10;C++)this._h[C]+=x,x=this._h[C]>>>13,this._h[C]&=8191;for(this._h[0]+=x*5,x=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=x,x=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=x,I[0]=this._h[0]+5,x=I[0]>>>13,I[0]&=8191,C=1;C<10;C++)I[C]=this._h[C]+x,x=I[C]>>>13,I[C]&=8191;for(I[9]-=1<<13,N=(x^1)-1,C=0;C<10;C++)I[C]&=N;for(N=~N,C=0;C<10;C++)this._h[C]=this._h[C]&N|I[C];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,q=this._h[0]+this._pad[0],this._h[0]=q&65535,C=1;C<8;C++)q=(this._h[C]+this._pad[C]|0)+(q>>>16)|0,this._h[C]=q&65535;return g[w+0]=this._h[0]>>>0,g[w+1]=this._h[0]>>>8,g[w+2]=this._h[1]>>>0,g[w+3]=this._h[1]>>>8,g[w+4]=this._h[2]>>>0,g[w+5]=this._h[2]>>>8,g[w+6]=this._h[3]>>>0,g[w+7]=this._h[3]>>>8,g[w+8]=this._h[4]>>>0,g[w+9]=this._h[4]>>>8,g[w+10]=this._h[5]>>>0,g[w+11]=this._h[5]>>>8,g[w+12]=this._h[6]>>>0,g[w+13]=this._h[6]>>>8,g[w+14]=this._h[7]>>>0,g[w+15]=this._h[7]>>>8,this._finished=!0,this},_.prototype.update=function(g){var w=0,I=g.length,x;if(this._leftover){x=16-this._leftover,x>I&&(x=I);for(var N=0;N<x;N++)this._buffer[this._leftover+N]=g[w+N];if(I-=x,w+=x,this._leftover+=x,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(I>=16&&(x=I-I%16,this._blocks(g,w,x),w+=x,I-=x),I){for(var N=0;N<I;N++)this._buffer[this._leftover+N]=g[w+N];this._leftover+=I}return this},_.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var g=new Uint8Array(16);return this.finish(g),g},_.prototype.clean=function(){return t.wipe(this._buffer),t.wipe(this._r),t.wipe(this._h),t.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},_}();r.Poly1305=i;function n(_,g){var w=new i(_);w.update(g);var I=w.digest();return w.clean(),I}r.oneTimeAuth=n;function d(_,g){return _.length!==r.DIGEST_LENGTH||g.length!==r.DIGEST_LENGTH?!1:e.equal(_,g)}r.equal=d})(co);(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=Jr,t=co,i=Ct,n=Gr,d=zt;r.KEY_LENGTH=32,r.NONCE_LENGTH=12,r.TAG_LENGTH=16;var _=new Uint8Array(16),g=function(){function w(I){if(this.nonceLength=r.NONCE_LENGTH,this.tagLength=r.TAG_LENGTH,I.length!==r.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(I)}return w.prototype.seal=function(I,x,N,q){if(I.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var C=new Uint8Array(16);C.set(I,C.length-I.length);var A=new Uint8Array(32);e.stream(this._key,C,A,4);var z=x.length+this.tagLength,j;if(q){if(q.length!==z)throw new Error("ChaCha20Poly1305: incorrect destination length");j=q}else j=new Uint8Array(z);return e.streamXOR(this._key,C,x,j,4),this._authenticate(j.subarray(j.length-this.tagLength,j.length),A,j.subarray(0,j.length-this.tagLength),N),i.wipe(C),j},w.prototype.open=function(I,x,N,q){if(I.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(x.length<this.tagLength)return null;var C=new Uint8Array(16);C.set(I,C.length-I.length);var A=new Uint8Array(32);e.stream(this._key,C,A,4);var z=new Uint8Array(this.tagLength);if(this._authenticate(z,A,x.subarray(0,x.length-this.tagLength),N),!d.equal(z,x.subarray(x.length-this.tagLength,x.length)))return null;var j=x.length-this.tagLength,G;if(q){if(q.length!==j)throw new Error("ChaCha20Poly1305: incorrect destination length");G=q}else G=new Uint8Array(j);return e.streamXOR(this._key,C,x.subarray(0,x.length-this.tagLength),G,4),i.wipe(C),G},w.prototype.clean=function(){return i.wipe(this._key),this},w.prototype._authenticate=function(I,x,N,q){var C=new t.Poly1305(x);q&&(C.update(q),q.length%16>0&&C.update(_.subarray(q.length%16))),C.update(N),N.length%16>0&&C.update(_.subarray(N.length%16));var A=new Uint8Array(8);q&&n.writeUint64LE(q.length,A),C.update(A),n.writeUint64LE(N.length,A),C.update(A);for(var z=C.digest(),j=0;j<z.length;j++)I[j]=z[j];C.clean(),i.wipe(z),i.wipe(A)},w}();r.ChaCha20Poly1305=g})(ji);var fo={},xr={},Li={};Object.defineProperty(Li,"__esModule",{value:!0});function ku(r){return typeof r.saveState<"u"&&typeof r.restoreState<"u"&&typeof r.cleanSavedState<"u"}Li.isSerializableHash=ku;Object.defineProperty(xr,"__esModule",{value:!0});var vt=Li,Yu=zt,Ju=Ct,ho=function(){function r(e,t){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);t.length>this.blockSize?this._inner.update(t).finish(i).clean():i.set(t);for(var n=0;n<i.length;n++)i[n]^=54;this._inner.update(i);for(var n=0;n<i.length;n++)i[n]^=106;this._outer.update(i),vt.isSerializableHash(this._inner)&&vt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),Ju.wipe(i)}return r.prototype.reset=function(){if(!vt.isSerializableHash(this._inner)||!vt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},r.prototype.clean=function(){vt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),vt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},r.prototype.update=function(e){return this._inner.update(e),this},r.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},r.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},r.prototype.saveState=function(){if(!vt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},r.prototype.restoreState=function(e){if(!vt.isSerializableHash(this._inner)||!vt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},r.prototype.cleanSavedState=function(e){if(!vt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},r}();xr.HMAC=ho;function Xu(r,e,t){var i=new ho(r,e);i.update(t);var n=i.digest();return i.clean(),n}xr.hmac=Xu;xr.equal=Yu.equal;Object.defineProperty(fo,"__esModule",{value:!0});var zn=xr,Hn=Ct,Zu=function(){function r(e,t,i,n){i===void 0&&(i=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=n;var d=zn.hmac(this._hash,i,t);this._hmac=new zn.HMAC(e,d),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return r.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},r.prototype.expand=function(e){for(var t=new Uint8Array(e),i=0;i<t.length;i++)this._bufpos===this._buffer.length&&this._fillBuffer(),t[i]=this._buffer[this._bufpos++];return t},r.prototype.clean=function(){this._hmac.clean(),Hn.wipe(this._buffer),Hn.wipe(this._counter),this._bufpos=0},r}(),Qu=fo.HKDF=Zu,Xr={};(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=Gr,t=Ct;r.DIGEST_LENGTH=32,r.BLOCK_SIZE=64;var i=function(){function g(){this.digestLength=r.DIGEST_LENGTH,this.blockSize=r.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return g.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},g.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},g.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._temp),this.reset()},g.prototype.update=function(w,I){if(I===void 0&&(I=w.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var x=0;if(this._bytesHashed+=I,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&I>0;)this._buffer[this._bufferLength++]=w[x++],I--;this._bufferLength===this.blockSize&&(d(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(I>=this.blockSize&&(x=d(this._temp,this._state,w,x,I),I%=this.blockSize);I>0;)this._buffer[this._bufferLength++]=w[x++],I--;return this},g.prototype.finish=function(w){if(!this._finished){var I=this._bytesHashed,x=this._bufferLength,N=I/536870912|0,q=I<<3,C=I%64<56?64:128;this._buffer[x]=128;for(var A=x+1;A<C-8;A++)this._buffer[A]=0;e.writeUint32BE(N,this._buffer,C-8),e.writeUint32BE(q,this._buffer,C-4),d(this._temp,this._state,this._buffer,0,C),this._finished=!0}for(var A=0;A<this.digestLength/4;A++)e.writeUint32BE(this._state[A],w,A*4);return this},g.prototype.digest=function(){var w=new Uint8Array(this.digestLength);return this.finish(w),w},g.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},g.prototype.restoreState=function(w){return this._state.set(w.state),this._bufferLength=w.bufferLength,w.buffer&&this._buffer.set(w.buffer),this._bytesHashed=w.bytesHashed,this._finished=!1,this},g.prototype.cleanSavedState=function(w){t.wipe(w.state),w.buffer&&t.wipe(w.buffer),w.bufferLength=0,w.bytesHashed=0},g}();r.SHA256=i;var n=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function d(g,w,I,x,N){for(;N>=64;){for(var q=w[0],C=w[1],A=w[2],z=w[3],j=w[4],G=w[5],b=w[6],D=w[7],m=0;m<16;m++){var v=x+m*4;g[m]=e.readUint32BE(I,v)}for(var m=16;m<64;m++){var p=g[m-2],s=(p>>>17|p<<32-17)^(p>>>19|p<<32-19)^p>>>10;p=g[m-15];var h=(p>>>7|p<<32-7)^(p>>>18|p<<32-18)^p>>>3;g[m]=(s+g[m-7]|0)+(h+g[m-16]|0)}for(var m=0;m<64;m++){var s=(((j>>>6|j<<26)^(j>>>11|j<<21)^(j>>>25|j<<7))+(j&G^~j&b)|0)+(D+(n[m]+g[m]|0)|0)|0,h=((q>>>2|q<<32-2)^(q>>>13|q<<32-13)^(q>>>22|q<<32-22))+(q&C^q&A^C&A)|0;D=b,b=G,G=j,j=z+s|0,z=A,A=C,C=q,q=s+h|0}w[0]+=q,w[1]+=C,w[2]+=A,w[3]+=z,w[4]+=j,w[5]+=G,w[6]+=b,w[7]+=D,x+=64,N-=64}return x}function _(g){var w=new i;w.update(g);var I=w.digest();return w.clean(),I}r.hash=_})(Xr);var Mi={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.sharedKey=r.generateKeyPair=r.generateKeyPairFromSeed=r.scalarMultBase=r.scalarMult=r.SHARED_KEY_LENGTH=r.SECRET_KEY_LENGTH=r.PUBLIC_KEY_LENGTH=void 0;const e=Er,t=Ct;r.PUBLIC_KEY_LENGTH=32,r.SECRET_KEY_LENGTH=32,r.SHARED_KEY_LENGTH=32;function i(m){const v=new Float64Array(16);if(m)for(let p=0;p<m.length;p++)v[p]=m[p];return v}const n=new Uint8Array(32);n[0]=9;const d=i([56129,1]);function _(m){let v=1;for(let p=0;p<16;p++){let s=m[p]+v+65535;v=Math.floor(s/65536),m[p]=s-v*65536}m[0]+=v-1+37*(v-1)}function g(m,v,p){const s=~(p-1);for(let h=0;h<16;h++){const L=s&(m[h]^v[h]);m[h]^=L,v[h]^=L}}function w(m,v){const p=i(),s=i();for(let h=0;h<16;h++)s[h]=v[h];_(s),_(s),_(s);for(let h=0;h<2;h++){p[0]=s[0]-65517;for(let o=1;o<15;o++)p[o]=s[o]-65535-(p[o-1]>>16&1),p[o-1]&=65535;p[15]=s[15]-32767-(p[14]>>16&1);const L=p[15]>>16&1;p[14]&=65535,g(s,p,1-L)}for(let h=0;h<16;h++)m[2*h]=s[h]&255,m[2*h+1]=s[h]>>8}function I(m,v){for(let p=0;p<16;p++)m[p]=v[2*p]+(v[2*p+1]<<8);m[15]&=32767}function x(m,v,p){for(let s=0;s<16;s++)m[s]=v[s]+p[s]}function N(m,v,p){for(let s=0;s<16;s++)m[s]=v[s]-p[s]}function q(m,v,p){let s,h,L=0,o=0,c=0,u=0,y=0,l=0,f=0,O=0,P=0,H=0,E=0,R=0,B=0,K=0,V=0,X=0,Y=0,ee=0,$=0,M=0,F=0,a=0,T=0,k=0,Z=0,fe=0,ye=0,le=0,me=0,Fe=0,Ae=0,pe=p[0],de=p[1],he=p[2],ce=p[3],ae=p[4],oe=p[5],se=p[6],re=p[7],ue=p[8],ge=p[9],ie=p[10],_e=p[11],be=p[12],ve=p[13],Ee=p[14],we=p[15];s=v[0],L+=s*pe,o+=s*de,c+=s*he,u+=s*ce,y+=s*ae,l+=s*oe,f+=s*se,O+=s*re,P+=s*ue,H+=s*ge,E+=s*ie,R+=s*_e,B+=s*be,K+=s*ve,V+=s*Ee,X+=s*we,s=v[1],o+=s*pe,c+=s*de,u+=s*he,y+=s*ce,l+=s*ae,f+=s*oe,O+=s*se,P+=s*re,H+=s*ue,E+=s*ge,R+=s*ie,B+=s*_e,K+=s*be,V+=s*ve,X+=s*Ee,Y+=s*we,s=v[2],c+=s*pe,u+=s*de,y+=s*he,l+=s*ce,f+=s*ae,O+=s*oe,P+=s*se,H+=s*re,E+=s*ue,R+=s*ge,B+=s*ie,K+=s*_e,V+=s*be,X+=s*ve,Y+=s*Ee,ee+=s*we,s=v[3],u+=s*pe,y+=s*de,l+=s*he,f+=s*ce,O+=s*ae,P+=s*oe,H+=s*se,E+=s*re,R+=s*ue,B+=s*ge,K+=s*ie,V+=s*_e,X+=s*be,Y+=s*ve,ee+=s*Ee,$+=s*we,s=v[4],y+=s*pe,l+=s*de,f+=s*he,O+=s*ce,P+=s*ae,H+=s*oe,E+=s*se,R+=s*re,B+=s*ue,K+=s*ge,V+=s*ie,X+=s*_e,Y+=s*be,ee+=s*ve,$+=s*Ee,M+=s*we,s=v[5],l+=s*pe,f+=s*de,O+=s*he,P+=s*ce,H+=s*ae,E+=s*oe,R+=s*se,B+=s*re,K+=s*ue,V+=s*ge,X+=s*ie,Y+=s*_e,ee+=s*be,$+=s*ve,M+=s*Ee,F+=s*we,s=v[6],f+=s*pe,O+=s*de,P+=s*he,H+=s*ce,E+=s*ae,R+=s*oe,B+=s*se,K+=s*re,V+=s*ue,X+=s*ge,Y+=s*ie,ee+=s*_e,$+=s*be,M+=s*ve,F+=s*Ee,a+=s*we,s=v[7],O+=s*pe,P+=s*de,H+=s*he,E+=s*ce,R+=s*ae,B+=s*oe,K+=s*se,V+=s*re,X+=s*ue,Y+=s*ge,ee+=s*ie,$+=s*_e,M+=s*be,F+=s*ve,a+=s*Ee,T+=s*we,s=v[8],P+=s*pe,H+=s*de,E+=s*he,R+=s*ce,B+=s*ae,K+=s*oe,V+=s*se,X+=s*re,Y+=s*ue,ee+=s*ge,$+=s*ie,M+=s*_e,F+=s*be,a+=s*ve,T+=s*Ee,k+=s*we,s=v[9],H+=s*pe,E+=s*de,R+=s*he,B+=s*ce,K+=s*ae,V+=s*oe,X+=s*se,Y+=s*re,ee+=s*ue,$+=s*ge,M+=s*ie,F+=s*_e,a+=s*be,T+=s*ve,k+=s*Ee,Z+=s*we,s=v[10],E+=s*pe,R+=s*de,B+=s*he,K+=s*ce,V+=s*ae,X+=s*oe,Y+=s*se,ee+=s*re,$+=s*ue,M+=s*ge,F+=s*ie,a+=s*_e,T+=s*be,k+=s*ve,Z+=s*Ee,fe+=s*we,s=v[11],R+=s*pe,B+=s*de,K+=s*he,V+=s*ce,X+=s*ae,Y+=s*oe,ee+=s*se,$+=s*re,M+=s*ue,F+=s*ge,a+=s*ie,T+=s*_e,k+=s*be,Z+=s*ve,fe+=s*Ee,ye+=s*we,s=v[12],B+=s*pe,K+=s*de,V+=s*he,X+=s*ce,Y+=s*ae,ee+=s*oe,$+=s*se,M+=s*re,F+=s*ue,a+=s*ge,T+=s*ie,k+=s*_e,Z+=s*be,fe+=s*ve,ye+=s*Ee,le+=s*we,s=v[13],K+=s*pe,V+=s*de,X+=s*he,Y+=s*ce,ee+=s*ae,$+=s*oe,M+=s*se,F+=s*re,a+=s*ue,T+=s*ge,k+=s*ie,Z+=s*_e,fe+=s*be,ye+=s*ve,le+=s*Ee,me+=s*we,s=v[14],V+=s*pe,X+=s*de,Y+=s*he,ee+=s*ce,$+=s*ae,M+=s*oe,F+=s*se,a+=s*re,T+=s*ue,k+=s*ge,Z+=s*ie,fe+=s*_e,ye+=s*be,le+=s*ve,me+=s*Ee,Fe+=s*we,s=v[15],X+=s*pe,Y+=s*de,ee+=s*he,$+=s*ce,M+=s*ae,F+=s*oe,a+=s*se,T+=s*re,k+=s*ue,Z+=s*ge,fe+=s*ie,ye+=s*_e,le+=s*be,me+=s*ve,Fe+=s*Ee,Ae+=s*we,L+=38*Y,o+=38*ee,c+=38*$,u+=38*M,y+=38*F,l+=38*a,f+=38*T,O+=38*k,P+=38*Z,H+=38*fe,E+=38*ye,R+=38*le,B+=38*me,K+=38*Fe,V+=38*Ae,h=1,s=L+h+65535,h=Math.floor(s/65536),L=s-h*65536,s=o+h+65535,h=Math.floor(s/65536),o=s-h*65536,s=c+h+65535,h=Math.floor(s/65536),c=s-h*65536,s=u+h+65535,h=Math.floor(s/65536),u=s-h*65536,s=y+h+65535,h=Math.floor(s/65536),y=s-h*65536,s=l+h+65535,h=Math.floor(s/65536),l=s-h*65536,s=f+h+65535,h=Math.floor(s/65536),f=s-h*65536,s=O+h+65535,h=Math.floor(s/65536),O=s-h*65536,s=P+h+65535,h=Math.floor(s/65536),P=s-h*65536,s=H+h+65535,h=Math.floor(s/65536),H=s-h*65536,s=E+h+65535,h=Math.floor(s/65536),E=s-h*65536,s=R+h+65535,h=Math.floor(s/65536),R=s-h*65536,s=B+h+65535,h=Math.floor(s/65536),B=s-h*65536,s=K+h+65535,h=Math.floor(s/65536),K=s-h*65536,s=V+h+65535,h=Math.floor(s/65536),V=s-h*65536,s=X+h+65535,h=Math.floor(s/65536),X=s-h*65536,L+=h-1+37*(h-1),h=1,s=L+h+65535,h=Math.floor(s/65536),L=s-h*65536,s=o+h+65535,h=Math.floor(s/65536),o=s-h*65536,s=c+h+65535,h=Math.floor(s/65536),c=s-h*65536,s=u+h+65535,h=Math.floor(s/65536),u=s-h*65536,s=y+h+65535,h=Math.floor(s/65536),y=s-h*65536,s=l+h+65535,h=Math.floor(s/65536),l=s-h*65536,s=f+h+65535,h=Math.floor(s/65536),f=s-h*65536,s=O+h+65535,h=Math.floor(s/65536),O=s-h*65536,s=P+h+65535,h=Math.floor(s/65536),P=s-h*65536,s=H+h+65535,h=Math.floor(s/65536),H=s-h*65536,s=E+h+65535,h=Math.floor(s/65536),E=s-h*65536,s=R+h+65535,h=Math.floor(s/65536),R=s-h*65536,s=B+h+65535,h=Math.floor(s/65536),B=s-h*65536,s=K+h+65535,h=Math.floor(s/65536),K=s-h*65536,s=V+h+65535,h=Math.floor(s/65536),V=s-h*65536,s=X+h+65535,h=Math.floor(s/65536),X=s-h*65536,L+=h-1+37*(h-1),m[0]=L,m[1]=o,m[2]=c,m[3]=u,m[4]=y,m[5]=l,m[6]=f,m[7]=O,m[8]=P,m[9]=H,m[10]=E,m[11]=R,m[12]=B,m[13]=K,m[14]=V,m[15]=X}function C(m,v){q(m,v,v)}function A(m,v){const p=i();for(let s=0;s<16;s++)p[s]=v[s];for(let s=253;s>=0;s--)C(p,p),s!==2&&s!==4&&q(p,p,v);for(let s=0;s<16;s++)m[s]=p[s]}function z(m,v){const p=new Uint8Array(32),s=new Float64Array(80),h=i(),L=i(),o=i(),c=i(),u=i(),y=i();for(let P=0;P<31;P++)p[P]=m[P];p[31]=m[31]&127|64,p[0]&=248,I(s,v);for(let P=0;P<16;P++)L[P]=s[P];h[0]=c[0]=1;for(let P=254;P>=0;--P){const H=p[P>>>3]>>>(P&7)&1;g(h,L,H),g(o,c,H),x(u,h,o),N(h,h,o),x(o,L,c),N(L,L,c),C(c,u),C(y,h),q(h,o,h),q(o,L,u),x(u,h,o),N(h,h,o),C(L,h),N(o,c,y),q(h,o,d),x(h,h,c),q(o,o,h),q(h,c,y),q(c,L,s),C(L,u),g(h,L,H),g(o,c,H)}for(let P=0;P<16;P++)s[P+16]=h[P],s[P+32]=o[P],s[P+48]=L[P],s[P+64]=c[P];const l=s.subarray(32),f=s.subarray(16);A(l,l),q(f,f,l);const O=new Uint8Array(32);return w(O,f),O}r.scalarMult=z;function j(m){return z(m,n)}r.scalarMultBase=j;function G(m){if(m.length!==r.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${r.SECRET_KEY_LENGTH} bytes`);const v=new Uint8Array(m);return{publicKey:j(v),secretKey:v}}r.generateKeyPairFromSeed=G;function b(m){const v=(0,e.randomBytes)(32,m),p=G(v);return(0,t.wipe)(v),p}r.generateKeyPair=b;function D(m,v,p=!1){if(m.length!==r.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(v.length!==r.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const s=z(m,v);if(p){let h=0;for(let L=0;L<s.length;L++)h|=s[L];if(h===0)throw new Error("X25519: invalid shared key")}return s}r.sharedKey=D})(Mi);function lo(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}function qn(r,e){e||(e=r.reduce((n,d)=>n+d.length,0));const t=lo(e);let i=0;for(const n of r)t.set(n,i),i+=n.length;return t}function go(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const Kn=go("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),pi=go("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=lo(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),po={utf8:Kn,"utf-8":Kn,hex:qr.base16,latin1:pi,ascii:pi,binary:pi,...qr};function bt(r,e="utf8"){const t=po[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r,"utf8"):t.decoder.decode(`${t.prefix}${r}`)}function mt(r,e="utf8"){const t=po[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}var Bn=globalThis&&globalThis.__spreadArray||function(r,e,t){if(t||arguments.length===2)for(var i=0,n=e.length,d;i<n;i++)(d||!(i in e))&&(d||(d=Array.prototype.slice.call(e,0,i)),d[i]=e[i]);return r.concat(d||Array.prototype.slice.call(e))},ef=function(){function r(e,t,i){this.name=e,this.version=t,this.os=i,this.type="browser"}return r}(),tf=function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=St.platform}return r}(),rf=function(){function r(e,t,i,n){this.name=e,this.version=t,this.os=i,this.bot=n,this.type="bot-device"}return r}(),nf=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}(),sf=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}(),of=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,af=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Vn=3,cf=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",of]],Gn=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function uf(r){return r?Wn(r):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new sf:typeof navigator<"u"?Wn(navigator.userAgent):lf()}function ff(r){return r!==""&&cf.reduce(function(e,t){var i=t[0],n=t[1];if(e)return e;var d=n.exec(r);return!!d&&[i,d]},!1)}function Wn(r){var e=ff(r);if(!e)return null;var t=e[0],i=e[1];if(t==="searchbot")return new nf;var n=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);n?n.length<Vn&&(n=Bn(Bn([],n,!0),df(Vn-n.length),!0)):n=[];var d=n.join("."),_=hf(r),g=af.exec(r);return g&&g[1]?new rf(t,d,_,g[1]):new ef(t,d,_)}function hf(r){for(var e=0,t=Gn.length;e<t;e++){var i=Gn[e],n=i[0],d=i[1],_=d.exec(r);if(_)return n}return null}function lf(){var r=typeof St<"u"&&St.version;return r?new tf(St.version.slice(1)):null}function df(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}var Se={};Object.defineProperty(Se,"__esModule",{value:!0});Se.getLocalStorage=Se.getLocalStorageOrThrow=Se.getCrypto=Se.getCryptoOrThrow=_o=Se.getLocation=Se.getLocationOrThrow=$i=Se.getNavigator=Se.getNavigatorOrThrow=yo=Se.getDocument=Se.getDocumentOrThrow=Se.getFromWindowOrThrow=Se.getFromWindow=void 0;function Xt(r){let e;return typeof window<"u"&&typeof window[r]<"u"&&(e=window[r]),e}Se.getFromWindow=Xt;function sr(r){const e=Xt(r);if(!e)throw new Error(`${r} is not defined in Window`);return e}Se.getFromWindowOrThrow=sr;function gf(){return sr("document")}Se.getDocumentOrThrow=gf;function pf(){return Xt("document")}var yo=Se.getDocument=pf;function yf(){return sr("navigator")}Se.getNavigatorOrThrow=yf;function _f(){return Xt("navigator")}var $i=Se.getNavigator=_f;function bf(){return sr("location")}Se.getLocationOrThrow=bf;function mf(){return Xt("location")}var _o=Se.getLocation=mf;function wf(){return sr("crypto")}Se.getCryptoOrThrow=wf;function vf(){return Xt("crypto")}Se.getCrypto=vf;function Ef(){return sr("localStorage")}Se.getLocalStorageOrThrow=Ef;function Df(){return Xt("localStorage")}Se.getLocalStorage=Df;var zi={};Object.defineProperty(zi,"__esModule",{value:!0});var bo=zi.getWindowMetadata=void 0;const kn=Se;function Sf(){let r,e;try{r=kn.getDocumentOrThrow(),e=kn.getLocationOrThrow()}catch{return null}function t(){const N=r.getElementsByTagName("link"),q=[];for(let C=0;C<N.length;C++){const A=N[C],z=A.getAttribute("rel");if(z&&z.toLowerCase().indexOf("icon")>-1){const j=A.getAttribute("href");if(j)if(j.toLowerCase().indexOf("https:")===-1&&j.toLowerCase().indexOf("http:")===-1&&j.indexOf("//")!==0){let G=e.protocol+"//"+e.host;if(j.indexOf("/")===0)G+=j;else{const b=e.pathname.split("/");b.pop();const D=b.join("/");G+=D+"/"+j}q.push(G)}else if(j.indexOf("//")===0){const G=e.protocol+j;q.push(G)}else q.push(j)}}return q}function i(...N){const q=r.getElementsByTagName("meta");for(let C=0;C<q.length;C++){const A=q[C],z=["itemprop","property","name"].map(j=>A.getAttribute(j)).filter(j=>j?N.includes(j):!1);if(z.length&&z){const j=A.getAttribute("content");if(j)return j}}return""}function n(){let N=i("name","og:site_name","og:title","twitter:title");return N||(N=r.title),N}function d(){return i("description","og:description","twitter:description","keywords")}const _=n(),g=d(),w=e.origin,I=t();return{description:g,url:w,icons:I,name:_}}bo=zi.getWindowMetadata=Sf;var vr={},mo=function(r,e){for(var t={},i=Object.keys(r),n=Array.isArray(e),d=0;d<i.length;d++){var _=i[d],g=r[_];(n?e.indexOf(_)!==-1:e(_,g,r))&&(t[_]=g)}return t};(function(r){const e=Bs,t=Vs,i=Ks,n=mo,d=b=>b==null,_=Symbol("encodeFragmentIdentifier");function g(b){switch(b.arrayFormat){case"index":return D=>(m,v)=>{const p=m.length;return v===void 0||b.skipNull&&v===null||b.skipEmptyString&&v===""?m:v===null?[...m,[x(D,b),"[",p,"]"].join("")]:[...m,[x(D,b),"[",x(p,b),"]=",x(v,b)].join("")]};case"bracket":return D=>(m,v)=>v===void 0||b.skipNull&&v===null||b.skipEmptyString&&v===""?m:v===null?[...m,[x(D,b),"[]"].join("")]:[...m,[x(D,b),"[]=",x(v,b)].join("")];case"colon-list-separator":return D=>(m,v)=>v===void 0||b.skipNull&&v===null||b.skipEmptyString&&v===""?m:v===null?[...m,[x(D,b),":list="].join("")]:[...m,[x(D,b),":list=",x(v,b)].join("")];case"comma":case"separator":case"bracket-separator":{const D=b.arrayFormat==="bracket-separator"?"[]=":"=";return m=>(v,p)=>p===void 0||b.skipNull&&p===null||b.skipEmptyString&&p===""?v:(p=p===null?"":p,v.length===0?[[x(m,b),D,x(p,b)].join("")]:[[v,x(p,b)].join(b.arrayFormatSeparator)])}default:return D=>(m,v)=>v===void 0||b.skipNull&&v===null||b.skipEmptyString&&v===""?m:v===null?[...m,x(D,b)]:[...m,[x(D,b),"=",x(v,b)].join("")]}}function w(b){let D;switch(b.arrayFormat){case"index":return(m,v,p)=>{if(D=/\[(\d*)\]$/.exec(m),m=m.replace(/\[\d*\]$/,""),!D){p[m]=v;return}p[m]===void 0&&(p[m]={}),p[m][D[1]]=v};case"bracket":return(m,v,p)=>{if(D=/(\[\])$/.exec(m),m=m.replace(/\[\]$/,""),!D){p[m]=v;return}if(p[m]===void 0){p[m]=[v];return}p[m]=[].concat(p[m],v)};case"colon-list-separator":return(m,v,p)=>{if(D=/(:list)$/.exec(m),m=m.replace(/:list$/,""),!D){p[m]=v;return}if(p[m]===void 0){p[m]=[v];return}p[m]=[].concat(p[m],v)};case"comma":case"separator":return(m,v,p)=>{const s=typeof v=="string"&&v.includes(b.arrayFormatSeparator),h=typeof v=="string"&&!s&&N(v,b).includes(b.arrayFormatSeparator);v=h?N(v,b):v;const L=s||h?v.split(b.arrayFormatSeparator).map(o=>N(o,b)):v===null?v:N(v,b);p[m]=L};case"bracket-separator":return(m,v,p)=>{const s=/(\[\])$/.test(m);if(m=m.replace(/\[\]$/,""),!s){p[m]=v&&N(v,b);return}const h=v===null?[]:v.split(b.arrayFormatSeparator).map(L=>N(L,b));if(p[m]===void 0){p[m]=h;return}p[m]=[].concat(p[m],h)};default:return(m,v,p)=>{if(p[m]===void 0){p[m]=v;return}p[m]=[].concat(p[m],v)}}}function I(b){if(typeof b!="string"||b.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function x(b,D){return D.encode?D.strict?e(b):encodeURIComponent(b):b}function N(b,D){return D.decode?t(b):b}function q(b){return Array.isArray(b)?b.sort():typeof b=="object"?q(Object.keys(b)).sort((D,m)=>Number(D)-Number(m)).map(D=>b[D]):b}function C(b){const D=b.indexOf("#");return D!==-1&&(b=b.slice(0,D)),b}function A(b){let D="";const m=b.indexOf("#");return m!==-1&&(D=b.slice(m)),D}function z(b){b=C(b);const D=b.indexOf("?");return D===-1?"":b.slice(D+1)}function j(b,D){return D.parseNumbers&&!Number.isNaN(Number(b))&&typeof b=="string"&&b.trim()!==""?b=Number(b):D.parseBooleans&&b!==null&&(b.toLowerCase()==="true"||b.toLowerCase()==="false")&&(b=b.toLowerCase()==="true"),b}function G(b,D){D=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},D),I(D.arrayFormatSeparator);const m=w(D),v=Object.create(null);if(typeof b!="string"||(b=b.trim().replace(/^[?#&]/,""),!b))return v;for(const p of b.split("&")){if(p==="")continue;let[s,h]=i(D.decode?p.replace(/\+/g," "):p,"=");h=h===void 0?null:["comma","separator","bracket-separator"].includes(D.arrayFormat)?h:N(h,D),m(N(s,D),h,v)}for(const p of Object.keys(v)){const s=v[p];if(typeof s=="object"&&s!==null)for(const h of Object.keys(s))s[h]=j(s[h],D);else v[p]=j(s,D)}return D.sort===!1?v:(D.sort===!0?Object.keys(v).sort():Object.keys(v).sort(D.sort)).reduce((p,s)=>{const h=v[s];return Boolean(h)&&typeof h=="object"&&!Array.isArray(h)?p[s]=q(h):p[s]=h,p},Object.create(null))}r.extract=z,r.parse=G,r.stringify=(b,D)=>{if(!b)return"";D=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},D),I(D.arrayFormatSeparator);const m=h=>D.skipNull&&d(b[h])||D.skipEmptyString&&b[h]==="",v=g(D),p={};for(const h of Object.keys(b))m(h)||(p[h]=b[h]);const s=Object.keys(p);return D.sort!==!1&&s.sort(D.sort),s.map(h=>{const L=b[h];return L===void 0?"":L===null?x(h,D):Array.isArray(L)?L.length===0&&D.arrayFormat==="bracket-separator"?x(h,D)+"[]":L.reduce(v(h),[]).join("&"):x(h,D)+"="+x(L,D)}).filter(h=>h.length>0).join("&")},r.parseUrl=(b,D)=>{D=Object.assign({decode:!0},D);const[m,v]=i(b,"#");return Object.assign({url:m.split("?")[0]||"",query:G(z(b),D)},D&&D.parseFragmentIdentifier&&v?{fragmentIdentifier:N(v,D)}:{})},r.stringifyUrl=(b,D)=>{D=Object.assign({encode:!0,strict:!0,[_]:!0},D);const m=C(b.url).split("?")[0]||"",v=r.extract(b.url),p=r.parse(v,{sort:!1}),s=Object.assign(p,b.query);let h=r.stringify(s,D);h&&(h=`?${h}`);let L=A(b.url);return b.fragmentIdentifier&&(L=`#${D[_]?x(b.fragmentIdentifier,D):b.fragmentIdentifier}`),`${m}${h}${L}`},r.pick=(b,D,m)=>{m=Object.assign({parseFragmentIdentifier:!0,[_]:!1},m);const{url:v,query:p,fragmentIdentifier:s}=r.parseUrl(b,m);return r.stringifyUrl({url:v,query:n(p,D),fragmentIdentifier:s},m)},r.exclude=(b,D,m)=>{const v=Array.isArray(D)?p=>!D.includes(p):(p,s)=>!D(p,s);return r.pick(b,v,m)}})(vr);const Of={waku:{publish:"waku_publish",subscribe:"waku_subscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe"},irn:{publish:"irn_publish",subscribe:"irn_subscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe"},iridium:{publish:"iridium_publish",subscribe:"iridium_subscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe"}},wo="base10",at="base16",Ei="base64pad",Hi="utf8",vo=0,Zt=1,xf=0,Yn=1,Di=12,qi=32;function If(){const r=Mi.generateKeyPair();return{privateKey:mt(r.secretKey,at),publicKey:mt(r.publicKey,at)}}function Si(){const r=Er.randomBytes(qi);return mt(r,at)}function Tf(r,e){const t=Mi.sharedKey(bt(r,at),bt(e,at)),i=new Qu(Xr.SHA256,t).expand(qi);return mt(i,at)}function Pf(r){const e=Xr.hash(bt(r,at));return mt(e,at)}function Oi(r){const e=Xr.hash(bt(r,Hi));return mt(e,at)}function Af(r){return bt(`${r}`,wo)}function Ir(r){return Number(mt(r,wo))}function Nf(r){const e=Af(typeof r.type<"u"?r.type:vo);if(Ir(e)===Zt&&typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof r.senderPublicKey<"u"?bt(r.senderPublicKey,at):void 0,i=typeof r.iv<"u"?bt(r.iv,at):Er.randomBytes(Di),n=new ji.ChaCha20Poly1305(bt(r.symKey,at)).seal(i,bt(r.message,Hi));return Rf({type:e,sealed:n,iv:i,senderPublicKey:t})}function Cf(r){const e=new ji.ChaCha20Poly1305(bt(r.symKey,at)),{sealed:t,iv:i}=Ki(r.encoded),n=e.open(i,t);if(n===null)throw new Error("Failed to decrypt");return mt(n,Hi)}function Rf(r){if(Ir(r.type)===Zt){if(typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return mt(qn([r.type,r.senderPublicKey,r.iv,r.sealed]),Ei)}return mt(qn([r.type,r.iv,r.sealed]),Ei)}function Ki(r){const e=bt(r,Ei),t=e.slice(xf,Yn),i=Yn;if(Ir(t)===Zt){const g=i+qi,w=g+Di,I=e.slice(i,g),x=e.slice(g,w),N=e.slice(w);return{type:t,sealed:N,iv:x,senderPublicKey:I}}const n=i+Di,d=e.slice(i,n),_=e.slice(n);return{type:t,sealed:_,iv:d}}function Ff(r,e){const t=Ki(r);return Eo({type:Ir(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?mt(t.senderPublicKey,at):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Eo(r){const e=(r==null?void 0:r.type)||vo;if(e===Zt){if(typeof(r==null?void 0:r.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(r==null?void 0:r.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:r==null?void 0:r.senderPublicKey,receiverPublicKey:r==null?void 0:r.receiverPublicKey}}function Jn(r){return r.type===Zt&&typeof r.senderPublicKey=="string"&&typeof r.receiverPublicKey=="string"}var Uf=Object.defineProperty,Xn=Object.getOwnPropertySymbols,jf=Object.prototype.hasOwnProperty,Lf=Object.prototype.propertyIsEnumerable,Zn=(r,e,t)=>e in r?Uf(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Qn=(r,e)=>{for(var t in e||(e={}))jf.call(e,t)&&Zn(r,t,e[t]);if(Xn)for(var t of Xn(e))Lf.call(e,t)&&Zn(r,t,e[t]);return r};const Mf="ReactNative",br={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},$f="js";function Do(){return typeof St<"u"&&typeof St.versions<"u"&&typeof St.versions.node<"u"}function zf(){return!yo()&&!!$i()&&navigator.product===Mf}function Hf(){return!Do()&&!!$i()}function qf(){return zf()?br.reactNative:Do()?br.node:Hf()?br.browser:br.unknown}function Kf(r,e){let t=vr.parse(r);return t=Qn(Qn({},t),e),r=vr.stringify(t),r}function Bf(){return bo()||{name:"",description:"",url:"",icons:[""]}}function Vf(){const r=uf();if(r===null)return"unknown";const e=r.os?r.os.replace(" ","").toLowerCase():"unknown";return r.type==="browser"?[e,r.name,r.version].join("-"):[e,r.version].join("-")}function Gf(){var r;const e=qf();return e===br.browser?[e,((r=_o())==null?void 0:r.host)||"unknown"].join(":"):e}function Wf(r,e,t){const i=Vf(),n=Gf();return[[r,e].join("-"),[$f,t].join("-"),i,n].join("/")}function kf({protocol:r,version:e,relayUrl:t,sdkVersion:i,auth:n,projectId:d}){const _=t.split("?"),g=Wf(r,e,i),w={auth:n,ua:g,projectId:d},I=Kf(_[1]||"",w);return _[0]+"?"+I}function ot(r,e){return r.filter(t=>e.includes(t)).length===r.length}function So(r){return Object.fromEntries(r.entries())}function Oo(r){return new Map(Object.entries(r))}function Nt(r,e){return te.fromMiliseconds((e||Date.now())+te.toMiliseconds(r))}function Mt(r){return te.fromMiliseconds(Date.now())>=te.toMiliseconds(r)}function Yt(){const r=te.toMiliseconds(te.FIVE_MINUTES);let e,t,i;return{resolve:n=>{i&&e&&(clearTimeout(i),e(n))},reject:n=>{i&&t&&(clearTimeout(i),t(n))},done:()=>new Promise((n,d)=>{i=setTimeout(d,r),e=n,t=d})}}function xo(r,e){return new Promise(async(t,i)=>{const n=setTimeout(()=>i(),e),d=await r;clearTimeout(n),t(d)})}function Io(r,e){if(typeof e=="string"&&e.startsWith(`${r}:`))return e;if(r.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(r.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${r}`)}function Yf(r){return Io("topic",r)}function Jf(r){return Io("id",r)}function To(r){const[e,t]=r.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")i.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))i.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return i}function Ue(r,e){return`${r}${e?`:${e}`:""}`}const Xf="irn";function xi(r){return(r==null?void 0:r.relay)||{protocol:Xf}}function Ii(r){const e=Of[r];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${r}`);return e}var Zf=Object.defineProperty,es=Object.getOwnPropertySymbols,Qf=Object.prototype.hasOwnProperty,eh=Object.prototype.propertyIsEnumerable,ts=(r,e,t)=>e in r?Zf(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,th=(r,e)=>{for(var t in e||(e={}))Qf.call(e,t)&&ts(r,t,e[t]);if(es)for(var t of es(e))eh.call(e,t)&&ts(r,t,e[t]);return r};function rh(r,e="-"){const t={},i="relay"+e;return Object.keys(r).forEach(n=>{if(n.startsWith(i)){const d=n.replace(i,""),_=r[n];t[d]=_}}),t}function ih(r){const e=r.indexOf(":"),t=r.indexOf("?")!==-1?r.indexOf("?"):void 0,i=r.substring(0,e),n=r.substring(e+1,t).split("@"),d=typeof t<"u"?r.substring(t):"",_=vr.parse(d);return{protocol:i,topic:n[0],version:parseInt(n[1],10),symKey:_.symKey,relay:rh(_)}}function nh(r,e="-"){const t="relay",i={};return Object.keys(r).forEach(n=>{const d=t+e+n;r[n]&&(i[d]=r[n])}),i}function sh(r){return`${r.protocol}:${r.topic}@${r.version}?`+vr.stringify(th({symKey:r.symKey},nh(r.relay)))}function Ot(r){const e=[];return r.forEach(t=>{const[i,n]=t.split(":");e.push(`${i}:${n}`)}),e}function oh(r){const e=[];return Object.values(r).forEach(t=>{e.push(...Ot(t.accounts)),t.extension&&t.extension.forEach(i=>{e.push(...Ot(i.accounts))})}),e}function ah(r,e){const t=[];return Object.values(r).forEach(i=>{Ot(i.accounts).includes(e)&&t.push(...i.methods),i.extension&&i.extension.forEach(n=>{Ot(n.accounts).includes(e)&&t.push(...n.methods)})}),t}function ch(r,e){const t=[];return Object.values(r).forEach(i=>{Ot(i.accounts).includes(e)&&t.push(...i.events),i.extension&&i.extension.forEach(n=>{Ot(n.accounts).includes(e)&&t.push(...n.events)})}),t}const uh={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},fh={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function J(r,e){const{message:t,code:i}=fh[r];return{message:e?`${t} ${e}`:t,code:i}}function Je(r,e){const{message:t,code:i}=uh[r];return{message:e?`${t} ${e}`:t,code:i}}function Tr(r,e){return Array.isArray(r)?typeof e<"u"&&r.length?r.every(e):!0:!1}function Po(r){return Object.getPrototypeOf(r)===Object.prototype&&Object.keys(r).length}function gt(r){return typeof r>"u"}function Ze(r,e){return e&&gt(r)?!0:typeof r=="string"&&Boolean(r.trim().length)}function Ao(r,e){return e&&gt(r)?!0:typeof r=="number"&&!isNaN(r)}function hh(r,e){const{requiredNamespaces:t}=e,i=Object.keys(r.namespaces),n=Object.keys(t);let d=!0;return ot(n,i)?(i.forEach(_=>{const{accounts:g,methods:w,events:I,extension:x}=r.namespaces[_],N=Ot(g),q=t[_];(!ot(q.chains,N)||!ot(q.methods,w)||!ot(q.events,I))&&(d=!1),d&&x&&x.forEach(C=>{var A;const{accounts:z,methods:j,events:G}=C,b=Ot(z);(A=q.extension)!=null&&A.find(D=>ot(D.chains,b)&&ot(D.methods,j)&&ot(D.events,G))||(d=!1)})}),d):!1}function Bi(r){return Ze(r,!1)&&r.includes(":")?r.split(":").length===2:!1}function lh(r){if(Ze(r,!1)&&r.includes(":")){const e=r.split(":");if(e.length===3){const t=e[0]+":"+e[1];return!!e[2]&&Bi(t)}}return!1}function dh(r){if(Ze(r,!1))try{return typeof new URL(r)<"u"}catch{return!1}return!1}function gh(r){var e;return(e=r==null?void 0:r.proposer)==null?void 0:e.publicKey}function ph(r){return r==null?void 0:r.topic}function yh(r,e){let t=null;return Ze(r==null?void 0:r.publicKey,!1)||(t=J("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function Vi(r,e){let t=null;return gt(r==null?void 0:r.extension)||(!Tr(r.extension)||!r.extension.length)&&(t=J("MISSING_OR_INVALID",`${e} extension should be an array of namespaces, or omitted`)),t}function rs(r){let e=!0;return Tr(r)?r.length&&(e=r.every(t=>Ze(t,!1))):e=!1,e}function is(r,e,t){let i=null;return Tr(e)?e.forEach(n=>{i||(!Bi(n)||!n.includes(r))&&(i=Je("UNSUPPORTED_CHAINS",`${t}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):i=Je("UNSUPPORTED_CHAINS",`${t}, chains ${e} should be an array of strings conforming to "namespace:chainId" format`),i}function _h(r,e){let t=null;return Object.entries(r).forEach(([i,n])=>{if(t)return;const d=is(i,n==null?void 0:n.chains,`${e} requiredNamespace`),_=Vi(n,e);d?t=d:_?t=_:n.extension&&n.extension.forEach(g=>{if(t)return;const w=is(i,g.chains,`${e} extension`);w&&(t=w)})}),t}function ns(r,e){let t=null;return Tr(r)?r.forEach(i=>{t||lh(i)||(t=Je("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):t=Je("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function bh(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const n=ns(i==null?void 0:i.accounts,`${e} namespace`),d=Vi(i,e);n?t=n:d?t=d:i.extension&&i.extension.forEach(_=>{if(t)return;const g=ns(_.accounts,`${e} extension`);g&&(t=g)})}),t}function ss(r,e){let t=null;return rs(r==null?void 0:r.methods)?rs(r==null?void 0:r.events)||(t=Je("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=Je("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function No(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const n=ss(i,`${e}, namespace`),d=Vi(i,e);n?t=n:d?t=d:i.extension&&i.extension.forEach(_=>{if(t)return;const g=ss(_,`${e}, extension`);g&&(t=g)})}),t}function mh(r,e){let t=null;if(r&&Po(r)){const i=No(r,e);i&&(t=i);const n=_h(r,e);n&&(t=n)}else t=J("MISSING_OR_INVALID",`${e}, requiredNamespaces should be an object with data`);return t}function yi(r,e){let t=null;if(r&&Po(r)){const i=No(r,e);i&&(t=i);const n=bh(r,e);n&&(t=n)}else t=J("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function Co(r){return Ze(r.protocol,!0)}function wh(r,e){let t=!1;return e&&!r?t=!0:r&&Tr(r)&&r.length&&r.forEach(i=>{t=Co(i)}),t}function vh(r){return typeof r=="number"}function nt(r){return typeof r<"u"&&typeof r!==null}function Eh(r){return!(!r||typeof r!="object"||!r.code||!Ao(r.code,!1)||!r.message||!Ze(r.message,!1))}function Dh(r){return!(gt(r)||!Ze(r.method,!1))}function Sh(r){return!(gt(r)||gt(r.result)&&gt(r.error)||!Ao(r.id,!1)||!Ze(r.jsonrpc,!1))}function Oh(r){return!(gt(r)||!Ze(r.name,!1))}function os(r,e){return!(!Bi(e)||!oh(r).includes(e))}function xh(r,e,t){return Ze(t,!1)?ah(r,e).includes(t):!1}function Ih(r,e,t){return Ze(t,!1)?ch(r,e).includes(t):!1}function as(r,e,t){let i=null;const n=Object.keys(r),d=Object.keys(e);return ot(n,d)?n.forEach(_=>{var g;if(i)return;const w=r[_].chains,I=Ot(e[_].accounts);ot(w,I)?ot(r[_].methods,e[_].methods)?ot(r[_].events,e[_].events)?r[_].extension&&!e[_].extension?i=J("NON_CONFORMING_NAMESPACES",`${t} namespaces extension doesn't satisfy requiredNamespaces extension for ${_}`):r[_].extension&&e[_].extension&&((g=r[_].extension)==null||g.forEach(({methods:x,events:N,chains:q})=>{var C;i||(C=e[_].extension)!=null&&C.find(A=>{const z=Ot(A.accounts);return ot(q,z)&&ot(N,A.events)&&ot(x,A.methods)})||(i=J("NON_CONFORMING_NAMESPACES",`${t} namespaces extension doesn't satisfy requiredNamespaces extension for ${_}`))})):i=J("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy requiredNamespaces events for ${_}`):i=J("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy requiredNamespaces methods for ${_}`):i=J("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy requiredNamespaces chains for ${_}`)}):i=J("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces`),i}const Th="PARSE_ERROR",Ph="INVALID_REQUEST",Ah="METHOD_NOT_FOUND",Nh="INVALID_PARAMS",Ro="INTERNAL_ERROR",Gi="SERVER_ERROR",Ch=[-32700,-32600,-32601,-32602,-32603],mr={[Th]:{code:-32700,message:"Parse error"},[Ph]:{code:-32600,message:"Invalid Request"},[Ah]:{code:-32601,message:"Method not found"},[Nh]:{code:-32602,message:"Invalid params"},[Ro]:{code:-32603,message:"Internal error"},[Gi]:{code:-32e3,message:"Server error"}},Fo=Gi;function Rh(r){return Ch.includes(r)}function cs(r){return Object.keys(mr).includes(r)?mr[r]:mr[Fo]}function Fh(r){const e=Object.values(mr).find(t=>t.code===r);return e||mr[Fo]}function Uo(r,e,t){return r.message.includes("getaddrinfo ENOTFOUND")||r.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${t} RPC url at ${e}`):r}var jo={},Ti={},Uh={get exports(){return Ti},set exports(r){Ti=r}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(r){var e,t,i,n,d,_,g,w,I,x,N,q,C,A,z,j,G,b,D,m,v,p,s;(function(h){var L=typeof Pe=="object"?Pe:typeof self=="object"?self:typeof this=="object"?this:{};h(o(L,o(r.exports)));function o(c,u){return c!==L&&(typeof Object.create=="function"?Object.defineProperty(c,"__esModule",{value:!0}):c.__esModule=!0),function(y,l){return c[y]=u?u(y,l):l}}})(function(h){var L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,c){o.__proto__=c}||function(o,c){for(var u in c)c.hasOwnProperty(u)&&(o[u]=c[u])};e=function(o,c){L(o,c);function u(){this.constructor=o}o.prototype=c===null?Object.create(c):(u.prototype=c.prototype,new u)},t=Object.assign||function(o){for(var c,u=1,y=arguments.length;u<y;u++){c=arguments[u];for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(o[l]=c[l])}return o},i=function(o,c){var u={};for(var y in o)Object.prototype.hasOwnProperty.call(o,y)&&c.indexOf(y)<0&&(u[y]=o[y]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,y=Object.getOwnPropertySymbols(o);l<y.length;l++)c.indexOf(y[l])<0&&Object.prototype.propertyIsEnumerable.call(o,y[l])&&(u[y[l]]=o[y[l]]);return u},n=function(o,c,u,y){var l=arguments.length,f=l<3?c:y===null?y=Object.getOwnPropertyDescriptor(c,u):y,O;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,c,u,y);else for(var P=o.length-1;P>=0;P--)(O=o[P])&&(f=(l<3?O(f):l>3?O(c,u,f):O(c,u))||f);return l>3&&f&&Object.defineProperty(c,u,f),f},d=function(o,c){return function(u,y){c(u,y,o)}},_=function(o,c){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,c)},g=function(o,c,u,y){function l(f){return f instanceof u?f:new u(function(O){O(f)})}return new(u||(u=Promise))(function(f,O){function P(R){try{E(y.next(R))}catch(B){O(B)}}function H(R){try{E(y.throw(R))}catch(B){O(B)}}function E(R){R.done?f(R.value):l(R.value).then(P,H)}E((y=y.apply(o,c||[])).next())})},w=function(o,c){var u={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},y,l,f,O;return O={next:P(0),throw:P(1),return:P(2)},typeof Symbol=="function"&&(O[Symbol.iterator]=function(){return this}),O;function P(E){return function(R){return H([E,R])}}function H(E){if(y)throw new TypeError("Generator is already executing.");for(;u;)try{if(y=1,l&&(f=E[0]&2?l.return:E[0]?l.throw||((f=l.return)&&f.call(l),0):l.next)&&!(f=f.call(l,E[1])).done)return f;switch(l=0,f&&(E=[E[0]&2,f.value]),E[0]){case 0:case 1:f=E;break;case 4:return u.label++,{value:E[1],done:!1};case 5:u.label++,l=E[1],E=[0];continue;case 7:E=u.ops.pop(),u.trys.pop();continue;default:if(f=u.trys,!(f=f.length>0&&f[f.length-1])&&(E[0]===6||E[0]===2)){u=0;continue}if(E[0]===3&&(!f||E[1]>f[0]&&E[1]<f[3])){u.label=E[1];break}if(E[0]===6&&u.label<f[1]){u.label=f[1],f=E;break}if(f&&u.label<f[2]){u.label=f[2],u.ops.push(E);break}f[2]&&u.ops.pop(),u.trys.pop();continue}E=c.call(o,u)}catch(R){E=[6,R],l=0}finally{y=f=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}},s=function(o,c,u,y){y===void 0&&(y=u),o[y]=c[u]},I=function(o,c){for(var u in o)u!=="default"&&!c.hasOwnProperty(u)&&(c[u]=o[u])},x=function(o){var c=typeof Symbol=="function"&&Symbol.iterator,u=c&&o[c],y=0;if(u)return u.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&y>=o.length&&(o=void 0),{value:o&&o[y++],done:!o}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")},N=function(o,c){var u=typeof Symbol=="function"&&o[Symbol.iterator];if(!u)return o;var y=u.call(o),l,f=[],O;try{for(;(c===void 0||c-- >0)&&!(l=y.next()).done;)f.push(l.value)}catch(P){O={error:P}}finally{try{l&&!l.done&&(u=y.return)&&u.call(y)}finally{if(O)throw O.error}}return f},q=function(){for(var o=[],c=0;c<arguments.length;c++)o=o.concat(N(arguments[c]));return o},C=function(){for(var o=0,c=0,u=arguments.length;c<u;c++)o+=arguments[c].length;for(var y=Array(o),l=0,c=0;c<u;c++)for(var f=arguments[c],O=0,P=f.length;O<P;O++,l++)y[l]=f[O];return y},A=function(o){return this instanceof A?(this.v=o,this):new A(o)},z=function(o,c,u){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var y=u.apply(o,c||[]),l,f=[];return l={},O("next"),O("throw"),O("return"),l[Symbol.asyncIterator]=function(){return this},l;function O(K){y[K]&&(l[K]=function(V){return new Promise(function(X,Y){f.push([K,V,X,Y])>1||P(K,V)})})}function P(K,V){try{H(y[K](V))}catch(X){B(f[0][3],X)}}function H(K){K.value instanceof A?Promise.resolve(K.value.v).then(E,R):B(f[0][2],K)}function E(K){P("next",K)}function R(K){P("throw",K)}function B(K,V){K(V),f.shift(),f.length&&P(f[0][0],f[0][1])}},j=function(o){var c,u;return c={},y("next"),y("throw",function(l){throw l}),y("return"),c[Symbol.iterator]=function(){return this},c;function y(l,f){c[l]=o[l]?function(O){return(u=!u)?{value:A(o[l](O)),done:l==="return"}:f?f(O):O}:f}},G=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=o[Symbol.asyncIterator],u;return c?c.call(o):(o=typeof x=="function"?x(o):o[Symbol.iterator](),u={},y("next"),y("throw"),y("return"),u[Symbol.asyncIterator]=function(){return this},u);function y(f){u[f]=o[f]&&function(O){return new Promise(function(P,H){O=o[f](O),l(P,H,O.done,O.value)})}}function l(f,O,P,H){Promise.resolve(H).then(function(E){f({value:E,done:P})},O)}},b=function(o,c){return Object.defineProperty?Object.defineProperty(o,"raw",{value:c}):o.raw=c,o},D=function(o){if(o&&o.__esModule)return o;var c={};if(o!=null)for(var u in o)Object.hasOwnProperty.call(o,u)&&(c[u]=o[u]);return c.default=o,c},m=function(o){return o&&o.__esModule?o:{default:o}},v=function(o,c){if(!c.has(o))throw new TypeError("attempted to get private field on non-instance");return c.get(o)},p=function(o,c,u){if(!c.has(o))throw new TypeError("attempted to set private field on non-instance");return c.set(o,u),u},h("__extends",e),h("__assign",t),h("__rest",i),h("__decorate",n),h("__param",d),h("__metadata",_),h("__awaiter",g),h("__generator",w),h("__exportStar",I),h("__createBinding",s),h("__values",x),h("__read",N),h("__spread",q),h("__spreadArrays",C),h("__await",A),h("__asyncGenerator",z),h("__asyncDelegator",j),h("__asyncValues",G),h("__makeTemplateObject",b),h("__importStar",D),h("__importDefault",m),h("__classPrivateFieldGet",v),h("__classPrivateFieldSet",p)})})(Uh);var Tt={},us;function jh(){if(us)return Tt;us=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.isBrowserCryptoAvailable=Tt.getSubtleCrypto=Tt.getBrowerCrypto=void 0;function r(){return(Pe===null||Pe===void 0?void 0:Pe.crypto)||(Pe===null||Pe===void 0?void 0:Pe.msCrypto)||{}}Tt.getBrowerCrypto=r;function e(){const i=r();return i.subtle||i.webkitSubtle}Tt.getSubtleCrypto=e;function t(){return!!r()&&!!e()}return Tt.isBrowserCryptoAvailable=t,Tt}var Pt={},fs;function Lh(){if(fs)return Pt;fs=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.isBrowser=Pt.isNode=Pt.isReactNative=void 0;function r(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Pt.isReactNative=r;function e(){return typeof St<"u"&&typeof St.versions<"u"&&typeof St.versions.node<"u"}Pt.isNode=e;function t(){return!r()&&!e()}return Pt.isBrowser=t,Pt}(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Ti;e.__exportStar(jh(),r),e.__exportStar(Lh(),r)})(jo);function Mh(){const r=Date.now()*Math.pow(10,3),e=Math.floor(Math.random()*Math.pow(10,3));return r+e}function Zr(r,e,t){return{id:t||Mh(),jsonrpc:"2.0",method:r,params:e}}function Wi(r,e){return{id:r,jsonrpc:"2.0",result:e}}function Qr(r,e,t){return{id:r,jsonrpc:"2.0",error:$h(e,t)}}function $h(r,e){return typeof r>"u"?cs(Ro):(typeof r=="string"&&(r=Object.assign(Object.assign({},cs(Gi)),{message:r})),typeof e<"u"&&(r.data=e),Rh(r.code)&&(r=Fh(r.code)),r)}class zh{}class Hh extends zh{constructor(){super()}}class qh extends Hh{constructor(e){super()}}const Kh="^https?:",Bh="^wss?:";function Vh(r){const e=r.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function Lo(r,e){const t=Vh(r);return typeof t>"u"?!1:new RegExp(e).test(t)}function hs(r){return Lo(r,Kh)}function ls(r){return Lo(r,Bh)}function Gh(r){return new RegExp("wss?://localhost(:d{2,5})?").test(r)}function Mo(r){return typeof r=="object"&&"id"in r&&"jsonrpc"in r&&r.jsonrpc==="2.0"}function ki(r){return Mo(r)&&"method"in r}function Yi(r){return Mo(r)&&(At(r)||_t(r))}function At(r){return"result"in r}function _t(r){return"error"in r}class Ji extends qh{constructor(e){super(e),this.events=new ct.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async request(e,t){return this.requestStrict(Zr(e.method,e.params||[]),t)}async requestStrict(e,t){return new Promise(async(i,n)=>{if(!this.connection.connected)try{await this.open()}catch(d){n(d)}this.events.on(`${e.id}`,d=>{_t(d)?n(d.error):i(d.result)});try{await this.connection.send(e,t)}catch(d){n(d)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Yi(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",()=>this.events.emit("disconnect")),this.connection.on("error",e=>this.events.emit("error",e)),this.hasRegisteredEventListeners=!0)}}const ds=10,Wh=()=>typeof ii<"u"&&typeof ii.WebSocket<"u"?ii.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:require("ws"),kh=()=>typeof window<"u",Yh=Wh();class Jh{constructor(e){if(this.url=e,this.events=new ct.EventEmitter,this.registering=!1,!ls(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){if(typeof this.socket>"u")throw new Error("Connection already closed");this.socket.close(),this.onClose()}async send(e,t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(wr(e))}catch(i){this.onError(e.id,i)}}register(e=this.url){if(!ls(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((i,n)=>{this.events.once("register_error",d=>{this.resetMaxListeners(),n(d)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return n(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,i)=>{const n=jo.isReactNative()?void 0:{rejectUnauthorized:!Gh(e)},d=new Yh(e,[],n);kh()?d.onerror=_=>{const g=_;i(this.emitError(g.error))}:d.on("error",_=>{i(this.emitError(_))}),d.onopen=()=>{this.onOpen(d),t(d)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=()=>this.onClose(),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(){this.socket=void 0,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?Ni(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const i=this.parseError(t),n=i.message||i.toString(),d=Qr(e,n);this.events.emit("payload",d)}parseError(e,t=this.url){return Uo(e,t,"WS")}resetMaxListeners(){this.events.getMaxListeners()>ds&&this.events.setMaxListeners(ds)}emitError(e){const t=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for URL: ${this.url}`));return this.events.emit("register_error",t),t}}var Br={},Xh={get exports(){return Br},set exports(r){Br=r}};(function(r,e){var t=200,i="__lodash_hash_undefined__",n=1,d=2,_=9007199254740991,g="[object Arguments]",w="[object Array]",I="[object AsyncFunction]",x="[object Boolean]",N="[object Date]",q="[object Error]",C="[object Function]",A="[object GeneratorFunction]",z="[object Map]",j="[object Number]",G="[object Null]",b="[object Object]",D="[object Promise]",m="[object Proxy]",v="[object RegExp]",p="[object Set]",s="[object String]",h="[object Symbol]",L="[object Undefined]",o="[object WeakMap]",c="[object ArrayBuffer]",u="[object DataView]",y="[object Float32Array]",l="[object Float64Array]",f="[object Int8Array]",O="[object Int16Array]",P="[object Int32Array]",H="[object Uint8Array]",E="[object Uint8ClampedArray]",R="[object Uint16Array]",B="[object Uint32Array]",K=/[\\^$.*+?()[\]{}|]/g,V=/^\[object .+?Constructor\]$/,X=/^(?:0|[1-9]\d*)$/,Y={};Y[y]=Y[l]=Y[f]=Y[O]=Y[P]=Y[H]=Y[E]=Y[R]=Y[B]=!0,Y[g]=Y[w]=Y[c]=Y[x]=Y[u]=Y[N]=Y[q]=Y[C]=Y[z]=Y[j]=Y[b]=Y[v]=Y[p]=Y[s]=Y[o]=!1;var ee=typeof Pe=="object"&&Pe&&Pe.Object===Object&&Pe,$=typeof self=="object"&&self&&self.Object===Object&&self,M=ee||$||Function("return this")(),F=e&&!e.nodeType&&e,a=F&&!0&&r&&!r.nodeType&&r,T=a&&a.exports===F,k=T&&ee.process,Z=function(){try{return k&&k.binding&&k.binding("util")}catch{}}(),fe=Z&&Z.isTypedArray;function ye(S,U){for(var W=-1,Q=S==null?0:S.length,xe=0,ne=[];++W<Q;){var Re=S[W];U(Re,W,S)&&(ne[xe++]=Re)}return ne}function le(S,U){for(var W=-1,Q=U.length,xe=S.length;++W<Q;)S[xe+W]=U[W];return S}function me(S,U){for(var W=-1,Q=S==null?0:S.length;++W<Q;)if(U(S[W],W,S))return!0;return!1}function Fe(S,U){for(var W=-1,Q=Array(S);++W<S;)Q[W]=U(W);return Q}function Ae(S){return function(U){return S(U)}}function pe(S,U){return S.has(U)}function de(S,U){return S==null?void 0:S[U]}function he(S){var U=-1,W=Array(S.size);return S.forEach(function(Q,xe){W[++U]=[xe,Q]}),W}function ce(S,U){return function(W){return S(U(W))}}function ae(S){var U=-1,W=Array(S.size);return S.forEach(function(Q){W[++U]=Q}),W}var oe=Array.prototype,se=Function.prototype,re=Object.prototype,ue=M["__core-js_shared__"],ge=se.toString,ie=re.hasOwnProperty,_e=function(){var S=/[^.]+$/.exec(ue&&ue.keys&&ue.keys.IE_PROTO||"");return S?"Symbol(src)_1."+S:""}(),be=re.toString,ve=RegExp("^"+ge.call(ie).replace(K,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ee=T?M.Buffer:void 0,we=M.Symbol,pt=M.Uint8Array,wt=re.propertyIsEnumerable,Rt=oe.splice,ut=we?we.toStringTag:void 0,Ht=Object.getOwnPropertySymbols,ar=Ee?Ee.isBuffer:void 0,Ar=ce(Object.keys,Object),je=er(M,"DataView"),Ne=er(M,"Map"),Le=er(M,"Promise"),Me=er(M,"Set"),$e=er(M,"WeakMap"),Ce=er(Object,"create"),qe=Kt(je),Ke=Kt(Ne),Be=Kt(Le),Ve=Kt(Me),Ge=Kt($e),He=we?we.prototype:void 0,ze=He?He.valueOf:void 0;function Ie(S){var U=-1,W=S==null?0:S.length;for(this.clear();++U<W;){var Q=S[U];this.set(Q[0],Q[1])}}function We(){this.__data__=Ce?Ce(null):{},this.size=0}function ke(S){var U=this.has(S)&&delete this.__data__[S];return this.size-=U?1:0,U}function ra(S){var U=this.__data__;if(Ce){var W=U[S];return W===i?void 0:W}return ie.call(U,S)?U[S]:void 0}function ia(S){var U=this.__data__;return Ce?U[S]!==void 0:ie.call(U,S)}function na(S,U){var W=this.__data__;return this.size+=this.has(S)?0:1,W[S]=Ce&&U===void 0?i:U,this}Ie.prototype.clear=We,Ie.prototype.delete=ke,Ie.prototype.get=ra,Ie.prototype.has=ia,Ie.prototype.set=na;function xt(S){var U=-1,W=S==null?0:S.length;for(this.clear();++U<W;){var Q=S[U];this.set(Q[0],Q[1])}}function sa(){this.__data__=[],this.size=0}function oa(S){var U=this.__data__,W=Cr(U,S);if(W<0)return!1;var Q=U.length-1;return W==Q?U.pop():Rt.call(U,W,1),--this.size,!0}function aa(S){var U=this.__data__,W=Cr(U,S);return W<0?void 0:U[W][1]}function ca(S){return Cr(this.__data__,S)>-1}function ua(S,U){var W=this.__data__,Q=Cr(W,S);return Q<0?(++this.size,W.push([S,U])):W[Q][1]=U,this}xt.prototype.clear=sa,xt.prototype.delete=oa,xt.prototype.get=aa,xt.prototype.has=ca,xt.prototype.set=ua;function qt(S){var U=-1,W=S==null?0:S.length;for(this.clear();++U<W;){var Q=S[U];this.set(Q[0],Q[1])}}function fa(){this.size=0,this.__data__={hash:new Ie,map:new(Ne||xt),string:new Ie}}function ha(S){var U=Rr(this,S).delete(S);return this.size-=U?1:0,U}function la(S){return Rr(this,S).get(S)}function da(S){return Rr(this,S).has(S)}function ga(S,U){var W=Rr(this,S),Q=W.size;return W.set(S,U),this.size+=W.size==Q?0:1,this}qt.prototype.clear=fa,qt.prototype.delete=ha,qt.prototype.get=la,qt.prototype.has=da,qt.prototype.set=ga;function Nr(S){var U=-1,W=S==null?0:S.length;for(this.__data__=new qt;++U<W;)this.add(S[U])}function pa(S){return this.__data__.set(S,i),this}function ya(S){return this.__data__.has(S)}Nr.prototype.add=Nr.prototype.push=pa,Nr.prototype.has=ya;function Ft(S){var U=this.__data__=new xt(S);this.size=U.size}function _a(){this.__data__=new xt,this.size=0}function ba(S){var U=this.__data__,W=U.delete(S);return this.size=U.size,W}function ma(S){return this.__data__.get(S)}function wa(S){return this.__data__.has(S)}function va(S,U){var W=this.__data__;if(W instanceof xt){var Q=W.__data__;if(!Ne||Q.length<t-1)return Q.push([S,U]),this.size=++W.size,this;W=this.__data__=new qt(Q)}return W.set(S,U),this.size=W.size,this}Ft.prototype.clear=_a,Ft.prototype.delete=ba,Ft.prototype.get=ma,Ft.prototype.has=wa,Ft.prototype.set=va;function Ea(S,U){var W=Fr(S),Q=!W&&La(S),xe=!W&&!Q&&ri(S),ne=!W&&!Q&&!xe&&hn(S),Re=W||Q||xe||ne,Ye=Re?Fe(S.length,String):[],Xe=Ye.length;for(var Te in S)(U||ie.call(S,Te))&&!(Re&&(Te=="length"||xe&&(Te=="offset"||Te=="parent")||ne&&(Te=="buffer"||Te=="byteLength"||Te=="byteOffset")||Ca(Te,Xe)))&&Ye.push(Te);return Ye}function Cr(S,U){for(var W=S.length;W--;)if(an(S[W][0],U))return W;return-1}function Da(S,U,W){var Q=U(S);return Fr(S)?Q:le(Q,W(S))}function cr(S){return S==null?S===void 0?L:G:ut&&ut in Object(S)?Aa(S):ja(S)}function rn(S){return ur(S)&&cr(S)==g}function nn(S,U,W,Q,xe){return S===U?!0:S==null||U==null||!ur(S)&&!ur(U)?S!==S&&U!==U:Sa(S,U,W,Q,nn,xe)}function Sa(S,U,W,Q,xe,ne){var Re=Fr(S),Ye=Fr(U),Xe=Re?w:Ut(S),Te=Ye?w:Ut(U);Xe=Xe==g?b:Xe,Te=Te==g?b:Te;var ft=Xe==b,yt=Te==b,tt=Xe==Te;if(tt&&ri(S)){if(!ri(U))return!1;Re=!0,ft=!1}if(tt&&!ft)return ne||(ne=new Ft),Re||hn(S)?sn(S,U,W,Q,xe,ne):Ta(S,U,Xe,W,Q,xe,ne);if(!(W&n)){var ht=ft&&ie.call(S,"__wrapped__"),lt=yt&&ie.call(U,"__wrapped__");if(ht||lt){var jt=ht?S.value():S,It=lt?U.value():U;return ne||(ne=new Ft),xe(jt,It,W,Q,ne)}}return tt?(ne||(ne=new Ft),Pa(S,U,W,Q,xe,ne)):!1}function Oa(S){if(!fn(S)||Fa(S))return!1;var U=cn(S)?ve:V;return U.test(Kt(S))}function xa(S){return ur(S)&&un(S.length)&&!!Y[cr(S)]}function Ia(S){if(!Ua(S))return Ar(S);var U=[];for(var W in Object(S))ie.call(S,W)&&W!="constructor"&&U.push(W);return U}function sn(S,U,W,Q,xe,ne){var Re=W&n,Ye=S.length,Xe=U.length;if(Ye!=Xe&&!(Re&&Xe>Ye))return!1;var Te=ne.get(S);if(Te&&ne.get(U))return Te==U;var ft=-1,yt=!0,tt=W&d?new Nr:void 0;for(ne.set(S,U),ne.set(U,S);++ft<Ye;){var ht=S[ft],lt=U[ft];if(Q)var jt=Re?Q(lt,ht,ft,U,S,ne):Q(ht,lt,ft,S,U,ne);if(jt!==void 0){if(jt)continue;yt=!1;break}if(tt){if(!me(U,function(It,Bt){if(!pe(tt,Bt)&&(ht===It||xe(ht,It,W,Q,ne)))return tt.push(Bt)})){yt=!1;break}}else if(!(ht===lt||xe(ht,lt,W,Q,ne))){yt=!1;break}}return ne.delete(S),ne.delete(U),yt}function Ta(S,U,W,Q,xe,ne,Re){switch(W){case u:if(S.byteLength!=U.byteLength||S.byteOffset!=U.byteOffset)return!1;S=S.buffer,U=U.buffer;case c:return!(S.byteLength!=U.byteLength||!ne(new pt(S),new pt(U)));case x:case N:case j:return an(+S,+U);case q:return S.name==U.name&&S.message==U.message;case v:case s:return S==U+"";case z:var Ye=he;case p:var Xe=Q&n;if(Ye||(Ye=ae),S.size!=U.size&&!Xe)return!1;var Te=Re.get(S);if(Te)return Te==U;Q|=d,Re.set(S,U);var ft=sn(Ye(S),Ye(U),Q,xe,ne,Re);return Re.delete(S),ft;case h:if(ze)return ze.call(S)==ze.call(U)}return!1}function Pa(S,U,W,Q,xe,ne){var Re=W&n,Ye=on(S),Xe=Ye.length,Te=on(U),ft=Te.length;if(Xe!=ft&&!Re)return!1;for(var yt=Xe;yt--;){var tt=Ye[yt];if(!(Re?tt in U:ie.call(U,tt)))return!1}var ht=ne.get(S);if(ht&&ne.get(U))return ht==U;var lt=!0;ne.set(S,U),ne.set(U,S);for(var jt=Re;++yt<Xe;){tt=Ye[yt];var It=S[tt],Bt=U[tt];if(Q)var ln=Re?Q(Bt,It,tt,U,S,ne):Q(It,Bt,tt,S,U,ne);if(!(ln===void 0?It===Bt||xe(It,Bt,W,Q,ne):ln)){lt=!1;break}jt||(jt=tt=="constructor")}if(lt&&!jt){var Ur=S.constructor,jr=U.constructor;Ur!=jr&&"constructor"in S&&"constructor"in U&&!(typeof Ur=="function"&&Ur instanceof Ur&&typeof jr=="function"&&jr instanceof jr)&&(lt=!1)}return ne.delete(S),ne.delete(U),lt}function on(S){return Da(S,za,Na)}function Rr(S,U){var W=S.__data__;return Ra(U)?W[typeof U=="string"?"string":"hash"]:W.map}function er(S,U){var W=de(S,U);return Oa(W)?W:void 0}function Aa(S){var U=ie.call(S,ut),W=S[ut];try{S[ut]=void 0;var Q=!0}catch{}var xe=be.call(S);return Q&&(U?S[ut]=W:delete S[ut]),xe}var Na=Ht?function(S){return S==null?[]:(S=Object(S),ye(Ht(S),function(U){return wt.call(S,U)}))}:Ha,Ut=cr;(je&&Ut(new je(new ArrayBuffer(1)))!=u||Ne&&Ut(new Ne)!=z||Le&&Ut(Le.resolve())!=D||Me&&Ut(new Me)!=p||$e&&Ut(new $e)!=o)&&(Ut=function(S){var U=cr(S),W=U==b?S.constructor:void 0,Q=W?Kt(W):"";if(Q)switch(Q){case qe:return u;case Ke:return z;case Be:return D;case Ve:return p;case Ge:return o}return U});function Ca(S,U){return U=U??_,!!U&&(typeof S=="number"||X.test(S))&&S>-1&&S%1==0&&S<U}function Ra(S){var U=typeof S;return U=="string"||U=="number"||U=="symbol"||U=="boolean"?S!=="__proto__":S===null}function Fa(S){return!!_e&&_e in S}function Ua(S){var U=S&&S.constructor,W=typeof U=="function"&&U.prototype||re;return S===W}function ja(S){return be.call(S)}function Kt(S){if(S!=null){try{return ge.call(S)}catch{}try{return S+""}catch{}}return""}function an(S,U){return S===U||S!==S&&U!==U}var La=rn(function(){return arguments}())?rn:function(S){return ur(S)&&ie.call(S,"callee")&&!wt.call(S,"callee")},Fr=Array.isArray;function Ma(S){return S!=null&&un(S.length)&&!cn(S)}var ri=ar||qa;function $a(S,U){return nn(S,U)}function cn(S){if(!fn(S))return!1;var U=cr(S);return U==C||U==A||U==I||U==m}function un(S){return typeof S=="number"&&S>-1&&S%1==0&&S<=_}function fn(S){var U=typeof S;return S!=null&&(U=="object"||U=="function")}function ur(S){return S!=null&&typeof S=="object"}var hn=fe?Ae(fe):xa;function za(S){return Ma(S)?Ea(S):Ia(S)}function Ha(){return[]}function qa(){return!1}r.exports=$a})(Xh,Br);function Zh(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var n=0;n<r.length;n++){var d=r.charAt(n),_=d.charCodeAt(0);if(t[_]!==255)throw new TypeError(d+" is ambiguous");t[_]=n}var g=r.length,w=r.charAt(0),I=Math.log(g)/Math.log(256),x=Math.log(256)/Math.log(g);function N(A){if(A instanceof Uint8Array||(ArrayBuffer.isView(A)?A=new Uint8Array(A.buffer,A.byteOffset,A.byteLength):Array.isArray(A)&&(A=Uint8Array.from(A))),!(A instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(A.length===0)return"";for(var z=0,j=0,G=0,b=A.length;G!==b&&A[G]===0;)G++,z++;for(var D=(b-G)*x+1>>>0,m=new Uint8Array(D);G!==b;){for(var v=A[G],p=0,s=D-1;(v!==0||p<j)&&s!==-1;s--,p++)v+=256*m[s]>>>0,m[s]=v%g>>>0,v=v/g>>>0;if(v!==0)throw new Error("Non-zero carry");j=p,G++}for(var h=D-j;h!==D&&m[h]===0;)h++;for(var L=w.repeat(z);h<D;++h)L+=r.charAt(m[h]);return L}function q(A){if(typeof A!="string")throw new TypeError("Expected String");if(A.length===0)return new Uint8Array;var z=0;if(A[z]!==" "){for(var j=0,G=0;A[z]===w;)j++,z++;for(var b=(A.length-z)*I+1>>>0,D=new Uint8Array(b);A[z];){var m=t[A.charCodeAt(z)];if(m===255)return;for(var v=0,p=b-1;(m!==0||v<G)&&p!==-1;p--,v++)m+=g*D[p]>>>0,D[p]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");G=v,z++}if(A[z]!==" "){for(var s=b-G;s!==b&&D[s]===0;)s++;for(var h=new Uint8Array(j+(b-s)),L=j;s!==b;)h[L++]=D[s++];return h}}}function C(A){var z=q(A);if(z)return z;throw new Error(`Non-${e} character`)}return{encode:N,decodeUnsafe:q,decode:C}}var Qh=Zh,el=Qh;const $o=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},tl=r=>new TextEncoder().encode(r),rl=r=>new TextDecoder().decode(r);class il{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class nl{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return zo(this,e)}}class sl{constructor(e){this.decoders=e}or(e){return zo(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const zo=(r,e)=>new sl({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class ol{constructor(e,t,i,n){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=n,this.encoder=new il(e,t,i),this.decoder=new nl(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ei=({name:r,prefix:e,encode:t,decode:i})=>new ol(r,e,t,i),Pr=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:n}=el(t,e);return ei({prefix:r,name:e,encode:i,decode:d=>$o(n(d))})},al=(r,e,t,i)=>{const n={};for(let x=0;x<e.length;++x)n[e[x]]=x;let d=r.length;for(;r[d-1]==="=";)--d;const _=new Uint8Array(d*t/8|0);let g=0,w=0,I=0;for(let x=0;x<d;++x){const N=n[r[x]];if(N===void 0)throw new SyntaxError(`Non-${i} character`);w=w<<t|N,g+=t,g>=8&&(g-=8,_[I++]=255&w>>g)}if(g>=t||255&w<<8-g)throw new SyntaxError("Unexpected end of data");return _},cl=(r,e,t)=>{const i=e[e.length-1]==="=",n=(1<<t)-1;let d="",_=0,g=0;for(let w=0;w<r.length;++w)for(g=g<<8|r[w],_+=8;_>t;)_-=t,d+=e[n&g>>_];if(_&&(d+=e[n&g<<t-_]),i)for(;d.length*t&7;)d+="=";return d},et=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>ei({prefix:e,name:r,encode(n){return cl(n,i,t)},decode(n){return al(n,i,t,r)}}),ul=ei({prefix:"\0",name:"identity",encode:r=>rl(r),decode:r=>tl(r)});var fl=Object.freeze({__proto__:null,identity:ul});const hl=et({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var ll=Object.freeze({__proto__:null,base2:hl});const dl=et({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var gl=Object.freeze({__proto__:null,base8:dl});const pl=Pr({prefix:"9",name:"base10",alphabet:"0123456789"});var yl=Object.freeze({__proto__:null,base10:pl});const _l=et({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),bl=et({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var ml=Object.freeze({__proto__:null,base16:_l,base16upper:bl});const wl=et({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),vl=et({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),El=et({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Dl=et({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Sl=et({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Ol=et({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),xl=et({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Il=et({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Tl=et({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Pl=Object.freeze({__proto__:null,base32:wl,base32upper:vl,base32pad:El,base32padupper:Dl,base32hex:Sl,base32hexupper:Ol,base32hexpad:xl,base32hexpadupper:Il,base32z:Tl});const Al=Pr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Nl=Pr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Cl=Object.freeze({__proto__:null,base36:Al,base36upper:Nl});const Rl=Pr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Fl=Pr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Ul=Object.freeze({__proto__:null,base58btc:Rl,base58flickr:Fl});const jl=et({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ll=et({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ml=et({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),$l=et({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var zl=Object.freeze({__proto__:null,base64:jl,base64pad:Ll,base64url:Ml,base64urlpad:$l});const Ho=Array.from(""),Hl=Ho.reduce((r,e,t)=>(r[t]=e,r),[]),ql=Ho.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function Kl(r){return r.reduce((e,t)=>(e+=Hl[t],e),"")}function Bl(r){const e=[];for(const t of r){const i=ql[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const Vl=ei({prefix:"",name:"base256emoji",encode:Kl,decode:Bl});var Gl=Object.freeze({__proto__:null,base256emoji:Vl}),Wl=qo,gs=128,kl=127,Yl=~kl,Jl=Math.pow(2,31);function qo(r,e,t){e=e||[],t=t||0;for(var i=t;r>=Jl;)e[t++]=r&255|gs,r/=128;for(;r&Yl;)e[t++]=r&255|gs,r>>>=7;return e[t]=r|0,qo.bytes=t-i+1,e}var Xl=Pi,Zl=128,ps=127;function Pi(r,i){var t=0,i=i||0,n=0,d=i,_,g=r.length;do{if(d>=g)throw Pi.bytes=0,new RangeError("Could not decode varint");_=r[d++],t+=n<28?(_&ps)<<n:(_&ps)*Math.pow(2,n),n+=7}while(_>=Zl);return Pi.bytes=d-i,t}var Ql=Math.pow(2,7),ed=Math.pow(2,14),td=Math.pow(2,21),rd=Math.pow(2,28),id=Math.pow(2,35),nd=Math.pow(2,42),sd=Math.pow(2,49),od=Math.pow(2,56),ad=Math.pow(2,63),cd=function(r){return r<Ql?1:r<ed?2:r<td?3:r<rd?4:r<id?5:r<nd?6:r<sd?7:r<od?8:r<ad?9:10},ud={encode:Wl,decode:Xl,encodingLength:cd},Ko=ud;const ys=(r,e,t=0)=>(Ko.encode(r,e,t),e),_s=r=>Ko.encodingLength(r),Ai=(r,e)=>{const t=e.byteLength,i=_s(r),n=i+_s(t),d=new Uint8Array(n+t);return ys(r,d,0),ys(t,d,i),d.set(e,n),new fd(r,t,e,d)};class fd{constructor(e,t,i,n){this.code=e,this.size=t,this.digest=i,this.bytes=n}}const Bo=({name:r,code:e,encode:t})=>new hd(r,e,t);class hd{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Ai(this.code,t):t.then(i=>Ai(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Vo=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),ld=Bo({name:"sha2-256",code:18,encode:Vo("SHA-256")}),dd=Bo({name:"sha2-512",code:19,encode:Vo("SHA-512")});var gd=Object.freeze({__proto__:null,sha256:ld,sha512:dd});const Go=0,pd="identity",Wo=$o,yd=r=>Ai(Go,Wo(r)),_d={code:Go,name:pd,encode:Wo,digest:yd};var bd=Object.freeze({__proto__:null,identity:_d});new TextEncoder,new TextDecoder;const bs={...fl,...ll,...gl,...yl,...ml,...Pl,...Cl,...Ul,...zl,...Gl};({...gd,...bd});function md(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}function ko(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const ms=ko("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),_i=ko("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=md(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),wd={utf8:ms,"utf-8":ms,hex:bs.base16,latin1:_i,ascii:_i,binary:_i,...bs};function vd(r,e="utf8"){const t=wd[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r,"utf8"):t.decoder.decode(`${t.prefix}${r}`)}const Yo="wc",Ed=2,Xi="core",$t=`${Yo}@${2}:${Xi}:`,Dd={name:Xi,logger:"error"},Sd={database:":memory:"},Od="crypto",ws="client_ed25519_seed",xd=te.ONE_DAY,Id="keychain",Td="0.3",Pd="messages",Ad="0.3",Nd=te.SIX_HOURS,Cd="publisher",Jo="irn",Rd="error",Fd="wss://relay.walletconnect.com",Ud="relayer",st={message:"relayer_message",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed"},jd="_subscription",Lr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},vs=te.ONE_SECOND,Ld="2.1.3",Md="0.3",Dt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},$d="subscription",zd="0.3",Hd=te.FIVE_SECONDS*1e3,qd="pairing",Kd="0.3",yr={wc_pairingDelete:{req:{ttl:te.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:te.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:te.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:te.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:te.ONE_DAY,prompt:!1,tag:0},res:{ttl:te.ONE_DAY,prompt:!1,tag:0}}},Et={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Bd="history",Vd="0.3",Gd="expirer",dt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Wd="0.3";class kd{constructor(e,t){this.core=e,this.logger=t,this.keychain=new Map,this.name=Id,this.version=Td,this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,n)=>{this.isInitialized(),this.keychain.set(i,n),await this.persist()},this.get=i=>{this.isInitialized();const n=this.keychain.get(i);if(typeof n>"u"){const{message:d}=J("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(d)}return n},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=De.generateChildLogger(t,this.name)}get context(){return De.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,So(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Oo(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Yd{constructor(e,t,i){this.core=e,this.logger=t,this.name=Od,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=n=>(this.isInitialized(),this.keychain.has(n)),this.getClientId=async()=>{this.isInitialized();const n=await this.getClientSeed(),d=$n(n);return oo(d.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const n=If();return this.setPrivateKey(n.publicKey,n.privateKey)},this.signJWT=async n=>{this.isInitialized();const d=await this.getClientSeed(),_=$n(d),g=Si();return await zu(g,n,xd,_)},this.generateSharedKey=(n,d,_)=>{this.isInitialized();const g=this.getPrivateKey(n),w=Tf(g,d);return this.setSymKey(w,_)},this.setSymKey=async(n,d)=>{this.isInitialized();const _=d||Pf(n);return await this.keychain.set(_,n),_},this.deleteKeyPair=async n=>{this.isInitialized(),await this.keychain.del(n)},this.deleteSymKey=async n=>{this.isInitialized(),await this.keychain.del(n)},this.encode=async(n,d,_)=>{this.isInitialized();const g=Eo(_),w=wr(d);if(Jn(g)){const q=g.senderPublicKey,C=g.receiverPublicKey;n=await this.generateSharedKey(q,C)}const I=this.getSymKey(n),{type:x,senderPublicKey:N}=g;return Nf({type:x,symKey:I,message:w,senderPublicKey:N})},this.decode=async(n,d,_)=>{this.isInitialized();const g=Ff(d,_);if(Jn(g)){const x=g.receiverPublicKey,N=g.senderPublicKey;n=await this.generateSharedKey(x,N)}const w=this.getSymKey(n),I=Cf({symKey:w,encoded:d});return Ni(I)},this.core=e,this.logger=De.generateChildLogger(t,this.name),this.keychain=i||new kd(this.core,this.logger)}get context(){return De.getLoggerContext(this.logger)}getPayloadType(e){const t=Ki(e);return Ir(t.type)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(ws)}catch{e=Si(),await this.keychain.set(ws,e)}return vd(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Jd extends Ec{constructor(e,t){super(e,t),this.logger=e,this.core=t,this.messages=new Map,this.name=Pd,this.version=Ad,this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,n)=>{this.isInitialized();const d=Oi(n);let _=this.messages.get(i);return typeof _>"u"&&(_={}),typeof _[d]<"u"||(_[d]=n,this.messages.set(i,_),await this.persist()),d},this.get=i=>{this.isInitialized();let n=this.messages.get(i);return typeof n>"u"&&(n={}),n},this.has=(i,n)=>{this.isInitialized();const d=this.get(i),_=Oi(n);return typeof d[_]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=De.generateChildLogger(e,this.name),this.core=t}get context(){return De.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,So(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Oo(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Xd extends Dc{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.events=new ct.EventEmitter,this.name=Cd,this.queue=new Map,this.publishTimeout=1e4,this.publish=async(i,n,d)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:d}});try{const _=(d==null?void 0:d.ttl)||Nd,g=xi(d),w=(d==null?void 0:d.prompt)||!1,I=(d==null?void 0:d.tag)||0,x={topic:i,message:n,opts:{ttl:_,relay:g,prompt:w,tag:I}},N=Oi(n);this.queue.set(N,x);try{await await xo(this.rpcPublish(i,n,_,g,w,I),this.publishTimeout)}catch{this.logger.debug("Publishing Payload stalled"),this.relayer.events.emit(st.connection_stalled);return}this.onPublish(N,x),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:d}})}catch(_){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(_),_}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.relayer=e,this.logger=De.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return De.getLoggerContext(this.logger)}rpcPublish(e,t,i,n,d,_){var g,w,I,x;const N={method:Ii(n.protocol).publish,params:{topic:e,message:t,ttl:i,prompt:d,tag:_}};return gt((g=N.params)==null?void 0:g.prompt)&&((w=N.params)==null||delete w.prompt),gt((I=N.params)==null?void 0:I.tag)&&((x=N.params)==null||delete x.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:N}),this.relayer.provider.request(N)}onPublish(e,t){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:t,message:i,opts:n}=e;await this.publish(t,i,n)})}registerEventListeners(){this.relayer.core.heartbeat.on(Sr.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()})}}class Zd{constructor(){this.map=new Map,this.set=(e,t)=>{const i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])},this.get=e=>this.map.get(e)||[],this.exists=(e,t)=>this.get(e).includes(t),this.delete=(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,t))return;const n=i.filter(d=>d!==t);if(!n.length){this.map.delete(e);return}this.map.set(e,n)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Qd=Object.defineProperty,eg=Object.defineProperties,tg=Object.getOwnPropertyDescriptors,Es=Object.getOwnPropertySymbols,rg=Object.prototype.hasOwnProperty,ig=Object.prototype.propertyIsEnumerable,Ds=(r,e,t)=>e in r?Qd(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Mr=(r,e)=>{for(var t in e||(e={}))rg.call(e,t)&&Ds(r,t,e[t]);if(Es)for(var t of Es(e))ig.call(e,t)&&Ds(r,t,e[t]);return r},bi=(r,e)=>eg(r,tg(e));class ng extends xc{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.subscriptions=new Map,this.topicMap=new Zd,this.events=new ct.EventEmitter,this.name=$d,this.version=zd,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pendingSubInterval=20,this.storagePrefix=$t,this.subscribeTimeout=1e4,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable())},this.subscribe=async(i,n)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}});try{const d=xi(n),_={topic:i,relay:d};this.pending.set(i,_);const g=await this.rpcSubscribe(i,d);return this.onSubscribe(g,_),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}}),g}catch(d){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(d),d}},this.unsubscribe=async(i,n)=>{this.isInitialized(),typeof(n==null?void 0:n.id)<"u"?await this.unsubscribeById(i,n.id,n):await this.unsubscribeByTopic(i,n)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((n,d)=>{const _=new te.Watch;_.start(this.pendingSubscriptionWatchLabel);const g=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(g),_.stop(this.pendingSubscriptionWatchLabel),n(!0)),_.elapsed(this.pendingSubscriptionWatchLabel)>=Hd&&(clearInterval(g),_.stop(this.pendingSubscriptionWatchLabel),d(!1))},this.pendingSubInterval)}),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.restart=async()=>{await this.restore(),await this.reset()},this.relayer=e,this.logger=De.generateChildLogger(t,this.name)}get context(){return De.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear(),this.initialized=!1}async unsubscribeByTopic(e,t){const i=this.topicMap.get(e);await Promise.all(i.map(async n=>await this.unsubscribeById(e,n,t)))}async unsubscribeById(e,t,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}});try{const n=xi(i);await this.rpcUnsubscribe(e,t,n);const d=Je("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,d),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,t){const i={method:Ii(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let n;try{n=await await xo(this.relayer.provider.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(st.connection_stalled)}return n}rpcUnsubscribe(e,t,i){const n={method:Ii(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.provider.request(n)}onSubscribe(e,t){this.setSubscription(e,bi(Mr({},t),{id:e})),this.pending.delete(t.topic)}onResubscribe(e,t){this.addSubscription(e,bi(Mr({},t),{id:e})),this.pending.delete(t.topic)}async onUnsubscribe(e,t,i){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t))}addSubscription(e,t){this.subscriptions.set(e,Mr({},t)),this.topicMap.set(t.topic,e),this.events.emit(Dt.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:i}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(Dt.deleted,bi(Mr({},i),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Dt.sync)}async reset(){this.cached.length&&await Promise.all(this.cached.map(async e=>await this.resubscribe(e))),this.events.emit(Dt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async resubscribe(e){if(!this.ids.includes(e.id)){const{topic:t,relay:i}=e,n={topic:t,relay:i};this.pending.set(n.topic,n);const d=await this.rpcSubscribe(n.topic,n.relay);this.onResubscribe(d,n)}}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}checkPending(){this.relayer.transportExplicitlyClosed||this.pending.forEach(async e=>{const t=await this.rpcSubscribe(e.topic,e.relay);this.onSubscribe(t,e)})}registerEventListeners(){this.relayer.core.heartbeat.on(Sr.HEARTBEAT_EVENTS.pulse,()=>{this.checkPending()}),this.relayer.on(st.connect,async()=>{await this.onConnect()}),this.relayer.on(st.disconnect,()=>{this.onDisconnect()}),this.events.on(Dt.created,async e=>{const t=Dt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()}),this.events.on(Dt.deleted,async e=>{const t=Dt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}var sg=Object.defineProperty,Ss=Object.getOwnPropertySymbols,og=Object.prototype.hasOwnProperty,ag=Object.prototype.propertyIsEnumerable,Os=(r,e,t)=>e in r?sg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,cg=(r,e)=>{for(var t in e||(e={}))og.call(e,t)&&Os(r,t,e[t]);if(Ss)for(var t of Ss(e))ag.call(e,t)&&Os(r,t,e[t]);return r};class ug extends Sc{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new ct.EventEmitter,this.name=Ud,this.transportExplicitlyClosed=!1,this.initialized=!1,this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?De.generateChildLogger(e.logger,this.name):Wr(De.getDefaultLoggerOptions({level:e.logger||Rd})),this.messages=new Jd(this.logger,e.core),this.subscriber=new ng(this,this.logger),this.publisher=new Xd(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Fd,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.provider=await this.createProvider(),await Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0}get context(){return De.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,t,i){this.isInitialized(),await this.publisher.publish(e,t,i),await this.recordMessageEvent({topic:e,message:t})}async subscribe(e,t){this.isInitialized();let i="";return await Promise.all([new Promise(n=>{this.subscriber.once(Dt.created,d=>{d.topic===e&&n()})}),new Promise(async n=>{i=await this.subscriber.subscribe(e,t),n()})]),i}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&await this.provider.disconnect(),this.events.emit(st.transport_closed)}async transportOpen(e){this.relayUrl=e||this.relayUrl,this.transportExplicitlyClosed=!1;try{await Promise.all([new Promise(t=>{this.initialized||t(),this.subscriber.once(Dt.resubscribed,()=>{t()})}),await Promise.race([this.provider.connect(),new Promise((t,i)=>this.once(st.transport_closed,()=>{i()}))])])}catch(t){const i=t;if(!/socket hang up/i.test(i.message))throw new Error(i.message);this.logger.error(i),this.events.emit(st.transport_closed)}}async restartTransport(e){await this.transportClose(),await new Promise(t=>setTimeout(t,vs)),await this.transportOpen(e)}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);return new Ji(new Jh(kf({sdkVersion:Ld,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e})))}async recordMessageEvent(e){const{topic:t,message:i}=e;await this.messages.set(t,i)}async shouldIgnoreMessageEvent(e){const{topic:t,message:i}=e;return await this.subscriber.isSubscribed(t)?this.messages.has(t,i):!0}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),ki(e)){if(!e.method.endsWith(jd))return;const t=e.params,{topic:i,message:n}=t.data,d={topic:i,message:n};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(cg({type:"event",event:t.id},d)),this.events.emit(t.id,d),await this.acknowledgePayload(e),await this.onMessageEvent(d)}}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(st.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const t=Wi(e.id,!0);await this.provider.connection.send(t)}registerEventListeners(){this.provider.on(Lr.payload,e=>this.onProviderPayload(e)),this.provider.on(Lr.connect,()=>{this.events.emit(st.connect)}),this.provider.on(Lr.disconnect,()=>{this.events.emit(st.disconnect),this.attemptToReconnect()}),this.provider.on(Lr.error,e=>this.events.emit(st.error,e)),this.events.on(st.connection_stalled,async()=>{await this.restartTransport()})}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.transportOpen()},te.toMiliseconds(vs))}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}var fg=Object.defineProperty,xs=Object.getOwnPropertySymbols,hg=Object.prototype.hasOwnProperty,lg=Object.prototype.propertyIsEnumerable,Is=(r,e,t)=>e in r?fg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ts=(r,e)=>{for(var t in e||(e={}))hg.call(e,t)&&Is(r,t,e[t]);if(xs)for(var t of xs(e))lg.call(e,t)&&Is(r,t,e[t]);return r};class ti extends Oc{constructor(e,t,i,n=$t,d=void 0){super(e,t,i,n),this.core=e,this.logger=t,this.name=i,this.map=new Map,this.version=Md,this.cached=[],this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(_=>{gh(_)?this.map.set(_.id,_):ph(_)?this.map.set(_.topic,_):this.getKey&&_!==null&&!gt(_)&&this.map.set(this.getKey(_),_)}),this.cached=[],this.initialized=!0)},this.set=async(_,g)=>{this.isInitialized(),this.map.has(_)?await this.update(_,g):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:_,value:g}),this.map.set(_,g),await this.persist())},this.get=_=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:_}),this.getData(_)),this.getAll=_=>(this.isInitialized(),_?this.values.filter(g=>Object.keys(_).every(w=>Br(g[w],_[w]))):this.values),this.update=async(_,g)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:_,update:g});const w=Ts(Ts({},this.getData(_)),g);this.map.set(_,w),await this.persist()},this.delete=async(_,g)=>{this.isInitialized(),this.map.has(_)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:_,reason:g}),this.map.delete(_),await this.persist())},this.logger=De.generateChildLogger(t,this.name),this.storagePrefix=n,this.getKey=d}get context(){return De.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){const{message:i}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}class dg{constructor(e,t){this.core=e,this.logger=t,this.name=qd,this.version=Kd,this.events=new ct,this.initialized=!1,this.storagePrefix=$t,this.ignoredPayloadTypes=[Zt],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=Si(),n=await this.core.crypto.setSymKey(i),d=Nt(te.FIVE_MINUTES),_={protocol:Jo},g={topic:n,expiry:d,relay:_,active:!1},w=sh({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:i,relay:_});return await this.pairings.set(n,g),await this.core.relayer.subscribe(n),this.core.expirer.set(n,d),{topic:n,uri:w}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:n,symKey:d,relay:_}=ih(i.uri),g=Nt(te.FIVE_MINUTES),w={topic:n,relay:_,expiry:g,active:!1};return await this.pairings.set(n,w),await this.core.crypto.setSymKey(d,n),await this.core.relayer.subscribe(n,{relay:_}),this.core.expirer.set(n,g),i.activatePairing&&await this.activate({topic:n}),w},this.activate=async({topic:i})=>{this.isInitialized();const n=Nt(te.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:n}),this.core.expirer.set(i,n)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:n}=i;if(this.pairings.keys.includes(n)){const d=await this.sendRequest(n,"wc_pairingPing",{}),{done:_,resolve:g,reject:w}=Yt();this.events.once(Ue("pairing_ping",d),({error:I})=>{I?w(I):g()}),await _()}},this.updateExpiry=async({topic:i,expiry:n})=>{this.isInitialized(),await this.pairings.update(i,{expiry:n})},this.updateMetadata=async({topic:i,metadata:n})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:n})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",Je("USER_DISCONNECTED")),await this.deletePairing(n))},this.sendRequest=async(i,n,d)=>{const _=Zr(n,d),g=await this.core.crypto.encode(i,_),w=yr[n].req;return this.core.history.set(i,_),await this.core.relayer.publish(i,g,w),_.id},this.sendResult=async(i,n,d)=>{const _=Wi(i,d),g=await this.core.crypto.encode(n,_),w=await this.core.history.get(n,i),I=yr[w.request.method].res;await this.core.relayer.publish(n,g,I),await this.core.history.resolve(_)},this.sendError=async(i,n,d)=>{const _=Qr(i,d),g=await this.core.crypto.encode(n,_),w=await this.core.history.get(n,i),I=yr[w.request.method]?yr[w.request.method].res:yr.unregistered_method.res;await this.core.relayer.publish(n,g,I),await this.core.history.resolve(_)},this.deletePairing=async(i,n)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,Je("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),n?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(n=>Mt(n.expiry));await Promise.all(i.map(n=>this.deletePairing(n.topic)))},this.onRelayEventRequest=i=>{const{topic:n,payload:d}=i;switch(d.method){case"wc_pairingPing":return this.onPairingPingRequest(n,d);case"wc_pairingDelete":return this.onPairingDeleteRequest(n,d);default:return this.onUnknownRpcMethodRequest(n,d)}},this.onRelayEventResponse=async i=>{const{topic:n,payload:d}=i,_=(await this.core.history.get(n,d.id)).request.method;switch(_){case"wc_pairingPing":return this.onPairingPingResponse(n,d);default:return this.onUnknownRpcMethodResponse(_)}},this.onPairingPingRequest=async(i,n)=>{const{id:d}=n;try{this.isValidPing({topic:i}),await this.sendResult(d,i,!0),this.events.emit("pairing_ping",{id:d,topic:i})}catch(_){await this.sendError(d,i,_),this.logger.error(_)}},this.onPairingPingResponse=(i,n)=>{const{id:d}=n;setTimeout(()=>{At(n)?this.events.emit(Ue("pairing_ping",d),{}):_t(n)&&this.events.emit(Ue("pairing_ping",d),{error:n.error})},500)},this.onPairingDeleteRequest=async(i,n)=>{const{id:d}=n;try{this.isValidDisconnect({topic:i}),await this.sendResult(d,i,!0),await this.deletePairing(i),this.events.emit("pairing_delete",{id:d,topic:i})}catch(_){await this.sendError(d,i,_),this.logger.error(_)}},this.onUnknownRpcMethodRequest=async(i,n)=>{const{id:d,method:_}=n;try{if(this.registeredMethods.includes(_))return;const g=Je("WC_METHOD_UNSUPPORTED",_);await this.sendError(d,i,g),this.logger.error(g)}catch(g){await this.sendError(d,i,g),this.logger.error(g)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(Je("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{if(!nt(i)){const{message:n}=J("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(n)}if(!dh(i.uri)){const{message:n}=J("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(n)}},this.isValidPing=async i=>{if(!nt(i)){const{message:d}=J("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(d)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidDisconnect=async i=>{if(!nt(i)){const{message:d}=J("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(d)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidPairingTopic=async i=>{if(!Ze(i,!1)){const{message:n}=J("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(n)}if(!this.pairings.keys.includes(i)){const{message:n}=J("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(n)}if(Mt(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:n}=J("EXPIRED",`pairing topic: ${i}`);throw new Error(n)}},this.core=e,this.logger=De.generateChildLogger(t,this.name),this.pairings=new ti(this.core,this.logger,this.name,this.storagePrefix)}get context(){return De.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(st.message,async e=>{const{topic:t,message:i}=e;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const n=await this.core.crypto.decode(t,i);ki(n)?(this.core.history.set(t,n),this.onRelayEventRequest({topic:t,payload:n})):Yi(n)&&(await this.core.history.resolve(n),this.onRelayEventResponse({topic:t,payload:n}))})}registerExpirerEvents(){this.core.expirer.on(dt.expired,async e=>{const{topic:t}=To(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit("pairing_expire",{topic:t}))})}}class gg extends vc{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.records=new Map,this.events=new ct.EventEmitter,this.name=Bd,this.version=Vd,this.cached=[],this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,n,d)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:n,chainId:d}),this.records.has(n.id))return;const _={id:n.id,topic:i,request:{method:n.method,params:n.params||null},chainId:d};this.records.set(_.id,_),this.events.emit(Et.created,_)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const n=await this.getRecord(i.id);typeof n.response>"u"&&(n.response=_t(i)?{error:i.error}:{result:i.result},this.records.set(n.id,n),this.events.emit(Et.updated,n))},this.get=async(i,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:n}),await this.getRecord(n)),this.delete=(i,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(d=>{if(d.topic===i){if(typeof n<"u"&&d.id!==n)return;this.records.delete(d.id),this.events.emit(Et.deleted,d)}})},this.exists=async(i,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===i:!1),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=De.generateChildLogger(t,this.name)}get context(){return De.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const i={topic:t.topic,request:Zr(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:i}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Et.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Et.created,e=>{const t=Et.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(Et.updated,e=>{const t=Et.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(Et.deleted,e=>{const t=Et.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}class pg extends Ic{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.expirations=new Map,this.events=new ct.EventEmitter,this.name=Gd,this.version=Wd,this.cached=[],this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const n=this.formatTarget(i);return typeof this.getExpiration(n)<"u"}catch{return!1}},this.set=(i,n)=>{this.isInitialized();const d=this.formatTarget(i),_={target:d,expiry:n};this.expirations.set(d,_),this.checkExpiry(d,_),this.events.emit(dt.created,{target:d,expiration:_})},this.get=i=>{this.isInitialized();const n=this.formatTarget(i);return this.getExpiration(n)},this.del=i=>{this.isInitialized();const n=this.formatTarget(i);if(this.has(n)){const d=this.getExpiration(n);this.expirations.delete(n),this.events.emit(dt.deleted,{target:n,expiration:d})}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=De.generateChildLogger(t,this.name)}get context(){return De.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Yf(e);if(typeof e=="number")return Jf(e);const{message:t}=J("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(dt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:i}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}checkExpiry(e,t){const{expiry:i}=t;te.toMiliseconds(i)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(dt.expired,{target:e,expiration:t})}checkExpirations(){this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(Sr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(dt.created,e=>{const t=dt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(dt.expired,e=>{const t=dt.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(dt.deleted,e=>{const t=dt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}var yg=Object.defineProperty,Ps=Object.getOwnPropertySymbols,_g=Object.prototype.hasOwnProperty,bg=Object.prototype.propertyIsEnumerable,As=(r,e,t)=>e in r?yg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ns=(r,e)=>{for(var t in e||(e={}))_g.call(e,t)&&As(r,t,e[t]);if(Ps)for(var t of Ps(e))bg.call(e,t)&&As(r,t,e[t]);return r};class Zi extends wc{constructor(e){super(e),this.protocol=Yo,this.version=Ed,this.name=Xi,this.events=new ct.EventEmitter,this.initialized=!1,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.projectId=e==null?void 0:e.projectId;const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Wr(De.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Dd.logger}));this.logger=De.generateChildLogger(t,this.name),this.heartbeat=new Sr.HeartBeat,this.crypto=new Yd(this,this.logger,e==null?void 0:e.keychain),this.history=new gg(this,this.logger),this.expirer=new pg(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new rc(Ns(Ns({},Sd),e==null?void 0:e.storageOptions)),this.relayer=new ug({core:this,logger:this.logger,relayUrl:e==null?void 0:e.relayUrl,projectId:this.projectId}),this.pairing=new dg(this,this.logger)}static async init(e){const t=new Zi(e);return await t.initialize(),t}get context(){return De.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initilization Success")}catch(e){throw this.logger.warn(`Core Initilization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const mg=Zi,Xo="wc",Zo=2,Qo="client",Qi=`${Xo}@${Zo}:${Qo}:`,mi={name:Qo,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},wg="proposal",vg="session",$r=te.SEVEN_DAYS,Eg="engine",_r={wc_sessionPropose:{req:{ttl:te.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:te.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:te.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:te.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:te.ONE_DAY,prompt:!1,tag:1104},res:{ttl:te.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:te.ONE_DAY,prompt:!1,tag:1106},res:{ttl:te.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:te.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:te.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:te.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:te.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:te.ONE_DAY,prompt:!1,tag:1112},res:{ttl:te.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:te.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:te.THIRTY_SECONDS,prompt:!1,tag:1115}}},Dg="request";var Sg=Object.defineProperty,Og=Object.defineProperties,xg=Object.getOwnPropertyDescriptors,Cs=Object.getOwnPropertySymbols,Ig=Object.prototype.hasOwnProperty,Tg=Object.prototype.propertyIsEnumerable,Rs=(r,e,t)=>e in r?Sg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Lt=(r,e)=>{for(var t in e||(e={}))Ig.call(e,t)&&Rs(r,t,e[t]);if(Cs)for(var t of Cs(e))Tg.call(e,t)&&Rs(r,t,e[t]);return r},Fs=(r,e)=>Og(r,xg(e));class Pg extends Pc{constructor(e){super(e),this.name=Eg,this.events=new ct,this.initialized=!1,this.ignoredPayloadTypes=[Zt],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(_r)}),this.initialized=!0)},this.connect=async t=>{this.isInitialized(),await this.isValidConnect(t);const{pairingTopic:i,requiredNamespaces:n,relays:d}=t;let _=i,g,w=!1;if(_&&(w=this.client.core.pairing.pairings.get(_).active),!_||!w){const{topic:j,uri:G}=await this.client.core.pairing.create();_=j,g=G}const I=await this.client.core.crypto.generateKeyPair(),x={requiredNamespaces:n,relays:d??[{protocol:Jo}],proposer:{publicKey:I,metadata:this.client.metadata}},{reject:N,resolve:q,done:C}=Yt();if(this.events.once(Ue("session_connect"),async({error:j,session:G})=>{if(j)N(j);else if(G){G.self.publicKey=I;const b=Fs(Lt({},G),{requiredNamespaces:n});await this.client.session.set(G.topic,b),await this.setExpiry(G.topic,G.expiry),_&&await this.client.core.pairing.updateMetadata({topic:_,metadata:G.peer.metadata}),q(b)}}),!_){const{message:j}=J("NO_MATCHING_KEY",`connect() pairing topic: ${_}`);throw new Error(j)}const A=await this.sendRequest(_,"wc_sessionPropose",x),z=Nt(te.FIVE_MINUTES);return await this.setProposal(A,Lt({id:A,expiry:z},x)),{uri:g,approval:C}},this.pair=async t=>(this.isInitialized(),await this.client.core.pairing.pair(t)),this.approve=async t=>{this.isInitialized(),await this.isValidApprove(t);const{id:i,relayProtocol:n,namespaces:d}=t,{pairingTopic:_,proposer:g,requiredNamespaces:w}=this.client.proposal.get(i),I=await this.client.core.crypto.generateKeyPair(),x=g.publicKey,N=await this.client.core.crypto.generateSharedKey(I,x),q={relay:{protocol:n??"irn"},namespaces:d,requiredNamespaces:w,controller:{publicKey:I,metadata:this.client.metadata},expiry:Nt($r)};await this.client.core.relayer.subscribe(N);const C=await this.sendRequest(N,"wc_sessionSettle",q),{done:A,resolve:z,reject:j}=Yt();this.events.once(Ue("session_approve",C),({error:b})=>{b?j(b):z(this.client.session.get(N))});const G=Fs(Lt({},q),{topic:N,acknowledged:!1,self:q.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:I});return await this.client.session.set(N,G),await this.setExpiry(N,Nt($r)),_&&await this.client.core.pairing.updateMetadata({topic:_,metadata:G.peer.metadata}),_&&i&&(await this.sendResult(i,_,{relay:{protocol:n??"irn"},responderPublicKey:I}),await this.client.proposal.delete(i,Je("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:_})),{topic:N,acknowledged:A}},this.reject=async t=>{this.isInitialized(),await this.isValidReject(t);const{id:i,reason:n}=t,{pairingTopic:d}=this.client.proposal.get(i);d&&(await this.sendError(i,d,n),await this.client.proposal.delete(i,Je("USER_DISCONNECTED")))},this.update=async t=>{this.isInitialized(),await this.isValidUpdate(t);const{topic:i,namespaces:n}=t,d=await this.sendRequest(i,"wc_sessionUpdate",{namespaces:n}),{done:_,resolve:g,reject:w}=Yt();return this.events.once(Ue("session_update",d),({error:I})=>{I?w(I):g()}),await this.client.session.update(i,{namespaces:n}),{acknowledged:_}},this.extend=async t=>{this.isInitialized(),await this.isValidExtend(t);const{topic:i}=t,n=await this.sendRequest(i,"wc_sessionExtend",{}),{done:d,resolve:_,reject:g}=Yt();return this.events.once(Ue("session_extend",n),({error:w})=>{w?g(w):_()}),await this.setExpiry(i,Nt($r)),{acknowledged:d}},this.request=async t=>{this.isInitialized(),await this.isValidRequest(t);const{chainId:i,request:n,topic:d}=t,_=await this.sendRequest(d,"wc_sessionRequest",{request:n,chainId:i}),{done:g,resolve:w,reject:I}=Yt();return this.events.once(Ue("session_request",_),({error:x,result:N})=>{x?I(x):w(N)}),await g()},this.respond=async t=>{this.isInitialized(),await this.isValidRespond(t);const{topic:i,response:n}=t,{id:d}=n;At(n)?await this.sendResult(d,i,n.result):_t(n)&&await this.sendError(d,i,n.error),this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0})},this.ping=async t=>{this.isInitialized(),await this.isValidPing(t);const{topic:i}=t;if(this.client.session.keys.includes(i)){const n=await this.sendRequest(i,"wc_sessionPing",{}),{done:d,resolve:_,reject:g}=Yt();this.events.once(Ue("session_ping",n),({error:w})=>{w?g(w):_()}),await d()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async t=>{this.isInitialized(),await this.isValidEmit(t);const{topic:i,event:n,chainId:d}=t;await this.sendRequest(i,"wc_sessionEvent",{event:n,chainId:d})},this.disconnect=async t=>{this.isInitialized(),await this.isValidDisconnect(t);const{topic:i}=t;this.client.session.keys.includes(i)?(await this.sendRequest(i,"wc_sessionDelete",Je("USER_DISCONNECTED")),await this.deleteSession(i)):await this.client.core.pairing.disconnect({topic:i})},this.find=t=>(this.isInitialized(),this.client.session.getAll().filter(i=>hh(i,t))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.deleteSession=async(t,i)=>{const{self:n}=this.client.session.get(t);await this.client.core.relayer.unsubscribe(t),await Promise.all([this.client.session.delete(t,Je("USER_DISCONNECTED")),this.client.core.crypto.deleteKeyPair(n.publicKey),this.client.core.crypto.deleteSymKey(t),i?Promise.resolve():this.client.core.expirer.del(t)])},this.deleteProposal=async(t,i)=>{await Promise.all([this.client.proposal.delete(t,Je("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(t)])},this.deletePendingSessionRequest=async(t,i,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,i),n?Promise.resolve():this.client.core.expirer.del(t)])},this.setExpiry=async(t,i)=>{this.client.session.keys.includes(t)&&await this.client.session.update(t,{expiry:i}),this.client.core.expirer.set(t,i)},this.setProposal=async(t,i)=>{await this.client.proposal.set(t,i),this.client.core.expirer.set(t,i.expiry)},this.setPendingSessionRequest=async t=>{const i=_r.wc_sessionRequest.req.ttl,{id:n,topic:d,params:_}=t;await this.client.pendingRequest.set(n,{id:n,topic:d,params:_}),i&&this.client.core.expirer.set(n,i)},this.sendRequest=async(t,i,n)=>{const d=Zr(i,n),_=await this.client.core.crypto.encode(t,d),g=_r[i].req;return this.client.core.history.set(t,d),this.client.core.relayer.publish(t,_,g),d.id},this.sendResult=async(t,i,n)=>{const d=Wi(t,n),_=await this.client.core.crypto.encode(i,d),g=await this.client.core.history.get(i,t),w=_r[g.request.method].res;this.client.core.relayer.publish(i,_,w),await this.client.core.history.resolve(d)},this.sendError=async(t,i,n)=>{const d=Qr(t,n),_=await this.client.core.crypto.encode(i,d),g=await this.client.core.history.get(i,t),w=_r[g.request.method].res;this.client.core.relayer.publish(i,_,w),await this.client.core.history.resolve(d)},this.cleanup=async()=>{const t=[],i=[];this.client.session.getAll().forEach(n=>{Mt(n.expiry)&&t.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{Mt(n.expiry)&&i.push(n.id)}),await Promise.all([...t.map(n=>this.deleteSession(n)),...i.map(n=>this.deleteProposal(n))])},this.onRelayEventRequest=t=>{const{topic:i,payload:n}=t,d=n.method;switch(d){case"wc_sessionPropose":return this.onSessionProposeRequest(i,n);case"wc_sessionSettle":return this.onSessionSettleRequest(i,n);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,n);case"wc_sessionExtend":return this.onSessionExtendRequest(i,n);case"wc_sessionPing":return this.onSessionPingRequest(i,n);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,n);case"wc_sessionRequest":return this.onSessionRequest(i,n);case"wc_sessionEvent":return this.onSessionEventRequest(i,n);default:return this.client.logger.info(`Unsupported request method ${d}`)}},this.onRelayEventResponse=async t=>{const{topic:i,payload:n}=t,d=(await this.client.core.history.get(i,n.id)).request.method;switch(d){case"wc_sessionPropose":return this.onSessionProposeResponse(i,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,n);case"wc_sessionExtend":return this.onSessionExtendResponse(i,n);case"wc_sessionPing":return this.onSessionPingResponse(i,n);case"wc_sessionRequest":return this.onSessionRequestResponse(i,n);default:return this.client.logger.info(`Unsupported response method ${d}`)}},this.onSessionProposeRequest=async(t,i)=>{const{params:n,id:d}=i;try{this.isValidConnect(Lt({},i.params));const _=Nt(te.FIVE_MINUTES),g=Lt({id:d,pairingTopic:t,expiry:_},n);await this.setProposal(d,g),this.client.events.emit("session_proposal",{id:d,params:g})}catch(_){await this.sendError(d,t,_),this.client.logger.error(_)}},this.onSessionProposeResponse=async(t,i)=>{const{id:n}=i;if(At(i)){const{result:d}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:d});const _=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:_});const g=_.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});const w=d.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:w});const I=await this.client.core.crypto.generateSharedKey(g,w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:I});const x=await this.client.core.relayer.subscribe(I);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:x}),await this.client.core.pairing.activate({topic:t})}else _t(i)&&(await this.client.proposal.delete(n,Je("USER_DISCONNECTED")),this.events.emit(Ue("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(t,i)=>{const{id:n,params:d}=i;try{this.isValidSessionSettleRequest(d);const{relay:_,controller:g,expiry:w,namespaces:I}=i.params,x={topic:t,relay:_,expiry:w,namespaces:I,acknowledged:!0,controller:g.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}};await this.sendResult(i.id,t,!0),this.events.emit(Ue("session_connect"),{session:x})}catch(_){await this.sendError(n,t,_),this.client.logger.error(_)}},this.onSessionSettleResponse=async(t,i)=>{const{id:n}=i;At(i)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(Ue("session_approve",n),{})):_t(i)&&(await this.client.session.delete(t,Je("USER_DISCONNECTED")),this.events.emit(Ue("session_approve",n),{error:i.error}))},this.onSessionUpdateRequest=async(t,i)=>{const{params:n,id:d}=i;try{this.isValidUpdate(Lt({topic:t},n)),await this.client.session.update(t,{namespaces:n.namespaces}),await this.sendResult(d,t,!0),this.client.events.emit("session_update",{id:d,topic:t,params:n})}catch(_){await this.sendError(d,t,_),this.client.logger.error(_)}},this.onSessionUpdateResponse=(t,i)=>{const{id:n}=i;At(i)?this.events.emit(Ue("session_update",n),{}):_t(i)&&this.events.emit(Ue("session_update",n),{error:i.error})},this.onSessionExtendRequest=async(t,i)=>{const{id:n}=i;try{this.isValidExtend({topic:t}),await this.setExpiry(t,Nt($r)),await this.sendResult(n,t,!0),this.client.events.emit("session_extend",{id:n,topic:t})}catch(d){await this.sendError(n,t,d),this.client.logger.error(d)}},this.onSessionExtendResponse=(t,i)=>{const{id:n}=i;At(i)?this.events.emit(Ue("session_extend",n),{}):_t(i)&&this.events.emit(Ue("session_extend",n),{error:i.error})},this.onSessionPingRequest=async(t,i)=>{const{id:n}=i;try{this.isValidPing({topic:t}),await this.sendResult(n,t,!0),this.client.events.emit("session_ping",{id:n,topic:t})}catch(d){await this.sendError(n,t,d),this.client.logger.error(d)}},this.onSessionPingResponse=(t,i)=>{const{id:n}=i;setTimeout(()=>{At(i)?this.events.emit(Ue("session_ping",n),{}):_t(i)&&this.events.emit(Ue("session_ping",n),{error:i.error})},500)},this.onSessionDeleteRequest=async(t,i)=>{const{id:n}=i;try{this.isValidDisconnect({topic:t,reason:i.params}),await this.sendResult(n,t,!0),await this.deleteSession(t),this.client.events.emit("session_delete",{id:n,topic:t})}catch(d){await this.sendError(n,t,d),this.client.logger.error(d)}},this.onSessionRequest=async(t,i)=>{const{id:n,params:d}=i;try{this.isValidRequest(Lt({topic:t},d)),await this.setPendingSessionRequest({id:n,topic:t,params:d}),this.client.events.emit("session_request",{id:n,topic:t,params:d})}catch(_){await this.sendError(n,t,_),this.client.logger.error(_)}},this.onSessionRequestResponse=(t,i)=>{const{id:n}=i;At(i)?this.events.emit(Ue("session_request",n),{result:i.result}):_t(i)&&this.events.emit(Ue("session_request",n),{error:i.error})},this.onSessionEventRequest=async(t,i)=>{const{id:n,params:d}=i;try{this.isValidEmit(Lt({topic:t},d)),this.client.events.emit("session_event",{id:n,topic:t,params:d})}catch(_){await this.sendError(n,t,_),this.client.logger.error(_)}},this.isValidConnect=async t=>{if(!nt(t)){const{message:g}=J("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(g)}const{pairingTopic:i,requiredNamespaces:n,relays:d}=t;gt(i)||await this.isValidPairingTopic(i);const _=mh(n,"connect()");if(_)throw new Error(_.message);if(!wh(d,!0)){const{message:g}=J("MISSING_OR_INVALID",`connect() relays: ${d}`);throw new Error(g)}},this.isValidApprove=async t=>{if(!nt(t))throw new Error(J("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:i,namespaces:n,relayProtocol:d}=t;await this.isValidProposalId(i);const _=this.client.proposal.get(i),g=yi(n,"approve()");if(g)throw new Error(g.message);const w=as(_.requiredNamespaces,n,"update()");if(w)throw new Error(w.message);if(!Ze(d,!0)){const{message:I}=J("MISSING_OR_INVALID",`approve() relayProtocol: ${d}`);throw new Error(I)}},this.isValidReject=async t=>{if(!nt(t)){const{message:d}=J("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(d)}const{id:i,reason:n}=t;if(await this.isValidProposalId(i),!Eh(n)){const{message:d}=J("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(d)}},this.isValidSessionSettleRequest=t=>{if(!nt(t)){const{message:I}=J("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(I)}const{relay:i,controller:n,namespaces:d,expiry:_}=t;if(!Co(i)){const{message:I}=J("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(I)}const g=yh(n,"onSessionSettleRequest()");if(g)throw new Error(g.message);const w=yi(d,"onSessionSettleRequest()");if(w)throw new Error(w.message);if(Mt(_)){const{message:I}=J("EXPIRED","onSessionSettleRequest()");throw new Error(I)}},this.isValidUpdate=async t=>{if(!nt(t)){const{message:w}=J("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(w)}const{topic:i,namespaces:n}=t;await this.isValidSessionTopic(i);const d=this.client.session.get(i),_=yi(n,"update()");if(_)throw new Error(_.message);const g=as(d.requiredNamespaces,n,"update()");if(g)throw new Error(g.message)},this.isValidExtend=async t=>{if(!nt(t)){const{message:n}=J("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(n)}const{topic:i}=t;await this.isValidSessionTopic(i)},this.isValidRequest=async t=>{if(!nt(t)){const{message:g}=J("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(g)}const{topic:i,request:n,chainId:d}=t;await this.isValidSessionTopic(i);const{namespaces:_}=this.client.session.get(i);if(!os(_,d)){const{message:g}=J("MISSING_OR_INVALID",`request() chainId: ${d}`);throw new Error(g)}if(!Dh(n)){const{message:g}=J("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(g)}if(!xh(_,d,n.method)){const{message:g}=J("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(g)}},this.isValidRespond=async t=>{if(!nt(t)){const{message:d}=J("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(d)}const{topic:i,response:n}=t;if(await this.isValidSessionTopic(i),!Sh(n)){const{message:d}=J("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(d)}},this.isValidPing=async t=>{if(!nt(t)){const{message:n}=J("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(n)}const{topic:i}=t;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async t=>{if(!nt(t)){const{message:g}=J("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(g)}const{topic:i,event:n,chainId:d}=t;await this.isValidSessionTopic(i);const{namespaces:_}=this.client.session.get(i);if(!os(_,d)){const{message:g}=J("MISSING_OR_INVALID",`emit() chainId: ${d}`);throw new Error(g)}if(!Oh(n)){const{message:g}=J("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(g)}if(!Ih(_,d,n.name)){const{message:g}=J("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(g)}},this.isValidDisconnect=async t=>{if(!nt(t)){const{message:n}=J("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(n)}const{topic:i}=t;await this.isValidSessionOrPairingTopic(i)}}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(st.message,async e=>{const{topic:t,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const n=await this.client.core.crypto.decode(t,i);ki(n)?(this.client.core.history.set(t,n),this.onRelayEventRequest({topic:t,payload:n})):Yi(n)&&(await this.client.core.history.resolve(n),this.onRelayEventResponse({topic:t,payload:n}))})}registerExpirerEvents(){this.client.core.expirer.on(dt.expired,async e=>{const{topic:t,id:i}=To(e.target);if(i&&this.getPendingSessionRequests()[i])return await this.deletePendingSessionRequest(i,J("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession(t,!0),this.client.events.emit("session_expire",{topic:t})):i&&await this.deleteProposal(i,!0)})}isValidPairingTopic(e){if(!Ze(e,!1)){const{message:t}=J("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=J("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(Mt(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=J("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!Ze(e,!1)){const{message:t}=J("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(!this.client.session.keys.includes(e)){const{message:t}=J("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(Mt(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:t}=J("EXPIRED",`session topic: ${e}`);throw new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Ze(e,!1)){const{message:t}=J("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=J("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!vh(e)){const{message:t}=J("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=J("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(Mt(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:t}=J("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class Ag extends ti{constructor(e,t){super(e,t,wg,Qi),this.core=e,this.logger=t}}class Ng extends ti{constructor(e,t){super(e,t,vg,Qi),this.core=e,this.logger=t}}class Cg extends ti{constructor(e,t){super(e,t,Dg,Qi),this.core=e,this.logger=t}}let Rg=class ea extends Tc{constructor(e){super(e),this.protocol=Xo,this.version=Zo,this.name=mi.name,this.events=new ct.EventEmitter,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(n){throw this.logger.error(n.message),n}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(n){throw this.logger.error(n.message),n}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(n){throw this.logger.error(n.message),n}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(n){throw this.logger.error(n.message),n}},this.update=async i=>{try{return await this.engine.update(i)}catch(n){throw this.logger.error(n.message),n}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(n){throw this.logger.error(n.message),n}},this.request=async i=>{try{return await this.engine.request(i)}catch(n){throw this.logger.error(n.message),n}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(n){throw this.logger.error(n.message),n}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(n){throw this.logger.error(n.message),n}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(n){throw this.logger.error(n.message),n}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(n){throw this.logger.error(n.message),n}},this.find=i=>{try{return this.engine.find(i)}catch(n){throw this.logger.error(n.message),n}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=(e==null?void 0:e.name)||mi.name,this.metadata=(e==null?void 0:e.metadata)||Bf();const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Wr(De.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||mi.logger}));this.core=(e==null?void 0:e.core)||new mg(e),this.logger=De.generateChildLogger(t,this.name),this.session=new Ng(this.core,this.logger),this.proposal=new Ag(this.core,this.logger),this.pendingRequest=new Cg(this.core,this.logger),this.engine=new Pg(this)}static async init(e){const t=new ea(e);return await t.initialize(),t}get context(){return De.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.logger.info("SignClient Initilization Success")}catch(e){throw this.logger.info("SignClient Initilization Failure"),this.logger.error(e.message),e}}};var Oe={};Object.defineProperty(Oe,"__esModule",{value:!0});Oe.getLocalStorage=Oe.getLocalStorageOrThrow=Oe.getCrypto=Oe.getCryptoOrThrow=Oe.getLocation=Oe.getLocationOrThrow=Oe.getNavigator=Oe.getNavigatorOrThrow=Oe.getDocument=Oe.getDocumentOrThrow=Oe.getFromWindowOrThrow=Oe.getFromWindow=void 0;function Qt(r){let e;return typeof window<"u"&&typeof window[r]<"u"&&(e=window[r]),e}Oe.getFromWindow=Qt;function or(r){const e=Qt(r);if(!e)throw new Error(`${r} is not defined in Window`);return e}Oe.getFromWindowOrThrow=or;function Fg(){return or("document")}Oe.getDocumentOrThrow=Fg;function Ug(){return Qt("document")}Oe.getDocument=Ug;function jg(){return or("navigator")}Oe.getNavigatorOrThrow=jg;function Lg(){return Qt("navigator")}Oe.getNavigator=Lg;function Mg(){return or("location")}Oe.getLocationOrThrow=Mg;function $g(){return Qt("location")}Oe.getLocation=$g;function zg(){return or("crypto")}Oe.getCryptoOrThrow=zg;function Hg(){return Qt("crypto")}Oe.getCrypto=Hg;function qg(){return or("localStorage")}Oe.getLocalStorageOrThrow=qg;function Kg(){return Qt("localStorage")}Oe.getLocalStorage=Kg;var en={};Object.defineProperty(en,"__esModule",{value:!0});en.getWindowMetadata=void 0;const Us=Oe;function Bg(){let r,e;try{r=Us.getDocumentOrThrow(),e=Us.getLocationOrThrow()}catch{return null}function t(){const N=r.getElementsByTagName("link"),q=[];for(let C=0;C<N.length;C++){const A=N[C],z=A.getAttribute("rel");if(z&&z.toLowerCase().indexOf("icon")>-1){const j=A.getAttribute("href");if(j)if(j.toLowerCase().indexOf("https:")===-1&&j.toLowerCase().indexOf("http:")===-1&&j.indexOf("//")!==0){let G=e.protocol+"//"+e.host;if(j.indexOf("/")===0)G+=j;else{const b=e.pathname.split("/");b.pop();const D=b.join("/");G+=D+"/"+j}q.push(G)}else if(j.indexOf("//")===0){const G=e.protocol+j;q.push(G)}else q.push(j)}}return q}function i(...N){const q=r.getElementsByTagName("meta");for(let C=0;C<q.length;C++){const A=q[C],z=["itemprop","property","name"].map(j=>A.getAttribute(j)).filter(j=>j?N.includes(j):!1);if(z.length&&z){const j=A.getAttribute("content");if(j)return j}}return""}function n(){let N=i("name","og:site_name","og:title","twitter:title");return N||(N=r.title),N}function d(){return i("description","og:description","twitter:description","keywords")}const _=n(),g=d(),w=e.origin,I=t();return{description:g,url:w,icons:I,name:_}}en.getWindowMetadata=Bg;var Vg={};(function(r){const e=Bs,t=Vs,i=Ks,n=mo,d=b=>b==null,_=Symbol("encodeFragmentIdentifier");function g(b){switch(b.arrayFormat){case"index":return D=>(m,v)=>{const p=m.length;return v===void 0||b.skipNull&&v===null||b.skipEmptyString&&v===""?m:v===null?[...m,[x(D,b),"[",p,"]"].join("")]:[...m,[x(D,b),"[",x(p,b),"]=",x(v,b)].join("")]};case"bracket":return D=>(m,v)=>v===void 0||b.skipNull&&v===null||b.skipEmptyString&&v===""?m:v===null?[...m,[x(D,b),"[]"].join("")]:[...m,[x(D,b),"[]=",x(v,b)].join("")];case"colon-list-separator":return D=>(m,v)=>v===void 0||b.skipNull&&v===null||b.skipEmptyString&&v===""?m:v===null?[...m,[x(D,b),":list="].join("")]:[...m,[x(D,b),":list=",x(v,b)].join("")];case"comma":case"separator":case"bracket-separator":{const D=b.arrayFormat==="bracket-separator"?"[]=":"=";return m=>(v,p)=>p===void 0||b.skipNull&&p===null||b.skipEmptyString&&p===""?v:(p=p===null?"":p,v.length===0?[[x(m,b),D,x(p,b)].join("")]:[[v,x(p,b)].join(b.arrayFormatSeparator)])}default:return D=>(m,v)=>v===void 0||b.skipNull&&v===null||b.skipEmptyString&&v===""?m:v===null?[...m,x(D,b)]:[...m,[x(D,b),"=",x(v,b)].join("")]}}function w(b){let D;switch(b.arrayFormat){case"index":return(m,v,p)=>{if(D=/\[(\d*)\]$/.exec(m),m=m.replace(/\[\d*\]$/,""),!D){p[m]=v;return}p[m]===void 0&&(p[m]={}),p[m][D[1]]=v};case"bracket":return(m,v,p)=>{if(D=/(\[\])$/.exec(m),m=m.replace(/\[\]$/,""),!D){p[m]=v;return}if(p[m]===void 0){p[m]=[v];return}p[m]=[].concat(p[m],v)};case"colon-list-separator":return(m,v,p)=>{if(D=/(:list)$/.exec(m),m=m.replace(/:list$/,""),!D){p[m]=v;return}if(p[m]===void 0){p[m]=[v];return}p[m]=[].concat(p[m],v)};case"comma":case"separator":return(m,v,p)=>{const s=typeof v=="string"&&v.includes(b.arrayFormatSeparator),h=typeof v=="string"&&!s&&N(v,b).includes(b.arrayFormatSeparator);v=h?N(v,b):v;const L=s||h?v.split(b.arrayFormatSeparator).map(o=>N(o,b)):v===null?v:N(v,b);p[m]=L};case"bracket-separator":return(m,v,p)=>{const s=/(\[\])$/.test(m);if(m=m.replace(/\[\]$/,""),!s){p[m]=v&&N(v,b);return}const h=v===null?[]:v.split(b.arrayFormatSeparator).map(L=>N(L,b));if(p[m]===void 0){p[m]=h;return}p[m]=[].concat(p[m],h)};default:return(m,v,p)=>{if(p[m]===void 0){p[m]=v;return}p[m]=[].concat(p[m],v)}}}function I(b){if(typeof b!="string"||b.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function x(b,D){return D.encode?D.strict?e(b):encodeURIComponent(b):b}function N(b,D){return D.decode?t(b):b}function q(b){return Array.isArray(b)?b.sort():typeof b=="object"?q(Object.keys(b)).sort((D,m)=>Number(D)-Number(m)).map(D=>b[D]):b}function C(b){const D=b.indexOf("#");return D!==-1&&(b=b.slice(0,D)),b}function A(b){let D="";const m=b.indexOf("#");return m!==-1&&(D=b.slice(m)),D}function z(b){b=C(b);const D=b.indexOf("?");return D===-1?"":b.slice(D+1)}function j(b,D){return D.parseNumbers&&!Number.isNaN(Number(b))&&typeof b=="string"&&b.trim()!==""?b=Number(b):D.parseBooleans&&b!==null&&(b.toLowerCase()==="true"||b.toLowerCase()==="false")&&(b=b.toLowerCase()==="true"),b}function G(b,D){D=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},D),I(D.arrayFormatSeparator);const m=w(D),v=Object.create(null);if(typeof b!="string"||(b=b.trim().replace(/^[?#&]/,""),!b))return v;for(const p of b.split("&")){if(p==="")continue;let[s,h]=i(D.decode?p.replace(/\+/g," "):p,"=");h=h===void 0?null:["comma","separator","bracket-separator"].includes(D.arrayFormat)?h:N(h,D),m(N(s,D),h,v)}for(const p of Object.keys(v)){const s=v[p];if(typeof s=="object"&&s!==null)for(const h of Object.keys(s))s[h]=j(s[h],D);else v[p]=j(s,D)}return D.sort===!1?v:(D.sort===!0?Object.keys(v).sort():Object.keys(v).sort(D.sort)).reduce((p,s)=>{const h=v[s];return Boolean(h)&&typeof h=="object"&&!Array.isArray(h)?p[s]=q(h):p[s]=h,p},Object.create(null))}r.extract=z,r.parse=G,r.stringify=(b,D)=>{if(!b)return"";D=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},D),I(D.arrayFormatSeparator);const m=h=>D.skipNull&&d(b[h])||D.skipEmptyString&&b[h]==="",v=g(D),p={};for(const h of Object.keys(b))m(h)||(p[h]=b[h]);const s=Object.keys(p);return D.sort!==!1&&s.sort(D.sort),s.map(h=>{const L=b[h];return L===void 0?"":L===null?x(h,D):Array.isArray(L)?L.length===0&&D.arrayFormat==="bracket-separator"?x(h,D)+"[]":L.reduce(v(h),[]).join("&"):x(h,D)+"="+x(L,D)}).filter(h=>h.length>0).join("&")},r.parseUrl=(b,D)=>{D=Object.assign({decode:!0},D);const[m,v]=i(b,"#");return Object.assign({url:m.split("?")[0]||"",query:G(z(b),D)},D&&D.parseFragmentIdentifier&&v?{fragmentIdentifier:N(v,D)}:{})},r.stringifyUrl=(b,D)=>{D=Object.assign({encode:!0,strict:!0,[_]:!0},D);const m=C(b.url).split("?")[0]||"",v=r.extract(b.url),p=r.parse(v,{sort:!1}),s=Object.assign(p,b.query);let h=r.stringify(s,D);h&&(h=`?${h}`);let L=A(b.url);return b.fragmentIdentifier&&(L=`#${D[_]?x(b.fragmentIdentifier,D):b.fragmentIdentifier}`),`${m}${h}${L}`},r.pick=(b,D,m)=>{m=Object.assign({parseFragmentIdentifier:!0,[_]:!1},m);const{url:v,query:p,fragmentIdentifier:s}=r.parseUrl(b,m);return r.stringifyUrl({url:v,query:n(p,D),fragmentIdentifier:s},m)},r.exclude=(b,D,m)=>{const v=Array.isArray(D)?p=>!D.includes(p):(p,s)=>!D(p,s);return r.pick(b,v,m)}})(Vg);const Gg={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function Wg(r,e){const{message:t,code:i}=Gg[r];return{message:e?`${t} ${e}`:t,code:i}}const kg={Accept:"application/json","Content-Type":"application/json"},Yg="POST",js={headers:kg,method:Yg},Ls=10;class ta{constructor(e){if(this.url=e,this.events=new ct.EventEmitter,this.isAvailable=!1,this.registering=!1,!hs(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e,t){this.isAvailable||await this.register();try{const i=wr(e),d=await(await dn(this.url,Object.assign(Object.assign({},js),{body:i}))).json();this.onPayload({data:d})}catch(i){this.onError(e.id,i)}}async register(e=this.url){if(!hs(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((i,n)=>{this.events.once("register_error",d=>{this.resetMaxListeners(),n(d)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return n(new Error("HTTP connection is missing or invalid"));i()})})}this.url=e,this.registering=!0;try{const t=wr({id:1,jsonrpc:"2.0",method:"test",params:[]});await dn(e,Object.assign(Object.assign({},js),{body:t})),this.onOpen()}catch(t){const i=this.parseError(t);throw this.events.emit("register_error",i),this.onClose(),i}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?Ni(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const i=this.parseError(t),n=i.message||i.toString(),d=Qr(e,n);this.events.emit("payload",d)}parseError(e,t=this.url){return Uo(e,t,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Ls&&this.events.setMaxListeners(Ls)}}function Jg(r){var e;const t=(e=r[Object.keys(r)[0]])==null?void 0:e.chains[0];return[t.split(":")[0],t.split(":")[1]]}function Vr(r,e){let t;return e.rpcMap&&(t=e.rpcMap[Xg([r])]),t}function Xg(r){return Number(r[0].split(":")[1])}class Zg{constructor(e){this.name="eip155",this.namespace=e.namespace,this.client=e.client,this.events=e.events,this.httpProviders=this.createHttpProviders(),this.chainId=this.getDefaultChainId()}async request(e){var t;switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":{const i=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";return this.setDefaultChain(parseInt(i,16).toString()),null}case"eth_chainId":return this.getDefaultChainId()}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){if(this.chainId=parseInt(e),!this.httpProviders[e]){const i=t||Vr(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}createHttpProvider(e,t){const i=t||Vr(e,this.namespace);return typeof i>"u"?void 0:new Ji(new ta(i))}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return parseInt(e.split(":")[1])}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}}class Qg{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||Vr(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Vr(e,this.namespace);return typeof i>"u"?void 0:new Ji(new ta(i))}}const Ms="error",ep="wss://relay.walletconnect.com",tp="wc",rp="universal_provider",$s=`${tp}@${2}:${rp}:`;var ip=Object.defineProperty,np=Object.defineProperties,sp=Object.getOwnPropertyDescriptors,zs=Object.getOwnPropertySymbols,op=Object.prototype.hasOwnProperty,ap=Object.prototype.propertyIsEnumerable,Hs=(r,e,t)=>e in r?ip(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,qs=(r,e)=>{for(var t in e||(e={}))op.call(e,t)&&Hs(r,t,e[t]);if(zs)for(var t of zs(e))ap.call(e,t)&&Hs(r,t,e[t]);return r},cp=(r,e)=>np(r,sp(e));class tn{constructor(e){this.events=new ct,this.rpcProviders={},this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Wr(De.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Ms}))}static async init(e){const t=new tn(e);return await t.initialize(),t}async request(e,t){var i;const[n,d]=this.validateChain(t);return await this.getProvider(n).request({request:qs({},e),chainId:`${n}:${d}`,topic:(i=this.session)==null?void 0:i.topic})}sendAsync(e,t,i){this.request(e,i).then(n=>t(null,n)).catch(n=>t(n,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return await this.request({method:"eth_requestAccounts",params:[]})}async disconnect(){if(!this.client)throw new Error("Sign Client not initialized");await this.client.disconnect({topic:this.session.topic,reason:Wg("USER_DISCONNECTED")})}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");return this.setNamespaces(e.namespaces),this.createProviders(),e.skipPairing===!0?void 0:await this.pair(e.pairingTopic)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){const{uri:t,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces});return t&&(this.uri=t,this.events.emit("display_uri",t)),this.session=await i(),this.onSessionUpdate(),this.session}setDefaultChain(e,t){const[i,n]=this.validateChain(e);this.getProvider(i).setDefaultChain(n,t)}async checkStorage(){if(this.namespaces=await this.client.core.storage.getItem(`${$s}/namespaces`),this.namespaces&&this.createProviders(),this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.onSessionUpdate()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await Rg.init({logger:this.providerOpts.logger||Ms,relayUrl:this.providerOpts.relayUrl||ep,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");Object.keys(this.namespaces).forEach(e=>{switch(e){case"eip155":this.rpcProviders[e]=new Zg({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"solana":this.rpcProviders[e]=new Qg({client:this.client,namespace:this.namespaces[e],events:this.events});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var i;const{namespaces:n}=t,d=(i=this.client)==null?void 0:i.session.get(e);this.session=cp(qs({},d),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",()=>{this.events.emit("session_delete")})}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>this.getProvider(e).updateNamespace(this.session.namespaces[e]))}setNamespaces(e){if(!e||!Object.keys(e).length)throw new Error("Namespaces must be not empty");this.client.core.storage.setItem(`${$s}/namespaces`,e),this.namespaces=e}validateChain(e){const[t,i]=(e==null?void 0:e.split(":"))||["",""];if(t&&!Object.keys(this.namespaces).includes(t))throw new Error(`Invalid namespace: ${t}`);return!t||!i?Jg(this.namespaces):[t,i]}}const mp=tn;export{mp as UniversalProvider,tn as default};
//# sourceMappingURL=index.es-69cd6cd9.js.map
