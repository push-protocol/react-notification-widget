import{c as Pe,g as Ja,e as ct,a as Qr,w as Rt,d as Ir,b as St,f as fi}from"./index-aea9490c.js";import{s as Ys,a as Js,d as Xs,f as wn}from"./browser-ponyfill-4644c7b4.js";function Xa(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var Za=Qa;function Qa(t,e,r){var i=r&&r.stringify||Xa,n=1;if(typeof t=="object"&&t!==null){var l=e.length+n;if(l===1)return t;var y=new Array(l);y[0]=i(t);for(var g=1;g<l;g++)y[g]=i(e[g]);return y.join(" ")}if(typeof t!="string")return t;var p=e.length;if(p===0)return t;for(var I="",O=1-n,A=-1,z=t&&t.length||0,C=0;C<z;){if(t.charCodeAt(C)===37&&C+1<z){switch(A=A>-1?A:0,t.charCodeAt(C+1)){case 100:case 102:if(O>=p||e[O]==null)break;A<C&&(I+=t.slice(A,C)),I+=Number(e[O]),A=C+2,C++;break;case 105:if(O>=p||e[O]==null)break;A<C&&(I+=t.slice(A,C)),I+=Math.floor(Number(e[O])),A=C+2,C++;break;case 79:case 111:case 106:if(O>=p||e[O]===void 0)break;A<C&&(I+=t.slice(A,C));var P=typeof e[O];if(P==="string"){I+="'"+e[O]+"'",A=C+2,C++;break}if(P==="function"){I+=e[O].name||"<anonymous>",A=C+2,C++;break}I+=i(e[O]),A=C+2,C++;break;case 115:if(O>=p)break;A<C&&(I+=t.slice(A,C)),I+=String(e[O]),A=C+2,C++;break;case 37:A<C&&(I+=t.slice(A,C)),I+="%",A=C+2,C++,O--;break}++O}++C}return A===-1?t:(A<z&&(I+=t.slice(A)),I)}const vn=Za;var Tr=Ot;const Dr=uc().console||{},ec={mapHttpRequest:Kr,mapHttpResponse:Kr,wrapRequestSerializer:hi,wrapResponseSerializer:hi,wrapErrorSerializer:hi,req:Kr,res:Kr,err:sc};function tc(t,e){return Array.isArray(t)?t.filter(function(i){return i!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function Ot(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||Dr;t.browser.write&&(t.browser.asObject=!0);const i=t.serializers||{},n=tc(t.browser.serialize,i);let l=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(l=!1);const y=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),t.enabled===!1&&(t.level="silent");const g=t.level||"info",p=Object.create(r);p.log||(p.log=Sr),Object.defineProperty(p,"levelVal",{get:O}),Object.defineProperty(p,"level",{get:A,set:z});const I={transmit:e,serialize:n,asObject:t.browser.asObject,levels:y,timestamp:oc(t)};p.levels=Ot.levels,p.level=g,p.setMaxListeners=p.getMaxListeners=p.emit=p.addListener=p.on=p.prependListener=p.once=p.prependOnceListener=p.removeListener=p.removeAllListeners=p.listeners=p.listenerCount=p.eventNames=p.write=p.flush=Sr,p.serializers=i,p._serialize=n,p._stdErrSerialize=l,p.child=C,e&&(p._logEvent=xi());function O(){return this.level==="silent"?1/0:this.levels.values[this.level]}function A(){return this._level}function z(P){if(P!=="silent"&&!this.levels.values[P])throw Error("unknown level "+P);this._level=P,rr(I,p,"error","log"),rr(I,p,"fatal","error"),rr(I,p,"warn","error"),rr(I,p,"info","log"),rr(I,p,"debug","log"),rr(I,p,"trace","log")}function C(P,q){if(!P)throw new Error("missing bindings for child Pino");q=q||{},n&&P.serializers&&(q.serializers=P.serializers);const $=q.serializers;if(n&&$){var G=Object.assign({},i,$),b=t.browser.serialize===!0?Object.keys(G):n;delete P.serializers,ei([P],b,G,this._stdErrSerialize)}function D(m){this._childLevel=(m._childLevel|0)+1,this.error=ir(m,P,"error"),this.fatal=ir(m,P,"fatal"),this.warn=ir(m,P,"warn"),this.info=ir(m,P,"info"),this.debug=ir(m,P,"debug"),this.trace=ir(m,P,"trace"),G&&(this.serializers=G,this._serialize=b),e&&(this._logEvent=xi([].concat(m._logEvent.bindings,P)))}return D.prototype=this,new D(this)}return p}Ot.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};Ot.stdSerializers=ec;Ot.stdTimeFunctions=Object.assign({},{nullTime:Zs,epochTime:Qs,unixTime:ac,isoTime:cc});function rr(t,e,r,i){const n=Object.getPrototypeOf(e);e[r]=e.levelVal>e.levels.values[r]?Sr:n[r]?n[r]:Dr[r]||Dr[i]||Sr,rc(t,e,r)}function rc(t,e,r){!t.transmit&&e[r]===Sr||(e[r]=function(i){return function(){const l=t.timestamp(),y=new Array(arguments.length),g=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Dr?Dr:this;for(var p=0;p<y.length;p++)y[p]=arguments[p];if(t.serialize&&!t.asObject&&ei(y,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?i.call(g,ic(this,r,y,l)):i.apply(g,y),t.transmit){const I=t.transmit.level||e.level,O=Ot.levels.values[I],A=Ot.levels.values[r];if(A<O)return;nc(this,{ts:l,methodLevel:r,methodValue:A,transmitLevel:I,transmitValue:Ot.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},y)}}}(e[r]))}function ic(t,e,r,i){t._serialize&&ei(r,t._serialize,t.serializers,t._stdErrSerialize);const n=r.slice();let l=n[0];const y={};i&&(y.time=i),y.level=Ot.levels.values[e];let g=(t._childLevel|0)+1;if(g<1&&(g=1),l!==null&&typeof l=="object"){for(;g--&&typeof n[0]=="object";)Object.assign(y,n.shift());l=n.length?vn(n.shift(),n):void 0}else typeof l=="string"&&(l=vn(n.shift(),n));return l!==void 0&&(y.msg=l),y}function ei(t,e,r,i){for(const n in t)if(i&&t[n]instanceof Error)t[n]=Ot.stdSerializers.err(t[n]);else if(typeof t[n]=="object"&&!Array.isArray(t[n]))for(const l in t[n])e&&e.indexOf(l)>-1&&l in r&&(t[n][l]=r[l](t[n][l]))}function ir(t,e,r){return function(){const i=new Array(1+arguments.length);i[0]=e;for(var n=1;n<i.length;n++)i[n]=arguments[n-1];return t[r].apply(this,i)}}function nc(t,e,r){const i=e.send,n=e.ts,l=e.methodLevel,y=e.methodValue,g=e.val,p=t._logEvent.bindings;ei(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=n,t._logEvent.messages=r.filter(function(I){return p.indexOf(I)===-1}),t._logEvent.level.label=l,t._logEvent.level.value=y,i(l,t._logEvent,g),t._logEvent=xi(p)}function xi(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function sc(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function oc(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?Zs:Qs}function Kr(){return{}}function hi(t){return t}function Sr(){}function Zs(){return!1}function Qs(){return Date.now()}function ac(){return Math.round(Date.now()/1e3)}function cc(){return new Date(Date.now()).toISOString()}function uc(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}var ti={},Wr={},fc={get exports(){return Wr},set exports(t){Wr=t}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(t){var e,r,i,n,l,y,g,p,I,O,A,z,C,P,q,$,G,b,D,m,w,v,s;(function(h){var H=typeof Pe=="object"?Pe:typeof self=="object"?self:typeof this=="object"?this:{};h(o(H,o(t.exports)));function o(c,f){return c!==H&&(typeof Object.create=="function"?Object.defineProperty(c,"__esModule",{value:!0}):c.__esModule=!0),function(_,d){return c[_]=f?f(_,d):d}}})(function(h){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,c){o.__proto__=c}||function(o,c){for(var f in c)c.hasOwnProperty(f)&&(o[f]=c[f])};e=function(o,c){H(o,c);function f(){this.constructor=o}o.prototype=c===null?Object.create(c):(f.prototype=c.prototype,new f)},r=Object.assign||function(o){for(var c,f=1,_=arguments.length;f<_;f++){c=arguments[f];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(o[d]=c[d])}return o},i=function(o,c){var f={};for(var _ in o)Object.prototype.hasOwnProperty.call(o,_)&&c.indexOf(_)<0&&(f[_]=o[_]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,_=Object.getOwnPropertySymbols(o);d<_.length;d++)c.indexOf(_[d])<0&&Object.prototype.propertyIsEnumerable.call(o,_[d])&&(f[_[d]]=o[_[d]]);return f},n=function(o,c,f,_){var d=arguments.length,u=d<3?c:_===null?_=Object.getOwnPropertyDescriptor(c,f):_,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,c,f,_);else for(var N=o.length-1;N>=0;N--)(x=o[N])&&(u=(d<3?x(u):d>3?x(c,f,u):x(c,f))||u);return d>3&&u&&Object.defineProperty(c,f,u),u},l=function(o,c){return function(f,_){c(f,_,o)}},y=function(o,c){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,c)},g=function(o,c,f,_){function d(u){return u instanceof f?u:new f(function(x){x(u)})}return new(f||(f=Promise))(function(u,x){function N(U){try{E(_.next(U))}catch(B){x(B)}}function M(U){try{E(_.throw(U))}catch(B){x(B)}}function E(U){U.done?u(U.value):d(U.value).then(N,M)}E((_=_.apply(o,c||[])).next())})},p=function(o,c){var f={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},_,d,u,x;return x={next:N(0),throw:N(1),return:N(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function N(E){return function(U){return M([E,U])}}function M(E){if(_)throw new TypeError("Generator is already executing.");for(;f;)try{if(_=1,d&&(u=E[0]&2?d.return:E[0]?d.throw||((u=d.return)&&u.call(d),0):d.next)&&!(u=u.call(d,E[1])).done)return u;switch(d=0,u&&(E=[E[0]&2,u.value]),E[0]){case 0:case 1:u=E;break;case 4:return f.label++,{value:E[1],done:!1};case 5:f.label++,d=E[1],E=[0];continue;case 7:E=f.ops.pop(),f.trys.pop();continue;default:if(u=f.trys,!(u=u.length>0&&u[u.length-1])&&(E[0]===6||E[0]===2)){f=0;continue}if(E[0]===3&&(!u||E[1]>u[0]&&E[1]<u[3])){f.label=E[1];break}if(E[0]===6&&f.label<u[1]){f.label=u[1],u=E;break}if(u&&f.label<u[2]){f.label=u[2],f.ops.push(E);break}u[2]&&f.ops.pop(),f.trys.pop();continue}E=c.call(o,f)}catch(U){E=[6,U],d=0}finally{_=u=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}},s=function(o,c,f,_){_===void 0&&(_=f),o[_]=c[f]},I=function(o,c){for(var f in o)f!=="default"&&!c.hasOwnProperty(f)&&(c[f]=o[f])},O=function(o){var c=typeof Symbol=="function"&&Symbol.iterator,f=c&&o[c],_=0;if(f)return f.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&_>=o.length&&(o=void 0),{value:o&&o[_++],done:!o}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")},A=function(o,c){var f=typeof Symbol=="function"&&o[Symbol.iterator];if(!f)return o;var _=f.call(o),d,u=[],x;try{for(;(c===void 0||c-- >0)&&!(d=_.next()).done;)u.push(d.value)}catch(N){x={error:N}}finally{try{d&&!d.done&&(f=_.return)&&f.call(_)}finally{if(x)throw x.error}}return u},z=function(){for(var o=[],c=0;c<arguments.length;c++)o=o.concat(A(arguments[c]));return o},C=function(){for(var o=0,c=0,f=arguments.length;c<f;c++)o+=arguments[c].length;for(var _=Array(o),d=0,c=0;c<f;c++)for(var u=arguments[c],x=0,N=u.length;x<N;x++,d++)_[d]=u[x];return _},P=function(o){return this instanceof P?(this.v=o,this):new P(o)},q=function(o,c,f){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var _=f.apply(o,c||[]),d,u=[];return d={},x("next"),x("throw"),x("return"),d[Symbol.asyncIterator]=function(){return this},d;function x(K){_[K]&&(d[K]=function(V){return new Promise(function(Q,Y){u.push([K,V,Q,Y])>1||N(K,V)})})}function N(K,V){try{M(_[K](V))}catch(Q){B(u[0][3],Q)}}function M(K){K.value instanceof P?Promise.resolve(K.value.v).then(E,U):B(u[0][2],K)}function E(K){N("next",K)}function U(K){N("throw",K)}function B(K,V){K(V),u.shift(),u.length&&N(u[0][0],u[0][1])}},$=function(o){var c,f;return c={},_("next"),_("throw",function(d){throw d}),_("return"),c[Symbol.iterator]=function(){return this},c;function _(d,u){c[d]=o[d]?function(x){return(f=!f)?{value:P(o[d](x)),done:d==="return"}:u?u(x):x}:u}},G=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=o[Symbol.asyncIterator],f;return c?c.call(o):(o=typeof O=="function"?O(o):o[Symbol.iterator](),f={},_("next"),_("throw"),_("return"),f[Symbol.asyncIterator]=function(){return this},f);function _(u){f[u]=o[u]&&function(x){return new Promise(function(N,M){x=o[u](x),d(N,M,x.done,x.value)})}}function d(u,x,N,M){Promise.resolve(M).then(function(E){u({value:E,done:N})},x)}},b=function(o,c){return Object.defineProperty?Object.defineProperty(o,"raw",{value:c}):o.raw=c,o},D=function(o){if(o&&o.__esModule)return o;var c={};if(o!=null)for(var f in o)Object.hasOwnProperty.call(o,f)&&(c[f]=o[f]);return c.default=o,c},m=function(o){return o&&o.__esModule?o:{default:o}},w=function(o,c){if(!c.has(o))throw new TypeError("attempted to get private field on non-instance");return c.get(o)},v=function(o,c,f){if(!c.has(o))throw new TypeError("attempted to set private field on non-instance");return c.set(o,f),f},h("__extends",e),h("__assign",r),h("__rest",i),h("__decorate",n),h("__param",l),h("__metadata",y),h("__awaiter",g),h("__generator",p),h("__exportStar",I),h("__createBinding",s),h("__values",O),h("__read",A),h("__spread",z),h("__spreadArrays",C),h("__await",P),h("__asyncGenerator",q),h("__asyncDelegator",$),h("__asyncValues",G),h("__makeTemplateObject",b),h("__importStar",D),h("__importDefault",m),h("__classPrivateFieldGet",w),h("__classPrivateFieldSet",v)})})(fc);var Pr={};Object.defineProperty(Pr,"__esModule",{value:!0});function hc(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return JSON.parse(t)}catch{return t}}Pr.safeJsonParse=hc;function lc(t){return typeof t=="string"?t:JSON.stringify(t,(e,r)=>typeof r>"u"?null:r)}Pr.safeJsonStringify=lc;var kr={},li={get exports(){return kr},set exports(t){kr=t}},En;function dc(){return En||(En=1,function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Pe<"u"&&Pe.localStorage?li.exports=Pe.localStorage:typeof window<"u"&&window.localStorage?li.exports=window.localStorage:li.exports=new e}()),kr}var di={},dr={},Dn;function gc(){if(Dn)return dr;Dn=1,Object.defineProperty(dr,"__esModule",{value:!0}),dr.IKeyValueStorage=void 0;class t{}return dr.IKeyValueStorage=t,dr}var gr={},Sn;function pc(){if(Sn)return gr;Sn=1,Object.defineProperty(gr,"__esModule",{value:!0}),gr.parseEntry=void 0;const t=Pr;function e(r){var i;return[r[0],t.safeJsonParse((i=r[1])!==null&&i!==void 0?i:"")]}return gr.parseEntry=e,gr}var On;function yc(){return On||(On=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Wr;e.__exportStar(gc(),t),e.__exportStar(pc(),t)}(di)),di}Object.defineProperty(ti,"__esModule",{value:!0});ti.KeyValueStorage=void 0;const sr=Wr,xn=Pr,_c=sr.__importDefault(dc()),bc=yc();class eo{constructor(){this.localStorage=_c.default}getKeys(){return sr.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return sr.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(bc.parseEntry)})}getItem(e){return sr.__awaiter(this,void 0,void 0,function*(){const r=this.localStorage.getItem(e);if(r!==null)return xn.safeJsonParse(r)})}setItem(e,r){return sr.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,xn.safeJsonStringify(r))})}removeItem(e){return sr.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}ti.KeyValueStorage=eo;var mc=ti.default=eo,Ar={},or={},wc={get exports(){return or},set exports(t){or=t}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(t){var e,r,i,n,l,y,g,p,I,O,A,z,C,P,q,$,G,b,D,m,w,v,s;(function(h){var H=typeof Pe=="object"?Pe:typeof self=="object"?self:typeof this=="object"?this:{};h(o(H,o(t.exports)));function o(c,f){return c!==H&&(typeof Object.create=="function"?Object.defineProperty(c,"__esModule",{value:!0}):c.__esModule=!0),function(_,d){return c[_]=f?f(_,d):d}}})(function(h){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,c){o.__proto__=c}||function(o,c){for(var f in c)c.hasOwnProperty(f)&&(o[f]=c[f])};e=function(o,c){H(o,c);function f(){this.constructor=o}o.prototype=c===null?Object.create(c):(f.prototype=c.prototype,new f)},r=Object.assign||function(o){for(var c,f=1,_=arguments.length;f<_;f++){c=arguments[f];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(o[d]=c[d])}return o},i=function(o,c){var f={};for(var _ in o)Object.prototype.hasOwnProperty.call(o,_)&&c.indexOf(_)<0&&(f[_]=o[_]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,_=Object.getOwnPropertySymbols(o);d<_.length;d++)c.indexOf(_[d])<0&&Object.prototype.propertyIsEnumerable.call(o,_[d])&&(f[_[d]]=o[_[d]]);return f},n=function(o,c,f,_){var d=arguments.length,u=d<3?c:_===null?_=Object.getOwnPropertyDescriptor(c,f):_,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,c,f,_);else for(var N=o.length-1;N>=0;N--)(x=o[N])&&(u=(d<3?x(u):d>3?x(c,f,u):x(c,f))||u);return d>3&&u&&Object.defineProperty(c,f,u),u},l=function(o,c){return function(f,_){c(f,_,o)}},y=function(o,c){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,c)},g=function(o,c,f,_){function d(u){return u instanceof f?u:new f(function(x){x(u)})}return new(f||(f=Promise))(function(u,x){function N(U){try{E(_.next(U))}catch(B){x(B)}}function M(U){try{E(_.throw(U))}catch(B){x(B)}}function E(U){U.done?u(U.value):d(U.value).then(N,M)}E((_=_.apply(o,c||[])).next())})},p=function(o,c){var f={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},_,d,u,x;return x={next:N(0),throw:N(1),return:N(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function N(E){return function(U){return M([E,U])}}function M(E){if(_)throw new TypeError("Generator is already executing.");for(;f;)try{if(_=1,d&&(u=E[0]&2?d.return:E[0]?d.throw||((u=d.return)&&u.call(d),0):d.next)&&!(u=u.call(d,E[1])).done)return u;switch(d=0,u&&(E=[E[0]&2,u.value]),E[0]){case 0:case 1:u=E;break;case 4:return f.label++,{value:E[1],done:!1};case 5:f.label++,d=E[1],E=[0];continue;case 7:E=f.ops.pop(),f.trys.pop();continue;default:if(u=f.trys,!(u=u.length>0&&u[u.length-1])&&(E[0]===6||E[0]===2)){f=0;continue}if(E[0]===3&&(!u||E[1]>u[0]&&E[1]<u[3])){f.label=E[1];break}if(E[0]===6&&f.label<u[1]){f.label=u[1],u=E;break}if(u&&f.label<u[2]){f.label=u[2],f.ops.push(E);break}u[2]&&f.ops.pop(),f.trys.pop();continue}E=c.call(o,f)}catch(U){E=[6,U],d=0}finally{_=u=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}},s=function(o,c,f,_){_===void 0&&(_=f),o[_]=c[f]},I=function(o,c){for(var f in o)f!=="default"&&!c.hasOwnProperty(f)&&(c[f]=o[f])},O=function(o){var c=typeof Symbol=="function"&&Symbol.iterator,f=c&&o[c],_=0;if(f)return f.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&_>=o.length&&(o=void 0),{value:o&&o[_++],done:!o}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")},A=function(o,c){var f=typeof Symbol=="function"&&o[Symbol.iterator];if(!f)return o;var _=f.call(o),d,u=[],x;try{for(;(c===void 0||c-- >0)&&!(d=_.next()).done;)u.push(d.value)}catch(N){x={error:N}}finally{try{d&&!d.done&&(f=_.return)&&f.call(_)}finally{if(x)throw x.error}}return u},z=function(){for(var o=[],c=0;c<arguments.length;c++)o=o.concat(A(arguments[c]));return o},C=function(){for(var o=0,c=0,f=arguments.length;c<f;c++)o+=arguments[c].length;for(var _=Array(o),d=0,c=0;c<f;c++)for(var u=arguments[c],x=0,N=u.length;x<N;x++,d++)_[d]=u[x];return _},P=function(o){return this instanceof P?(this.v=o,this):new P(o)},q=function(o,c,f){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var _=f.apply(o,c||[]),d,u=[];return d={},x("next"),x("throw"),x("return"),d[Symbol.asyncIterator]=function(){return this},d;function x(K){_[K]&&(d[K]=function(V){return new Promise(function(Q,Y){u.push([K,V,Q,Y])>1||N(K,V)})})}function N(K,V){try{M(_[K](V))}catch(Q){B(u[0][3],Q)}}function M(K){K.value instanceof P?Promise.resolve(K.value.v).then(E,U):B(u[0][2],K)}function E(K){N("next",K)}function U(K){N("throw",K)}function B(K,V){K(V),u.shift(),u.length&&N(u[0][0],u[0][1])}},$=function(o){var c,f;return c={},_("next"),_("throw",function(d){throw d}),_("return"),c[Symbol.iterator]=function(){return this},c;function _(d,u){c[d]=o[d]?function(x){return(f=!f)?{value:P(o[d](x)),done:d==="return"}:u?u(x):x}:u}},G=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=o[Symbol.asyncIterator],f;return c?c.call(o):(o=typeof O=="function"?O(o):o[Symbol.iterator](),f={},_("next"),_("throw"),_("return"),f[Symbol.asyncIterator]=function(){return this},f);function _(u){f[u]=o[u]&&function(x){return new Promise(function(N,M){x=o[u](x),d(N,M,x.done,x.value)})}}function d(u,x,N,M){Promise.resolve(M).then(function(E){u({value:E,done:N})},x)}},b=function(o,c){return Object.defineProperty?Object.defineProperty(o,"raw",{value:c}):o.raw=c,o},D=function(o){if(o&&o.__esModule)return o;var c={};if(o!=null)for(var f in o)Object.hasOwnProperty.call(o,f)&&(c[f]=o[f]);return c.default=o,c},m=function(o){return o&&o.__esModule?o:{default:o}},w=function(o,c){if(!c.has(o))throw new TypeError("attempted to get private field on non-instance");return c.get(o)},v=function(o,c,f){if(!c.has(o))throw new TypeError("attempted to set private field on non-instance");return c.set(o,f),f},h("__extends",e),h("__assign",r),h("__rest",i),h("__decorate",n),h("__param",l),h("__metadata",y),h("__awaiter",g),h("__generator",p),h("__exportStar",I),h("__createBinding",s),h("__values",O),h("__read",A),h("__spread",z),h("__spreadArrays",C),h("__await",P),h("__asyncGenerator",q),h("__asyncDelegator",$),h("__asyncValues",G),h("__makeTemplateObject",b),h("__importStar",D),h("__importDefault",m),h("__classPrivateFieldGet",w),h("__classPrivateFieldSet",v)})})(wc);var pr={},ee={},ar={},vc={get exports(){return ar},set exports(t){ar=t}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(t){var e,r,i,n,l,y,g,p,I,O,A,z,C,P,q,$,G,b,D,m,w,v,s;(function(h){var H=typeof Pe=="object"?Pe:typeof self=="object"?self:typeof this=="object"?this:{};h(o(H,o(t.exports)));function o(c,f){return c!==H&&(typeof Object.create=="function"?Object.defineProperty(c,"__esModule",{value:!0}):c.__esModule=!0),function(_,d){return c[_]=f?f(_,d):d}}})(function(h){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,c){o.__proto__=c}||function(o,c){for(var f in c)c.hasOwnProperty(f)&&(o[f]=c[f])};e=function(o,c){H(o,c);function f(){this.constructor=o}o.prototype=c===null?Object.create(c):(f.prototype=c.prototype,new f)},r=Object.assign||function(o){for(var c,f=1,_=arguments.length;f<_;f++){c=arguments[f];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(o[d]=c[d])}return o},i=function(o,c){var f={};for(var _ in o)Object.prototype.hasOwnProperty.call(o,_)&&c.indexOf(_)<0&&(f[_]=o[_]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,_=Object.getOwnPropertySymbols(o);d<_.length;d++)c.indexOf(_[d])<0&&Object.prototype.propertyIsEnumerable.call(o,_[d])&&(f[_[d]]=o[_[d]]);return f},n=function(o,c,f,_){var d=arguments.length,u=d<3?c:_===null?_=Object.getOwnPropertyDescriptor(c,f):_,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,c,f,_);else for(var N=o.length-1;N>=0;N--)(x=o[N])&&(u=(d<3?x(u):d>3?x(c,f,u):x(c,f))||u);return d>3&&u&&Object.defineProperty(c,f,u),u},l=function(o,c){return function(f,_){c(f,_,o)}},y=function(o,c){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,c)},g=function(o,c,f,_){function d(u){return u instanceof f?u:new f(function(x){x(u)})}return new(f||(f=Promise))(function(u,x){function N(U){try{E(_.next(U))}catch(B){x(B)}}function M(U){try{E(_.throw(U))}catch(B){x(B)}}function E(U){U.done?u(U.value):d(U.value).then(N,M)}E((_=_.apply(o,c||[])).next())})},p=function(o,c){var f={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},_,d,u,x;return x={next:N(0),throw:N(1),return:N(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function N(E){return function(U){return M([E,U])}}function M(E){if(_)throw new TypeError("Generator is already executing.");for(;f;)try{if(_=1,d&&(u=E[0]&2?d.return:E[0]?d.throw||((u=d.return)&&u.call(d),0):d.next)&&!(u=u.call(d,E[1])).done)return u;switch(d=0,u&&(E=[E[0]&2,u.value]),E[0]){case 0:case 1:u=E;break;case 4:return f.label++,{value:E[1],done:!1};case 5:f.label++,d=E[1],E=[0];continue;case 7:E=f.ops.pop(),f.trys.pop();continue;default:if(u=f.trys,!(u=u.length>0&&u[u.length-1])&&(E[0]===6||E[0]===2)){f=0;continue}if(E[0]===3&&(!u||E[1]>u[0]&&E[1]<u[3])){f.label=E[1];break}if(E[0]===6&&f.label<u[1]){f.label=u[1],u=E;break}if(u&&f.label<u[2]){f.label=u[2],f.ops.push(E);break}u[2]&&f.ops.pop(),f.trys.pop();continue}E=c.call(o,f)}catch(U){E=[6,U],d=0}finally{_=u=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}},s=function(o,c,f,_){_===void 0&&(_=f),o[_]=c[f]},I=function(o,c){for(var f in o)f!=="default"&&!c.hasOwnProperty(f)&&(c[f]=o[f])},O=function(o){var c=typeof Symbol=="function"&&Symbol.iterator,f=c&&o[c],_=0;if(f)return f.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&_>=o.length&&(o=void 0),{value:o&&o[_++],done:!o}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")},A=function(o,c){var f=typeof Symbol=="function"&&o[Symbol.iterator];if(!f)return o;var _=f.call(o),d,u=[],x;try{for(;(c===void 0||c-- >0)&&!(d=_.next()).done;)u.push(d.value)}catch(N){x={error:N}}finally{try{d&&!d.done&&(f=_.return)&&f.call(_)}finally{if(x)throw x.error}}return u},z=function(){for(var o=[],c=0;c<arguments.length;c++)o=o.concat(A(arguments[c]));return o},C=function(){for(var o=0,c=0,f=arguments.length;c<f;c++)o+=arguments[c].length;for(var _=Array(o),d=0,c=0;c<f;c++)for(var u=arguments[c],x=0,N=u.length;x<N;x++,d++)_[d]=u[x];return _},P=function(o){return this instanceof P?(this.v=o,this):new P(o)},q=function(o,c,f){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var _=f.apply(o,c||[]),d,u=[];return d={},x("next"),x("throw"),x("return"),d[Symbol.asyncIterator]=function(){return this},d;function x(K){_[K]&&(d[K]=function(V){return new Promise(function(Q,Y){u.push([K,V,Q,Y])>1||N(K,V)})})}function N(K,V){try{M(_[K](V))}catch(Q){B(u[0][3],Q)}}function M(K){K.value instanceof P?Promise.resolve(K.value.v).then(E,U):B(u[0][2],K)}function E(K){N("next",K)}function U(K){N("throw",K)}function B(K,V){K(V),u.shift(),u.length&&N(u[0][0],u[0][1])}},$=function(o){var c,f;return c={},_("next"),_("throw",function(d){throw d}),_("return"),c[Symbol.iterator]=function(){return this},c;function _(d,u){c[d]=o[d]?function(x){return(f=!f)?{value:P(o[d](x)),done:d==="return"}:u?u(x):x}:u}},G=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=o[Symbol.asyncIterator],f;return c?c.call(o):(o=typeof O=="function"?O(o):o[Symbol.iterator](),f={},_("next"),_("throw"),_("return"),f[Symbol.asyncIterator]=function(){return this},f);function _(u){f[u]=o[u]&&function(x){return new Promise(function(N,M){x=o[u](x),d(N,M,x.done,x.value)})}}function d(u,x,N,M){Promise.resolve(M).then(function(E){u({value:E,done:N})},x)}},b=function(o,c){return Object.defineProperty?Object.defineProperty(o,"raw",{value:c}):o.raw=c,o},D=function(o){if(o&&o.__esModule)return o;var c={};if(o!=null)for(var f in o)Object.hasOwnProperty.call(o,f)&&(c[f]=o[f]);return c.default=o,c},m=function(o){return o&&o.__esModule?o:{default:o}},w=function(o,c){if(!c.has(o))throw new TypeError("attempted to get private field on non-instance");return c.get(o)},v=function(o,c,f){if(!c.has(o))throw new TypeError("attempted to set private field on non-instance");return c.set(o,f),f},h("__extends",e),h("__assign",r),h("__rest",i),h("__decorate",n),h("__param",l),h("__metadata",y),h("__awaiter",g),h("__generator",p),h("__exportStar",I),h("__createBinding",s),h("__values",O),h("__read",A),h("__spread",z),h("__spreadArrays",C),h("__await",P),h("__asyncGenerator",q),h("__asyncDelegator",$),h("__asyncValues",G),h("__makeTemplateObject",b),h("__importStar",D),h("__importDefault",m),h("__classPrivateFieldGet",w),h("__classPrivateFieldSet",v)})})(vc);var gi={},yr={},In;function Ec(){if(In)return yr;In=1,Object.defineProperty(yr,"__esModule",{value:!0}),yr.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return yr.delay=t,yr}var Gt={},pi={},Wt={},Tn;function Dc(){return Tn||(Tn=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.ONE_THOUSAND=Wt.ONE_HUNDRED=void 0,Wt.ONE_HUNDRED=100,Wt.ONE_THOUSAND=1e3),Wt}var yi={},Pn;function Sc(){return Pn||(Pn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(yi)),yi}var An;function to(){return An||(An=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ar;e.__exportStar(Dc(),t),e.__exportStar(Sc(),t)}(pi)),pi}var Nn;function Oc(){if(Nn)return Gt;Nn=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.fromMiliseconds=Gt.toMiliseconds=void 0;const t=to();function e(i){return i*t.ONE_THOUSAND}Gt.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return Gt.fromMiliseconds=r,Gt}var Cn;function xc(){return Cn||(Cn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ar;e.__exportStar(Ec(),t),e.__exportStar(Oc(),t)}(gi)),gi}var nr={},Rn;function Ic(){if(Rn)return nr;Rn=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const n=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:n})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return nr.Watch=t,nr.default=t,nr}var _i={},_r={},Fn;function Tc(){if(Fn)return _r;Fn=1,Object.defineProperty(_r,"__esModule",{value:!0}),_r.IWatch=void 0;class t{}return _r.IWatch=t,_r}var Un;function Pc(){return Un||(Un=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),ar.__exportStar(Tc(),t)}(_i)),_i}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ar;e.__exportStar(xc(),t),e.__exportStar(Ic(),t),e.__exportStar(Pc(),t),e.__exportStar(to(),t)})(ee);var bi={},br={};let Xt=class{};const Ac=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Xt},Symbol.toStringTag,{value:"Module"})),Nc=Ja(Ac);var jn;function Cc(){if(jn)return br;jn=1,Object.defineProperty(br,"__esModule",{value:!0}),br.IHeartBeat=void 0;const t=Nc;class e extends t.IEvents{constructor(i){super()}}return br.IHeartBeat=e,br}var Ln;function ro(){return Ln||(Ln=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),or.__exportStar(Cc(),t)}(bi)),bi}var mi={},kt={},Mn;function Rc(){if(Mn)return kt;Mn=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.HEARTBEAT_EVENTS=kt.HEARTBEAT_INTERVAL=void 0;const t=ee;return kt.HEARTBEAT_INTERVAL=t.FIVE_SECONDS,kt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},kt}var $n;function io(){return $n||($n=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),or.__exportStar(Rc(),t)}(mi)),mi}var zn;function Fc(){if(zn)return pr;zn=1,Object.defineProperty(pr,"__esModule",{value:!0}),pr.HeartBeat=void 0;const t=or,e=ct,r=ee,i=ro(),n=io();class l extends i.IHeartBeat{constructor(g){super(g),this.events=new e.EventEmitter,this.interval=n.HEARTBEAT_INTERVAL,this.interval=(g==null?void 0:g.interval)||n.HEARTBEAT_INTERVAL}static init(g){return t.__awaiter(this,void 0,void 0,function*(){const p=new l(g);return yield p.init(),p})}init(){return t.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}on(g,p){this.events.on(g,p)}once(g,p){this.events.once(g,p)}off(g,p){this.events.off(g,p)}removeListener(g,p){this.events.removeListener(g,p)}initialize(){return t.__awaiter(this,void 0,void 0,function*(){setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(n.HEARTBEAT_EVENTS.pulse)}}return pr.HeartBeat=l,pr}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=or;e.__exportStar(Fc(),t),e.__exportStar(ro(),t),e.__exportStar(io(),t)})(Ar);var De={},Ii={},Uc={get exports(){return Ii},set exports(t){Ii=t}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(t){var e,r,i,n,l,y,g,p,I,O,A,z,C,P,q,$,G,b,D,m,w,v,s;(function(h){var H=typeof Pe=="object"?Pe:typeof self=="object"?self:typeof this=="object"?this:{};h(o(H,o(t.exports)));function o(c,f){return c!==H&&(typeof Object.create=="function"?Object.defineProperty(c,"__esModule",{value:!0}):c.__esModule=!0),function(_,d){return c[_]=f?f(_,d):d}}})(function(h){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,c){o.__proto__=c}||function(o,c){for(var f in c)c.hasOwnProperty(f)&&(o[f]=c[f])};e=function(o,c){H(o,c);function f(){this.constructor=o}o.prototype=c===null?Object.create(c):(f.prototype=c.prototype,new f)},r=Object.assign||function(o){for(var c,f=1,_=arguments.length;f<_;f++){c=arguments[f];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(o[d]=c[d])}return o},i=function(o,c){var f={};for(var _ in o)Object.prototype.hasOwnProperty.call(o,_)&&c.indexOf(_)<0&&(f[_]=o[_]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,_=Object.getOwnPropertySymbols(o);d<_.length;d++)c.indexOf(_[d])<0&&Object.prototype.propertyIsEnumerable.call(o,_[d])&&(f[_[d]]=o[_[d]]);return f},n=function(o,c,f,_){var d=arguments.length,u=d<3?c:_===null?_=Object.getOwnPropertyDescriptor(c,f):_,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,c,f,_);else for(var N=o.length-1;N>=0;N--)(x=o[N])&&(u=(d<3?x(u):d>3?x(c,f,u):x(c,f))||u);return d>3&&u&&Object.defineProperty(c,f,u),u},l=function(o,c){return function(f,_){c(f,_,o)}},y=function(o,c){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,c)},g=function(o,c,f,_){function d(u){return u instanceof f?u:new f(function(x){x(u)})}return new(f||(f=Promise))(function(u,x){function N(U){try{E(_.next(U))}catch(B){x(B)}}function M(U){try{E(_.throw(U))}catch(B){x(B)}}function E(U){U.done?u(U.value):d(U.value).then(N,M)}E((_=_.apply(o,c||[])).next())})},p=function(o,c){var f={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},_,d,u,x;return x={next:N(0),throw:N(1),return:N(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function N(E){return function(U){return M([E,U])}}function M(E){if(_)throw new TypeError("Generator is already executing.");for(;f;)try{if(_=1,d&&(u=E[0]&2?d.return:E[0]?d.throw||((u=d.return)&&u.call(d),0):d.next)&&!(u=u.call(d,E[1])).done)return u;switch(d=0,u&&(E=[E[0]&2,u.value]),E[0]){case 0:case 1:u=E;break;case 4:return f.label++,{value:E[1],done:!1};case 5:f.label++,d=E[1],E=[0];continue;case 7:E=f.ops.pop(),f.trys.pop();continue;default:if(u=f.trys,!(u=u.length>0&&u[u.length-1])&&(E[0]===6||E[0]===2)){f=0;continue}if(E[0]===3&&(!u||E[1]>u[0]&&E[1]<u[3])){f.label=E[1];break}if(E[0]===6&&f.label<u[1]){f.label=u[1],u=E;break}if(u&&f.label<u[2]){f.label=u[2],f.ops.push(E);break}u[2]&&f.ops.pop(),f.trys.pop();continue}E=c.call(o,f)}catch(U){E=[6,U],d=0}finally{_=u=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}},s=function(o,c,f,_){_===void 0&&(_=f),o[_]=c[f]},I=function(o,c){for(var f in o)f!=="default"&&!c.hasOwnProperty(f)&&(c[f]=o[f])},O=function(o){var c=typeof Symbol=="function"&&Symbol.iterator,f=c&&o[c],_=0;if(f)return f.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&_>=o.length&&(o=void 0),{value:o&&o[_++],done:!o}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")},A=function(o,c){var f=typeof Symbol=="function"&&o[Symbol.iterator];if(!f)return o;var _=f.call(o),d,u=[],x;try{for(;(c===void 0||c-- >0)&&!(d=_.next()).done;)u.push(d.value)}catch(N){x={error:N}}finally{try{d&&!d.done&&(f=_.return)&&f.call(_)}finally{if(x)throw x.error}}return u},z=function(){for(var o=[],c=0;c<arguments.length;c++)o=o.concat(A(arguments[c]));return o},C=function(){for(var o=0,c=0,f=arguments.length;c<f;c++)o+=arguments[c].length;for(var _=Array(o),d=0,c=0;c<f;c++)for(var u=arguments[c],x=0,N=u.length;x<N;x++,d++)_[d]=u[x];return _},P=function(o){return this instanceof P?(this.v=o,this):new P(o)},q=function(o,c,f){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var _=f.apply(o,c||[]),d,u=[];return d={},x("next"),x("throw"),x("return"),d[Symbol.asyncIterator]=function(){return this},d;function x(K){_[K]&&(d[K]=function(V){return new Promise(function(Q,Y){u.push([K,V,Q,Y])>1||N(K,V)})})}function N(K,V){try{M(_[K](V))}catch(Q){B(u[0][3],Q)}}function M(K){K.value instanceof P?Promise.resolve(K.value.v).then(E,U):B(u[0][2],K)}function E(K){N("next",K)}function U(K){N("throw",K)}function B(K,V){K(V),u.shift(),u.length&&N(u[0][0],u[0][1])}},$=function(o){var c,f;return c={},_("next"),_("throw",function(d){throw d}),_("return"),c[Symbol.iterator]=function(){return this},c;function _(d,u){c[d]=o[d]?function(x){return(f=!f)?{value:P(o[d](x)),done:d==="return"}:u?u(x):x}:u}},G=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=o[Symbol.asyncIterator],f;return c?c.call(o):(o=typeof O=="function"?O(o):o[Symbol.iterator](),f={},_("next"),_("throw"),_("return"),f[Symbol.asyncIterator]=function(){return this},f);function _(u){f[u]=o[u]&&function(x){return new Promise(function(N,M){x=o[u](x),d(N,M,x.done,x.value)})}}function d(u,x,N,M){Promise.resolve(M).then(function(E){u({value:E,done:N})},x)}},b=function(o,c){return Object.defineProperty?Object.defineProperty(o,"raw",{value:c}):o.raw=c,o},D=function(o){if(o&&o.__esModule)return o;var c={};if(o!=null)for(var f in o)Object.hasOwnProperty.call(o,f)&&(c[f]=o[f]);return c.default=o,c},m=function(o){return o&&o.__esModule?o:{default:o}},w=function(o,c){if(!c.has(o))throw new TypeError("attempted to get private field on non-instance");return c.get(o)},v=function(o,c,f){if(!c.has(o))throw new TypeError("attempted to set private field on non-instance");return c.set(o,f),f},h("__extends",e),h("__assign",r),h("__rest",i),h("__decorate",n),h("__param",l),h("__metadata",y),h("__awaiter",g),h("__generator",p),h("__exportStar",I),h("__createBinding",s),h("__values",O),h("__read",A),h("__spread",z),h("__spreadArrays",C),h("__await",P),h("__asyncGenerator",q),h("__asyncDelegator",$),h("__asyncValues",G),h("__makeTemplateObject",b),h("__importStar",D),h("__importDefault",m),h("__classPrivateFieldGet",w),h("__classPrivateFieldSet",v)})})(Uc);var Yt={},Hn;function no(){return Hn||(Hn=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.PINO_CUSTOM_CONTEXT_KEY=Yt.PINO_LOGGER_DEFAULTS=void 0,Yt.PINO_LOGGER_DEFAULTS={level:"info"},Yt.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Yt}var it={},qn;function jc(){if(qn)return it;qn=1,Object.defineProperty(it,"__esModule",{value:!0}),it.generateChildLogger=it.formatChildLoggerContext=it.getLoggerContext=it.setBrowserLoggerContext=it.getBrowserLoggerContext=it.getDefaultLoggerOptions=void 0;const t=no();function e(g){return Object.assign(Object.assign({},g),{level:(g==null?void 0:g.level)||t.PINO_LOGGER_DEFAULTS.level})}it.getDefaultLoggerOptions=e;function r(g,p=t.PINO_CUSTOM_CONTEXT_KEY){return g[p]||""}it.getBrowserLoggerContext=r;function i(g,p,I=t.PINO_CUSTOM_CONTEXT_KEY){return g[I]=p,g}it.setBrowserLoggerContext=i;function n(g,p=t.PINO_CUSTOM_CONTEXT_KEY){let I="";return typeof g.bindings>"u"?I=r(g,p):I=g.bindings().context||"",I}it.getLoggerContext=n;function l(g,p,I=t.PINO_CUSTOM_CONTEXT_KEY){const O=n(g,I);return O.trim()?`${O}/${p}`:p}it.formatChildLoggerContext=l;function y(g,p,I=t.PINO_CUSTOM_CONTEXT_KEY){const O=l(g,p,I),A=g.child({context:O});return i(A,O,I)}return it.generateChildLogger=y,it}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.pino=void 0;const e=Ii,r=e.__importDefault(Tr);Object.defineProperty(t,"pino",{enumerable:!0,get:function(){return r.default}}),e.__exportStar(no(),t),e.__exportStar(jc(),t)})(De);class Lc extends Xt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}let Mc=class extends Xt{constructor(e,r){super(),this.core=e,this.logger=r,this.records=new Map}},$c=class{constructor(e,r){this.logger=e,this.core=r}},zc=class extends Xt{constructor(e,r){super(),this.relayer=e,this.logger=r}};class Hc extends Xt{constructor(e){super()}}let qc=class{constructor(e,r,i,n){this.core=e,this.logger=r,this.name=i}};class Kc extends Xt{constructor(e,r){super(),this.relayer=e,this.logger=r}}let Bc=class extends Xt{constructor(e,r){super(),this.core=e,this.logger=r}},Vc=class{constructor(e){this.opts=e,this.protocol="wc",this.version=2}},Gc=class{constructor(e){this.client=e}};function Mi(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return JSON.parse(t)}catch{return t}}function Or(t){return typeof t=="string"?t:JSON.stringify(t)}var $i={},so={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Qr,r=Rt;t.DIGEST_LENGTH=64,t.BLOCK_SIZE=128;var i=function(){function g(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return g.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},g.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},g.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},g.prototype.update=function(p,I){if(I===void 0&&(I=p.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var O=0;if(this._bytesHashed+=I,this._bufferLength>0){for(;this._bufferLength<t.BLOCK_SIZE&&I>0;)this._buffer[this._bufferLength++]=p[O++],I--;this._bufferLength===this.blockSize&&(l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(I>=this.blockSize&&(O=l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,p,O,I),I%=this.blockSize);I>0;)this._buffer[this._bufferLength++]=p[O++],I--;return this},g.prototype.finish=function(p){if(!this._finished){var I=this._bytesHashed,O=this._bufferLength,A=I/536870912|0,z=I<<3,C=I%128<112?128:256;this._buffer[O]=128;for(var P=O+1;P<C-8;P++)this._buffer[P]=0;e.writeUint32BE(A,this._buffer,C-8),e.writeUint32BE(z,this._buffer,C-4),l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,C),this._finished=!0}for(var P=0;P<this.digestLength/8;P++)e.writeUint32BE(this._stateHi[P],p,P*8),e.writeUint32BE(this._stateLo[P],p,P*8+4);return this},g.prototype.digest=function(){var p=new Uint8Array(this.digestLength);return this.finish(p),p},g.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},g.prototype.restoreState=function(p){return this._stateHi.set(p.stateHi),this._stateLo.set(p.stateLo),this._bufferLength=p.bufferLength,p.buffer&&this._buffer.set(p.buffer),this._bytesHashed=p.bytesHashed,this._finished=!1,this},g.prototype.cleanSavedState=function(p){r.wipe(p.stateHi),r.wipe(p.stateLo),p.buffer&&r.wipe(p.buffer),p.bufferLength=0,p.bytesHashed=0},g}();t.SHA512=i;var n=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function l(g,p,I,O,A,z,C){for(var P=I[0],q=I[1],$=I[2],G=I[3],b=I[4],D=I[5],m=I[6],w=I[7],v=O[0],s=O[1],h=O[2],H=O[3],o=O[4],c=O[5],f=O[6],_=O[7],d,u,x,N,M,E,U,B;C>=128;){for(var K=0;K<16;K++){var V=8*K+z;g[K]=e.readUint32BE(A,V),p[K]=e.readUint32BE(A,V+4)}for(var K=0;K<80;K++){var Q=P,Y=q,oe=$,L=G,j=b,R=D,a=m,T=w,k=v,X=s,fe=h,ye=H,le=o,me=c,Fe=f,Ae=_;if(d=w,u=_,M=u&65535,E=u>>>16,U=d&65535,B=d>>>16,d=(b>>>14|o<<32-14)^(b>>>18|o<<32-18)^(o>>>41-32|b<<32-(41-32)),u=(o>>>14|b<<32-14)^(o>>>18|b<<32-18)^(b>>>41-32|o<<32-(41-32)),M+=u&65535,E+=u>>>16,U+=d&65535,B+=d>>>16,d=b&D^~b&m,u=o&c^~o&f,M+=u&65535,E+=u>>>16,U+=d&65535,B+=d>>>16,d=n[K*2],u=n[K*2+1],M+=u&65535,E+=u>>>16,U+=d&65535,B+=d>>>16,d=g[K%16],u=p[K%16],M+=u&65535,E+=u>>>16,U+=d&65535,B+=d>>>16,E+=M>>>16,U+=E>>>16,B+=U>>>16,x=U&65535|B<<16,N=M&65535|E<<16,d=x,u=N,M=u&65535,E=u>>>16,U=d&65535,B=d>>>16,d=(P>>>28|v<<32-28)^(v>>>34-32|P<<32-(34-32))^(v>>>39-32|P<<32-(39-32)),u=(v>>>28|P<<32-28)^(P>>>34-32|v<<32-(34-32))^(P>>>39-32|v<<32-(39-32)),M+=u&65535,E+=u>>>16,U+=d&65535,B+=d>>>16,d=P&q^P&$^q&$,u=v&s^v&h^s&h,M+=u&65535,E+=u>>>16,U+=d&65535,B+=d>>>16,E+=M>>>16,U+=E>>>16,B+=U>>>16,T=U&65535|B<<16,Ae=M&65535|E<<16,d=L,u=ye,M=u&65535,E=u>>>16,U=d&65535,B=d>>>16,d=x,u=N,M+=u&65535,E+=u>>>16,U+=d&65535,B+=d>>>16,E+=M>>>16,U+=E>>>16,B+=U>>>16,L=U&65535|B<<16,ye=M&65535|E<<16,q=Q,$=Y,G=oe,b=L,D=j,m=R,w=a,P=T,s=k,h=X,H=fe,o=ye,c=le,f=me,_=Fe,v=Ae,K%16===15)for(var V=0;V<16;V++)d=g[V],u=p[V],M=u&65535,E=u>>>16,U=d&65535,B=d>>>16,d=g[(V+9)%16],u=p[(V+9)%16],M+=u&65535,E+=u>>>16,U+=d&65535,B+=d>>>16,x=g[(V+1)%16],N=p[(V+1)%16],d=(x>>>1|N<<32-1)^(x>>>8|N<<32-8)^x>>>7,u=(N>>>1|x<<32-1)^(N>>>8|x<<32-8)^(N>>>7|x<<32-7),M+=u&65535,E+=u>>>16,U+=d&65535,B+=d>>>16,x=g[(V+14)%16],N=p[(V+14)%16],d=(x>>>19|N<<32-19)^(N>>>61-32|x<<32-(61-32))^x>>>6,u=(N>>>19|x<<32-19)^(x>>>61-32|N<<32-(61-32))^(N>>>6|x<<32-6),M+=u&65535,E+=u>>>16,U+=d&65535,B+=d>>>16,E+=M>>>16,U+=E>>>16,B+=U>>>16,g[V]=U&65535|B<<16,p[V]=M&65535|E<<16}d=P,u=v,M=u&65535,E=u>>>16,U=d&65535,B=d>>>16,d=I[0],u=O[0],M+=u&65535,E+=u>>>16,U+=d&65535,B+=d>>>16,E+=M>>>16,U+=E>>>16,B+=U>>>16,I[0]=P=U&65535|B<<16,O[0]=v=M&65535|E<<16,d=q,u=s,M=u&65535,E=u>>>16,U=d&65535,B=d>>>16,d=I[1],u=O[1],M+=u&65535,E+=u>>>16,U+=d&65535,B+=d>>>16,E+=M>>>16,U+=E>>>16,B+=U>>>16,I[1]=q=U&65535|B<<16,O[1]=s=M&65535|E<<16,d=$,u=h,M=u&65535,E=u>>>16,U=d&65535,B=d>>>16,d=I[2],u=O[2],M+=u&65535,E+=u>>>16,U+=d&65535,B+=d>>>16,E+=M>>>16,U+=E>>>16,B+=U>>>16,I[2]=$=U&65535|B<<16,O[2]=h=M&65535|E<<16,d=G,u=H,M=u&65535,E=u>>>16,U=d&65535,B=d>>>16,d=I[3],u=O[3],M+=u&65535,E+=u>>>16,U+=d&65535,B+=d>>>16,E+=M>>>16,U+=E>>>16,B+=U>>>16,I[3]=G=U&65535|B<<16,O[3]=H=M&65535|E<<16,d=b,u=o,M=u&65535,E=u>>>16,U=d&65535,B=d>>>16,d=I[4],u=O[4],M+=u&65535,E+=u>>>16,U+=d&65535,B+=d>>>16,E+=M>>>16,U+=E>>>16,B+=U>>>16,I[4]=b=U&65535|B<<16,O[4]=o=M&65535|E<<16,d=D,u=c,M=u&65535,E=u>>>16,U=d&65535,B=d>>>16,d=I[5],u=O[5],M+=u&65535,E+=u>>>16,U+=d&65535,B+=d>>>16,E+=M>>>16,U+=E>>>16,B+=U>>>16,I[5]=D=U&65535|B<<16,O[5]=c=M&65535|E<<16,d=m,u=f,M=u&65535,E=u>>>16,U=d&65535,B=d>>>16,d=I[6],u=O[6],M+=u&65535,E+=u>>>16,U+=d&65535,B+=d>>>16,E+=M>>>16,U+=E>>>16,B+=U>>>16,I[6]=m=U&65535|B<<16,O[6]=f=M&65535|E<<16,d=w,u=_,M=u&65535,E=u>>>16,U=d&65535,B=d>>>16,d=I[7],u=O[7],M+=u&65535,E+=u>>>16,U+=d&65535,B+=d>>>16,E+=M>>>16,U+=E>>>16,B+=U>>>16,I[7]=w=U&65535|B<<16,O[7]=_=M&65535|E<<16,z+=128,C-=128}return z}function y(g){var p=new i;p.update(g);var I=p.digest();return p.clean(),I}t.hash=y})(so);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.convertSecretKeyToX25519=t.convertPublicKeyToX25519=t.verify=t.sign=t.extractPublicKeyFromSecretKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.SEED_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=t.SIGNATURE_LENGTH=void 0;const e=Ir,r=so,i=Rt;t.SIGNATURE_LENGTH=64,t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=64,t.SEED_LENGTH=32;function n(L){const j=new Float64Array(16);if(L)for(let R=0;R<L.length;R++)j[R]=L[R];return j}const l=new Uint8Array(32);l[0]=9;const y=n(),g=n([1]),p=n([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),I=n([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),O=n([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),A=n([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),z=n([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function C(L,j){for(let R=0;R<16;R++)L[R]=j[R]|0}function P(L){let j=1;for(let R=0;R<16;R++){let a=L[R]+j+65535;j=Math.floor(a/65536),L[R]=a-j*65536}L[0]+=j-1+37*(j-1)}function q(L,j,R){const a=~(R-1);for(let T=0;T<16;T++){const k=a&(L[T]^j[T]);L[T]^=k,j[T]^=k}}function $(L,j){const R=n(),a=n();for(let T=0;T<16;T++)a[T]=j[T];P(a),P(a),P(a);for(let T=0;T<2;T++){R[0]=a[0]-65517;for(let X=1;X<15;X++)R[X]=a[X]-65535-(R[X-1]>>16&1),R[X-1]&=65535;R[15]=a[15]-32767-(R[14]>>16&1);const k=R[15]>>16&1;R[14]&=65535,q(a,R,1-k)}for(let T=0;T<16;T++)L[2*T]=a[T]&255,L[2*T+1]=a[T]>>8}function G(L,j){let R=0;for(let a=0;a<32;a++)R|=L[a]^j[a];return(1&R-1>>>8)-1}function b(L,j){const R=new Uint8Array(32),a=new Uint8Array(32);return $(R,L),$(a,j),G(R,a)}function D(L){const j=new Uint8Array(32);return $(j,L),j[0]&1}function m(L,j){for(let R=0;R<16;R++)L[R]=j[2*R]+(j[2*R+1]<<8);L[15]&=32767}function w(L,j,R){for(let a=0;a<16;a++)L[a]=j[a]+R[a]}function v(L,j,R){for(let a=0;a<16;a++)L[a]=j[a]-R[a]}function s(L,j,R){let a,T,k=0,X=0,fe=0,ye=0,le=0,me=0,Fe=0,Ae=0,pe=0,de=0,he=0,ce=0,ae=0,se=0,ne=0,te=0,ue=0,ge=0,re=0,_e=0,be=0,ve=0,Ee=0,we=0,pt=0,wt=0,Ft=0,ut=0,qt=0,fr=0,jr=0,je=R[0],Ne=R[1],Le=R[2],Me=R[3],$e=R[4],Ce=R[5],qe=R[6],Ke=R[7],Be=R[8],Ve=R[9],Ge=R[10],He=R[11],ze=R[12],Ie=R[13],We=R[14],ke=R[15];a=j[0],k+=a*je,X+=a*Ne,fe+=a*Le,ye+=a*Me,le+=a*$e,me+=a*Ce,Fe+=a*qe,Ae+=a*Ke,pe+=a*Be,de+=a*Ve,he+=a*Ge,ce+=a*He,ae+=a*ze,se+=a*Ie,ne+=a*We,te+=a*ke,a=j[1],X+=a*je,fe+=a*Ne,ye+=a*Le,le+=a*Me,me+=a*$e,Fe+=a*Ce,Ae+=a*qe,pe+=a*Ke,de+=a*Be,he+=a*Ve,ce+=a*Ge,ae+=a*He,se+=a*ze,ne+=a*Ie,te+=a*We,ue+=a*ke,a=j[2],fe+=a*je,ye+=a*Ne,le+=a*Le,me+=a*Me,Fe+=a*$e,Ae+=a*Ce,pe+=a*qe,de+=a*Ke,he+=a*Be,ce+=a*Ve,ae+=a*Ge,se+=a*He,ne+=a*ze,te+=a*Ie,ue+=a*We,ge+=a*ke,a=j[3],ye+=a*je,le+=a*Ne,me+=a*Le,Fe+=a*Me,Ae+=a*$e,pe+=a*Ce,de+=a*qe,he+=a*Ke,ce+=a*Be,ae+=a*Ve,se+=a*Ge,ne+=a*He,te+=a*ze,ue+=a*Ie,ge+=a*We,re+=a*ke,a=j[4],le+=a*je,me+=a*Ne,Fe+=a*Le,Ae+=a*Me,pe+=a*$e,de+=a*Ce,he+=a*qe,ce+=a*Ke,ae+=a*Be,se+=a*Ve,ne+=a*Ge,te+=a*He,ue+=a*ze,ge+=a*Ie,re+=a*We,_e+=a*ke,a=j[5],me+=a*je,Fe+=a*Ne,Ae+=a*Le,pe+=a*Me,de+=a*$e,he+=a*Ce,ce+=a*qe,ae+=a*Ke,se+=a*Be,ne+=a*Ve,te+=a*Ge,ue+=a*He,ge+=a*ze,re+=a*Ie,_e+=a*We,be+=a*ke,a=j[6],Fe+=a*je,Ae+=a*Ne,pe+=a*Le,de+=a*Me,he+=a*$e,ce+=a*Ce,ae+=a*qe,se+=a*Ke,ne+=a*Be,te+=a*Ve,ue+=a*Ge,ge+=a*He,re+=a*ze,_e+=a*Ie,be+=a*We,ve+=a*ke,a=j[7],Ae+=a*je,pe+=a*Ne,de+=a*Le,he+=a*Me,ce+=a*$e,ae+=a*Ce,se+=a*qe,ne+=a*Ke,te+=a*Be,ue+=a*Ve,ge+=a*Ge,re+=a*He,_e+=a*ze,be+=a*Ie,ve+=a*We,Ee+=a*ke,a=j[8],pe+=a*je,de+=a*Ne,he+=a*Le,ce+=a*Me,ae+=a*$e,se+=a*Ce,ne+=a*qe,te+=a*Ke,ue+=a*Be,ge+=a*Ve,re+=a*Ge,_e+=a*He,be+=a*ze,ve+=a*Ie,Ee+=a*We,we+=a*ke,a=j[9],de+=a*je,he+=a*Ne,ce+=a*Le,ae+=a*Me,se+=a*$e,ne+=a*Ce,te+=a*qe,ue+=a*Ke,ge+=a*Be,re+=a*Ve,_e+=a*Ge,be+=a*He,ve+=a*ze,Ee+=a*Ie,we+=a*We,pt+=a*ke,a=j[10],he+=a*je,ce+=a*Ne,ae+=a*Le,se+=a*Me,ne+=a*$e,te+=a*Ce,ue+=a*qe,ge+=a*Ke,re+=a*Be,_e+=a*Ve,be+=a*Ge,ve+=a*He,Ee+=a*ze,we+=a*Ie,pt+=a*We,wt+=a*ke,a=j[11],ce+=a*je,ae+=a*Ne,se+=a*Le,ne+=a*Me,te+=a*$e,ue+=a*Ce,ge+=a*qe,re+=a*Ke,_e+=a*Be,be+=a*Ve,ve+=a*Ge,Ee+=a*He,we+=a*ze,pt+=a*Ie,wt+=a*We,Ft+=a*ke,a=j[12],ae+=a*je,se+=a*Ne,ne+=a*Le,te+=a*Me,ue+=a*$e,ge+=a*Ce,re+=a*qe,_e+=a*Ke,be+=a*Be,ve+=a*Ve,Ee+=a*Ge,we+=a*He,pt+=a*ze,wt+=a*Ie,Ft+=a*We,ut+=a*ke,a=j[13],se+=a*je,ne+=a*Ne,te+=a*Le,ue+=a*Me,ge+=a*$e,re+=a*Ce,_e+=a*qe,be+=a*Ke,ve+=a*Be,Ee+=a*Ve,we+=a*Ge,pt+=a*He,wt+=a*ze,Ft+=a*Ie,ut+=a*We,qt+=a*ke,a=j[14],ne+=a*je,te+=a*Ne,ue+=a*Le,ge+=a*Me,re+=a*$e,_e+=a*Ce,be+=a*qe,ve+=a*Ke,Ee+=a*Be,we+=a*Ve,pt+=a*Ge,wt+=a*He,Ft+=a*ze,ut+=a*Ie,qt+=a*We,fr+=a*ke,a=j[15],te+=a*je,ue+=a*Ne,ge+=a*Le,re+=a*Me,_e+=a*$e,be+=a*Ce,ve+=a*qe,Ee+=a*Ke,we+=a*Be,pt+=a*Ve,wt+=a*Ge,Ft+=a*He,ut+=a*ze,qt+=a*Ie,fr+=a*We,jr+=a*ke,k+=38*ue,X+=38*ge,fe+=38*re,ye+=38*_e,le+=38*be,me+=38*ve,Fe+=38*Ee,Ae+=38*we,pe+=38*pt,de+=38*wt,he+=38*Ft,ce+=38*ut,ae+=38*qt,se+=38*fr,ne+=38*jr,T=1,a=k+T+65535,T=Math.floor(a/65536),k=a-T*65536,a=X+T+65535,T=Math.floor(a/65536),X=a-T*65536,a=fe+T+65535,T=Math.floor(a/65536),fe=a-T*65536,a=ye+T+65535,T=Math.floor(a/65536),ye=a-T*65536,a=le+T+65535,T=Math.floor(a/65536),le=a-T*65536,a=me+T+65535,T=Math.floor(a/65536),me=a-T*65536,a=Fe+T+65535,T=Math.floor(a/65536),Fe=a-T*65536,a=Ae+T+65535,T=Math.floor(a/65536),Ae=a-T*65536,a=pe+T+65535,T=Math.floor(a/65536),pe=a-T*65536,a=de+T+65535,T=Math.floor(a/65536),de=a-T*65536,a=he+T+65535,T=Math.floor(a/65536),he=a-T*65536,a=ce+T+65535,T=Math.floor(a/65536),ce=a-T*65536,a=ae+T+65535,T=Math.floor(a/65536),ae=a-T*65536,a=se+T+65535,T=Math.floor(a/65536),se=a-T*65536,a=ne+T+65535,T=Math.floor(a/65536),ne=a-T*65536,a=te+T+65535,T=Math.floor(a/65536),te=a-T*65536,k+=T-1+37*(T-1),T=1,a=k+T+65535,T=Math.floor(a/65536),k=a-T*65536,a=X+T+65535,T=Math.floor(a/65536),X=a-T*65536,a=fe+T+65535,T=Math.floor(a/65536),fe=a-T*65536,a=ye+T+65535,T=Math.floor(a/65536),ye=a-T*65536,a=le+T+65535,T=Math.floor(a/65536),le=a-T*65536,a=me+T+65535,T=Math.floor(a/65536),me=a-T*65536,a=Fe+T+65535,T=Math.floor(a/65536),Fe=a-T*65536,a=Ae+T+65535,T=Math.floor(a/65536),Ae=a-T*65536,a=pe+T+65535,T=Math.floor(a/65536),pe=a-T*65536,a=de+T+65535,T=Math.floor(a/65536),de=a-T*65536,a=he+T+65535,T=Math.floor(a/65536),he=a-T*65536,a=ce+T+65535,T=Math.floor(a/65536),ce=a-T*65536,a=ae+T+65535,T=Math.floor(a/65536),ae=a-T*65536,a=se+T+65535,T=Math.floor(a/65536),se=a-T*65536,a=ne+T+65535,T=Math.floor(a/65536),ne=a-T*65536,a=te+T+65535,T=Math.floor(a/65536),te=a-T*65536,k+=T-1+37*(T-1),L[0]=k,L[1]=X,L[2]=fe,L[3]=ye,L[4]=le,L[5]=me,L[6]=Fe,L[7]=Ae,L[8]=pe,L[9]=de,L[10]=he,L[11]=ce,L[12]=ae,L[13]=se,L[14]=ne,L[15]=te}function h(L,j){s(L,j,j)}function H(L,j){const R=n();let a;for(a=0;a<16;a++)R[a]=j[a];for(a=253;a>=0;a--)h(R,R),a!==2&&a!==4&&s(R,R,j);for(a=0;a<16;a++)L[a]=R[a]}function o(L,j){const R=n();let a;for(a=0;a<16;a++)R[a]=j[a];for(a=250;a>=0;a--)h(R,R),a!==1&&s(R,R,j);for(a=0;a<16;a++)L[a]=R[a]}function c(L,j){const R=n(),a=n(),T=n(),k=n(),X=n(),fe=n(),ye=n(),le=n(),me=n();v(R,L[1],L[0]),v(me,j[1],j[0]),s(R,R,me),w(a,L[0],L[1]),w(me,j[0],j[1]),s(a,a,me),s(T,L[3],j[3]),s(T,T,I),s(k,L[2],j[2]),w(k,k,k),v(X,a,R),v(fe,k,T),w(ye,k,T),w(le,a,R),s(L[0],X,fe),s(L[1],le,ye),s(L[2],ye,fe),s(L[3],X,le)}function f(L,j,R){for(let a=0;a<4;a++)q(L[a],j[a],R)}function _(L,j){const R=n(),a=n(),T=n();H(T,j[2]),s(R,j[0],T),s(a,j[1],T),$(L,a),L[31]^=D(R)<<7}function d(L,j,R){C(L[0],y),C(L[1],g),C(L[2],g),C(L[3],y);for(let a=255;a>=0;--a){const T=R[a/8|0]>>(a&7)&1;f(L,j,T),c(j,L),c(L,L),f(L,j,T)}}function u(L,j){const R=[n(),n(),n(),n()];C(R[0],O),C(R[1],A),C(R[2],g),s(R[3],O,A),d(L,R,j)}function x(L){if(L.length!==t.SEED_LENGTH)throw new Error(`ed25519: seed must be ${t.SEED_LENGTH} bytes`);const j=(0,r.hash)(L);j[0]&=248,j[31]&=127,j[31]|=64;const R=new Uint8Array(32),a=[n(),n(),n(),n()];u(a,j),_(R,a);const T=new Uint8Array(64);return T.set(L),T.set(R,32),{publicKey:R,secretKey:T}}t.generateKeyPairFromSeed=x;function N(L){const j=(0,e.randomBytes)(32,L),R=x(j);return(0,i.wipe)(j),R}t.generateKeyPair=N;function M(L){if(L.length!==t.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${t.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(L.subarray(32))}t.extractPublicKeyFromSecretKey=M;const E=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function U(L,j){let R,a,T,k;for(a=63;a>=32;--a){for(R=0,T=a-32,k=a-12;T<k;++T)j[T]+=R-16*j[a]*E[T-(a-32)],R=Math.floor((j[T]+128)/256),j[T]-=R*256;j[T]+=R,j[a]=0}for(R=0,T=0;T<32;T++)j[T]+=R-(j[31]>>4)*E[T],R=j[T]>>8,j[T]&=255;for(T=0;T<32;T++)j[T]-=R*E[T];for(a=0;a<32;a++)j[a+1]+=j[a]>>8,L[a]=j[a]&255}function B(L){const j=new Float64Array(64);for(let R=0;R<64;R++)j[R]=L[R];for(let R=0;R<64;R++)L[R]=0;U(L,j)}function K(L,j){const R=new Float64Array(64),a=[n(),n(),n(),n()],T=(0,r.hash)(L.subarray(0,32));T[0]&=248,T[31]&=127,T[31]|=64;const k=new Uint8Array(64);k.set(T.subarray(32),32);const X=new r.SHA512;X.update(k.subarray(32)),X.update(j);const fe=X.digest();X.clean(),B(fe),u(a,fe),_(k,a),X.reset(),X.update(k.subarray(0,32)),X.update(L.subarray(32)),X.update(j);const ye=X.digest();B(ye);for(let le=0;le<32;le++)R[le]=fe[le];for(let le=0;le<32;le++)for(let me=0;me<32;me++)R[le+me]+=ye[le]*T[me];return U(k.subarray(32),R),k}t.sign=K;function V(L,j){const R=n(),a=n(),T=n(),k=n(),X=n(),fe=n(),ye=n();return C(L[2],g),m(L[1],j),h(T,L[1]),s(k,T,p),v(T,T,L[2]),w(k,L[2],k),h(X,k),h(fe,X),s(ye,fe,X),s(R,ye,T),s(R,R,k),o(R,R),s(R,R,T),s(R,R,k),s(R,R,k),s(L[0],R,k),h(a,L[0]),s(a,a,k),b(a,T)&&s(L[0],L[0],z),h(a,L[0]),s(a,a,k),b(a,T)?-1:(D(L[0])===j[31]>>7&&v(L[0],y,L[0]),s(L[3],L[0],L[1]),0)}function Q(L,j,R){const a=new Uint8Array(32),T=[n(),n(),n(),n()],k=[n(),n(),n(),n()];if(R.length!==t.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${t.SIGNATURE_LENGTH} bytes`);if(V(k,L))return!1;const X=new r.SHA512;X.update(R.subarray(0,32)),X.update(L),X.update(j);const fe=X.digest();return B(fe),d(T,k,fe),u(k,R.subarray(32)),c(T,k),_(a,T),!G(R,a)}t.verify=Q;function Y(L){let j=[n(),n(),n(),n()];if(V(j,L))throw new Error("Ed25519: invalid public key");let R=n(),a=n(),T=j[1];w(R,g,T),v(a,g,T),H(a,a),s(R,R,a);let k=new Uint8Array(32);return $(k,R),k}t.convertPublicKeyToX25519=Y;function oe(L){const j=(0,r.hash)(L.subarray(0,32));j[0]&=248,j[31]&=127,j[31]|=64;const R=new Uint8Array(j.subarray(0,32));return(0,i.wipe)(j),R}t.convertSecretKeyToX25519=oe})($i);const Wc="EdDSA",kc="JWT",oo=".",ao="base64url",Yc="utf8",Jc="utf8",Xc=":",Zc="did",Qc="key",Kn="base58btc",eu="z",tu="K36",ru=32;function zi(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function co(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?zi(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function iu(t,e){e||(e=t.reduce((n,l)=>n+l.length,0));const r=co(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return zi(r)}function nu(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var l=t.charAt(n),y=l.charCodeAt(0);if(r[y]!==255)throw new TypeError(l+" is ambiguous");r[y]=n}var g=t.length,p=t.charAt(0),I=Math.log(g)/Math.log(256),O=Math.log(256)/Math.log(g);function A(P){if(P instanceof Uint8Array||(ArrayBuffer.isView(P)?P=new Uint8Array(P.buffer,P.byteOffset,P.byteLength):Array.isArray(P)&&(P=Uint8Array.from(P))),!(P instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(P.length===0)return"";for(var q=0,$=0,G=0,b=P.length;G!==b&&P[G]===0;)G++,q++;for(var D=(b-G)*O+1>>>0,m=new Uint8Array(D);G!==b;){for(var w=P[G],v=0,s=D-1;(w!==0||v<$)&&s!==-1;s--,v++)w+=256*m[s]>>>0,m[s]=w%g>>>0,w=w/g>>>0;if(w!==0)throw new Error("Non-zero carry");$=v,G++}for(var h=D-$;h!==D&&m[h]===0;)h++;for(var H=p.repeat(q);h<D;++h)H+=t.charAt(m[h]);return H}function z(P){if(typeof P!="string")throw new TypeError("Expected String");if(P.length===0)return new Uint8Array;var q=0;if(P[q]!==" "){for(var $=0,G=0;P[q]===p;)$++,q++;for(var b=(P.length-q)*I+1>>>0,D=new Uint8Array(b);P[q];){var m=r[P.charCodeAt(q)];if(m===255)return;for(var w=0,v=b-1;(m!==0||w<G)&&v!==-1;v--,w++)m+=g*D[v]>>>0,D[v]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");G=w,q++}if(P[q]!==" "){for(var s=b-G;s!==b&&D[s]===0;)s++;for(var h=new Uint8Array($+(b-s)),H=$;s!==b;)h[H++]=D[s++];return h}}}function C(P){var q=z(P);if(q)return q;throw new Error(`Non-${e} character`)}return{encode:A,decodeUnsafe:z,decode:C}}var su=nu,ou=su;const au=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},cu=t=>new TextEncoder().encode(t),uu=t=>new TextDecoder().decode(t);class fu{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class hu{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return uo(this,e)}}class lu{constructor(e){this.decoders=e}or(e){return uo(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const uo=(t,e)=>new lu({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class du{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new fu(e,r,i),this.decoder=new hu(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ri=({name:t,prefix:e,encode:r,decode:i})=>new du(t,e,r,i),Nr=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=ou(r,e);return ri({prefix:t,name:e,encode:i,decode:l=>au(n(l))})},gu=(t,e,r,i)=>{const n={};for(let O=0;O<e.length;++O)n[e[O]]=O;let l=t.length;for(;t[l-1]==="=";)--l;const y=new Uint8Array(l*r/8|0);let g=0,p=0,I=0;for(let O=0;O<l;++O){const A=n[t[O]];if(A===void 0)throw new SyntaxError(`Non-${i} character`);p=p<<r|A,g+=r,g>=8&&(g-=8,y[I++]=255&p>>g)}if(g>=r||255&p<<8-g)throw new SyntaxError("Unexpected end of data");return y},pu=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let l="",y=0,g=0;for(let p=0;p<t.length;++p)for(g=g<<8|t[p],y+=8;y>r;)y-=r,l+=e[n&g>>y];if(y&&(l+=e[n&g<<r-y]),i)for(;l.length*r&7;)l+="=";return l},Qe=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>ri({prefix:e,name:t,encode(n){return pu(n,i,r)},decode(n){return gu(n,i,r,t)}}),yu=ri({prefix:"\0",name:"identity",encode:t=>uu(t),decode:t=>cu(t)}),_u=Object.freeze(Object.defineProperty({__proto__:null,identity:yu},Symbol.toStringTag,{value:"Module"})),bu=Qe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),mu=Object.freeze(Object.defineProperty({__proto__:null,base2:bu},Symbol.toStringTag,{value:"Module"})),wu=Qe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),vu=Object.freeze(Object.defineProperty({__proto__:null,base8:wu},Symbol.toStringTag,{value:"Module"})),Eu=Nr({prefix:"9",name:"base10",alphabet:"0123456789"}),Du=Object.freeze(Object.defineProperty({__proto__:null,base10:Eu},Symbol.toStringTag,{value:"Module"})),Su=Qe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Ou=Qe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),xu=Object.freeze(Object.defineProperty({__proto__:null,base16:Su,base16upper:Ou},Symbol.toStringTag,{value:"Module"})),Iu=Qe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Tu=Qe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Pu=Qe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Au=Qe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Nu=Qe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Cu=Qe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Ru=Qe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Fu=Qe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Uu=Qe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),ju=Object.freeze(Object.defineProperty({__proto__:null,base32:Iu,base32hex:Nu,base32hexpad:Ru,base32hexpadupper:Fu,base32hexupper:Cu,base32pad:Pu,base32padupper:Au,base32upper:Tu,base32z:Uu},Symbol.toStringTag,{value:"Module"})),Lu=Nr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Mu=Nr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),$u=Object.freeze(Object.defineProperty({__proto__:null,base36:Lu,base36upper:Mu},Symbol.toStringTag,{value:"Module"})),zu=Nr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Hu=Nr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),qu=Object.freeze(Object.defineProperty({__proto__:null,base58btc:zu,base58flickr:Hu},Symbol.toStringTag,{value:"Module"})),Ku=Qe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Bu=Qe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Vu=Qe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Gu=Qe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Wu=Object.freeze(Object.defineProperty({__proto__:null,base64:Ku,base64pad:Bu,base64url:Vu,base64urlpad:Gu},Symbol.toStringTag,{value:"Module"})),fo=Array.from(""),ku=fo.reduce((t,e,r)=>(t[r]=e,t),[]),Yu=fo.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Ju(t){return t.reduce((e,r)=>(e+=ku[r],e),"")}function Xu(t){const e=[];for(const r of t){const i=Yu[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Zu=ri({prefix:"",name:"base256emoji",encode:Ju,decode:Xu}),Qu=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Zu},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Yr={..._u,...mu,...vu,...Du,...xu,...ju,...$u,...qu,...Wu,...Qu};function ho(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Bn=ho("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),wi=ho("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=co(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),lo={utf8:Bn,"utf-8":Bn,hex:Yr.base16,latin1:wi,ascii:wi,binary:wi,...Yr};function Hi(t,e="utf8"){const r=lo[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function qi(t,e="utf8"){const r=lo[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?zi(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Jr(t){return Hi(qi(Or(t),Yc),ao)}function go(t){const e=qi(tu,Kn),r=eu+Hi(iu([e,t]),Kn);return[Zc,Qc,r].join(Xc)}function ef(t){return Hi(t,ao)}function tf(t){return qi([Jr(t.header),Jr(t.payload)].join(oo),Jc)}function rf(t){return[Jr(t.header),Jr(t.payload),ef(t.signature)].join(oo)}function Vn(t=Ir.randomBytes(ru)){return $i.generateKeyPairFromSeed(t)}async function nf(t,e,r,i,n=ee.fromMiliseconds(Date.now())){const l={alg:Wc,typ:kc},y=go(i.publicKey),g=n+r,p={iss:y,sub:t,aud:e,iat:n,exp:g},I=tf({header:l,payload:p}),O=$i.sign(i.secretKey,I);return rf({header:l,payload:p,signature:O})}var Ki={},ii={};Object.defineProperty(ii,"__esModule",{value:!0});var rt=Qr,Ti=Rt,sf=20;function of(t,e,r){for(var i=1634760805,n=857760878,l=2036477234,y=1797285236,g=r[3]<<24|r[2]<<16|r[1]<<8|r[0],p=r[7]<<24|r[6]<<16|r[5]<<8|r[4],I=r[11]<<24|r[10]<<16|r[9]<<8|r[8],O=r[15]<<24|r[14]<<16|r[13]<<8|r[12],A=r[19]<<24|r[18]<<16|r[17]<<8|r[16],z=r[23]<<24|r[22]<<16|r[21]<<8|r[20],C=r[27]<<24|r[26]<<16|r[25]<<8|r[24],P=r[31]<<24|r[30]<<16|r[29]<<8|r[28],q=e[3]<<24|e[2]<<16|e[1]<<8|e[0],$=e[7]<<24|e[6]<<16|e[5]<<8|e[4],G=e[11]<<24|e[10]<<16|e[9]<<8|e[8],b=e[15]<<24|e[14]<<16|e[13]<<8|e[12],D=i,m=n,w=l,v=y,s=g,h=p,H=I,o=O,c=A,f=z,_=C,d=P,u=q,x=$,N=G,M=b,E=0;E<sf;E+=2)D=D+s|0,u^=D,u=u>>>32-16|u<<16,c=c+u|0,s^=c,s=s>>>32-12|s<<12,m=m+h|0,x^=m,x=x>>>32-16|x<<16,f=f+x|0,h^=f,h=h>>>32-12|h<<12,w=w+H|0,N^=w,N=N>>>32-16|N<<16,_=_+N|0,H^=_,H=H>>>32-12|H<<12,v=v+o|0,M^=v,M=M>>>32-16|M<<16,d=d+M|0,o^=d,o=o>>>32-12|o<<12,w=w+H|0,N^=w,N=N>>>32-8|N<<8,_=_+N|0,H^=_,H=H>>>32-7|H<<7,v=v+o|0,M^=v,M=M>>>32-8|M<<8,d=d+M|0,o^=d,o=o>>>32-7|o<<7,m=m+h|0,x^=m,x=x>>>32-8|x<<8,f=f+x|0,h^=f,h=h>>>32-7|h<<7,D=D+s|0,u^=D,u=u>>>32-8|u<<8,c=c+u|0,s^=c,s=s>>>32-7|s<<7,D=D+h|0,M^=D,M=M>>>32-16|M<<16,_=_+M|0,h^=_,h=h>>>32-12|h<<12,m=m+H|0,u^=m,u=u>>>32-16|u<<16,d=d+u|0,H^=d,H=H>>>32-12|H<<12,w=w+o|0,x^=w,x=x>>>32-16|x<<16,c=c+x|0,o^=c,o=o>>>32-12|o<<12,v=v+s|0,N^=v,N=N>>>32-16|N<<16,f=f+N|0,s^=f,s=s>>>32-12|s<<12,w=w+o|0,x^=w,x=x>>>32-8|x<<8,c=c+x|0,o^=c,o=o>>>32-7|o<<7,v=v+s|0,N^=v,N=N>>>32-8|N<<8,f=f+N|0,s^=f,s=s>>>32-7|s<<7,m=m+H|0,u^=m,u=u>>>32-8|u<<8,d=d+u|0,H^=d,H=H>>>32-7|H<<7,D=D+h|0,M^=D,M=M>>>32-8|M<<8,_=_+M|0,h^=_,h=h>>>32-7|h<<7;rt.writeUint32LE(D+i|0,t,0),rt.writeUint32LE(m+n|0,t,4),rt.writeUint32LE(w+l|0,t,8),rt.writeUint32LE(v+y|0,t,12),rt.writeUint32LE(s+g|0,t,16),rt.writeUint32LE(h+p|0,t,20),rt.writeUint32LE(H+I|0,t,24),rt.writeUint32LE(o+O|0,t,28),rt.writeUint32LE(c+A|0,t,32),rt.writeUint32LE(f+z|0,t,36),rt.writeUint32LE(_+C|0,t,40),rt.writeUint32LE(d+P|0,t,44),rt.writeUint32LE(u+q|0,t,48),rt.writeUint32LE(x+$|0,t,52),rt.writeUint32LE(N+G|0,t,56),rt.writeUint32LE(M+b|0,t,60)}function po(t,e,r,i,n){if(n===void 0&&(n=0),t.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(i.length<r.length)throw new Error("ChaCha: destination is shorter than source");var l,y;if(n===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");l=new Uint8Array(16),y=l.length-e.length,l.set(e,y)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");l=e,y=n}for(var g=new Uint8Array(64),p=0;p<r.length;p+=64){of(g,l,t);for(var I=p;I<p+64&&I<r.length;I++)i[I]=r[I]^g[I-p];cf(l,0,y)}return Ti.wipe(g),n===0&&Ti.wipe(l),i}ii.streamXOR=po;function af(t,e,r,i){return i===void 0&&(i=0),Ti.wipe(r),po(t,e,r,r,i)}ii.stream=af;function cf(t,e,r){for(var i=1;r--;)i=i+(t[e]&255)|0,t[e]=i&255,i>>>=8,e++;if(i>0)throw new Error("ChaCha: counter overflow")}var yo={},Ht={};Object.defineProperty(Ht,"__esModule",{value:!0});function uf(t,e,r){return~(t-1)&e|t-1&r}Ht.select=uf;function ff(t,e){return(t|0)-(e|0)-1>>>31&1}Ht.lessOrEqual=ff;function _o(t,e){if(t.length!==e.length)return 0;for(var r=0,i=0;i<t.length;i++)r|=t[i]^e[i];return 1&r-1>>>8}Ht.compare=_o;function hf(t,e){return t.length===0||e.length===0?!1:_o(t,e)!==0}Ht.equal=hf;(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Ht,r=Rt;t.DIGEST_LENGTH=16;var i=function(){function y(g){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var p=g[0]|g[1]<<8;this._r[0]=p&8191;var I=g[2]|g[3]<<8;this._r[1]=(p>>>13|I<<3)&8191;var O=g[4]|g[5]<<8;this._r[2]=(I>>>10|O<<6)&7939;var A=g[6]|g[7]<<8;this._r[3]=(O>>>7|A<<9)&8191;var z=g[8]|g[9]<<8;this._r[4]=(A>>>4|z<<12)&255,this._r[5]=z>>>1&8190;var C=g[10]|g[11]<<8;this._r[6]=(z>>>14|C<<2)&8191;var P=g[12]|g[13]<<8;this._r[7]=(C>>>11|P<<5)&8065;var q=g[14]|g[15]<<8;this._r[8]=(P>>>8|q<<8)&8191,this._r[9]=q>>>5&127,this._pad[0]=g[16]|g[17]<<8,this._pad[1]=g[18]|g[19]<<8,this._pad[2]=g[20]|g[21]<<8,this._pad[3]=g[22]|g[23]<<8,this._pad[4]=g[24]|g[25]<<8,this._pad[5]=g[26]|g[27]<<8,this._pad[6]=g[28]|g[29]<<8,this._pad[7]=g[30]|g[31]<<8}return y.prototype._blocks=function(g,p,I){for(var O=this._fin?0:2048,A=this._h[0],z=this._h[1],C=this._h[2],P=this._h[3],q=this._h[4],$=this._h[5],G=this._h[6],b=this._h[7],D=this._h[8],m=this._h[9],w=this._r[0],v=this._r[1],s=this._r[2],h=this._r[3],H=this._r[4],o=this._r[5],c=this._r[6],f=this._r[7],_=this._r[8],d=this._r[9];I>=16;){var u=g[p+0]|g[p+1]<<8;A+=u&8191;var x=g[p+2]|g[p+3]<<8;z+=(u>>>13|x<<3)&8191;var N=g[p+4]|g[p+5]<<8;C+=(x>>>10|N<<6)&8191;var M=g[p+6]|g[p+7]<<8;P+=(N>>>7|M<<9)&8191;var E=g[p+8]|g[p+9]<<8;q+=(M>>>4|E<<12)&8191,$+=E>>>1&8191;var U=g[p+10]|g[p+11]<<8;G+=(E>>>14|U<<2)&8191;var B=g[p+12]|g[p+13]<<8;b+=(U>>>11|B<<5)&8191;var K=g[p+14]|g[p+15]<<8;D+=(B>>>8|K<<8)&8191,m+=K>>>5|O;var V=0,Q=V;Q+=A*w,Q+=z*(5*d),Q+=C*(5*_),Q+=P*(5*f),Q+=q*(5*c),V=Q>>>13,Q&=8191,Q+=$*(5*o),Q+=G*(5*H),Q+=b*(5*h),Q+=D*(5*s),Q+=m*(5*v),V+=Q>>>13,Q&=8191;var Y=V;Y+=A*v,Y+=z*w,Y+=C*(5*d),Y+=P*(5*_),Y+=q*(5*f),V=Y>>>13,Y&=8191,Y+=$*(5*c),Y+=G*(5*o),Y+=b*(5*H),Y+=D*(5*h),Y+=m*(5*s),V+=Y>>>13,Y&=8191;var oe=V;oe+=A*s,oe+=z*v,oe+=C*w,oe+=P*(5*d),oe+=q*(5*_),V=oe>>>13,oe&=8191,oe+=$*(5*f),oe+=G*(5*c),oe+=b*(5*o),oe+=D*(5*H),oe+=m*(5*h),V+=oe>>>13,oe&=8191;var L=V;L+=A*h,L+=z*s,L+=C*v,L+=P*w,L+=q*(5*d),V=L>>>13,L&=8191,L+=$*(5*_),L+=G*(5*f),L+=b*(5*c),L+=D*(5*o),L+=m*(5*H),V+=L>>>13,L&=8191;var j=V;j+=A*H,j+=z*h,j+=C*s,j+=P*v,j+=q*w,V=j>>>13,j&=8191,j+=$*(5*d),j+=G*(5*_),j+=b*(5*f),j+=D*(5*c),j+=m*(5*o),V+=j>>>13,j&=8191;var R=V;R+=A*o,R+=z*H,R+=C*h,R+=P*s,R+=q*v,V=R>>>13,R&=8191,R+=$*w,R+=G*(5*d),R+=b*(5*_),R+=D*(5*f),R+=m*(5*c),V+=R>>>13,R&=8191;var a=V;a+=A*c,a+=z*o,a+=C*H,a+=P*h,a+=q*s,V=a>>>13,a&=8191,a+=$*v,a+=G*w,a+=b*(5*d),a+=D*(5*_),a+=m*(5*f),V+=a>>>13,a&=8191;var T=V;T+=A*f,T+=z*c,T+=C*o,T+=P*H,T+=q*h,V=T>>>13,T&=8191,T+=$*s,T+=G*v,T+=b*w,T+=D*(5*d),T+=m*(5*_),V+=T>>>13,T&=8191;var k=V;k+=A*_,k+=z*f,k+=C*c,k+=P*o,k+=q*H,V=k>>>13,k&=8191,k+=$*h,k+=G*s,k+=b*v,k+=D*w,k+=m*(5*d),V+=k>>>13,k&=8191;var X=V;X+=A*d,X+=z*_,X+=C*f,X+=P*c,X+=q*o,V=X>>>13,X&=8191,X+=$*H,X+=G*h,X+=b*s,X+=D*v,X+=m*w,V+=X>>>13,X&=8191,V=(V<<2)+V|0,V=V+Q|0,Q=V&8191,V=V>>>13,Y+=V,A=Q,z=Y,C=oe,P=L,q=j,$=R,G=a,b=T,D=k,m=X,p+=16,I-=16}this._h[0]=A,this._h[1]=z,this._h[2]=C,this._h[3]=P,this._h[4]=q,this._h[5]=$,this._h[6]=G,this._h[7]=b,this._h[8]=D,this._h[9]=m},y.prototype.finish=function(g,p){p===void 0&&(p=0);var I=new Uint16Array(10),O,A,z,C;if(this._leftover){for(C=this._leftover,this._buffer[C++]=1;C<16;C++)this._buffer[C]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(O=this._h[1]>>>13,this._h[1]&=8191,C=2;C<10;C++)this._h[C]+=O,O=this._h[C]>>>13,this._h[C]&=8191;for(this._h[0]+=O*5,O=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=O,O=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=O,I[0]=this._h[0]+5,O=I[0]>>>13,I[0]&=8191,C=1;C<10;C++)I[C]=this._h[C]+O,O=I[C]>>>13,I[C]&=8191;for(I[9]-=1<<13,A=(O^1)-1,C=0;C<10;C++)I[C]&=A;for(A=~A,C=0;C<10;C++)this._h[C]=this._h[C]&A|I[C];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,z=this._h[0]+this._pad[0],this._h[0]=z&65535,C=1;C<8;C++)z=(this._h[C]+this._pad[C]|0)+(z>>>16)|0,this._h[C]=z&65535;return g[p+0]=this._h[0]>>>0,g[p+1]=this._h[0]>>>8,g[p+2]=this._h[1]>>>0,g[p+3]=this._h[1]>>>8,g[p+4]=this._h[2]>>>0,g[p+5]=this._h[2]>>>8,g[p+6]=this._h[3]>>>0,g[p+7]=this._h[3]>>>8,g[p+8]=this._h[4]>>>0,g[p+9]=this._h[4]>>>8,g[p+10]=this._h[5]>>>0,g[p+11]=this._h[5]>>>8,g[p+12]=this._h[6]>>>0,g[p+13]=this._h[6]>>>8,g[p+14]=this._h[7]>>>0,g[p+15]=this._h[7]>>>8,this._finished=!0,this},y.prototype.update=function(g){var p=0,I=g.length,O;if(this._leftover){O=16-this._leftover,O>I&&(O=I);for(var A=0;A<O;A++)this._buffer[this._leftover+A]=g[p+A];if(I-=O,p+=O,this._leftover+=O,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(I>=16&&(O=I-I%16,this._blocks(g,p,O),p+=O,I-=O),I){for(var A=0;A<I;A++)this._buffer[this._leftover+A]=g[p+A];this._leftover+=I}return this},y.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var g=new Uint8Array(16);return this.finish(g),g},y.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},y}();t.Poly1305=i;function n(y,g){var p=new i(y);p.update(g);var I=p.digest();return p.clean(),I}t.oneTimeAuth=n;function l(y,g){return y.length!==t.DIGEST_LENGTH||g.length!==t.DIGEST_LENGTH?!1:e.equal(y,g)}t.equal=l})(yo);(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=ii,r=yo,i=Rt,n=Qr,l=Ht;t.KEY_LENGTH=32,t.NONCE_LENGTH=12,t.TAG_LENGTH=16;var y=new Uint8Array(16),g=function(){function p(I){if(this.nonceLength=t.NONCE_LENGTH,this.tagLength=t.TAG_LENGTH,I.length!==t.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(I)}return p.prototype.seal=function(I,O,A,z){if(I.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var C=new Uint8Array(16);C.set(I,C.length-I.length);var P=new Uint8Array(32);e.stream(this._key,C,P,4);var q=O.length+this.tagLength,$;if(z){if(z.length!==q)throw new Error("ChaCha20Poly1305: incorrect destination length");$=z}else $=new Uint8Array(q);return e.streamXOR(this._key,C,O,$,4),this._authenticate($.subarray($.length-this.tagLength,$.length),P,$.subarray(0,$.length-this.tagLength),A),i.wipe(C),$},p.prototype.open=function(I,O,A,z){if(I.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(O.length<this.tagLength)return null;var C=new Uint8Array(16);C.set(I,C.length-I.length);var P=new Uint8Array(32);e.stream(this._key,C,P,4);var q=new Uint8Array(this.tagLength);if(this._authenticate(q,P,O.subarray(0,O.length-this.tagLength),A),!l.equal(q,O.subarray(O.length-this.tagLength,O.length)))return null;var $=O.length-this.tagLength,G;if(z){if(z.length!==$)throw new Error("ChaCha20Poly1305: incorrect destination length");G=z}else G=new Uint8Array($);return e.streamXOR(this._key,C,O.subarray(0,O.length-this.tagLength),G,4),i.wipe(C),G},p.prototype.clean=function(){return i.wipe(this._key),this},p.prototype._authenticate=function(I,O,A,z){var C=new r.Poly1305(O);z&&(C.update(z),z.length%16>0&&C.update(y.subarray(z.length%16))),C.update(A),A.length%16>0&&C.update(y.subarray(A.length%16));var P=new Uint8Array(8);z&&n.writeUint64LE(z.length,P),C.update(P),n.writeUint64LE(A.length,P),C.update(P);for(var q=C.digest(),$=0;$<q.length;$++)I[$]=q[$];C.clean(),i.wipe(q),i.wipe(P)},p}();t.ChaCha20Poly1305=g})(Ki);var bo={},Cr={},Bi={};Object.defineProperty(Bi,"__esModule",{value:!0});function lf(t){return typeof t.saveState<"u"&&typeof t.restoreState<"u"&&typeof t.cleanSavedState<"u"}Bi.isSerializableHash=lf;Object.defineProperty(Cr,"__esModule",{value:!0});var vt=Bi,df=Ht,gf=Rt,mo=function(){function t(e,r){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(i).clean():i.set(r);for(var n=0;n<i.length;n++)i[n]^=54;this._inner.update(i);for(var n=0;n<i.length;n++)i[n]^=106;this._outer.update(i),vt.isSerializableHash(this._inner)&&vt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),gf.wipe(i)}return t.prototype.reset=function(){if(!vt.isSerializableHash(this._inner)||!vt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.clean=function(){vt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),vt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},t.prototype.update=function(e){return this._inner.update(e),this},t.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype.saveState=function(){if(!vt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},t.prototype.restoreState=function(e){if(!vt.isSerializableHash(this._inner)||!vt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.cleanSavedState=function(e){if(!vt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},t}();Cr.HMAC=mo;function pf(t,e,r){var i=new mo(t,e);i.update(r);var n=i.digest();return i.clean(),n}Cr.hmac=pf;Cr.equal=df.equal;Object.defineProperty(bo,"__esModule",{value:!0});var Gn=Cr,Wn=Rt,yf=function(){function t(e,r,i,n){i===void 0&&(i=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=n;var l=Gn.hmac(this._hash,i,r);this._hmac=new Gn.HMAC(e,l),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return t.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},t.prototype.expand=function(e){for(var r=new Uint8Array(e),i=0;i<r.length;i++)this._bufpos===this._buffer.length&&this._fillBuffer(),r[i]=this._buffer[this._bufpos++];return r},t.prototype.clean=function(){this._hmac.clean(),Wn.wipe(this._buffer),Wn.wipe(this._counter),this._bufpos=0},t}(),_f=bo.HKDF=yf,ni={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Qr,r=Rt;t.DIGEST_LENGTH=32,t.BLOCK_SIZE=64;var i=function(){function g(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return g.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},g.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},g.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},g.prototype.update=function(p,I){if(I===void 0&&(I=p.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var O=0;if(this._bytesHashed+=I,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&I>0;)this._buffer[this._bufferLength++]=p[O++],I--;this._bufferLength===this.blockSize&&(l(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(I>=this.blockSize&&(O=l(this._temp,this._state,p,O,I),I%=this.blockSize);I>0;)this._buffer[this._bufferLength++]=p[O++],I--;return this},g.prototype.finish=function(p){if(!this._finished){var I=this._bytesHashed,O=this._bufferLength,A=I/536870912|0,z=I<<3,C=I%64<56?64:128;this._buffer[O]=128;for(var P=O+1;P<C-8;P++)this._buffer[P]=0;e.writeUint32BE(A,this._buffer,C-8),e.writeUint32BE(z,this._buffer,C-4),l(this._temp,this._state,this._buffer,0,C),this._finished=!0}for(var P=0;P<this.digestLength/4;P++)e.writeUint32BE(this._state[P],p,P*4);return this},g.prototype.digest=function(){var p=new Uint8Array(this.digestLength);return this.finish(p),p},g.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},g.prototype.restoreState=function(p){return this._state.set(p.state),this._bufferLength=p.bufferLength,p.buffer&&this._buffer.set(p.buffer),this._bytesHashed=p.bytesHashed,this._finished=!1,this},g.prototype.cleanSavedState=function(p){r.wipe(p.state),p.buffer&&r.wipe(p.buffer),p.bufferLength=0,p.bytesHashed=0},g}();t.SHA256=i;var n=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function l(g,p,I,O,A){for(;A>=64;){for(var z=p[0],C=p[1],P=p[2],q=p[3],$=p[4],G=p[5],b=p[6],D=p[7],m=0;m<16;m++){var w=O+m*4;g[m]=e.readUint32BE(I,w)}for(var m=16;m<64;m++){var v=g[m-2],s=(v>>>17|v<<32-17)^(v>>>19|v<<32-19)^v>>>10;v=g[m-15];var h=(v>>>7|v<<32-7)^(v>>>18|v<<32-18)^v>>>3;g[m]=(s+g[m-7]|0)+(h+g[m-16]|0)}for(var m=0;m<64;m++){var s=((($>>>6|$<<26)^($>>>11|$<<21)^($>>>25|$<<7))+($&G^~$&b)|0)+(D+(n[m]+g[m]|0)|0)|0,h=((z>>>2|z<<32-2)^(z>>>13|z<<32-13)^(z>>>22|z<<32-22))+(z&C^z&P^C&P)|0;D=b,b=G,G=$,$=q+s|0,q=P,P=C,C=z,z=s+h|0}p[0]+=z,p[1]+=C,p[2]+=P,p[3]+=q,p[4]+=$,p[5]+=G,p[6]+=b,p[7]+=D,O+=64,A-=64}return O}function y(g){var p=new i;p.update(g);var I=p.digest();return p.clean(),I}t.hash=y})(ni);var Vi={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.scalarMultBase=t.scalarMult=t.SHARED_KEY_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=void 0;const e=Ir,r=Rt;t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;function i(m){const w=new Float64Array(16);if(m)for(let v=0;v<m.length;v++)w[v]=m[v];return w}const n=new Uint8Array(32);n[0]=9;const l=i([56129,1]);function y(m){let w=1;for(let v=0;v<16;v++){let s=m[v]+w+65535;w=Math.floor(s/65536),m[v]=s-w*65536}m[0]+=w-1+37*(w-1)}function g(m,w,v){const s=~(v-1);for(let h=0;h<16;h++){const H=s&(m[h]^w[h]);m[h]^=H,w[h]^=H}}function p(m,w){const v=i(),s=i();for(let h=0;h<16;h++)s[h]=w[h];y(s),y(s),y(s);for(let h=0;h<2;h++){v[0]=s[0]-65517;for(let o=1;o<15;o++)v[o]=s[o]-65535-(v[o-1]>>16&1),v[o-1]&=65535;v[15]=s[15]-32767-(v[14]>>16&1);const H=v[15]>>16&1;v[14]&=65535,g(s,v,1-H)}for(let h=0;h<16;h++)m[2*h]=s[h]&255,m[2*h+1]=s[h]>>8}function I(m,w){for(let v=0;v<16;v++)m[v]=w[2*v]+(w[2*v+1]<<8);m[15]&=32767}function O(m,w,v){for(let s=0;s<16;s++)m[s]=w[s]+v[s]}function A(m,w,v){for(let s=0;s<16;s++)m[s]=w[s]-v[s]}function z(m,w,v){let s,h,H=0,o=0,c=0,f=0,_=0,d=0,u=0,x=0,N=0,M=0,E=0,U=0,B=0,K=0,V=0,Q=0,Y=0,oe=0,L=0,j=0,R=0,a=0,T=0,k=0,X=0,fe=0,ye=0,le=0,me=0,Fe=0,Ae=0,pe=v[0],de=v[1],he=v[2],ce=v[3],ae=v[4],se=v[5],ne=v[6],te=v[7],ue=v[8],ge=v[9],re=v[10],_e=v[11],be=v[12],ve=v[13],Ee=v[14],we=v[15];s=w[0],H+=s*pe,o+=s*de,c+=s*he,f+=s*ce,_+=s*ae,d+=s*se,u+=s*ne,x+=s*te,N+=s*ue,M+=s*ge,E+=s*re,U+=s*_e,B+=s*be,K+=s*ve,V+=s*Ee,Q+=s*we,s=w[1],o+=s*pe,c+=s*de,f+=s*he,_+=s*ce,d+=s*ae,u+=s*se,x+=s*ne,N+=s*te,M+=s*ue,E+=s*ge,U+=s*re,B+=s*_e,K+=s*be,V+=s*ve,Q+=s*Ee,Y+=s*we,s=w[2],c+=s*pe,f+=s*de,_+=s*he,d+=s*ce,u+=s*ae,x+=s*se,N+=s*ne,M+=s*te,E+=s*ue,U+=s*ge,B+=s*re,K+=s*_e,V+=s*be,Q+=s*ve,Y+=s*Ee,oe+=s*we,s=w[3],f+=s*pe,_+=s*de,d+=s*he,u+=s*ce,x+=s*ae,N+=s*se,M+=s*ne,E+=s*te,U+=s*ue,B+=s*ge,K+=s*re,V+=s*_e,Q+=s*be,Y+=s*ve,oe+=s*Ee,L+=s*we,s=w[4],_+=s*pe,d+=s*de,u+=s*he,x+=s*ce,N+=s*ae,M+=s*se,E+=s*ne,U+=s*te,B+=s*ue,K+=s*ge,V+=s*re,Q+=s*_e,Y+=s*be,oe+=s*ve,L+=s*Ee,j+=s*we,s=w[5],d+=s*pe,u+=s*de,x+=s*he,N+=s*ce,M+=s*ae,E+=s*se,U+=s*ne,B+=s*te,K+=s*ue,V+=s*ge,Q+=s*re,Y+=s*_e,oe+=s*be,L+=s*ve,j+=s*Ee,R+=s*we,s=w[6],u+=s*pe,x+=s*de,N+=s*he,M+=s*ce,E+=s*ae,U+=s*se,B+=s*ne,K+=s*te,V+=s*ue,Q+=s*ge,Y+=s*re,oe+=s*_e,L+=s*be,j+=s*ve,R+=s*Ee,a+=s*we,s=w[7],x+=s*pe,N+=s*de,M+=s*he,E+=s*ce,U+=s*ae,B+=s*se,K+=s*ne,V+=s*te,Q+=s*ue,Y+=s*ge,oe+=s*re,L+=s*_e,j+=s*be,R+=s*ve,a+=s*Ee,T+=s*we,s=w[8],N+=s*pe,M+=s*de,E+=s*he,U+=s*ce,B+=s*ae,K+=s*se,V+=s*ne,Q+=s*te,Y+=s*ue,oe+=s*ge,L+=s*re,j+=s*_e,R+=s*be,a+=s*ve,T+=s*Ee,k+=s*we,s=w[9],M+=s*pe,E+=s*de,U+=s*he,B+=s*ce,K+=s*ae,V+=s*se,Q+=s*ne,Y+=s*te,oe+=s*ue,L+=s*ge,j+=s*re,R+=s*_e,a+=s*be,T+=s*ve,k+=s*Ee,X+=s*we,s=w[10],E+=s*pe,U+=s*de,B+=s*he,K+=s*ce,V+=s*ae,Q+=s*se,Y+=s*ne,oe+=s*te,L+=s*ue,j+=s*ge,R+=s*re,a+=s*_e,T+=s*be,k+=s*ve,X+=s*Ee,fe+=s*we,s=w[11],U+=s*pe,B+=s*de,K+=s*he,V+=s*ce,Q+=s*ae,Y+=s*se,oe+=s*ne,L+=s*te,j+=s*ue,R+=s*ge,a+=s*re,T+=s*_e,k+=s*be,X+=s*ve,fe+=s*Ee,ye+=s*we,s=w[12],B+=s*pe,K+=s*de,V+=s*he,Q+=s*ce,Y+=s*ae,oe+=s*se,L+=s*ne,j+=s*te,R+=s*ue,a+=s*ge,T+=s*re,k+=s*_e,X+=s*be,fe+=s*ve,ye+=s*Ee,le+=s*we,s=w[13],K+=s*pe,V+=s*de,Q+=s*he,Y+=s*ce,oe+=s*ae,L+=s*se,j+=s*ne,R+=s*te,a+=s*ue,T+=s*ge,k+=s*re,X+=s*_e,fe+=s*be,ye+=s*ve,le+=s*Ee,me+=s*we,s=w[14],V+=s*pe,Q+=s*de,Y+=s*he,oe+=s*ce,L+=s*ae,j+=s*se,R+=s*ne,a+=s*te,T+=s*ue,k+=s*ge,X+=s*re,fe+=s*_e,ye+=s*be,le+=s*ve,me+=s*Ee,Fe+=s*we,s=w[15],Q+=s*pe,Y+=s*de,oe+=s*he,L+=s*ce,j+=s*ae,R+=s*se,a+=s*ne,T+=s*te,k+=s*ue,X+=s*ge,fe+=s*re,ye+=s*_e,le+=s*be,me+=s*ve,Fe+=s*Ee,Ae+=s*we,H+=38*Y,o+=38*oe,c+=38*L,f+=38*j,_+=38*R,d+=38*a,u+=38*T,x+=38*k,N+=38*X,M+=38*fe,E+=38*ye,U+=38*le,B+=38*me,K+=38*Fe,V+=38*Ae,h=1,s=H+h+65535,h=Math.floor(s/65536),H=s-h*65536,s=o+h+65535,h=Math.floor(s/65536),o=s-h*65536,s=c+h+65535,h=Math.floor(s/65536),c=s-h*65536,s=f+h+65535,h=Math.floor(s/65536),f=s-h*65536,s=_+h+65535,h=Math.floor(s/65536),_=s-h*65536,s=d+h+65535,h=Math.floor(s/65536),d=s-h*65536,s=u+h+65535,h=Math.floor(s/65536),u=s-h*65536,s=x+h+65535,h=Math.floor(s/65536),x=s-h*65536,s=N+h+65535,h=Math.floor(s/65536),N=s-h*65536,s=M+h+65535,h=Math.floor(s/65536),M=s-h*65536,s=E+h+65535,h=Math.floor(s/65536),E=s-h*65536,s=U+h+65535,h=Math.floor(s/65536),U=s-h*65536,s=B+h+65535,h=Math.floor(s/65536),B=s-h*65536,s=K+h+65535,h=Math.floor(s/65536),K=s-h*65536,s=V+h+65535,h=Math.floor(s/65536),V=s-h*65536,s=Q+h+65535,h=Math.floor(s/65536),Q=s-h*65536,H+=h-1+37*(h-1),h=1,s=H+h+65535,h=Math.floor(s/65536),H=s-h*65536,s=o+h+65535,h=Math.floor(s/65536),o=s-h*65536,s=c+h+65535,h=Math.floor(s/65536),c=s-h*65536,s=f+h+65535,h=Math.floor(s/65536),f=s-h*65536,s=_+h+65535,h=Math.floor(s/65536),_=s-h*65536,s=d+h+65535,h=Math.floor(s/65536),d=s-h*65536,s=u+h+65535,h=Math.floor(s/65536),u=s-h*65536,s=x+h+65535,h=Math.floor(s/65536),x=s-h*65536,s=N+h+65535,h=Math.floor(s/65536),N=s-h*65536,s=M+h+65535,h=Math.floor(s/65536),M=s-h*65536,s=E+h+65535,h=Math.floor(s/65536),E=s-h*65536,s=U+h+65535,h=Math.floor(s/65536),U=s-h*65536,s=B+h+65535,h=Math.floor(s/65536),B=s-h*65536,s=K+h+65535,h=Math.floor(s/65536),K=s-h*65536,s=V+h+65535,h=Math.floor(s/65536),V=s-h*65536,s=Q+h+65535,h=Math.floor(s/65536),Q=s-h*65536,H+=h-1+37*(h-1),m[0]=H,m[1]=o,m[2]=c,m[3]=f,m[4]=_,m[5]=d,m[6]=u,m[7]=x,m[8]=N,m[9]=M,m[10]=E,m[11]=U,m[12]=B,m[13]=K,m[14]=V,m[15]=Q}function C(m,w){z(m,w,w)}function P(m,w){const v=i();for(let s=0;s<16;s++)v[s]=w[s];for(let s=253;s>=0;s--)C(v,v),s!==2&&s!==4&&z(v,v,w);for(let s=0;s<16;s++)m[s]=v[s]}function q(m,w){const v=new Uint8Array(32),s=new Float64Array(80),h=i(),H=i(),o=i(),c=i(),f=i(),_=i();for(let N=0;N<31;N++)v[N]=m[N];v[31]=m[31]&127|64,v[0]&=248,I(s,w);for(let N=0;N<16;N++)H[N]=s[N];h[0]=c[0]=1;for(let N=254;N>=0;--N){const M=v[N>>>3]>>>(N&7)&1;g(h,H,M),g(o,c,M),O(f,h,o),A(h,h,o),O(o,H,c),A(H,H,c),C(c,f),C(_,h),z(h,o,h),z(o,H,f),O(f,h,o),A(h,h,o),C(H,h),A(o,c,_),z(h,o,l),O(h,h,c),z(o,o,h),z(h,c,_),z(c,H,s),C(H,f),g(h,H,M),g(o,c,M)}for(let N=0;N<16;N++)s[N+16]=h[N],s[N+32]=o[N],s[N+48]=H[N],s[N+64]=c[N];const d=s.subarray(32),u=s.subarray(16);P(d,d),z(u,u,d);const x=new Uint8Array(32);return p(x,u),x}t.scalarMult=q;function $(m){return q(m,n)}t.scalarMultBase=$;function G(m){if(m.length!==t.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${t.SECRET_KEY_LENGTH} bytes`);const w=new Uint8Array(m);return{publicKey:$(w),secretKey:w}}t.generateKeyPairFromSeed=G;function b(m){const w=(0,e.randomBytes)(32,m),v=G(w);return(0,r.wipe)(w),v}t.generateKeyPair=b;function D(m,w,v=!1){if(m.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(w.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const s=q(m,w);if(v){let h=0;for(let H=0;H<s.length;H++)h|=s[H];if(h===0)throw new Error("X25519: invalid shared key")}return s}t.sharedKey=D})(Vi);function wo(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function kn(t,e){e||(e=t.reduce((n,l)=>n+l.length,0));const r=wo(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return r}function vo(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Yn=vo("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),vi=vo("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=wo(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Eo={utf8:Yn,"utf-8":Yn,hex:Yr.base16,latin1:vi,ascii:vi,binary:vi,...Yr};function bt(t,e="utf8"){const r=Eo[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}function mt(t,e="utf8"){const r=Eo[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}var Jn=globalThis&&globalThis.__spreadArray||function(t,e,r){if(r||arguments.length===2)for(var i=0,n=e.length,l;i<n;i++)(l||!(i in e))&&(l||(l=Array.prototype.slice.call(e,0,i)),l[i]=e[i]);return t.concat(l||Array.prototype.slice.call(e))},bf=function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t}(),mf=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=St.platform}return t}(),wf=function(){function t(e,r,i,n){this.name=e,this.version=r,this.os=i,this.bot=n,this.type="bot-device"}return t}(),vf=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),Ef=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),Df=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Sf=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Xn=3,Of=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Df]],Zn=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function xf(t){return t?Qn(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Ef:typeof navigator<"u"?Qn(navigator.userAgent):Pf()}function If(t){return t!==""&&Of.reduce(function(e,r){var i=r[0],n=r[1];if(e)return e;var l=n.exec(t);return!!l&&[i,l]},!1)}function Qn(t){var e=If(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new vf;var n=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);n?n.length<Xn&&(n=Jn(Jn([],n,!0),Af(Xn-n.length),!0)):n=[];var l=n.join("."),y=Tf(t),g=Sf.exec(t);return g&&g[1]?new wf(r,l,y,g[1]):new bf(r,l,y)}function Tf(t){for(var e=0,r=Zn.length;e<r;e++){var i=Zn[e],n=i[0],l=i[1],y=l.exec(t);if(y)return n}return null}function Pf(){var t=typeof St<"u"&&St.version;return t?new mf(St.version.slice(1)):null}function Af(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var Se={};Object.defineProperty(Se,"__esModule",{value:!0});Se.getLocalStorage=Se.getLocalStorageOrThrow=Se.getCrypto=Se.getCryptoOrThrow=So=Se.getLocation=Se.getLocationOrThrow=Gi=Se.getNavigator=Se.getNavigatorOrThrow=Do=Se.getDocument=Se.getDocumentOrThrow=Se.getFromWindowOrThrow=Se.getFromWindow=void 0;function Zt(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}Se.getFromWindow=Zt;function cr(t){const e=Zt(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}Se.getFromWindowOrThrow=cr;function Nf(){return cr("document")}Se.getDocumentOrThrow=Nf;function Cf(){return Zt("document")}var Do=Se.getDocument=Cf;function Rf(){return cr("navigator")}Se.getNavigatorOrThrow=Rf;function Ff(){return Zt("navigator")}var Gi=Se.getNavigator=Ff;function Uf(){return cr("location")}Se.getLocationOrThrow=Uf;function jf(){return Zt("location")}var So=Se.getLocation=jf;function Lf(){return cr("crypto")}Se.getCryptoOrThrow=Lf;function Mf(){return Zt("crypto")}Se.getCrypto=Mf;function $f(){return cr("localStorage")}Se.getLocalStorageOrThrow=$f;function zf(){return Zt("localStorage")}Se.getLocalStorage=zf;var Wi={};Object.defineProperty(Wi,"__esModule",{value:!0});var Oo=Wi.getWindowMetadata=void 0;const es=Se;function Hf(){let t,e;try{t=es.getDocumentOrThrow(),e=es.getLocationOrThrow()}catch{return null}function r(){const A=t.getElementsByTagName("link"),z=[];for(let C=0;C<A.length;C++){const P=A[C],q=P.getAttribute("rel");if(q&&q.toLowerCase().indexOf("icon")>-1){const $=P.getAttribute("href");if($)if($.toLowerCase().indexOf("https:")===-1&&$.toLowerCase().indexOf("http:")===-1&&$.indexOf("//")!==0){let G=e.protocol+"//"+e.host;if($.indexOf("/")===0)G+=$;else{const b=e.pathname.split("/");b.pop();const D=b.join("/");G+=D+"/"+$}z.push(G)}else if($.indexOf("//")===0){const G=e.protocol+$;z.push(G)}else z.push($)}}return z}function i(...A){const z=t.getElementsByTagName("meta");for(let C=0;C<z.length;C++){const P=z[C],q=["itemprop","property","name"].map($=>P.getAttribute($)).filter($=>$?A.includes($):!1);if(q.length&&q){const $=P.getAttribute("content");if($)return $}}return""}function n(){let A=i("name","og:site_name","og:title","twitter:title");return A||(A=t.title),A}function l(){return i("description","og:description","twitter:description","keywords")}const y=n(),g=l(),p=e.origin,I=r();return{description:g,url:p,icons:I,name:y}}Oo=Wi.getWindowMetadata=Hf;var xr={},xo=function(t,e){for(var r={},i=Object.keys(t),n=Array.isArray(e),l=0;l<i.length;l++){var y=i[l],g=t[y];(n?e.indexOf(y)!==-1:e(y,g,t))&&(r[y]=g)}return r};(function(t){const e=Js,r=Xs,i=Ys,n=xo,l=b=>b==null,y=Symbol("encodeFragmentIdentifier");function g(b){switch(b.arrayFormat){case"index":return D=>(m,w)=>{const v=m.length;return w===void 0||b.skipNull&&w===null||b.skipEmptyString&&w===""?m:w===null?[...m,[O(D,b),"[",v,"]"].join("")]:[...m,[O(D,b),"[",O(v,b),"]=",O(w,b)].join("")]};case"bracket":return D=>(m,w)=>w===void 0||b.skipNull&&w===null||b.skipEmptyString&&w===""?m:w===null?[...m,[O(D,b),"[]"].join("")]:[...m,[O(D,b),"[]=",O(w,b)].join("")];case"colon-list-separator":return D=>(m,w)=>w===void 0||b.skipNull&&w===null||b.skipEmptyString&&w===""?m:w===null?[...m,[O(D,b),":list="].join("")]:[...m,[O(D,b),":list=",O(w,b)].join("")];case"comma":case"separator":case"bracket-separator":{const D=b.arrayFormat==="bracket-separator"?"[]=":"=";return m=>(w,v)=>v===void 0||b.skipNull&&v===null||b.skipEmptyString&&v===""?w:(v=v===null?"":v,w.length===0?[[O(m,b),D,O(v,b)].join("")]:[[w,O(v,b)].join(b.arrayFormatSeparator)])}default:return D=>(m,w)=>w===void 0||b.skipNull&&w===null||b.skipEmptyString&&w===""?m:w===null?[...m,O(D,b)]:[...m,[O(D,b),"=",O(w,b)].join("")]}}function p(b){let D;switch(b.arrayFormat){case"index":return(m,w,v)=>{if(D=/\[(\d*)\]$/.exec(m),m=m.replace(/\[\d*\]$/,""),!D){v[m]=w;return}v[m]===void 0&&(v[m]={}),v[m][D[1]]=w};case"bracket":return(m,w,v)=>{if(D=/(\[\])$/.exec(m),m=m.replace(/\[\]$/,""),!D){v[m]=w;return}if(v[m]===void 0){v[m]=[w];return}v[m]=[].concat(v[m],w)};case"colon-list-separator":return(m,w,v)=>{if(D=/(:list)$/.exec(m),m=m.replace(/:list$/,""),!D){v[m]=w;return}if(v[m]===void 0){v[m]=[w];return}v[m]=[].concat(v[m],w)};case"comma":case"separator":return(m,w,v)=>{const s=typeof w=="string"&&w.includes(b.arrayFormatSeparator),h=typeof w=="string"&&!s&&A(w,b).includes(b.arrayFormatSeparator);w=h?A(w,b):w;const H=s||h?w.split(b.arrayFormatSeparator).map(o=>A(o,b)):w===null?w:A(w,b);v[m]=H};case"bracket-separator":return(m,w,v)=>{const s=/(\[\])$/.test(m);if(m=m.replace(/\[\]$/,""),!s){v[m]=w&&A(w,b);return}const h=w===null?[]:w.split(b.arrayFormatSeparator).map(H=>A(H,b));if(v[m]===void 0){v[m]=h;return}v[m]=[].concat(v[m],h)};default:return(m,w,v)=>{if(v[m]===void 0){v[m]=w;return}v[m]=[].concat(v[m],w)}}}function I(b){if(typeof b!="string"||b.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function O(b,D){return D.encode?D.strict?e(b):encodeURIComponent(b):b}function A(b,D){return D.decode?r(b):b}function z(b){return Array.isArray(b)?b.sort():typeof b=="object"?z(Object.keys(b)).sort((D,m)=>Number(D)-Number(m)).map(D=>b[D]):b}function C(b){const D=b.indexOf("#");return D!==-1&&(b=b.slice(0,D)),b}function P(b){let D="";const m=b.indexOf("#");return m!==-1&&(D=b.slice(m)),D}function q(b){b=C(b);const D=b.indexOf("?");return D===-1?"":b.slice(D+1)}function $(b,D){return D.parseNumbers&&!Number.isNaN(Number(b))&&typeof b=="string"&&b.trim()!==""?b=Number(b):D.parseBooleans&&b!==null&&(b.toLowerCase()==="true"||b.toLowerCase()==="false")&&(b=b.toLowerCase()==="true"),b}function G(b,D){D=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},D),I(D.arrayFormatSeparator);const m=p(D),w=Object.create(null);if(typeof b!="string"||(b=b.trim().replace(/^[?#&]/,""),!b))return w;for(const v of b.split("&")){if(v==="")continue;let[s,h]=i(D.decode?v.replace(/\+/g," "):v,"=");h=h===void 0?null:["comma","separator","bracket-separator"].includes(D.arrayFormat)?h:A(h,D),m(A(s,D),h,w)}for(const v of Object.keys(w)){const s=w[v];if(typeof s=="object"&&s!==null)for(const h of Object.keys(s))s[h]=$(s[h],D);else w[v]=$(s,D)}return D.sort===!1?w:(D.sort===!0?Object.keys(w).sort():Object.keys(w).sort(D.sort)).reduce((v,s)=>{const h=w[s];return Boolean(h)&&typeof h=="object"&&!Array.isArray(h)?v[s]=z(h):v[s]=h,v},Object.create(null))}t.extract=q,t.parse=G,t.stringify=(b,D)=>{if(!b)return"";D=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},D),I(D.arrayFormatSeparator);const m=h=>D.skipNull&&l(b[h])||D.skipEmptyString&&b[h]==="",w=g(D),v={};for(const h of Object.keys(b))m(h)||(v[h]=b[h]);const s=Object.keys(v);return D.sort!==!1&&s.sort(D.sort),s.map(h=>{const H=b[h];return H===void 0?"":H===null?O(h,D):Array.isArray(H)?H.length===0&&D.arrayFormat==="bracket-separator"?O(h,D)+"[]":H.reduce(w(h),[]).join("&"):O(h,D)+"="+O(H,D)}).filter(h=>h.length>0).join("&")},t.parseUrl=(b,D)=>{D=Object.assign({decode:!0},D);const[m,w]=i(b,"#");return Object.assign({url:m.split("?")[0]||"",query:G(q(b),D)},D&&D.parseFragmentIdentifier&&w?{fragmentIdentifier:A(w,D)}:{})},t.stringifyUrl=(b,D)=>{D=Object.assign({encode:!0,strict:!0,[y]:!0},D);const m=C(b.url).split("?")[0]||"",w=t.extract(b.url),v=t.parse(w,{sort:!1}),s=Object.assign(v,b.query);let h=t.stringify(s,D);h&&(h=`?${h}`);let H=P(b.url);return b.fragmentIdentifier&&(H=`#${D[y]?O(b.fragmentIdentifier,D):b.fragmentIdentifier}`),`${m}${h}${H}`},t.pick=(b,D,m)=>{m=Object.assign({parseFragmentIdentifier:!0,[y]:!1},m);const{url:w,query:v,fragmentIdentifier:s}=t.parseUrl(b,m);return t.stringifyUrl({url:w,query:n(v,D),fragmentIdentifier:s},m)},t.exclude=(b,D,m)=>{const w=Array.isArray(D)?v=>!D.includes(v):(v,s)=>!D(v,s);return t.pick(b,w,m)}})(xr);const qf={waku:{publish:"waku_publish",subscribe:"waku_subscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe"},irn:{publish:"irn_publish",subscribe:"irn_subscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe"},iridium:{publish:"iridium_publish",subscribe:"iridium_subscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe"}},Io="base10",at="base16",Pi="base64pad",ki="utf8",To=0,Qt=1,Kf=0,ts=1,Ai=12,Yi=32;function Bf(){const t=Vi.generateKeyPair();return{privateKey:mt(t.secretKey,at),publicKey:mt(t.publicKey,at)}}function Ni(){const t=Ir.randomBytes(Yi);return mt(t,at)}function Vf(t,e){const r=Vi.sharedKey(bt(t,at),bt(e,at)),i=new _f(ni.SHA256,r).expand(Yi);return mt(i,at)}function Gf(t){const e=ni.hash(bt(t,at));return mt(e,at)}function Ci(t){const e=ni.hash(bt(t,ki));return mt(e,at)}function Wf(t){return bt(`${t}`,Io)}function Rr(t){return Number(mt(t,Io))}function kf(t){const e=Wf(typeof t.type<"u"?t.type:To);if(Rr(e)===Qt&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?bt(t.senderPublicKey,at):void 0,i=typeof t.iv<"u"?bt(t.iv,at):Ir.randomBytes(Ai),n=new Ki.ChaCha20Poly1305(bt(t.symKey,at)).seal(i,bt(t.message,ki));return Jf({type:e,sealed:n,iv:i,senderPublicKey:r})}function Yf(t){const e=new Ki.ChaCha20Poly1305(bt(t.symKey,at)),{sealed:r,iv:i}=Ji(t.encoded),n=e.open(i,r);if(n===null)throw new Error("Failed to decrypt");return mt(n,ki)}function Jf(t){if(Rr(t.type)===Qt){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return mt(kn([t.type,t.senderPublicKey,t.iv,t.sealed]),Pi)}return mt(kn([t.type,t.iv,t.sealed]),Pi)}function Ji(t){const e=bt(t,Pi),r=e.slice(Kf,ts),i=ts;if(Rr(r)===Qt){const g=i+Yi,p=g+Ai,I=e.slice(i,g),O=e.slice(g,p),A=e.slice(p);return{type:r,sealed:A,iv:O,senderPublicKey:I}}const n=i+Ai,l=e.slice(i,n),y=e.slice(n);return{type:r,sealed:y,iv:l}}function Xf(t,e){const r=Ji(t);return Po({type:Rr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?mt(r.senderPublicKey,at):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Po(t){const e=(t==null?void 0:t.type)||To;if(e===Qt){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function rs(t){return t.type===Qt&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}var Zf=Object.defineProperty,is=Object.getOwnPropertySymbols,Qf=Object.prototype.hasOwnProperty,eh=Object.prototype.propertyIsEnumerable,ns=(t,e,r)=>e in t?Zf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ss=(t,e)=>{for(var r in e||(e={}))Qf.call(e,r)&&ns(t,r,e[r]);if(is)for(var r of is(e))eh.call(e,r)&&ns(t,r,e[r]);return t};const th="ReactNative",vr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},rh="js";function Ao(){return typeof St<"u"&&typeof St.versions<"u"&&typeof St.versions.node<"u"}function ih(){return!Do()&&!!Gi()&&navigator.product===th}function nh(){return!Ao()&&!!Gi()}function sh(){return ih()?vr.reactNative:Ao()?vr.node:nh()?vr.browser:vr.unknown}function oh(t,e){let r=xr.parse(t);return r=ss(ss({},r),e),t=xr.stringify(r),t}function ah(){return Oo()||{name:"",description:"",url:"",icons:[""]}}function ch(){const t=xf();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function uh(){var t;const e=sh();return e===vr.browser?[e,((t=So())==null?void 0:t.host)||"unknown"].join(":"):e}function fh(t,e,r){const i=ch(),n=uh();return[[t,e].join("-"),[rh,r].join("-"),i,n].join("/")}function hh({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:n,projectId:l}){const y=r.split("?"),g=fh(t,e,i),p={auth:n,ua:g,projectId:l},I=oh(y[1]||"",p);return y[0]+"?"+I}function ot(t,e){return t.filter(r=>e.includes(r)).length===t.length}function No(t){return Object.fromEntries(t.entries())}function Co(t){return new Map(Object.entries(t))}function Ct(t,e){return ee.fromMiliseconds((e||Date.now())+ee.toMiliseconds(t))}function $t(t){return ee.fromMiliseconds(Date.now())>=ee.toMiliseconds(t)}function Jt(){const t=ee.toMiliseconds(ee.FIVE_MINUTES);let e,r,i;return{resolve:n=>{i&&e&&(clearTimeout(i),e(n))},reject:n=>{i&&r&&(clearTimeout(i),r(n))},done:()=>new Promise((n,l)=>{i=setTimeout(l,t),e=n,r=l})}}function Ro(t,e){return new Promise(async(r,i)=>{const n=setTimeout(()=>i(),e),l=await t;clearTimeout(n),r(l)})}function Fo(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function lh(t){return Fo("topic",t)}function dh(t){return Fo("id",t)}function Uo(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function Ue(t,e){return`${t}${e?`:${e}`:""}`}const gh="irn";function Ri(t){return(t==null?void 0:t.relay)||{protocol:gh}}function Fi(t){const e=qf[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var ph=Object.defineProperty,os=Object.getOwnPropertySymbols,yh=Object.prototype.hasOwnProperty,_h=Object.prototype.propertyIsEnumerable,as=(t,e,r)=>e in t?ph(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,bh=(t,e)=>{for(var r in e||(e={}))yh.call(e,r)&&as(t,r,e[r]);if(os)for(var r of os(e))_h.call(e,r)&&as(t,r,e[r]);return t};function mh(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(n=>{if(n.startsWith(i)){const l=n.replace(i,""),y=t[n];r[l]=y}}),r}function wh(t){const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),n=t.substring(e+1,r).split("@"),l=typeof r<"u"?t.substring(r):"",y=xr.parse(l);return{protocol:i,topic:n[0],version:parseInt(n[1],10),symKey:y.symKey,relay:mh(y)}}function vh(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(n=>{const l=r+e+n;t[n]&&(i[l]=t[n])}),i}function Eh(t){return`${t.protocol}:${t.topic}@${t.version}?`+xr.stringify(bh({symKey:t.symKey},vh(t.relay)))}function xt(t){const e=[];return t.forEach(r=>{const[i,n]=r.split(":");e.push(`${i}:${n}`)}),e}function Dh(t){const e=[];return Object.values(t).forEach(r=>{e.push(...xt(r.accounts)),r.extension&&r.extension.forEach(i=>{e.push(...xt(i.accounts))})}),e}function Sh(t,e){const r=[];return Object.values(t).forEach(i=>{xt(i.accounts).includes(e)&&r.push(...i.methods),i.extension&&i.extension.forEach(n=>{xt(n.accounts).includes(e)&&r.push(...n.methods)})}),r}function Oh(t,e){const r=[];return Object.values(t).forEach(i=>{xt(i.accounts).includes(e)&&r.push(...i.events),i.extension&&i.extension.forEach(n=>{xt(n.accounts).includes(e)&&r.push(...n.events)})}),r}const xh={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Ih={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function J(t,e){const{message:r,code:i}=Ih[t];return{message:e?`${r} ${e}`:r,code:i}}function Je(t,e){const{message:r,code:i}=xh[t];return{message:e?`${r} ${e}`:r,code:i}}function Fr(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function jo(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function gt(t){return typeof t>"u"}function Ze(t,e){return e&&gt(t)?!0:typeof t=="string"&&Boolean(t.trim().length)}function Lo(t,e){return e&&gt(t)?!0:typeof t=="number"&&!isNaN(t)}function Th(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),n=Object.keys(r);let l=!0;return ot(n,i)?(i.forEach(y=>{const{accounts:g,methods:p,events:I,extension:O}=t.namespaces[y],A=xt(g),z=r[y];(!ot(z.chains,A)||!ot(z.methods,p)||!ot(z.events,I))&&(l=!1),l&&O&&O.forEach(C=>{var P;const{accounts:q,methods:$,events:G}=C,b=xt(q);(P=z.extension)!=null&&P.find(D=>ot(D.chains,b)&&ot(D.methods,$)&&ot(D.events,G))||(l=!1)})}),l):!1}function Xi(t){return Ze(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function Ph(t){if(Ze(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&Xi(r)}}return!1}function Ah(t){if(Ze(t,!1))try{return typeof new URL(t)<"u"}catch{return!1}return!1}function Nh(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function Ch(t){return t==null?void 0:t.topic}function Rh(t,e){let r=null;return Ze(t==null?void 0:t.publicKey,!1)||(r=J("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function Zi(t,e){let r=null;return gt(t==null?void 0:t.extension)||(!Fr(t.extension)||!t.extension.length)&&(r=J("MISSING_OR_INVALID",`${e} extension should be an array of namespaces, or omitted`)),r}function cs(t){let e=!0;return Fr(t)?t.length&&(e=t.every(r=>Ze(r,!1))):e=!1,e}function us(t,e,r){let i=null;return Fr(e)?e.forEach(n=>{i||(!Xi(n)||!n.includes(t))&&(i=Je("UNSUPPORTED_CHAINS",`${r}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):i=Je("UNSUPPORTED_CHAINS",`${r}, chains ${e} should be an array of strings conforming to "namespace:chainId" format`),i}function Fh(t,e){let r=null;return Object.entries(t).forEach(([i,n])=>{if(r)return;const l=us(i,n==null?void 0:n.chains,`${e} requiredNamespace`),y=Zi(n,e);l?r=l:y?r=y:n.extension&&n.extension.forEach(g=>{if(r)return;const p=us(i,g.chains,`${e} extension`);p&&(r=p)})}),r}function fs(t,e){let r=null;return Fr(t)?t.forEach(i=>{r||Ph(i)||(r=Je("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=Je("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function Uh(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=fs(i==null?void 0:i.accounts,`${e} namespace`),l=Zi(i,e);n?r=n:l?r=l:i.extension&&i.extension.forEach(y=>{if(r)return;const g=fs(y.accounts,`${e} extension`);g&&(r=g)})}),r}function hs(t,e){let r=null;return cs(t==null?void 0:t.methods)?cs(t==null?void 0:t.events)||(r=Je("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=Je("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function Mo(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=hs(i,`${e}, namespace`),l=Zi(i,e);n?r=n:l?r=l:i.extension&&i.extension.forEach(y=>{if(r)return;const g=hs(y,`${e}, extension`);g&&(r=g)})}),r}function jh(t,e){let r=null;if(t&&jo(t)){const i=Mo(t,e);i&&(r=i);const n=Fh(t,e);n&&(r=n)}else r=J("MISSING_OR_INVALID",`${e}, requiredNamespaces should be an object with data`);return r}function Ei(t,e){let r=null;if(t&&jo(t)){const i=Mo(t,e);i&&(r=i);const n=Uh(t,e);n&&(r=n)}else r=J("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function $o(t){return Ze(t.protocol,!0)}function Lh(t,e){let r=!1;return e&&!t?r=!0:t&&Fr(t)&&t.length&&t.forEach(i=>{r=$o(i)}),r}function Mh(t){return typeof t=="number"}function nt(t){return typeof t<"u"&&typeof t!==null}function $h(t){return!(!t||typeof t!="object"||!t.code||!Lo(t.code,!1)||!t.message||!Ze(t.message,!1))}function zh(t){return!(gt(t)||!Ze(t.method,!1))}function Hh(t){return!(gt(t)||gt(t.result)&&gt(t.error)||!Lo(t.id,!1)||!Ze(t.jsonrpc,!1))}function qh(t){return!(gt(t)||!Ze(t.name,!1))}function ls(t,e){return!(!Xi(e)||!Dh(t).includes(e))}function Kh(t,e,r){return Ze(r,!1)?Sh(t,e).includes(r):!1}function Bh(t,e,r){return Ze(r,!1)?Oh(t,e).includes(r):!1}function ds(t,e,r){let i=null;const n=Object.keys(t),l=Object.keys(e);return ot(n,l)?n.forEach(y=>{var g;if(i)return;const p=t[y].chains,I=xt(e[y].accounts);ot(p,I)?ot(t[y].methods,e[y].methods)?ot(t[y].events,e[y].events)?t[y].extension&&!e[y].extension?i=J("NON_CONFORMING_NAMESPACES",`${r} namespaces extension doesn't satisfy requiredNamespaces extension for ${y}`):t[y].extension&&e[y].extension&&((g=t[y].extension)==null||g.forEach(({methods:O,events:A,chains:z})=>{var C;i||(C=e[y].extension)!=null&&C.find(P=>{const q=xt(P.accounts);return ot(z,q)&&ot(A,P.events)&&ot(O,P.methods)})||(i=J("NON_CONFORMING_NAMESPACES",`${r} namespaces extension doesn't satisfy requiredNamespaces extension for ${y}`))})):i=J("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy requiredNamespaces events for ${y}`):i=J("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy requiredNamespaces methods for ${y}`):i=J("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy requiredNamespaces chains for ${y}`)}):i=J("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces`),i}const Vh="PARSE_ERROR",Gh="INVALID_REQUEST",Wh="METHOD_NOT_FOUND",kh="INVALID_PARAMS",zo="INTERNAL_ERROR",Qi="SERVER_ERROR",Yh=[-32700,-32600,-32601,-32602,-32603],Er={[Vh]:{code:-32700,message:"Parse error"},[Gh]:{code:-32600,message:"Invalid Request"},[Wh]:{code:-32601,message:"Method not found"},[kh]:{code:-32602,message:"Invalid params"},[zo]:{code:-32603,message:"Internal error"},[Qi]:{code:-32e3,message:"Server error"}},Ho=Qi;function Jh(t){return Yh.includes(t)}function gs(t){return Object.keys(Er).includes(t)?Er[t]:Er[Ho]}function Xh(t){const e=Object.values(Er).find(r=>r.code===t);return e||Er[Ho]}function qo(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var Ko={},Ui={},Zh={get exports(){return Ui},set exports(t){Ui=t}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(t){var e,r,i,n,l,y,g,p,I,O,A,z,C,P,q,$,G,b,D,m,w,v,s;(function(h){var H=typeof Pe=="object"?Pe:typeof self=="object"?self:typeof this=="object"?this:{};h(o(H,o(t.exports)));function o(c,f){return c!==H&&(typeof Object.create=="function"?Object.defineProperty(c,"__esModule",{value:!0}):c.__esModule=!0),function(_,d){return c[_]=f?f(_,d):d}}})(function(h){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,c){o.__proto__=c}||function(o,c){for(var f in c)c.hasOwnProperty(f)&&(o[f]=c[f])};e=function(o,c){H(o,c);function f(){this.constructor=o}o.prototype=c===null?Object.create(c):(f.prototype=c.prototype,new f)},r=Object.assign||function(o){for(var c,f=1,_=arguments.length;f<_;f++){c=arguments[f];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(o[d]=c[d])}return o},i=function(o,c){var f={};for(var _ in o)Object.prototype.hasOwnProperty.call(o,_)&&c.indexOf(_)<0&&(f[_]=o[_]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,_=Object.getOwnPropertySymbols(o);d<_.length;d++)c.indexOf(_[d])<0&&Object.prototype.propertyIsEnumerable.call(o,_[d])&&(f[_[d]]=o[_[d]]);return f},n=function(o,c,f,_){var d=arguments.length,u=d<3?c:_===null?_=Object.getOwnPropertyDescriptor(c,f):_,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,c,f,_);else for(var N=o.length-1;N>=0;N--)(x=o[N])&&(u=(d<3?x(u):d>3?x(c,f,u):x(c,f))||u);return d>3&&u&&Object.defineProperty(c,f,u),u},l=function(o,c){return function(f,_){c(f,_,o)}},y=function(o,c){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,c)},g=function(o,c,f,_){function d(u){return u instanceof f?u:new f(function(x){x(u)})}return new(f||(f=Promise))(function(u,x){function N(U){try{E(_.next(U))}catch(B){x(B)}}function M(U){try{E(_.throw(U))}catch(B){x(B)}}function E(U){U.done?u(U.value):d(U.value).then(N,M)}E((_=_.apply(o,c||[])).next())})},p=function(o,c){var f={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},_,d,u,x;return x={next:N(0),throw:N(1),return:N(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function N(E){return function(U){return M([E,U])}}function M(E){if(_)throw new TypeError("Generator is already executing.");for(;f;)try{if(_=1,d&&(u=E[0]&2?d.return:E[0]?d.throw||((u=d.return)&&u.call(d),0):d.next)&&!(u=u.call(d,E[1])).done)return u;switch(d=0,u&&(E=[E[0]&2,u.value]),E[0]){case 0:case 1:u=E;break;case 4:return f.label++,{value:E[1],done:!1};case 5:f.label++,d=E[1],E=[0];continue;case 7:E=f.ops.pop(),f.trys.pop();continue;default:if(u=f.trys,!(u=u.length>0&&u[u.length-1])&&(E[0]===6||E[0]===2)){f=0;continue}if(E[0]===3&&(!u||E[1]>u[0]&&E[1]<u[3])){f.label=E[1];break}if(E[0]===6&&f.label<u[1]){f.label=u[1],u=E;break}if(u&&f.label<u[2]){f.label=u[2],f.ops.push(E);break}u[2]&&f.ops.pop(),f.trys.pop();continue}E=c.call(o,f)}catch(U){E=[6,U],d=0}finally{_=u=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}},s=function(o,c,f,_){_===void 0&&(_=f),o[_]=c[f]},I=function(o,c){for(var f in o)f!=="default"&&!c.hasOwnProperty(f)&&(c[f]=o[f])},O=function(o){var c=typeof Symbol=="function"&&Symbol.iterator,f=c&&o[c],_=0;if(f)return f.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&_>=o.length&&(o=void 0),{value:o&&o[_++],done:!o}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")},A=function(o,c){var f=typeof Symbol=="function"&&o[Symbol.iterator];if(!f)return o;var _=f.call(o),d,u=[],x;try{for(;(c===void 0||c-- >0)&&!(d=_.next()).done;)u.push(d.value)}catch(N){x={error:N}}finally{try{d&&!d.done&&(f=_.return)&&f.call(_)}finally{if(x)throw x.error}}return u},z=function(){for(var o=[],c=0;c<arguments.length;c++)o=o.concat(A(arguments[c]));return o},C=function(){for(var o=0,c=0,f=arguments.length;c<f;c++)o+=arguments[c].length;for(var _=Array(o),d=0,c=0;c<f;c++)for(var u=arguments[c],x=0,N=u.length;x<N;x++,d++)_[d]=u[x];return _},P=function(o){return this instanceof P?(this.v=o,this):new P(o)},q=function(o,c,f){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var _=f.apply(o,c||[]),d,u=[];return d={},x("next"),x("throw"),x("return"),d[Symbol.asyncIterator]=function(){return this},d;function x(K){_[K]&&(d[K]=function(V){return new Promise(function(Q,Y){u.push([K,V,Q,Y])>1||N(K,V)})})}function N(K,V){try{M(_[K](V))}catch(Q){B(u[0][3],Q)}}function M(K){K.value instanceof P?Promise.resolve(K.value.v).then(E,U):B(u[0][2],K)}function E(K){N("next",K)}function U(K){N("throw",K)}function B(K,V){K(V),u.shift(),u.length&&N(u[0][0],u[0][1])}},$=function(o){var c,f;return c={},_("next"),_("throw",function(d){throw d}),_("return"),c[Symbol.iterator]=function(){return this},c;function _(d,u){c[d]=o[d]?function(x){return(f=!f)?{value:P(o[d](x)),done:d==="return"}:u?u(x):x}:u}},G=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=o[Symbol.asyncIterator],f;return c?c.call(o):(o=typeof O=="function"?O(o):o[Symbol.iterator](),f={},_("next"),_("throw"),_("return"),f[Symbol.asyncIterator]=function(){return this},f);function _(u){f[u]=o[u]&&function(x){return new Promise(function(N,M){x=o[u](x),d(N,M,x.done,x.value)})}}function d(u,x,N,M){Promise.resolve(M).then(function(E){u({value:E,done:N})},x)}},b=function(o,c){return Object.defineProperty?Object.defineProperty(o,"raw",{value:c}):o.raw=c,o},D=function(o){if(o&&o.__esModule)return o;var c={};if(o!=null)for(var f in o)Object.hasOwnProperty.call(o,f)&&(c[f]=o[f]);return c.default=o,c},m=function(o){return o&&o.__esModule?o:{default:o}},w=function(o,c){if(!c.has(o))throw new TypeError("attempted to get private field on non-instance");return c.get(o)},v=function(o,c,f){if(!c.has(o))throw new TypeError("attempted to set private field on non-instance");return c.set(o,f),f},h("__extends",e),h("__assign",r),h("__rest",i),h("__decorate",n),h("__param",l),h("__metadata",y),h("__awaiter",g),h("__generator",p),h("__exportStar",I),h("__createBinding",s),h("__values",O),h("__read",A),h("__spread",z),h("__spreadArrays",C),h("__await",P),h("__asyncGenerator",q),h("__asyncDelegator",$),h("__asyncValues",G),h("__makeTemplateObject",b),h("__importStar",D),h("__importDefault",m),h("__classPrivateFieldGet",w),h("__classPrivateFieldSet",v)})})(Zh);var Pt={},ps;function Qh(){if(ps)return Pt;ps=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.isBrowserCryptoAvailable=Pt.getSubtleCrypto=Pt.getBrowerCrypto=void 0;function t(){return(Pe===null||Pe===void 0?void 0:Pe.crypto)||(Pe===null||Pe===void 0?void 0:Pe.msCrypto)||{}}Pt.getBrowerCrypto=t;function e(){const i=t();return i.subtle||i.webkitSubtle}Pt.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return Pt.isBrowserCryptoAvailable=r,Pt}var At={},ys;function el(){if(ys)return At;ys=1,Object.defineProperty(At,"__esModule",{value:!0}),At.isBrowser=At.isNode=At.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}At.isReactNative=t;function e(){return typeof St<"u"&&typeof St.versions<"u"&&typeof St.versions.node<"u"}At.isNode=e;function r(){return!t()&&!e()}return At.isBrowser=r,At}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ui;e.__exportStar(Qh(),t),e.__exportStar(el(),t)})(Ko);function tl(){const t=Date.now()*Math.pow(10,3),e=Math.floor(Math.random()*Math.pow(10,3));return t+e}function si(t,e,r){return{id:r||tl(),jsonrpc:"2.0",method:t,params:e}}function en(t,e){return{id:t,jsonrpc:"2.0",result:e}}function oi(t,e,r){return{id:t,jsonrpc:"2.0",error:rl(e,r)}}function rl(t,e){return typeof t>"u"?gs(zo):(typeof t=="string"&&(t=Object.assign(Object.assign({},gs(Qi)),{message:t})),typeof e<"u"&&(t.data=e),Jh(t.code)&&(t=Xh(t.code)),t)}class il{}class nl extends il{constructor(){super()}}class sl extends nl{constructor(e){super()}}const ol="^https?:",al="^wss?:";function cl(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function Bo(t,e){const r=cl(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function _s(t){return Bo(t,ol)}function bs(t){return Bo(t,al)}function ul(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function Vo(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function tn(t){return Vo(t)&&"method"in t}function rn(t){return Vo(t)&&(Nt(t)||_t(t))}function Nt(t){return"result"in t}function _t(t){return"error"in t}class nn extends sl{constructor(e){super(e),this.events=new ct.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(si(e.method,e.params||[]),r)}async requestStrict(e,r){return new Promise(async(i,n)=>{if(!this.connection.connected)try{await this.open()}catch(l){n(l)}this.events.on(`${e.id}`,l=>{_t(l)?n(l.error):i(l.result)});try{await this.connection.send(e,r)}catch(l){n(l)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),rn(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",()=>this.events.emit("disconnect")),this.connection.on("error",e=>this.events.emit("error",e)),this.hasRegisteredEventListeners=!0)}}const ms=10,fl=()=>typeof fi<"u"&&typeof fi.WebSocket<"u"?fi.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:require("ws"),hl=()=>typeof window<"u",ll=fl();class dl{constructor(e){if(this.url=e,this.events=new ct.EventEmitter,this.registering=!1,!bs(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(typeof this.socket>"u")throw new Error("Connection already closed");this.socket.close(),this.onClose()}async send(e,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Or(e))}catch(i){this.onError(e.id,i)}}register(e=this.url){if(!bs(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,n)=>{this.events.once("register_error",l=>{this.resetMaxListeners(),n(l)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return n(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const n=Ko.isReactNative()?void 0:{rejectUnauthorized:!ul(e)},l=new ll(e,[],n);hl()?l.onerror=y=>{const g=y;i(this.emitError(g.error))}:l.on("error",y=>{i(this.emitError(y))}),l.onopen=()=>{this.onOpen(l),r(l)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=()=>this.onClose(),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(){this.socket=void 0,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Mi(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),n=i.message||i.toString(),l=oi(e,n);this.events.emit("payload",l)}parseError(e,r=this.url){return qo(e,r,"WS")}resetMaxListeners(){this.events.getMaxListeners()>ms&&this.events.setMaxListeners(ms)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for URL: ${this.url}`));return this.events.emit("register_error",r),r}}var Xr={},gl={get exports(){return Xr},set exports(t){Xr=t}};(function(t,e){var r=200,i="__lodash_hash_undefined__",n=1,l=2,y=9007199254740991,g="[object Arguments]",p="[object Array]",I="[object AsyncFunction]",O="[object Boolean]",A="[object Date]",z="[object Error]",C="[object Function]",P="[object GeneratorFunction]",q="[object Map]",$="[object Number]",G="[object Null]",b="[object Object]",D="[object Promise]",m="[object Proxy]",w="[object RegExp]",v="[object Set]",s="[object String]",h="[object Symbol]",H="[object Undefined]",o="[object WeakMap]",c="[object ArrayBuffer]",f="[object DataView]",_="[object Float32Array]",d="[object Float64Array]",u="[object Int8Array]",x="[object Int16Array]",N="[object Int32Array]",M="[object Uint8Array]",E="[object Uint8ClampedArray]",U="[object Uint16Array]",B="[object Uint32Array]",K=/[\\^$.*+?()[\]{}|]/g,V=/^\[object .+?Constructor\]$/,Q=/^(?:0|[1-9]\d*)$/,Y={};Y[_]=Y[d]=Y[u]=Y[x]=Y[N]=Y[M]=Y[E]=Y[U]=Y[B]=!0,Y[g]=Y[p]=Y[c]=Y[O]=Y[f]=Y[A]=Y[z]=Y[C]=Y[q]=Y[$]=Y[b]=Y[w]=Y[v]=Y[s]=Y[o]=!1;var oe=typeof Pe=="object"&&Pe&&Pe.Object===Object&&Pe,L=typeof self=="object"&&self&&self.Object===Object&&self,j=oe||L||Function("return this")(),R=e&&!e.nodeType&&e,a=R&&!0&&t&&!t.nodeType&&t,T=a&&a.exports===R,k=T&&oe.process,X=function(){try{return k&&k.binding&&k.binding("util")}catch{}}(),fe=X&&X.isTypedArray;function ye(S,F){for(var W=-1,Z=S==null?0:S.length,xe=0,ie=[];++W<Z;){var Re=S[W];F(Re,W,S)&&(ie[xe++]=Re)}return ie}function le(S,F){for(var W=-1,Z=F.length,xe=S.length;++W<Z;)S[xe+W]=F[W];return S}function me(S,F){for(var W=-1,Z=S==null?0:S.length;++W<Z;)if(F(S[W],W,S))return!0;return!1}function Fe(S,F){for(var W=-1,Z=Array(S);++W<S;)Z[W]=F(W);return Z}function Ae(S){return function(F){return S(F)}}function pe(S,F){return S.has(F)}function de(S,F){return S==null?void 0:S[F]}function he(S){var F=-1,W=Array(S.size);return S.forEach(function(Z,xe){W[++F]=[xe,Z]}),W}function ce(S,F){return function(W){return S(F(W))}}function ae(S){var F=-1,W=Array(S.size);return S.forEach(function(Z){W[++F]=Z}),W}var se=Array.prototype,ne=Function.prototype,te=Object.prototype,ue=j["__core-js_shared__"],ge=ne.toString,re=te.hasOwnProperty,_e=function(){var S=/[^.]+$/.exec(ue&&ue.keys&&ue.keys.IE_PROTO||"");return S?"Symbol(src)_1."+S:""}(),be=te.toString,ve=RegExp("^"+ge.call(re).replace(K,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ee=T?j.Buffer:void 0,we=j.Symbol,pt=j.Uint8Array,wt=te.propertyIsEnumerable,Ft=se.splice,ut=we?we.toStringTag:void 0,qt=Object.getOwnPropertySymbols,fr=Ee?Ee.isBuffer:void 0,jr=ce(Object.keys,Object),je=tr(j,"DataView"),Ne=tr(j,"Map"),Le=tr(j,"Promise"),Me=tr(j,"Set"),$e=tr(j,"WeakMap"),Ce=tr(Object,"create"),qe=Bt(je),Ke=Bt(Ne),Be=Bt(Le),Ve=Bt(Me),Ge=Bt($e),He=we?we.prototype:void 0,ze=He?He.valueOf:void 0;function Ie(S){var F=-1,W=S==null?0:S.length;for(this.clear();++F<W;){var Z=S[F];this.set(Z[0],Z[1])}}function We(){this.__data__=Ce?Ce(null):{},this.size=0}function ke(S){var F=this.has(S)&&delete this.__data__[S];return this.size-=F?1:0,F}function ua(S){var F=this.__data__;if(Ce){var W=F[S];return W===i?void 0:W}return re.call(F,S)?F[S]:void 0}function fa(S){var F=this.__data__;return Ce?F[S]!==void 0:re.call(F,S)}function ha(S,F){var W=this.__data__;return this.size+=this.has(S)?0:1,W[S]=Ce&&F===void 0?i:F,this}Ie.prototype.clear=We,Ie.prototype.delete=ke,Ie.prototype.get=ua,Ie.prototype.has=fa,Ie.prototype.set=ha;function It(S){var F=-1,W=S==null?0:S.length;for(this.clear();++F<W;){var Z=S[F];this.set(Z[0],Z[1])}}function la(){this.__data__=[],this.size=0}function da(S){var F=this.__data__,W=Mr(F,S);if(W<0)return!1;var Z=F.length-1;return W==Z?F.pop():Ft.call(F,W,1),--this.size,!0}function ga(S){var F=this.__data__,W=Mr(F,S);return W<0?void 0:F[W][1]}function pa(S){return Mr(this.__data__,S)>-1}function ya(S,F){var W=this.__data__,Z=Mr(W,S);return Z<0?(++this.size,W.push([S,F])):W[Z][1]=F,this}It.prototype.clear=la,It.prototype.delete=da,It.prototype.get=ga,It.prototype.has=pa,It.prototype.set=ya;function Kt(S){var F=-1,W=S==null?0:S.length;for(this.clear();++F<W;){var Z=S[F];this.set(Z[0],Z[1])}}function _a(){this.size=0,this.__data__={hash:new Ie,map:new(Ne||It),string:new Ie}}function ba(S){var F=$r(this,S).delete(S);return this.size-=F?1:0,F}function ma(S){return $r(this,S).get(S)}function wa(S){return $r(this,S).has(S)}function va(S,F){var W=$r(this,S),Z=W.size;return W.set(S,F),this.size+=W.size==Z?0:1,this}Kt.prototype.clear=_a,Kt.prototype.delete=ba,Kt.prototype.get=ma,Kt.prototype.has=wa,Kt.prototype.set=va;function Lr(S){var F=-1,W=S==null?0:S.length;for(this.__data__=new Kt;++F<W;)this.add(S[F])}function Ea(S){return this.__data__.set(S,i),this}function Da(S){return this.__data__.has(S)}Lr.prototype.add=Lr.prototype.push=Ea,Lr.prototype.has=Da;function Ut(S){var F=this.__data__=new It(S);this.size=F.size}function Sa(){this.__data__=new It,this.size=0}function Oa(S){var F=this.__data__,W=F.delete(S);return this.size=F.size,W}function xa(S){return this.__data__.get(S)}function Ia(S){return this.__data__.has(S)}function Ta(S,F){var W=this.__data__;if(W instanceof It){var Z=W.__data__;if(!Ne||Z.length<r-1)return Z.push([S,F]),this.size=++W.size,this;W=this.__data__=new Kt(Z)}return W.set(S,F),this.size=W.size,this}Ut.prototype.clear=Sa,Ut.prototype.delete=Oa,Ut.prototype.get=xa,Ut.prototype.has=Ia,Ut.prototype.set=Ta;function Pa(S,F){var W=zr(S),Z=!W&&Ba(S),xe=!W&&!Z&&ui(S),ie=!W&&!Z&&!xe&&bn(S),Re=W||Z||xe||ie,Ye=Re?Fe(S.length,String):[],Xe=Ye.length;for(var Te in S)(F||re.call(S,Te))&&!(Re&&(Te=="length"||xe&&(Te=="offset"||Te=="parent")||ie&&(Te=="buffer"||Te=="byteLength"||Te=="byteOffset")||$a(Te,Xe)))&&Ye.push(Te);return Ye}function Mr(S,F){for(var W=S.length;W--;)if(gn(S[W][0],F))return W;return-1}function Aa(S,F,W){var Z=F(S);return zr(S)?Z:le(Z,W(S))}function hr(S){return S==null?S===void 0?H:G:ut&&ut in Object(S)?La(S):Ka(S)}function fn(S){return lr(S)&&hr(S)==g}function hn(S,F,W,Z,xe){return S===F?!0:S==null||F==null||!lr(S)&&!lr(F)?S!==S&&F!==F:Na(S,F,W,Z,hn,xe)}function Na(S,F,W,Z,xe,ie){var Re=zr(S),Ye=zr(F),Xe=Re?p:jt(S),Te=Ye?p:jt(F);Xe=Xe==g?b:Xe,Te=Te==g?b:Te;var ft=Xe==b,yt=Te==b,tt=Xe==Te;if(tt&&ui(S)){if(!ui(F))return!1;Re=!0,ft=!1}if(tt&&!ft)return ie||(ie=new Ut),Re||bn(S)?ln(S,F,W,Z,xe,ie):Ua(S,F,Xe,W,Z,xe,ie);if(!(W&n)){var ht=ft&&re.call(S,"__wrapped__"),lt=yt&&re.call(F,"__wrapped__");if(ht||lt){var Lt=ht?S.value():S,Tt=lt?F.value():F;return ie||(ie=new Ut),xe(Lt,Tt,W,Z,ie)}}return tt?(ie||(ie=new Ut),ja(S,F,W,Z,xe,ie)):!1}function Ca(S){if(!_n(S)||Ha(S))return!1;var F=pn(S)?ve:V;return F.test(Bt(S))}function Ra(S){return lr(S)&&yn(S.length)&&!!Y[hr(S)]}function Fa(S){if(!qa(S))return jr(S);var F=[];for(var W in Object(S))re.call(S,W)&&W!="constructor"&&F.push(W);return F}function ln(S,F,W,Z,xe,ie){var Re=W&n,Ye=S.length,Xe=F.length;if(Ye!=Xe&&!(Re&&Xe>Ye))return!1;var Te=ie.get(S);if(Te&&ie.get(F))return Te==F;var ft=-1,yt=!0,tt=W&l?new Lr:void 0;for(ie.set(S,F),ie.set(F,S);++ft<Ye;){var ht=S[ft],lt=F[ft];if(Z)var Lt=Re?Z(lt,ht,ft,F,S,ie):Z(ht,lt,ft,S,F,ie);if(Lt!==void 0){if(Lt)continue;yt=!1;break}if(tt){if(!me(F,function(Tt,Vt){if(!pe(tt,Vt)&&(ht===Tt||xe(ht,Tt,W,Z,ie)))return tt.push(Vt)})){yt=!1;break}}else if(!(ht===lt||xe(ht,lt,W,Z,ie))){yt=!1;break}}return ie.delete(S),ie.delete(F),yt}function Ua(S,F,W,Z,xe,ie,Re){switch(W){case f:if(S.byteLength!=F.byteLength||S.byteOffset!=F.byteOffset)return!1;S=S.buffer,F=F.buffer;case c:return!(S.byteLength!=F.byteLength||!ie(new pt(S),new pt(F)));case O:case A:case $:return gn(+S,+F);case z:return S.name==F.name&&S.message==F.message;case w:case s:return S==F+"";case q:var Ye=he;case v:var Xe=Z&n;if(Ye||(Ye=ae),S.size!=F.size&&!Xe)return!1;var Te=Re.get(S);if(Te)return Te==F;Z|=l,Re.set(S,F);var ft=ln(Ye(S),Ye(F),Z,xe,ie,Re);return Re.delete(S),ft;case h:if(ze)return ze.call(S)==ze.call(F)}return!1}function ja(S,F,W,Z,xe,ie){var Re=W&n,Ye=dn(S),Xe=Ye.length,Te=dn(F),ft=Te.length;if(Xe!=ft&&!Re)return!1;for(var yt=Xe;yt--;){var tt=Ye[yt];if(!(Re?tt in F:re.call(F,tt)))return!1}var ht=ie.get(S);if(ht&&ie.get(F))return ht==F;var lt=!0;ie.set(S,F),ie.set(F,S);for(var Lt=Re;++yt<Xe;){tt=Ye[yt];var Tt=S[tt],Vt=F[tt];if(Z)var mn=Re?Z(Vt,Tt,tt,F,S,ie):Z(Tt,Vt,tt,S,F,ie);if(!(mn===void 0?Tt===Vt||xe(Tt,Vt,W,Z,ie):mn)){lt=!1;break}Lt||(Lt=tt=="constructor")}if(lt&&!Lt){var Hr=S.constructor,qr=F.constructor;Hr!=qr&&"constructor"in S&&"constructor"in F&&!(typeof Hr=="function"&&Hr instanceof Hr&&typeof qr=="function"&&qr instanceof qr)&&(lt=!1)}return ie.delete(S),ie.delete(F),lt}function dn(S){return Aa(S,Wa,Ma)}function $r(S,F){var W=S.__data__;return za(F)?W[typeof F=="string"?"string":"hash"]:W.map}function tr(S,F){var W=de(S,F);return Ca(W)?W:void 0}function La(S){var F=re.call(S,ut),W=S[ut];try{S[ut]=void 0;var Z=!0}catch{}var xe=be.call(S);return Z&&(F?S[ut]=W:delete S[ut]),xe}var Ma=qt?function(S){return S==null?[]:(S=Object(S),ye(qt(S),function(F){return wt.call(S,F)}))}:ka,jt=hr;(je&&jt(new je(new ArrayBuffer(1)))!=f||Ne&&jt(new Ne)!=q||Le&&jt(Le.resolve())!=D||Me&&jt(new Me)!=v||$e&&jt(new $e)!=o)&&(jt=function(S){var F=hr(S),W=F==b?S.constructor:void 0,Z=W?Bt(W):"";if(Z)switch(Z){case qe:return f;case Ke:return q;case Be:return D;case Ve:return v;case Ge:return o}return F});function $a(S,F){return F=F??y,!!F&&(typeof S=="number"||Q.test(S))&&S>-1&&S%1==0&&S<F}function za(S){var F=typeof S;return F=="string"||F=="number"||F=="symbol"||F=="boolean"?S!=="__proto__":S===null}function Ha(S){return!!_e&&_e in S}function qa(S){var F=S&&S.constructor,W=typeof F=="function"&&F.prototype||te;return S===W}function Ka(S){return be.call(S)}function Bt(S){if(S!=null){try{return ge.call(S)}catch{}try{return S+""}catch{}}return""}function gn(S,F){return S===F||S!==S&&F!==F}var Ba=fn(function(){return arguments}())?fn:function(S){return lr(S)&&re.call(S,"callee")&&!wt.call(S,"callee")},zr=Array.isArray;function Va(S){return S!=null&&yn(S.length)&&!pn(S)}var ui=fr||Ya;function Ga(S,F){return hn(S,F)}function pn(S){if(!_n(S))return!1;var F=hr(S);return F==C||F==P||F==I||F==m}function yn(S){return typeof S=="number"&&S>-1&&S%1==0&&S<=y}function _n(S){var F=typeof S;return S!=null&&(F=="object"||F=="function")}function lr(S){return S!=null&&typeof S=="object"}var bn=fe?Ae(fe):Ra;function Wa(S){return Va(S)?Pa(S):Fa(S)}function ka(){return[]}function Ya(){return!1}t.exports=Ga})(gl,Xr);function pl(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var l=t.charAt(n),y=l.charCodeAt(0);if(r[y]!==255)throw new TypeError(l+" is ambiguous");r[y]=n}var g=t.length,p=t.charAt(0),I=Math.log(g)/Math.log(256),O=Math.log(256)/Math.log(g);function A(P){if(P instanceof Uint8Array||(ArrayBuffer.isView(P)?P=new Uint8Array(P.buffer,P.byteOffset,P.byteLength):Array.isArray(P)&&(P=Uint8Array.from(P))),!(P instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(P.length===0)return"";for(var q=0,$=0,G=0,b=P.length;G!==b&&P[G]===0;)G++,q++;for(var D=(b-G)*O+1>>>0,m=new Uint8Array(D);G!==b;){for(var w=P[G],v=0,s=D-1;(w!==0||v<$)&&s!==-1;s--,v++)w+=256*m[s]>>>0,m[s]=w%g>>>0,w=w/g>>>0;if(w!==0)throw new Error("Non-zero carry");$=v,G++}for(var h=D-$;h!==D&&m[h]===0;)h++;for(var H=p.repeat(q);h<D;++h)H+=t.charAt(m[h]);return H}function z(P){if(typeof P!="string")throw new TypeError("Expected String");if(P.length===0)return new Uint8Array;var q=0;if(P[q]!==" "){for(var $=0,G=0;P[q]===p;)$++,q++;for(var b=(P.length-q)*I+1>>>0,D=new Uint8Array(b);P[q];){var m=r[P.charCodeAt(q)];if(m===255)return;for(var w=0,v=b-1;(m!==0||w<G)&&v!==-1;v--,w++)m+=g*D[v]>>>0,D[v]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");G=w,q++}if(P[q]!==" "){for(var s=b-G;s!==b&&D[s]===0;)s++;for(var h=new Uint8Array($+(b-s)),H=$;s!==b;)h[H++]=D[s++];return h}}}function C(P){var q=z(P);if(q)return q;throw new Error(`Non-${e} character`)}return{encode:A,decodeUnsafe:z,decode:C}}var yl=pl,_l=yl;const Go=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},bl=t=>new TextEncoder().encode(t),ml=t=>new TextDecoder().decode(t);class wl{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class vl{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Wo(this,e)}}class El{constructor(e){this.decoders=e}or(e){return Wo(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Wo=(t,e)=>new El({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Dl{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new wl(e,r,i),this.decoder=new vl(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ai=({name:t,prefix:e,encode:r,decode:i})=>new Dl(t,e,r,i),Ur=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=_l(r,e);return ai({prefix:t,name:e,encode:i,decode:l=>Go(n(l))})},Sl=(t,e,r,i)=>{const n={};for(let O=0;O<e.length;++O)n[e[O]]=O;let l=t.length;for(;t[l-1]==="=";)--l;const y=new Uint8Array(l*r/8|0);let g=0,p=0,I=0;for(let O=0;O<l;++O){const A=n[t[O]];if(A===void 0)throw new SyntaxError(`Non-${i} character`);p=p<<r|A,g+=r,g>=8&&(g-=8,y[I++]=255&p>>g)}if(g>=r||255&p<<8-g)throw new SyntaxError("Unexpected end of data");return y},Ol=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let l="",y=0,g=0;for(let p=0;p<t.length;++p)for(g=g<<8|t[p],y+=8;y>r;)y-=r,l+=e[n&g>>y];if(y&&(l+=e[n&g<<r-y]),i)for(;l.length*r&7;)l+="=";return l},et=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>ai({prefix:e,name:t,encode(n){return Ol(n,i,r)},decode(n){return Sl(n,i,r,t)}}),xl=ai({prefix:"\0",name:"identity",encode:t=>ml(t),decode:t=>bl(t)});var Il=Object.freeze({__proto__:null,identity:xl});const Tl=et({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Pl=Object.freeze({__proto__:null,base2:Tl});const Al=et({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Nl=Object.freeze({__proto__:null,base8:Al});const Cl=Ur({prefix:"9",name:"base10",alphabet:"0123456789"});var Rl=Object.freeze({__proto__:null,base10:Cl});const Fl=et({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Ul=et({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var jl=Object.freeze({__proto__:null,base16:Fl,base16upper:Ul});const Ll=et({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ml=et({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),$l=et({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),zl=et({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Hl=et({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ql=et({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Kl=et({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Bl=et({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Vl=et({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Gl=Object.freeze({__proto__:null,base32:Ll,base32upper:Ml,base32pad:$l,base32padupper:zl,base32hex:Hl,base32hexupper:ql,base32hexpad:Kl,base32hexpadupper:Bl,base32z:Vl});const Wl=Ur({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),kl=Ur({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Yl=Object.freeze({__proto__:null,base36:Wl,base36upper:kl});const Jl=Ur({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Xl=Ur({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Zl=Object.freeze({__proto__:null,base58btc:Jl,base58flickr:Xl});const Ql=et({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ed=et({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),td=et({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),rd=et({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var id=Object.freeze({__proto__:null,base64:Ql,base64pad:ed,base64url:td,base64urlpad:rd});const ko=Array.from(""),nd=ko.reduce((t,e,r)=>(t[r]=e,t),[]),sd=ko.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function od(t){return t.reduce((e,r)=>(e+=nd[r],e),"")}function ad(t){const e=[];for(const r of t){const i=sd[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const cd=ai({prefix:"",name:"base256emoji",encode:od,decode:ad});var ud=Object.freeze({__proto__:null,base256emoji:cd}),fd=Yo,ws=128,hd=127,ld=~hd,dd=Math.pow(2,31);function Yo(t,e,r){e=e||[],r=r||0;for(var i=r;t>=dd;)e[r++]=t&255|ws,t/=128;for(;t&ld;)e[r++]=t&255|ws,t>>>=7;return e[r]=t|0,Yo.bytes=r-i+1,e}var gd=ji,pd=128,vs=127;function ji(t,i){var r=0,i=i||0,n=0,l=i,y,g=t.length;do{if(l>=g)throw ji.bytes=0,new RangeError("Could not decode varint");y=t[l++],r+=n<28?(y&vs)<<n:(y&vs)*Math.pow(2,n),n+=7}while(y>=pd);return ji.bytes=l-i,r}var yd=Math.pow(2,7),_d=Math.pow(2,14),bd=Math.pow(2,21),md=Math.pow(2,28),wd=Math.pow(2,35),vd=Math.pow(2,42),Ed=Math.pow(2,49),Dd=Math.pow(2,56),Sd=Math.pow(2,63),Od=function(t){return t<yd?1:t<_d?2:t<bd?3:t<md?4:t<wd?5:t<vd?6:t<Ed?7:t<Dd?8:t<Sd?9:10},xd={encode:fd,decode:gd,encodingLength:Od},Jo=xd;const Es=(t,e,r=0)=>(Jo.encode(t,e,r),e),Ds=t=>Jo.encodingLength(t),Li=(t,e)=>{const r=e.byteLength,i=Ds(t),n=i+Ds(r),l=new Uint8Array(n+r);return Es(t,l,0),Es(r,l,i),l.set(e,n),new Id(t,r,e,l)};class Id{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const Xo=({name:t,code:e,encode:r})=>new Td(t,e,r);class Td{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Li(this.code,r):r.then(i=>Li(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Zo=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Pd=Xo({name:"sha2-256",code:18,encode:Zo("SHA-256")}),Ad=Xo({name:"sha2-512",code:19,encode:Zo("SHA-512")});var Nd=Object.freeze({__proto__:null,sha256:Pd,sha512:Ad});const Qo=0,Cd="identity",ea=Go,Rd=t=>Li(Qo,ea(t)),Fd={code:Qo,name:Cd,encode:ea,digest:Rd};var Ud=Object.freeze({__proto__:null,identity:Fd});new TextEncoder,new TextDecoder;const Ss={...Il,...Pl,...Nl,...Rl,...jl,...Gl,...Yl,...Zl,...id,...ud};({...Nd,...Ud});function jd(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function ta(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Os=ta("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Di=ta("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=jd(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Ld={utf8:Os,"utf-8":Os,hex:Ss.base16,latin1:Di,ascii:Di,binary:Di,...Ss};function Md(t,e="utf8"){const r=Ld[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}const ra="wc",$d=2,sn="core",zt=`${ra}@${2}:${sn}:`,zd={name:sn,logger:"error"},Hd={database:":memory:"},qd="crypto",xs="client_ed25519_seed",Kd=ee.ONE_DAY,Bd="keychain",Vd="0.3",Gd="messages",Wd="0.3",kd=ee.SIX_HOURS,Yd="publisher",ia="irn",Jd="error",Xd="wss://relay.walletconnect.com",Zd="relayer",st={message:"relayer_message",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed"},Qd="_subscription",Br={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Is=ee.ONE_SECOND,eg="2.1.3",tg="0.3",Dt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},rg="subscription",ig="0.3",ng=ee.FIVE_SECONDS*1e3,sg="pairing",og="0.3",mr={wc_pairingDelete:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:0},res:{ttl:ee.ONE_DAY,prompt:!1,tag:0}}},Et={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},ag="history",cg="0.3",ug="expirer",dt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},fg="0.3";class hg{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=Bd,this.version=Vd,this.initialized=!1,this.storagePrefix=zt,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,n)=>{this.isInitialized(),this.keychain.set(i,n),await this.persist()},this.get=i=>{this.isInitialized();const n=this.keychain.get(i);if(typeof n>"u"){const{message:l}=J("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(l)}return n},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=De.generateChildLogger(r,this.name)}get context(){return De.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,No(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Co(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}class lg{constructor(e,r,i){this.core=e,this.logger=r,this.name=qd,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=n=>(this.isInitialized(),this.keychain.has(n)),this.getClientId=async()=>{this.isInitialized();const n=await this.getClientSeed(),l=Vn(n);return go(l.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const n=Bf();return this.setPrivateKey(n.publicKey,n.privateKey)},this.signJWT=async n=>{this.isInitialized();const l=await this.getClientSeed(),y=Vn(l),g=Ni();return await nf(g,n,Kd,y)},this.generateSharedKey=(n,l,y)=>{this.isInitialized();const g=this.getPrivateKey(n),p=Vf(g,l);return this.setSymKey(p,y)},this.setSymKey=async(n,l)=>{this.isInitialized();const y=l||Gf(n);return await this.keychain.set(y,n),y},this.deleteKeyPair=async n=>{this.isInitialized(),await this.keychain.del(n)},this.deleteSymKey=async n=>{this.isInitialized(),await this.keychain.del(n)},this.encode=async(n,l,y)=>{this.isInitialized();const g=Po(y),p=Or(l);if(rs(g)){const z=g.senderPublicKey,C=g.receiverPublicKey;n=await this.generateSharedKey(z,C)}const I=this.getSymKey(n),{type:O,senderPublicKey:A}=g;return kf({type:O,symKey:I,message:p,senderPublicKey:A})},this.decode=async(n,l,y)=>{this.isInitialized();const g=Xf(l,y);if(rs(g)){const O=g.receiverPublicKey,A=g.senderPublicKey;n=await this.generateSharedKey(O,A)}const p=this.getSymKey(n),I=Yf({symKey:p,encoded:l});return Mi(I)},this.core=e,this.logger=De.generateChildLogger(r,this.name),this.keychain=i||new hg(this.core,this.logger)}get context(){return De.getLoggerContext(this.logger)}getPayloadType(e){const r=Ji(e);return Rr(r.type)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(xs)}catch{e=Ni(),await this.keychain.set(xs,e)}return Md(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}class dg extends $c{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=Gd,this.version=Wd,this.initialized=!1,this.storagePrefix=zt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,n)=>{this.isInitialized();const l=Ci(n);let y=this.messages.get(i);return typeof y>"u"&&(y={}),typeof y[l]<"u"||(y[l]=n,this.messages.set(i,y),await this.persist()),l},this.get=i=>{this.isInitialized();let n=this.messages.get(i);return typeof n>"u"&&(n={}),n},this.has=(i,n)=>{this.isInitialized();const l=this.get(i),y=Ci(n);return typeof l[y]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=De.generateChildLogger(e,this.name),this.core=r}get context(){return De.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,No(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Co(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}class gg extends zc{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new ct.EventEmitter,this.name=Yd,this.queue=new Map,this.publishTimeout=1e4,this.publish=async(i,n,l)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:l}});try{const y=(l==null?void 0:l.ttl)||kd,g=Ri(l),p=(l==null?void 0:l.prompt)||!1,I=(l==null?void 0:l.tag)||0,O={topic:i,message:n,opts:{ttl:y,relay:g,prompt:p,tag:I}},A=Ci(n);this.queue.set(A,O);try{await await Ro(this.rpcPublish(i,n,y,g,p,I),this.publishTimeout)}catch{this.logger.debug("Publishing Payload stalled"),this.relayer.events.emit(st.connection_stalled);return}this.onPublish(A,O),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:l}})}catch(y){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(y),y}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.relayer=e,this.logger=De.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return De.getLoggerContext(this.logger)}rpcPublish(e,r,i,n,l,y){var g,p,I,O;const A={method:Fi(n.protocol).publish,params:{topic:e,message:r,ttl:i,prompt:l,tag:y}};return gt((g=A.params)==null?void 0:g.prompt)&&((p=A.params)==null||delete p.prompt),gt((I=A.params)==null?void 0:I.tag)&&((O=A.params)==null||delete O.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:A}),this.relayer.provider.request(A)}onPublish(e,r){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:r,message:i,opts:n}=e;await this.publish(r,i,n)})}registerEventListeners(){this.relayer.core.heartbeat.on(Ar.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()})}}class pg{constructor(){this.map=new Map,this.set=(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const n=i.filter(l=>l!==r);if(!n.length){this.map.delete(e);return}this.map.set(e,n)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var yg=Object.defineProperty,_g=Object.defineProperties,bg=Object.getOwnPropertyDescriptors,Ts=Object.getOwnPropertySymbols,mg=Object.prototype.hasOwnProperty,wg=Object.prototype.propertyIsEnumerable,Ps=(t,e,r)=>e in t?yg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Vr=(t,e)=>{for(var r in e||(e={}))mg.call(e,r)&&Ps(t,r,e[r]);if(Ts)for(var r of Ts(e))wg.call(e,r)&&Ps(t,r,e[r]);return t},Si=(t,e)=>_g(t,bg(e));class vg extends Kc{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new pg,this.events=new ct.EventEmitter,this.name=rg,this.version=ig,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pendingSubInterval=20,this.storagePrefix=zt,this.subscribeTimeout=1e4,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable())},this.subscribe=async(i,n)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}});try{const l=Ri(n),y={topic:i,relay:l};this.pending.set(i,y);const g=await this.rpcSubscribe(i,l);return this.onSubscribe(g,y),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}}),g}catch(l){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(l),l}},this.unsubscribe=async(i,n)=>{this.isInitialized(),typeof(n==null?void 0:n.id)<"u"?await this.unsubscribeById(i,n.id,n):await this.unsubscribeByTopic(i,n)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((n,l)=>{const y=new ee.Watch;y.start(this.pendingSubscriptionWatchLabel);const g=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(g),y.stop(this.pendingSubscriptionWatchLabel),n(!0)),y.elapsed(this.pendingSubscriptionWatchLabel)>=ng&&(clearInterval(g),y.stop(this.pendingSubscriptionWatchLabel),l(!1))},this.pendingSubInterval)}),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.restart=async()=>{await this.restore(),await this.reset()},this.relayer=e,this.logger=De.generateChildLogger(r,this.name)}get context(){return De.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear(),this.initialized=!1}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async n=>await this.unsubscribeById(e,n,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const n=Ri(i);await this.rpcUnsubscribe(e,r,n);const l=Je("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,l),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,r){const i={method:Fi(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let n;try{n=await await Ro(this.relayer.provider.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(st.connection_stalled)}return n}rpcUnsubscribe(e,r,i){const n={method:Fi(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.provider.request(n)}onSubscribe(e,r){this.setSubscription(e,Si(Vr({},r),{id:e})),this.pending.delete(r.topic)}onResubscribe(e,r){this.addSubscription(e,Si(Vr({},r),{id:e})),this.pending.delete(r.topic)}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r))}addSubscription(e,r){this.subscriptions.set(e,Vr({},r)),this.topicMap.set(r.topic,e),this.events.emit(Dt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(Dt.deleted,Si(Vr({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Dt.sync)}async reset(){this.cached.length&&await Promise.all(this.cached.map(async e=>await this.resubscribe(e))),this.events.emit(Dt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async resubscribe(e){if(!this.ids.includes(e.id)){const{topic:r,relay:i}=e,n={topic:r,relay:i};this.pending.set(n.topic,n);const l=await this.rpcSubscribe(n.topic,n.relay);this.onResubscribe(l,n)}}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}checkPending(){this.relayer.transportExplicitlyClosed||this.pending.forEach(async e=>{const r=await this.rpcSubscribe(e.topic,e.relay);this.onSubscribe(r,e)})}registerEventListeners(){this.relayer.core.heartbeat.on(Ar.HEARTBEAT_EVENTS.pulse,()=>{this.checkPending()}),this.relayer.on(st.connect,async()=>{await this.onConnect()}),this.relayer.on(st.disconnect,()=>{this.onDisconnect()}),this.events.on(Dt.created,async e=>{const r=Dt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on(Dt.deleted,async e=>{const r=Dt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Eg=Object.defineProperty,As=Object.getOwnPropertySymbols,Dg=Object.prototype.hasOwnProperty,Sg=Object.prototype.propertyIsEnumerable,Ns=(t,e,r)=>e in t?Eg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Og=(t,e)=>{for(var r in e||(e={}))Dg.call(e,r)&&Ns(t,r,e[r]);if(As)for(var r of As(e))Sg.call(e,r)&&Ns(t,r,e[r]);return t};class xg extends Hc{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new ct.EventEmitter,this.name=Zd,this.transportExplicitlyClosed=!1,this.initialized=!1,this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?De.generateChildLogger(e.logger,this.name):Tr(De.getDefaultLoggerOptions({level:e.logger||Jd})),this.messages=new dg(this.logger,e.core),this.subscriber=new vg(this,this.logger),this.publisher=new gg(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Xd,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.provider=await this.createProvider(),await Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0}get context(){return De.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r})}async subscribe(e,r){this.isInitialized();let i="";return await Promise.all([new Promise(n=>{this.subscriber.once(Dt.created,l=>{l.topic===e&&n()})}),new Promise(async n=>{i=await this.subscriber.subscribe(e,r),n()})]),i}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&await this.provider.disconnect(),this.events.emit(st.transport_closed)}async transportOpen(e){this.relayUrl=e||this.relayUrl,this.transportExplicitlyClosed=!1;try{await Promise.all([new Promise(r=>{this.initialized||r(),this.subscriber.once(Dt.resubscribed,()=>{r()})}),await Promise.race([this.provider.connect(),new Promise((r,i)=>this.once(st.transport_closed,()=>{i()}))])])}catch(r){const i=r;if(!/socket hang up/i.test(i.message))throw new Error(i.message);this.logger.error(i),this.events.emit(st.transport_closed)}}async restartTransport(e){await this.transportClose(),await new Promise(r=>setTimeout(r,Is)),await this.transportOpen(e)}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);return new nn(new dl(hh({sdkVersion:eg,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e})))}async recordMessageEvent(e){const{topic:r,message:i}=e;await this.messages.set(r,i)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;return await this.subscriber.isSubscribed(r)?this.messages.has(r,i):!0}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),tn(e)){if(!e.method.endsWith(Qd))return;const r=e.params,{topic:i,message:n}=r.data,l={topic:i,message:n};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Og({type:"event",event:r.id},l)),this.events.emit(r.id,l),await this.acknowledgePayload(e),await this.onMessageEvent(l)}}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(st.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=en(e.id,!0);await this.provider.connection.send(r)}registerEventListeners(){this.provider.on(Br.payload,e=>this.onProviderPayload(e)),this.provider.on(Br.connect,()=>{this.events.emit(st.connect)}),this.provider.on(Br.disconnect,()=>{this.events.emit(st.disconnect),this.attemptToReconnect()}),this.provider.on(Br.error,e=>this.events.emit(st.error,e)),this.events.on(st.connection_stalled,async()=>{await this.restartTransport()})}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.transportOpen()},ee.toMiliseconds(Is))}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Ig=Object.defineProperty,Cs=Object.getOwnPropertySymbols,Tg=Object.prototype.hasOwnProperty,Pg=Object.prototype.propertyIsEnumerable,Rs=(t,e,r)=>e in t?Ig(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Fs=(t,e)=>{for(var r in e||(e={}))Tg.call(e,r)&&Rs(t,r,e[r]);if(Cs)for(var r of Cs(e))Pg.call(e,r)&&Rs(t,r,e[r]);return t};class ci extends qc{constructor(e,r,i,n=zt,l=void 0){super(e,r,i,n),this.core=e,this.logger=r,this.name=i,this.map=new Map,this.version=tg,this.cached=[],this.initialized=!1,this.storagePrefix=zt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(y=>{Nh(y)?this.map.set(y.id,y):Ch(y)?this.map.set(y.topic,y):this.getKey&&y!==null&&!gt(y)&&this.map.set(this.getKey(y),y)}),this.cached=[],this.initialized=!0)},this.set=async(y,g)=>{this.isInitialized(),this.map.has(y)?await this.update(y,g):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:y,value:g}),this.map.set(y,g),await this.persist())},this.get=y=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:y}),this.getData(y)),this.getAll=y=>(this.isInitialized(),y?this.values.filter(g=>Object.keys(y).every(p=>Xr(g[p],y[p]))):this.values),this.update=async(y,g)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:y,update:g});const p=Fs(Fs({},this.getData(y)),g);this.map.set(y,p),await this.persist()},this.delete=async(y,g)=>{this.isInitialized(),this.map.has(y)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:y,reason:g}),this.map.delete(y),await this.persist())},this.logger=De.generateChildLogger(r,this.name),this.storagePrefix=n,this.getKey=l}get context(){return De.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){const{message:i}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Ag{constructor(e,r){this.core=e,this.logger=r,this.name=sg,this.version=og,this.events=new ct,this.initialized=!1,this.storagePrefix=zt,this.ignoredPayloadTypes=[Qt],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=Ni(),n=await this.core.crypto.setSymKey(i),l=Ct(ee.FIVE_MINUTES),y={protocol:ia},g={topic:n,expiry:l,relay:y,active:!1},p=Eh({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:i,relay:y});return await this.pairings.set(n,g),await this.core.relayer.subscribe(n),this.core.expirer.set(n,l),{topic:n,uri:p}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:n,symKey:l,relay:y}=wh(i.uri),g=Ct(ee.FIVE_MINUTES),p={topic:n,relay:y,expiry:g,active:!1};return await this.pairings.set(n,p),await this.core.crypto.setSymKey(l,n),await this.core.relayer.subscribe(n,{relay:y}),this.core.expirer.set(n,g),i.activatePairing&&await this.activate({topic:n}),p},this.activate=async({topic:i})=>{this.isInitialized();const n=Ct(ee.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:n}),this.core.expirer.set(i,n)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:n}=i;if(this.pairings.keys.includes(n)){const l=await this.sendRequest(n,"wc_pairingPing",{}),{done:y,resolve:g,reject:p}=Jt();this.events.once(Ue("pairing_ping",l),({error:I})=>{I?p(I):g()}),await y()}},this.updateExpiry=async({topic:i,expiry:n})=>{this.isInitialized(),await this.pairings.update(i,{expiry:n})},this.updateMetadata=async({topic:i,metadata:n})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:n})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",Je("USER_DISCONNECTED")),await this.deletePairing(n))},this.sendRequest=async(i,n,l)=>{const y=si(n,l),g=await this.core.crypto.encode(i,y),p=mr[n].req;return this.core.history.set(i,y),await this.core.relayer.publish(i,g,p),y.id},this.sendResult=async(i,n,l)=>{const y=en(i,l),g=await this.core.crypto.encode(n,y),p=await this.core.history.get(n,i),I=mr[p.request.method].res;await this.core.relayer.publish(n,g,I),await this.core.history.resolve(y)},this.sendError=async(i,n,l)=>{const y=oi(i,l),g=await this.core.crypto.encode(n,y),p=await this.core.history.get(n,i),I=mr[p.request.method]?mr[p.request.method].res:mr.unregistered_method.res;await this.core.relayer.publish(n,g,I),await this.core.history.resolve(y)},this.deletePairing=async(i,n)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,Je("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),n?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(n=>$t(n.expiry));await Promise.all(i.map(n=>this.deletePairing(n.topic)))},this.onRelayEventRequest=i=>{const{topic:n,payload:l}=i;switch(l.method){case"wc_pairingPing":return this.onPairingPingRequest(n,l);case"wc_pairingDelete":return this.onPairingDeleteRequest(n,l);default:return this.onUnknownRpcMethodRequest(n,l)}},this.onRelayEventResponse=async i=>{const{topic:n,payload:l}=i,y=(await this.core.history.get(n,l.id)).request.method;switch(y){case"wc_pairingPing":return this.onPairingPingResponse(n,l);default:return this.onUnknownRpcMethodResponse(y)}},this.onPairingPingRequest=async(i,n)=>{const{id:l}=n;try{this.isValidPing({topic:i}),await this.sendResult(l,i,!0),this.events.emit("pairing_ping",{id:l,topic:i})}catch(y){await this.sendError(l,i,y),this.logger.error(y)}},this.onPairingPingResponse=(i,n)=>{const{id:l}=n;setTimeout(()=>{Nt(n)?this.events.emit(Ue("pairing_ping",l),{}):_t(n)&&this.events.emit(Ue("pairing_ping",l),{error:n.error})},500)},this.onPairingDeleteRequest=async(i,n)=>{const{id:l}=n;try{this.isValidDisconnect({topic:i}),await this.sendResult(l,i,!0),await this.deletePairing(i),this.events.emit("pairing_delete",{id:l,topic:i})}catch(y){await this.sendError(l,i,y),this.logger.error(y)}},this.onUnknownRpcMethodRequest=async(i,n)=>{const{id:l,method:y}=n;try{if(this.registeredMethods.includes(y))return;const g=Je("WC_METHOD_UNSUPPORTED",y);await this.sendError(l,i,g),this.logger.error(g)}catch(g){await this.sendError(l,i,g),this.logger.error(g)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(Je("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{if(!nt(i)){const{message:n}=J("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(n)}if(!Ah(i.uri)){const{message:n}=J("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(n)}},this.isValidPing=async i=>{if(!nt(i)){const{message:l}=J("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(l)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidDisconnect=async i=>{if(!nt(i)){const{message:l}=J("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(l)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidPairingTopic=async i=>{if(!Ze(i,!1)){const{message:n}=J("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(n)}if(!this.pairings.keys.includes(i)){const{message:n}=J("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(n)}if($t(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:n}=J("EXPIRED",`pairing topic: ${i}`);throw new Error(n)}},this.core=e,this.logger=De.generateChildLogger(r,this.name),this.pairings=new ci(this.core,this.logger,this.name,this.storagePrefix)}get context(){return De.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(st.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const n=await this.core.crypto.decode(r,i);tn(n)?(this.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):rn(n)&&(await this.core.history.resolve(n),this.onRelayEventResponse({topic:r,payload:n}))})}registerExpirerEvents(){this.core.expirer.on(dt.expired,async e=>{const{topic:r}=Uo(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit("pairing_expire",{topic:r}))})}}class Ng extends Mc{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new ct.EventEmitter,this.name=ag,this.version=cg,this.cached=[],this.initialized=!1,this.storagePrefix=zt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,n,l)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:n,chainId:l}),this.records.has(n.id))return;const y={id:n.id,topic:i,request:{method:n.method,params:n.params||null},chainId:l};this.records.set(y.id,y),this.events.emit(Et.created,y)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const n=await this.getRecord(i.id);typeof n.response>"u"&&(n.response=_t(i)?{error:i.error}:{result:i.result},this.records.set(n.id,n),this.events.emit(Et.updated,n))},this.get=async(i,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:n}),await this.getRecord(n)),this.delete=(i,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(l=>{if(l.topic===i){if(typeof n<"u"&&l.id!==n)return;this.records.delete(l.id),this.events.emit(Et.deleted,l)}})},this.exists=async(i,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===i:!1),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=De.generateChildLogger(r,this.name)}get context(){return De.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:si(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Et.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Et.created,e=>{const r=Et.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(Et.updated,e=>{const r=Et.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(Et.deleted,e=>{const r=Et.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Cg extends Bc{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new ct.EventEmitter,this.name=ug,this.version=fg,this.cached=[],this.initialized=!1,this.storagePrefix=zt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const n=this.formatTarget(i);return typeof this.getExpiration(n)<"u"}catch{return!1}},this.set=(i,n)=>{this.isInitialized();const l=this.formatTarget(i),y={target:l,expiry:n};this.expirations.set(l,y),this.checkExpiry(l,y),this.events.emit(dt.created,{target:l,expiration:y})},this.get=i=>{this.isInitialized();const n=this.formatTarget(i);return this.getExpiration(n)},this.del=i=>{this.isInitialized();const n=this.formatTarget(i);if(this.has(n)){const l=this.getExpiration(n);this.expirations.delete(n),this.events.emit(dt.deleted,{target:n,expiration:l})}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=De.generateChildLogger(r,this.name)}get context(){return De.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return lh(e);if(typeof e=="number")return dh(e);const{message:r}=J("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(dt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=J("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=J("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;ee.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(dt.expired,{target:e,expiration:r})}checkExpirations(){this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Ar.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(dt.created,e=>{const r=dt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(dt.expired,e=>{const r=dt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(dt.deleted,e=>{const r=dt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Rg=Object.defineProperty,Us=Object.getOwnPropertySymbols,Fg=Object.prototype.hasOwnProperty,Ug=Object.prototype.propertyIsEnumerable,js=(t,e,r)=>e in t?Rg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ls=(t,e)=>{for(var r in e||(e={}))Fg.call(e,r)&&js(t,r,e[r]);if(Us)for(var r of Us(e))Ug.call(e,r)&&js(t,r,e[r]);return t};class on extends Lc{constructor(e){super(e),this.protocol=ra,this.version=$d,this.name=sn,this.events=new ct.EventEmitter,this.initialized=!1,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.projectId=e==null?void 0:e.projectId;const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Tr(De.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||zd.logger}));this.logger=De.generateChildLogger(r,this.name),this.heartbeat=new Ar.HeartBeat,this.crypto=new lg(this,this.logger,e==null?void 0:e.keychain),this.history=new Ng(this,this.logger),this.expirer=new Cg(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new mc(Ls(Ls({},Hd),e==null?void 0:e.storageOptions)),this.relayer=new xg({core:this,logger:this.logger,relayUrl:e==null?void 0:e.relayUrl,projectId:this.projectId}),this.pairing=new Ag(this,this.logger)}static async init(e){const r=new on(e);return await r.initialize(),r}get context(){return De.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initilization Success")}catch(e){throw this.logger.warn(`Core Initilization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const jg=on,na="wc",sa=2,oa="client",an=`${na}@${sa}:${oa}:`,Oi={name:oa,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Lg="proposal",Mg="session",Gr=ee.SEVEN_DAYS,$g="engine",wr={wc_sessionPropose:{req:{ttl:ee.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ee.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ee.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1115}}},zg="request";var Hg=Object.defineProperty,qg=Object.defineProperties,Kg=Object.getOwnPropertyDescriptors,Ms=Object.getOwnPropertySymbols,Bg=Object.prototype.hasOwnProperty,Vg=Object.prototype.propertyIsEnumerable,$s=(t,e,r)=>e in t?Hg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Mt=(t,e)=>{for(var r in e||(e={}))Bg.call(e,r)&&$s(t,r,e[r]);if(Ms)for(var r of Ms(e))Vg.call(e,r)&&$s(t,r,e[r]);return t},zs=(t,e)=>qg(t,Kg(e));class Gg extends Gc{constructor(e){super(e),this.name=$g,this.events=new ct,this.initialized=!1,this.ignoredPayloadTypes=[Qt],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(wr)}),this.initialized=!0)},this.connect=async r=>{this.isInitialized(),await this.isValidConnect(r);const{pairingTopic:i,requiredNamespaces:n,relays:l}=r;let y=i,g,p=!1;if(y&&(p=this.client.core.pairing.pairings.get(y).active),!y||!p){const{topic:$,uri:G}=await this.client.core.pairing.create();y=$,g=G}const I=await this.client.core.crypto.generateKeyPair(),O={requiredNamespaces:n,relays:l??[{protocol:ia}],proposer:{publicKey:I,metadata:this.client.metadata}},{reject:A,resolve:z,done:C}=Jt();if(this.events.once(Ue("session_connect"),async({error:$,session:G})=>{if($)A($);else if(G){G.self.publicKey=I;const b=zs(Mt({},G),{requiredNamespaces:n});await this.client.session.set(G.topic,b),await this.setExpiry(G.topic,G.expiry),y&&await this.client.core.pairing.updateMetadata({topic:y,metadata:G.peer.metadata}),z(b)}}),!y){const{message:$}=J("NO_MATCHING_KEY",`connect() pairing topic: ${y}`);throw new Error($)}const P=await this.sendRequest(y,"wc_sessionPropose",O),q=Ct(ee.FIVE_MINUTES);return await this.setProposal(P,Mt({id:P,expiry:q},O)),{uri:g,approval:C}},this.pair=async r=>(this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{this.isInitialized(),await this.isValidApprove(r);const{id:i,relayProtocol:n,namespaces:l}=r,{pairingTopic:y,proposer:g,requiredNamespaces:p}=this.client.proposal.get(i),I=await this.client.core.crypto.generateKeyPair(),O=g.publicKey,A=await this.client.core.crypto.generateSharedKey(I,O),z={relay:{protocol:n??"irn"},namespaces:l,requiredNamespaces:p,controller:{publicKey:I,metadata:this.client.metadata},expiry:Ct(Gr)};await this.client.core.relayer.subscribe(A);const C=await this.sendRequest(A,"wc_sessionSettle",z),{done:P,resolve:q,reject:$}=Jt();this.events.once(Ue("session_approve",C),({error:b})=>{b?$(b):q(this.client.session.get(A))});const G=zs(Mt({},z),{topic:A,acknowledged:!1,self:z.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:I});return await this.client.session.set(A,G),await this.setExpiry(A,Ct(Gr)),y&&await this.client.core.pairing.updateMetadata({topic:y,metadata:G.peer.metadata}),y&&i&&(await this.sendResult(i,y,{relay:{protocol:n??"irn"},responderPublicKey:I}),await this.client.proposal.delete(i,Je("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:y})),{topic:A,acknowledged:P}},this.reject=async r=>{this.isInitialized(),await this.isValidReject(r);const{id:i,reason:n}=r,{pairingTopic:l}=this.client.proposal.get(i);l&&(await this.sendError(i,l,n),await this.client.proposal.delete(i,Je("USER_DISCONNECTED")))},this.update=async r=>{this.isInitialized(),await this.isValidUpdate(r);const{topic:i,namespaces:n}=r,l=await this.sendRequest(i,"wc_sessionUpdate",{namespaces:n}),{done:y,resolve:g,reject:p}=Jt();return this.events.once(Ue("session_update",l),({error:I})=>{I?p(I):g()}),await this.client.session.update(i,{namespaces:n}),{acknowledged:y}},this.extend=async r=>{this.isInitialized(),await this.isValidExtend(r);const{topic:i}=r,n=await this.sendRequest(i,"wc_sessionExtend",{}),{done:l,resolve:y,reject:g}=Jt();return this.events.once(Ue("session_extend",n),({error:p})=>{p?g(p):y()}),await this.setExpiry(i,Ct(Gr)),{acknowledged:l}},this.request=async r=>{this.isInitialized(),await this.isValidRequest(r);const{chainId:i,request:n,topic:l}=r,y=await this.sendRequest(l,"wc_sessionRequest",{request:n,chainId:i}),{done:g,resolve:p,reject:I}=Jt();return this.events.once(Ue("session_request",y),({error:O,result:A})=>{O?I(O):p(A)}),await g()},this.respond=async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:n}=r,{id:l}=n;Nt(n)?await this.sendResult(l,i,n.result):_t(n)&&await this.sendError(l,i,n.error),this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0})},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:i}=r;if(this.client.session.keys.includes(i)){const n=await this.sendRequest(i,"wc_sessionPing",{}),{done:l,resolve:y,reject:g}=Jt();this.events.once(Ue("session_ping",n),({error:p})=>{p?g(p):y()}),await l()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async r=>{this.isInitialized(),await this.isValidEmit(r);const{topic:i,event:n,chainId:l}=r;await this.sendRequest(i,"wc_sessionEvent",{event:n,chainId:l})},this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;this.client.session.keys.includes(i)?(await this.sendRequest(i,"wc_sessionDelete",Je("USER_DISCONNECTED")),await this.deleteSession(i)):await this.client.core.pairing.disconnect({topic:i})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(i=>Th(i,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.deleteSession=async(r,i)=>{const{self:n}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),await Promise.all([this.client.session.delete(r,Je("USER_DISCONNECTED")),this.client.core.crypto.deleteKeyPair(n.publicKey),this.client.core.crypto.deleteSymKey(r),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deleteProposal=async(r,i)=>{await Promise.all([this.client.proposal.delete(r,Je("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,i,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),n?Promise.resolve():this.client.core.expirer.del(r)])},this.setExpiry=async(r,i)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:i}),this.client.core.expirer.set(r,i)},this.setProposal=async(r,i)=>{await this.client.proposal.set(r,i),this.client.core.expirer.set(r,i.expiry)},this.setPendingSessionRequest=async r=>{const i=wr.wc_sessionRequest.req.ttl,{id:n,topic:l,params:y}=r;await this.client.pendingRequest.set(n,{id:n,topic:l,params:y}),i&&this.client.core.expirer.set(n,i)},this.sendRequest=async(r,i,n)=>{const l=si(i,n),y=await this.client.core.crypto.encode(r,l),g=wr[i].req;return this.client.core.history.set(r,l),this.client.core.relayer.publish(r,y,g),l.id},this.sendResult=async(r,i,n)=>{const l=en(r,n),y=await this.client.core.crypto.encode(i,l),g=await this.client.core.history.get(i,r),p=wr[g.request.method].res;this.client.core.relayer.publish(i,y,p),await this.client.core.history.resolve(l)},this.sendError=async(r,i,n)=>{const l=oi(r,n),y=await this.client.core.crypto.encode(i,l),g=await this.client.core.history.get(i,r),p=wr[g.request.method].res;this.client.core.relayer.publish(i,y,p),await this.client.core.history.resolve(l)},this.cleanup=async()=>{const r=[],i=[];this.client.session.getAll().forEach(n=>{$t(n.expiry)&&r.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{$t(n.expiry)&&i.push(n.id)}),await Promise.all([...r.map(n=>this.deleteSession(n)),...i.map(n=>this.deleteProposal(n))])},this.onRelayEventRequest=r=>{const{topic:i,payload:n}=r,l=n.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeRequest(i,n);case"wc_sessionSettle":return this.onSessionSettleRequest(i,n);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,n);case"wc_sessionExtend":return this.onSessionExtendRequest(i,n);case"wc_sessionPing":return this.onSessionPingRequest(i,n);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,n);case"wc_sessionRequest":return this.onSessionRequest(i,n);case"wc_sessionEvent":return this.onSessionEventRequest(i,n);default:return this.client.logger.info(`Unsupported request method ${l}`)}},this.onRelayEventResponse=async r=>{const{topic:i,payload:n}=r,l=(await this.client.core.history.get(i,n.id)).request.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeResponse(i,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,n);case"wc_sessionExtend":return this.onSessionExtendResponse(i,n);case"wc_sessionPing":return this.onSessionPingResponse(i,n);case"wc_sessionRequest":return this.onSessionRequestResponse(i,n);default:return this.client.logger.info(`Unsupported response method ${l}`)}},this.onSessionProposeRequest=async(r,i)=>{const{params:n,id:l}=i;try{this.isValidConnect(Mt({},i.params));const y=Ct(ee.FIVE_MINUTES),g=Mt({id:l,pairingTopic:r,expiry:y},n);await this.setProposal(l,g),this.client.events.emit("session_proposal",{id:l,params:g})}catch(y){await this.sendError(l,r,y),this.client.logger.error(y)}},this.onSessionProposeResponse=async(r,i)=>{const{id:n}=i;if(Nt(i)){const{result:l}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:l});const y=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:y});const g=y.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});const p=l.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:p});const I=await this.client.core.crypto.generateSharedKey(g,p);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:I});const O=await this.client.core.relayer.subscribe(I);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:O}),await this.client.core.pairing.activate({topic:r})}else _t(i)&&(await this.client.proposal.delete(n,Je("USER_DISCONNECTED")),this.events.emit(Ue("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(r,i)=>{const{id:n,params:l}=i;try{this.isValidSessionSettleRequest(l);const{relay:y,controller:g,expiry:p,namespaces:I}=i.params,O={topic:r,relay:y,expiry:p,namespaces:I,acknowledged:!0,controller:g.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}};await this.sendResult(i.id,r,!0),this.events.emit(Ue("session_connect"),{session:O})}catch(y){await this.sendError(n,r,y),this.client.logger.error(y)}},this.onSessionSettleResponse=async(r,i)=>{const{id:n}=i;Nt(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Ue("session_approve",n),{})):_t(i)&&(await this.client.session.delete(r,Je("USER_DISCONNECTED")),this.events.emit(Ue("session_approve",n),{error:i.error}))},this.onSessionUpdateRequest=async(r,i)=>{const{params:n,id:l}=i;try{this.isValidUpdate(Mt({topic:r},n)),await this.client.session.update(r,{namespaces:n.namespaces}),await this.sendResult(l,r,!0),this.client.events.emit("session_update",{id:l,topic:r,params:n})}catch(y){await this.sendError(l,r,y),this.client.logger.error(y)}},this.onSessionUpdateResponse=(r,i)=>{const{id:n}=i;Nt(i)?this.events.emit(Ue("session_update",n),{}):_t(i)&&this.events.emit(Ue("session_update",n),{error:i.error})},this.onSessionExtendRequest=async(r,i)=>{const{id:n}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Ct(Gr)),await this.sendResult(n,r,!0),this.client.events.emit("session_extend",{id:n,topic:r})}catch(l){await this.sendError(n,r,l),this.client.logger.error(l)}},this.onSessionExtendResponse=(r,i)=>{const{id:n}=i;Nt(i)?this.events.emit(Ue("session_extend",n),{}):_t(i)&&this.events.emit(Ue("session_extend",n),{error:i.error})},this.onSessionPingRequest=async(r,i)=>{const{id:n}=i;try{this.isValidPing({topic:r}),await this.sendResult(n,r,!0),this.client.events.emit("session_ping",{id:n,topic:r})}catch(l){await this.sendError(n,r,l),this.client.logger.error(l)}},this.onSessionPingResponse=(r,i)=>{const{id:n}=i;setTimeout(()=>{Nt(i)?this.events.emit(Ue("session_ping",n),{}):_t(i)&&this.events.emit(Ue("session_ping",n),{error:i.error})},500)},this.onSessionDeleteRequest=async(r,i)=>{const{id:n}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),await this.sendResult(n,r,!0),await this.deleteSession(r),this.client.events.emit("session_delete",{id:n,topic:r})}catch(l){await this.sendError(n,r,l),this.client.logger.error(l)}},this.onSessionRequest=async(r,i)=>{const{id:n,params:l}=i;try{this.isValidRequest(Mt({topic:r},l)),await this.setPendingSessionRequest({id:n,topic:r,params:l}),this.client.events.emit("session_request",{id:n,topic:r,params:l})}catch(y){await this.sendError(n,r,y),this.client.logger.error(y)}},this.onSessionRequestResponse=(r,i)=>{const{id:n}=i;Nt(i)?this.events.emit(Ue("session_request",n),{result:i.result}):_t(i)&&this.events.emit(Ue("session_request",n),{error:i.error})},this.onSessionEventRequest=async(r,i)=>{const{id:n,params:l}=i;try{this.isValidEmit(Mt({topic:r},l)),this.client.events.emit("session_event",{id:n,topic:r,params:l})}catch(y){await this.sendError(n,r,y),this.client.logger.error(y)}},this.isValidConnect=async r=>{if(!nt(r)){const{message:g}=J("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(g)}const{pairingTopic:i,requiredNamespaces:n,relays:l}=r;gt(i)||await this.isValidPairingTopic(i);const y=jh(n,"connect()");if(y)throw new Error(y.message);if(!Lh(l,!0)){const{message:g}=J("MISSING_OR_INVALID",`connect() relays: ${l}`);throw new Error(g)}},this.isValidApprove=async r=>{if(!nt(r))throw new Error(J("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:n,relayProtocol:l}=r;await this.isValidProposalId(i);const y=this.client.proposal.get(i),g=Ei(n,"approve()");if(g)throw new Error(g.message);const p=ds(y.requiredNamespaces,n,"update()");if(p)throw new Error(p.message);if(!Ze(l,!0)){const{message:I}=J("MISSING_OR_INVALID",`approve() relayProtocol: ${l}`);throw new Error(I)}},this.isValidReject=async r=>{if(!nt(r)){const{message:l}=J("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(l)}const{id:i,reason:n}=r;if(await this.isValidProposalId(i),!$h(n)){const{message:l}=J("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(l)}},this.isValidSessionSettleRequest=r=>{if(!nt(r)){const{message:I}=J("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(I)}const{relay:i,controller:n,namespaces:l,expiry:y}=r;if(!$o(i)){const{message:I}=J("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(I)}const g=Rh(n,"onSessionSettleRequest()");if(g)throw new Error(g.message);const p=Ei(l,"onSessionSettleRequest()");if(p)throw new Error(p.message);if($t(y)){const{message:I}=J("EXPIRED","onSessionSettleRequest()");throw new Error(I)}},this.isValidUpdate=async r=>{if(!nt(r)){const{message:p}=J("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(p)}const{topic:i,namespaces:n}=r;await this.isValidSessionTopic(i);const l=this.client.session.get(i),y=Ei(n,"update()");if(y)throw new Error(y.message);const g=ds(l.requiredNamespaces,n,"update()");if(g)throw new Error(g.message)},this.isValidExtend=async r=>{if(!nt(r)){const{message:n}=J("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionTopic(i)},this.isValidRequest=async r=>{if(!nt(r)){const{message:g}=J("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(g)}const{topic:i,request:n,chainId:l}=r;await this.isValidSessionTopic(i);const{namespaces:y}=this.client.session.get(i);if(!ls(y,l)){const{message:g}=J("MISSING_OR_INVALID",`request() chainId: ${l}`);throw new Error(g)}if(!zh(n)){const{message:g}=J("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(g)}if(!Kh(y,l,n.method)){const{message:g}=J("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(g)}},this.isValidRespond=async r=>{if(!nt(r)){const{message:l}=J("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(l)}const{topic:i,response:n}=r;if(await this.isValidSessionTopic(i),!Hh(n)){const{message:l}=J("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(l)}},this.isValidPing=async r=>{if(!nt(r)){const{message:n}=J("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async r=>{if(!nt(r)){const{message:g}=J("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(g)}const{topic:i,event:n,chainId:l}=r;await this.isValidSessionTopic(i);const{namespaces:y}=this.client.session.get(i);if(!ls(y,l)){const{message:g}=J("MISSING_OR_INVALID",`emit() chainId: ${l}`);throw new Error(g)}if(!qh(n)){const{message:g}=J("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(g)}if(!Bh(y,l,n.name)){const{message:g}=J("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(g)}},this.isValidDisconnect=async r=>{if(!nt(r)){const{message:n}=J("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}}isInitialized(){if(!this.initialized){const{message:e}=J("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(st.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const n=await this.client.core.crypto.decode(r,i);tn(n)?(this.client.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):rn(n)&&(await this.client.core.history.resolve(n),this.onRelayEventResponse({topic:r,payload:n}))})}registerExpirerEvents(){this.client.core.expirer.on(dt.expired,async e=>{const{topic:r,id:i}=Uo(e.target);if(i&&this.getPendingSessionRequests()[i])return await this.deletePendingSessionRequest(i,J("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):i&&await this.deleteProposal(i,!0)})}isValidPairingTopic(e){if(!Ze(e,!1)){const{message:r}=J("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=J("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if($t(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=J("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!Ze(e,!1)){const{message:r}=J("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(!this.client.session.keys.includes(e)){const{message:r}=J("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if($t(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:r}=J("EXPIRED",`session topic: ${e}`);throw new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Ze(e,!1)){const{message:r}=J("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=J("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!Mh(e)){const{message:r}=J("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=J("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if($t(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:r}=J("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class Wg extends ci{constructor(e,r){super(e,r,Lg,an),this.core=e,this.logger=r}}class kg extends ci{constructor(e,r){super(e,r,Mg,an),this.core=e,this.logger=r}}class Yg extends ci{constructor(e,r){super(e,r,zg,an),this.core=e,this.logger=r}}let Jg=class aa extends Vc{constructor(e){super(e),this.protocol=na,this.version=sa,this.name=Oi.name,this.events=new ct.EventEmitter,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(n){throw this.logger.error(n.message),n}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(n){throw this.logger.error(n.message),n}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(n){throw this.logger.error(n.message),n}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(n){throw this.logger.error(n.message),n}},this.update=async i=>{try{return await this.engine.update(i)}catch(n){throw this.logger.error(n.message),n}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(n){throw this.logger.error(n.message),n}},this.request=async i=>{try{return await this.engine.request(i)}catch(n){throw this.logger.error(n.message),n}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(n){throw this.logger.error(n.message),n}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(n){throw this.logger.error(n.message),n}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(n){throw this.logger.error(n.message),n}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(n){throw this.logger.error(n.message),n}},this.find=i=>{try{return this.engine.find(i)}catch(n){throw this.logger.error(n.message),n}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=(e==null?void 0:e.name)||Oi.name,this.metadata=(e==null?void 0:e.metadata)||ah();const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Tr(De.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Oi.logger}));this.core=(e==null?void 0:e.core)||new jg(e),this.logger=De.generateChildLogger(r,this.name),this.session=new kg(this.core,this.logger),this.proposal=new Wg(this.core,this.logger),this.pendingRequest=new Yg(this.core,this.logger),this.engine=new Gg(this)}static async init(e){const r=new aa(e);return await r.initialize(),r}get context(){return De.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.logger.info("SignClient Initilization Success")}catch(e){throw this.logger.info("SignClient Initilization Failure"),this.logger.error(e.message),e}}};var Oe={};Object.defineProperty(Oe,"__esModule",{value:!0});Oe.getLocalStorage=Oe.getLocalStorageOrThrow=Oe.getCrypto=Oe.getCryptoOrThrow=Oe.getLocation=Oe.getLocationOrThrow=Oe.getNavigator=Oe.getNavigatorOrThrow=Oe.getDocument=Oe.getDocumentOrThrow=Oe.getFromWindowOrThrow=Oe.getFromWindow=void 0;function er(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}Oe.getFromWindow=er;function ur(t){const e=er(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}Oe.getFromWindowOrThrow=ur;function Xg(){return ur("document")}Oe.getDocumentOrThrow=Xg;function Zg(){return er("document")}Oe.getDocument=Zg;function Qg(){return ur("navigator")}Oe.getNavigatorOrThrow=Qg;function ep(){return er("navigator")}Oe.getNavigator=ep;function tp(){return ur("location")}Oe.getLocationOrThrow=tp;function rp(){return er("location")}Oe.getLocation=rp;function ip(){return ur("crypto")}Oe.getCryptoOrThrow=ip;function np(){return er("crypto")}Oe.getCrypto=np;function sp(){return ur("localStorage")}Oe.getLocalStorageOrThrow=sp;function op(){return er("localStorage")}Oe.getLocalStorage=op;var cn={};Object.defineProperty(cn,"__esModule",{value:!0});cn.getWindowMetadata=void 0;const Hs=Oe;function ap(){let t,e;try{t=Hs.getDocumentOrThrow(),e=Hs.getLocationOrThrow()}catch{return null}function r(){const A=t.getElementsByTagName("link"),z=[];for(let C=0;C<A.length;C++){const P=A[C],q=P.getAttribute("rel");if(q&&q.toLowerCase().indexOf("icon")>-1){const $=P.getAttribute("href");if($)if($.toLowerCase().indexOf("https:")===-1&&$.toLowerCase().indexOf("http:")===-1&&$.indexOf("//")!==0){let G=e.protocol+"//"+e.host;if($.indexOf("/")===0)G+=$;else{const b=e.pathname.split("/");b.pop();const D=b.join("/");G+=D+"/"+$}z.push(G)}else if($.indexOf("//")===0){const G=e.protocol+$;z.push(G)}else z.push($)}}return z}function i(...A){const z=t.getElementsByTagName("meta");for(let C=0;C<z.length;C++){const P=z[C],q=["itemprop","property","name"].map($=>P.getAttribute($)).filter($=>$?A.includes($):!1);if(q.length&&q){const $=P.getAttribute("content");if($)return $}}return""}function n(){let A=i("name","og:site_name","og:title","twitter:title");return A||(A=t.title),A}function l(){return i("description","og:description","twitter:description","keywords")}const y=n(),g=l(),p=e.origin,I=r();return{description:g,url:p,icons:I,name:y}}cn.getWindowMetadata=ap;var cp={};(function(t){const e=Js,r=Xs,i=Ys,n=xo,l=b=>b==null,y=Symbol("encodeFragmentIdentifier");function g(b){switch(b.arrayFormat){case"index":return D=>(m,w)=>{const v=m.length;return w===void 0||b.skipNull&&w===null||b.skipEmptyString&&w===""?m:w===null?[...m,[O(D,b),"[",v,"]"].join("")]:[...m,[O(D,b),"[",O(v,b),"]=",O(w,b)].join("")]};case"bracket":return D=>(m,w)=>w===void 0||b.skipNull&&w===null||b.skipEmptyString&&w===""?m:w===null?[...m,[O(D,b),"[]"].join("")]:[...m,[O(D,b),"[]=",O(w,b)].join("")];case"colon-list-separator":return D=>(m,w)=>w===void 0||b.skipNull&&w===null||b.skipEmptyString&&w===""?m:w===null?[...m,[O(D,b),":list="].join("")]:[...m,[O(D,b),":list=",O(w,b)].join("")];case"comma":case"separator":case"bracket-separator":{const D=b.arrayFormat==="bracket-separator"?"[]=":"=";return m=>(w,v)=>v===void 0||b.skipNull&&v===null||b.skipEmptyString&&v===""?w:(v=v===null?"":v,w.length===0?[[O(m,b),D,O(v,b)].join("")]:[[w,O(v,b)].join(b.arrayFormatSeparator)])}default:return D=>(m,w)=>w===void 0||b.skipNull&&w===null||b.skipEmptyString&&w===""?m:w===null?[...m,O(D,b)]:[...m,[O(D,b),"=",O(w,b)].join("")]}}function p(b){let D;switch(b.arrayFormat){case"index":return(m,w,v)=>{if(D=/\[(\d*)\]$/.exec(m),m=m.replace(/\[\d*\]$/,""),!D){v[m]=w;return}v[m]===void 0&&(v[m]={}),v[m][D[1]]=w};case"bracket":return(m,w,v)=>{if(D=/(\[\])$/.exec(m),m=m.replace(/\[\]$/,""),!D){v[m]=w;return}if(v[m]===void 0){v[m]=[w];return}v[m]=[].concat(v[m],w)};case"colon-list-separator":return(m,w,v)=>{if(D=/(:list)$/.exec(m),m=m.replace(/:list$/,""),!D){v[m]=w;return}if(v[m]===void 0){v[m]=[w];return}v[m]=[].concat(v[m],w)};case"comma":case"separator":return(m,w,v)=>{const s=typeof w=="string"&&w.includes(b.arrayFormatSeparator),h=typeof w=="string"&&!s&&A(w,b).includes(b.arrayFormatSeparator);w=h?A(w,b):w;const H=s||h?w.split(b.arrayFormatSeparator).map(o=>A(o,b)):w===null?w:A(w,b);v[m]=H};case"bracket-separator":return(m,w,v)=>{const s=/(\[\])$/.test(m);if(m=m.replace(/\[\]$/,""),!s){v[m]=w&&A(w,b);return}const h=w===null?[]:w.split(b.arrayFormatSeparator).map(H=>A(H,b));if(v[m]===void 0){v[m]=h;return}v[m]=[].concat(v[m],h)};default:return(m,w,v)=>{if(v[m]===void 0){v[m]=w;return}v[m]=[].concat(v[m],w)}}}function I(b){if(typeof b!="string"||b.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function O(b,D){return D.encode?D.strict?e(b):encodeURIComponent(b):b}function A(b,D){return D.decode?r(b):b}function z(b){return Array.isArray(b)?b.sort():typeof b=="object"?z(Object.keys(b)).sort((D,m)=>Number(D)-Number(m)).map(D=>b[D]):b}function C(b){const D=b.indexOf("#");return D!==-1&&(b=b.slice(0,D)),b}function P(b){let D="";const m=b.indexOf("#");return m!==-1&&(D=b.slice(m)),D}function q(b){b=C(b);const D=b.indexOf("?");return D===-1?"":b.slice(D+1)}function $(b,D){return D.parseNumbers&&!Number.isNaN(Number(b))&&typeof b=="string"&&b.trim()!==""?b=Number(b):D.parseBooleans&&b!==null&&(b.toLowerCase()==="true"||b.toLowerCase()==="false")&&(b=b.toLowerCase()==="true"),b}function G(b,D){D=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},D),I(D.arrayFormatSeparator);const m=p(D),w=Object.create(null);if(typeof b!="string"||(b=b.trim().replace(/^[?#&]/,""),!b))return w;for(const v of b.split("&")){if(v==="")continue;let[s,h]=i(D.decode?v.replace(/\+/g," "):v,"=");h=h===void 0?null:["comma","separator","bracket-separator"].includes(D.arrayFormat)?h:A(h,D),m(A(s,D),h,w)}for(const v of Object.keys(w)){const s=w[v];if(typeof s=="object"&&s!==null)for(const h of Object.keys(s))s[h]=$(s[h],D);else w[v]=$(s,D)}return D.sort===!1?w:(D.sort===!0?Object.keys(w).sort():Object.keys(w).sort(D.sort)).reduce((v,s)=>{const h=w[s];return Boolean(h)&&typeof h=="object"&&!Array.isArray(h)?v[s]=z(h):v[s]=h,v},Object.create(null))}t.extract=q,t.parse=G,t.stringify=(b,D)=>{if(!b)return"";D=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},D),I(D.arrayFormatSeparator);const m=h=>D.skipNull&&l(b[h])||D.skipEmptyString&&b[h]==="",w=g(D),v={};for(const h of Object.keys(b))m(h)||(v[h]=b[h]);const s=Object.keys(v);return D.sort!==!1&&s.sort(D.sort),s.map(h=>{const H=b[h];return H===void 0?"":H===null?O(h,D):Array.isArray(H)?H.length===0&&D.arrayFormat==="bracket-separator"?O(h,D)+"[]":H.reduce(w(h),[]).join("&"):O(h,D)+"="+O(H,D)}).filter(h=>h.length>0).join("&")},t.parseUrl=(b,D)=>{D=Object.assign({decode:!0},D);const[m,w]=i(b,"#");return Object.assign({url:m.split("?")[0]||"",query:G(q(b),D)},D&&D.parseFragmentIdentifier&&w?{fragmentIdentifier:A(w,D)}:{})},t.stringifyUrl=(b,D)=>{D=Object.assign({encode:!0,strict:!0,[y]:!0},D);const m=C(b.url).split("?")[0]||"",w=t.extract(b.url),v=t.parse(w,{sort:!1}),s=Object.assign(v,b.query);let h=t.stringify(s,D);h&&(h=`?${h}`);let H=P(b.url);return b.fragmentIdentifier&&(H=`#${D[y]?O(b.fragmentIdentifier,D):b.fragmentIdentifier}`),`${m}${h}${H}`},t.pick=(b,D,m)=>{m=Object.assign({parseFragmentIdentifier:!0,[y]:!1},m);const{url:w,query:v,fragmentIdentifier:s}=t.parseUrl(b,m);return t.stringifyUrl({url:w,query:n(v,D),fragmentIdentifier:s},m)},t.exclude=(b,D,m)=>{const w=Array.isArray(D)?v=>!D.includes(v):(v,s)=>!D(v,s);return t.pick(b,w,m)}})(cp);const up={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function fp(t,e){const{message:r,code:i}=up[t];return{message:e?`${r} ${e}`:r,code:i}}const hp={Accept:"application/json","Content-Type":"application/json"},lp="POST",qs={headers:hp,method:lp},Ks=10;class ca{constructor(e){if(this.url=e,this.events=new ct.EventEmitter,this.isAvailable=!1,this.registering=!1,!_s(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e,r){this.isAvailable||await this.register();try{const i=Or(e),l=await(await wn(this.url,Object.assign(Object.assign({},qs),{body:i}))).json();this.onPayload({data:l})}catch(i){this.onError(e.id,i)}}async register(e=this.url){if(!_s(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,n)=>{this.events.once("register_error",l=>{this.resetMaxListeners(),n(l)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return n(new Error("HTTP connection is missing or invalid"));i()})})}this.url=e,this.registering=!0;try{const r=Or({id:1,jsonrpc:"2.0",method:"test",params:[]});await wn(e,Object.assign(Object.assign({},qs),{body:r})),this.onOpen()}catch(r){const i=this.parseError(r);throw this.events.emit("register_error",i),this.onClose(),i}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Mi(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),n=i.message||i.toString(),l=oi(e,n);this.events.emit("payload",l)}parseError(e,r=this.url){return qo(e,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Ks&&this.events.setMaxListeners(Ks)}}function dp(t){var e;const r=(e=t[Object.keys(t)[0]])==null?void 0:e.chains[0];return[r.split(":")[0],r.split(":")[1]]}function Zr(t,e){let r;return e.rpcMap&&(r=e.rpcMap[gp([t])]),r}function gp(t){return Number(t[0].split(":")[1])}class pp{constructor(e){this.name="eip155",this.namespace=e.namespace,this.client=e.client,this.events=e.events,this.httpProviders=this.createHttpProviders(),this.chainId=this.getDefaultChainId()}async request(e){var r;switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":{const i=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";return this.setDefaultChain(parseInt(i,16).toString()),null}case"eth_chainId":return this.getDefaultChainId()}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){if(this.chainId=parseInt(e),!this.httpProviders[e]){const i=r||Zr(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}createHttpProvider(e,r){const i=r||Zr(e,this.namespace);return typeof i>"u"?void 0:new nn(new ca(i))}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return parseInt(e.split(":")[1])}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}}class yp{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const i=r||Zr(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Zr(e,this.namespace);return typeof i>"u"?void 0:new nn(new ca(i))}}const Bs="error",_p="wss://relay.walletconnect.com",bp="wc",mp="universal_provider",Vs=`${bp}@${2}:${mp}:`;var wp=Object.defineProperty,vp=Object.defineProperties,Ep=Object.getOwnPropertyDescriptors,Gs=Object.getOwnPropertySymbols,Dp=Object.prototype.hasOwnProperty,Sp=Object.prototype.propertyIsEnumerable,Ws=(t,e,r)=>e in t?wp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ks=(t,e)=>{for(var r in e||(e={}))Dp.call(e,r)&&Ws(t,r,e[r]);if(Gs)for(var r of Gs(e))Sp.call(e,r)&&Ws(t,r,e[r]);return t},Op=(t,e)=>vp(t,Ep(e));class un{constructor(e){this.events=new ct,this.rpcProviders={},this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Tr(De.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Bs}))}static async init(e){const r=new un(e);return await r.initialize(),r}async request(e,r){var i;const[n,l]=this.validateChain(r);return await this.getProvider(n).request({request:ks({},e),chainId:`${n}:${l}`,topic:(i=this.session)==null?void 0:i.topic})}sendAsync(e,r,i){this.request(e,i).then(n=>r(null,n)).catch(n=>r(n,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return await this.request({method:"eth_requestAccounts",params:[]})}async disconnect(){if(!this.client)throw new Error("Sign Client not initialized");await this.client.disconnect({topic:this.session.topic,reason:fp("USER_DISCONNECTED")})}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");return this.setNamespaces(e.namespaces),this.createProviders(),e.skipPairing===!0?void 0:await this.pair(e.pairingTopic)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){const{uri:r,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces});return r&&(this.uri=r,this.events.emit("display_uri",r)),this.session=await i(),this.onSessionUpdate(),this.session}setDefaultChain(e,r){const[i,n]=this.validateChain(e);this.getProvider(i).setDefaultChain(n,r)}async checkStorage(){if(this.namespaces=await this.client.core.storage.getItem(`${Vs}/namespaces`),this.namespaces&&this.createProviders(),this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.onSessionUpdate()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await Jg.init({logger:this.providerOpts.logger||Bs,relayUrl:this.providerOpts.relayUrl||_p,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");Object.keys(this.namespaces).forEach(e=>{switch(e){case"eip155":this.rpcProviders[e]=new pp({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"solana":this.rpcProviders[e]=new yp({client:this.client,namespace:this.namespaces[e],events:this.events});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var i;const{namespaces:n}=r,l=(i=this.client)==null?void 0:i.session.get(e);this.session=Op(ks({},l),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",()=>{this.events.emit("session_delete")})}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>this.getProvider(e).updateNamespace(this.session.namespaces[e]))}setNamespaces(e){if(!e||!Object.keys(e).length)throw new Error("Namespaces must be not empty");this.client.core.storage.setItem(`${Vs}/namespaces`,e),this.namespaces=e}validateChain(e){const[r,i]=(e==null?void 0:e.split(":"))||["",""];if(r&&!Object.keys(this.namespaces).includes(r))throw new Error(`Invalid namespace: ${r}`);return!r||!i?dp(this.namespaces):[r,i]}}const jp=un;export{jp as UniversalProvider,un as default};
//# sourceMappingURL=index.es-ec052fef.js.map
